{"fav_nums": 3, "praise_nums": "1", "title": "Linux 下各文件夹的结构说明及用途介绍", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xningge/p/8331631.html\">小宁哥</a>   </div><p><strong>linux</strong><strong>下各文件</strong><strong>夹</strong><strong>的</strong><strong>结</strong><strong>构</strong><strong>说</strong><strong>明及用途介</strong><strong>绍</strong><strong>：</strong></p>\n<p><strong>/bin</strong><strong>：</strong>二进制可执行命令。<br>\n<strong>/dev</strong><strong>：</strong>设备特殊文件。<br>\n<strong>/etc</strong><strong>：</strong>系统管理和配置文件。<br>\n<strong>/etc/rc.d</strong><strong>：</strong>启动的配 置文件和脚本。<br>\n<strong>/home</strong><strong>：</strong>用户主目录的基点，比如用户user的主目录就是/home/user，可以用~user表示。<br>\n<strong>/lib</strong><strong>：</strong>标准程序设计库，又 叫动态链接共享库，作用类似windows里的.dll文件。<br>\n<strong>/sbin</strong><strong>：</strong>系统管理命令，这 里存放的是系统管理员使用的管理程序。<br>\n<strong>/tmp</strong><strong>：</strong>公用的临时文件存储 点。<br>\n<strong>/root</strong><strong>：</strong>系统管理员的主目 录。<br>\n<strong>/mnt</strong><strong>：</strong>系统提供这个目录是 让用户临时挂载其他的文件系统。<br>\n<strong>/lost+found</strong><strong>：</strong>这个 目录平时是空的，系统非正常关机而留下“无家可归”的文件就在这里。<br>\n<strong>/proc</strong><strong>：</strong>虚拟的目录，是系 统内存的映射。可直接访问这个目录来获取系统信息。<br>\n<strong>/var</strong><strong>：</strong>某些大文件的溢出 区，比方说各种服务的日志文件。<br>\n<strong>/usr</strong><strong>：</strong>最庞大的目录，要用 到的应用程序和文件几乎都在这个目录。<strong>其中包含</strong><strong>：</strong><br>\n<strong>/usr/x11r6</strong><strong>：</strong>存放x window的目录。<br>\n<strong>/usr/bin</strong><strong>：</strong>众多的应用程序。<br>\n<strong>/usr/sbin</strong><strong>：</strong>超级用户的一些管理程序。<br>\n<strong>/usr/doc</strong><strong>：</strong>linux文档。<br>\n<strong>/usr/include</strong><strong>：</strong>linux下开发和编译应用程序所需要的头文件。<br>\n<strong>/usr/lib</strong><strong>：</strong>常用的动态链接库和软件包的配置文件。<br>\n<strong>/usr/man</strong><strong>：</strong>帮助文档。<br>\n<strong>/usr/src</strong><strong>：</strong>源代码，linux内核的源代码就放在/usr/src/linux 里。<br>\n<strong>/usr/local/bin</strong><strong>：</strong>本地增加的命令。<br>\n<strong>/usr/local/lib</strong><strong>：</strong>本地增加的库根文件系统。</p>\n<p>通常情况下，根文件系统所占空间一般应该比较小，因为其中的绝大部分文件都不需要经常改动，而且包括严格的文件和一个小的 不经常改变的文件系统不容易损坏。除了可能的一个叫<strong>/vmlinuz</strong>标准的系统引导映像之外，根目录一般不含任何文 件。所有其他文件在根文件系统的子目录中。<br>\n<strong>1. /bin</strong><strong>目</strong><strong>录</strong><br>\n<strong>/bin</strong>目录包含了引导启动所需的命令或普通用户可能用的命令(可能在引导启动后)。这些命 令都是二进制文件的可执行程序(bin是binary的简称)，多是系统中重要的系统文件。<br>\n<strong>2. /sbin</strong><strong>目</strong><strong>录</strong><br>\n<strong>/sbin</strong>目录类似<strong>/bin</strong> ，也用于存储二进制文件。因为其中的大部分文件多是系统管理员使用的基本的系统程序，所以虽然普通用户必要且允许时可以使用，但一般不给普通用户使 用。<br>\n<strong>3. /etc</strong><strong>目</strong><strong>录</strong><br>\n<strong>/etc</strong>目录存放着各种系统配置文件，其中包括了用户信息文件<strong>/etc/passwd</strong>， 系统初始化文件<strong>/etc/rc</strong>等。linux正是靠这些文件才得以正常地运行。<br>\n<strong>4. /root</strong><strong>目</strong><strong>录</strong><br>\n/root目录是超级用户的目录。<br>\n<strong>5. /lib</strong><strong>目</strong><strong>录</strong><br>\n<strong>/lib</strong>目录是根文件系统上的程序所需的共享库，存放了根文件系统程序运行所需的共享文件。 这些文件包含了可被许多程序共享的代码，以避免每个程序都包含有相同的子程序的副本，故可以使得可执行文件变得更小，节省空间。<br>\n<strong>6. /lib/modules</strong><strong>目</strong><strong>录</strong><br>\n<strong>/lib/modules</strong>目录包含系统核心可加载各种模块，尤其是那些在恢复损坏的系统时重 新引导系统所需的模块(例如网络和文件系统驱动)。<br>\n<strong>7. /dev</strong><strong>目</strong><strong>录</strong><br>\n<strong>/dev</strong>目录存放了设备文件，即设备驱动程序，用户通过这些文件访问外部设备。比如，用户可 以通过访问<strong>/dev/mouse</strong>来访问鼠标的输入，就像访问其他文件一样。<br>\n<strong>8. /tmp</strong><strong>目</strong><strong>录</strong><br>\n<strong>/tmp</strong>目录存放程序在运行时产生的信息和数据。但在引导启动后，运行的程序最好使用<strong>/var/tmp</strong>来 代替<strong>/tmp</strong>，因为前者可能拥有一个更大的磁盘空间。<br>\n<strong>9. /boot</strong><strong>目</strong><strong>录</strong><br>\n<strong>/boot</strong>目录存放引导加载器(bootstrap loader)使用的文件，如lilo，核心映像也经常放在这里，而不是放在根目录中。但是如果有许多核心映像，这个目录就可能变得很大，这时使用单独的 文件系统会更好一些。还有一点要注意的是，要确保核心映像必须在ide硬盘的前1024柱面内。<br>\n<strong>10. /mnt</strong><strong>目</strong><strong>录</strong><br>\n<strong>/mnt</strong>目录是系统管理员临时安装(mount)文件系统的安装点。程序并不自动支持安装到<strong>/mnt</strong> 。<strong>/mnt</strong>下面可以分为许多子目录，例如<strong>/mnt/dosa</strong>可能是使用 msdos文件系统的软驱，而<strong>/mnt/exta</strong>可能是使用ext2文件系统的软驱，<strong>/mnt/cdrom</strong>光 驱等等。<br>\n<strong>11. /proc, /usr, /var, /home</strong><strong>目</strong><strong>录</strong><br>\n其他文件系统的安装点。</p>\n<p>目录树可以分为小的部分，每个部分可以在自己的磁盘或分区上。主要部分是根、/usr 、/var 和 /home 文件系统。每个部分有不同的目的。<br>\n每台机器都有根文件系统，它包含系统引导和使其他文件系统得以mount所必要的文件，根文件系统应该有单用户状态所必须的足够的内容。还应该包括修复损坏 系统、恢复备份等的工具。<br>\n/usr 文件系统包含所有命令、库、man页和其他一般操作中所需的不改变的文件。 /usr 不应该有 一般使用中要修改的文件。这样允许此文件系统中的文件通过网络共享，这样可以更有效，因为这样节省了磁盘空间(/usr 很容易是数百兆)，且易于管理 (当升级应用时，只有主/usr 需要改变，而无须改变每台机器) 即使此文件系统在本地盘上，也可以只读mount，以减少系统崩溃时文件系统的损 坏。<br>\n/var 文件系统包含会改变的文件，比如spool目录(mail、news、打印机等用的)， log文件、 formatted manual pages和暂存文件。传统上/var 的所有东西曾在 /usr 下的某个地方，但这样/usr 就不可能只读安装 了。<br>\n/home 文件系统包含用户家目录，即系统上的所有实际数据。一个大的/home 可能要分为若干文件系统，需要在 /home 下加一级名字，如/home/students 、/home/staff 等。</p>\n<p>下面详细介绍：<br>\n<strong>/etc</strong><strong>文件系</strong><strong>统</strong><strong><br>\n</strong><strong>/etc</strong>目录包含各种系统配置文件，下面说明其中的一些。其他的你应该知道它们属于哪个程序， 并阅读该程序的man页。许多网络配置文件也在/etc中。<br>\n<strong>1. /etc/rc</strong><strong>或/etc/rc.d或/etc/rc?.d：</strong>启动、或改变运行级时运 行的脚本或脚本的目录。<br>\n<strong>2. /etc/passwd</strong><strong>：</strong>用户数据库，其中的域给出了用户名、真实姓名、用户起始目 录、加密口令和用户的其他信息。<br>\n<strong>3. /etc/fdprm</strong><strong>：</strong>软盘参数表，用以说明不同的软盘格式。可用setfdprm进 行设置。更多的信息见setfdprm的帮助页。<br>\n<strong>4. /etc/fstab</strong><strong>：</strong>指定启动时需要自动安装的文件系统列表。也包括用swapon -a启用的swap区的信息。<br>\n<strong>5. /etc/group</strong><strong>：</strong>类似<strong>/etc/passwd</strong> ，但说明的不是用户信息而是组的信息。包括组的各种数据。<br>\n<strong>6. /etc/inittab</strong><strong>：</strong>init 的配置文件。<br>\n<strong>7. /etc/issue</strong><strong>：</strong>包括用户在登录提示符前的输出信息。通常包括系统的一段短说明 或欢迎信息。具体内容由系统管理员确定。<br>\n<strong>8. /etc/magic</strong><strong>：</strong>“file”的配置文件。包含不同文件格式的说 明，“file”基于它猜测文件类型。<br>\n<strong>9. /etc/motd</strong><strong>：</strong>motd是message of the day的缩写，用户成功登录后自动输出。内容由系统管理员确定。<br>\n常用于通告信息，如计划关机时间的警告等。<br>\n<strong>10. /etc/mtab</strong><strong>：</strong>当前安装的文件系统列表。由脚本(scritp)初始化，并由 mount命令自动更新。当需要一个当前安装的文件系统的列表时使用(例如df命令)。<br>\n<strong>11. /etc/shadow</strong><strong>：</strong>在安装了影子(shadow)口令软件的系统上的影子口令 文件。影子口令文件将/etc/passwd文件中的加密口令移动到/etc/shadow中，而后者只对超级用户(root)可读。这使破译口令更困 难，以此增加系统的安全性。<br>\n<strong>12. /etc/login.defs</strong><strong>：</strong>login命令的配置文件。<br>\n<strong>13. /etc/printcap</strong><strong>：</strong>类似/etc/termcap ，但针对打印机。语法不同。<br>\n<strong>14. /etc/profile </strong><strong>、</strong><strong>/etc/csh.login</strong><strong>、</strong><strong>/etc/csh.cshrc</strong><strong>：</strong>登 录或启动时bourne或cshells执行的文件。这允许系统管理员为所有用户建立全局缺省环境。<br>\n<strong>15. /etc/securetty</strong><strong>：</strong>确认安全终端，即哪个终端允许超级用户(root) 登录。一般只列出虚拟控制台，这样就不可能(至少很困难)通过调制解调器(modem)或网络闯入系统并得到超级用户特权。<br>\n<strong>16. /etc/shells</strong><strong>：</strong>列出可以使用的shell。chsh命令允许用户在本文件 指定范围内改变登录的shell。提供一<br>\n台机器ftp服务的服务进程ftpd检查用户shell是否列在<strong>/etc/shells</strong>文件 中，如果不是，将不允许该用户登录。<br>\n<strong>17. /etc/termcap</strong><strong>：</strong>终端性能数据库。说明不同的终端用什么“转义序列”控 制。写程序时不直接输出转义<br>\n序列(这样只能工作于特定品牌的终端)，而是从<strong>/etc/termcap</strong>中查找要做的工作的 正确序列。这样，多数的程序可以在多数终端上运行。<br>\n<strong>/dev</strong><strong>文件系</strong><strong>统</strong><strong><br>\n<strong>/dev</strong></strong>目录包括所有设备的设备文件。设备文件用特定的约定命名，这在设备列表中说明。设备文件在安装时由系 统产生，以后可以用<strong>/dev/makedev</strong>描述。/dev/makedev.local 是系统管理员为本地设备文件(或连接)写的描述文稿(即如一些非标准设备驱动不是标准makedev 的一部分)。下面简要介绍<strong>/dev</strong>下 一些常用文件。<br>\n<strong>1. /dev/console</strong><strong>：</strong>系统控制台，也就是直接和系统连接的监视器。<br>\n<strong>2. /dev/hd</strong><strong>：</strong>ide硬盘驱动程序接口。如：/dev/hda指的是第一个硬 盘，had1则是指<strong>/dev/hda</strong>的第一个分区。如系统中有其他的硬盘，则依次为<strong>/dev /hdb</strong><strong>、/dev/hdc、. . . . .</strong> .；如有多个分区则依次为hda1、hda2 . . . . . .<br>\n<strong>3. /dev/sd</strong><strong>：</strong>scsi磁盘驱动程序接口。如系统有scsi硬盘，就不会访问<strong>/dev/had</strong>， 而会访问<strong>/dev/sda</strong>。<br>\n<strong>4. /dev/fd</strong><strong>：</strong>软驱设备驱动程序。如<strong>：/dev/fd0</strong>指 系统的第一个软盘，也就是通常所说的a盘<strong>，/dev/fd1</strong>指第二个软盘，. . . . . .而<strong>/dev/fd1 h1440</strong>则表示访问驱动器1中的4.5高密盘。<br>\n<strong>5. /dev/st</strong><strong>：</strong>scsi磁带驱动器驱动程序。<br>\n<strong>6. /dev/tty</strong><strong>：</strong>提供虚拟控制台支持。如<strong>：/dev/tty1</strong>指 的是系统的第一个虚拟控制台<strong>，/dev/tty2</strong>则是系统<br>\n的第二个虚拟控制台。<br>\n<strong>7. /dev/pty</strong><strong>：</strong>提供远程登陆伪终端支持。在进行telnet登录时就要用到<strong>/dev/pty</strong>设 备。<br>\n<strong>8. /dev/ttys</strong><strong>：</strong>计算机串行接口，对于dos来说就是“com1”口。<br>\n<strong>9. /dev/cua</strong><strong>：</strong>计算机串行接口，与调制解调器一起使用的设备。<br>\n<strong>10. /dev/null</strong><strong>：</strong>“黑洞”，所有写入该设备的信息都将消失。例如：当想要将屏幕 上的输出信息隐藏起来<br>\n时，只要将输出信息输入到/dev/null中即可。<br>\n<strong>/usr</strong><strong>文件系</strong><strong>统</strong><br>\n<strong>/usr</strong>是个很重要的目录，通常这一文件系统很大，因为所有程序安装在这里。<strong>/usr</strong>里 的所有文件一般来自linux发行版；本地安装的程序和其他东西在<strong>/usr/local</strong>下，因为这样可以在升级新版系 统或新发行版时无须重新安装全部程序。/usr目录下的许多内容是可选的，但这些功能会使用户使用系统更加有效。/usr可容纳许多大型的软件包和它们的 配置文件。下面列出一些重要的目录(一些不太重要的目录被省略了)。<br>\n<strong>1. /usr/x11r6</strong><strong>：</strong>包含x window系统的所有可执行程序、配置文件和支持文件。为简化x的开发和安装，x的文件没有集成到系统中。x window系统是一个功能强大的图形环境，提供了大量的图形工具程序。用户如果对microsoft windows比较熟悉的话，就不会对x window系统感到束手无策了。<br>\n<strong>2. /usr/x386</strong><strong>：</strong>类似<strong>/usr/x11r6</strong> ，但是是专门给x 11 release 5的。<br>\n<strong>3. /usr/bin</strong><strong>：</strong>集中了几乎所有用户命令，是系统的软件库。另有些命令在<strong>/bin</strong>或<strong>/usr/local/bin</strong>中。<br>\n<strong>4. /usr/sbin</strong><strong>：</strong>包括了根文件系统不必要的系统管理命令，例如多数服务程序。<br>\n<strong>5. /usr/man</strong><strong>、/usr/info、/usr/doc：</strong>这些目录包含所有手册页、 gnu信息文档和各种其他文档文件。每个联机手册的“节”都有两个子目录。例如：/usr/man/man1中包含联机手册第一节的源码(没有格式化的原 始文件)，/usr/man/cat1包含第一节已格式化的内容。联机手册分为以下九节：内部命令、系统调用、库函数、设备、文件格式、游戏、宏软件包、 系统管理和核心程序。<br>\n<strong>6. /usr/include</strong><strong>：</strong>包含了c语言的头文件，这些文件多以.h结尾，用来描述c 语言程序中用到的数据结构、<br>\n子过程和常量。为了保持一致性，这实际上应该放在<strong>/usr/lib</strong>下，但习惯上一直沿用了这 个名字。<br>\n<strong>7. /usr/lib</strong><strong>：</strong>包含了程序或子系统的不变的数据文件，包括一些site – wide配置文件。名字lib来源于库(library); 编程的原始库也存在<strong>/usr/lib</strong> 里。当编译程序时，程序便会和其中的库进行连接。也有许多程序把配置文件存入其中。<br>\n<strong>8. /usr/local</strong><strong>：</strong>本地安装的软件和其他文件放在这里。这与/usr很相似。用户 可能会在这发现一些比较大<br>\n的软件包，如tex、emacs等。</p>\n<p><strong>/var</strong><strong>文件系</strong><strong>统</strong><br>\n<strong>/var</strong>包含系统一般运行时要改变的数据。通常这些数据所在的目录的大小是要经常变化或扩充 的。原来/var目录中有些内容是在/usr中的，但为了保持/usr目录的相对稳定，就把那些需要经常改变的目录放到/var中了。每个系统是特定的， 即不通过网络与其他计算机共享。下面列出一些重要的目录(一些不太重要的目录省略了)。<br>\n<strong>1. /var/catman</strong><strong>：</strong>包括了格式化过的帮助(man)页。帮助页的源文件一般存在 /usr/man/catman中；有些man页可能有预格式化的版本，存在/usr/man/cat中。而其他的man页在第一次看时都需要格式化，格 式化完的版本存在/var/man中，这样其他人再看相同的页时就无须等待格式化了。(/<strong>var/catman</strong>经常被 清除，就像清除临时目录一样。)<br>\n<strong>2. /var/lib</strong><strong>：</strong>存放系统正常运行时要改变的文件。<br>\n<strong>3. /var/local</strong><strong>：</strong>存放<strong>/usr/local</strong>中 安装的程序的可变数据(即系统管理员安装的程序)。注意，如果必要，<br>\n即使本地安装的程序也会使用其他/var目录，例如/var/lock 。<br>\n<strong>4. /var/lock</strong><strong>：</strong>锁定文件。许多程序遵循在<strong>/var/lock</strong>中 产生一个锁定文件的约定，以用来支持他们正在<br>\n使用某个特定的设备或文件。其他程序注意到这个锁定文件时，就不会再使用这个设备或文件。<br>\n<strong>5. /var/log</strong><strong>：</strong>各种程序的日志(log)文件，尤其是login (<strong>/var/log/wtmplog</strong>纪 录所有到系统的登录和注销) 和syslog (/<strong>var/log/messages</strong> 纪录存储所有核心和系统程序信息)。/var/log 里的文件经常不确定地增长，应该定期清除。<br>\n<strong>6. /var/run</strong><strong>：</strong>保存在下一次系统引导前有效的关于系统的信息文件。例如<strong>，</strong><strong>/var/run/utmp</strong>包 含当前登录的用户的信息。<br>\n<strong>7. /var/spool</strong><strong>：</strong>放置“假脱机(spool)”程序的目录，如mail、 news、打印队列和其他队列工作的目录。每<br>\n个不同的spool在/var/spool下有自己的子目录，例如，用户的邮箱就存放在/var/spool/mail 中。<br>\n<strong>8. /var/tmp</strong><strong>：</strong>比/tmp允许更大的或需要存在较长时间的临时文件。注意系统管理 员可能不允许/var/tmp有很旧的文件。</p>\n<p><strong>/proc</strong><strong>文件系</strong><strong>统</strong><br>\n<strong>/proc</strong>文件系统是一个伪的文件系统，就是说它是一个实际上不存在的目录，因而这是一个非 常特殊的目录。它并不存在于某个磁盘上，而是由核心在内存中产生。这个目录用于提供关于系统的信息。下面说明一些最重要的文件和目录(/proc文件系统 在proc man页中有更详细的说明)。<br>\n<strong>1. /proc/x</strong><strong>：</strong>关于进程x的信息目录，这x是这一进程的标识号。每个进程在 /proc下有一个名为自己进程号的目录。<br>\n<strong>2. /proc/cpuinfo</strong><strong>：</strong>存放处理器(cpu)的信息，如cpu的类型、制造商、 型号和性能等。<br>\n<strong>3. /proc/devices</strong><strong>：</strong>当前运行的核心配置的设备驱动的列表。<br>\n<strong>4. /proc/dma</strong><strong>：</strong>显示当前使用的dma通道。<br>\n<strong>5. /proc/filesystems</strong><strong>：</strong>核心配置的文件系统信息。<br>\n<strong>6. /proc/interrupts</strong><strong>：</strong>显示被占用的中断信息和占用者的信息，以及被占用 的数量。<br>\n<strong>7. /proc/ioports</strong><strong>：</strong>当前使用的i/o端口。<br>\n<strong>8. /proc/kcore</strong><strong>：</strong>系统物理内存映像。与物理内存大小完全一样，然而实际上没有 占用这么多内存；它仅<br>\n仅是在程序访问它时才被创建。(注意：除非你把它拷贝到什么地方，否则/proc下没有任何东西占用任何磁盘空间。)<br>\n<strong>9. /proc/kmsg</strong><strong>：</strong>核心输出的消息。也会被送到syslog。<br>\n<strong>10. /proc/ksyms</strong><strong>：</strong>核心符号表。<br>\n<strong>11. /proc/loadavg</strong><strong>：</strong>系统“平均负载”；3个没有意义的指示器指出系统当前 的工作量。<br>\n<strong>12. /proc/meminfo</strong><strong>：</strong>各种存储器使用信息，包括物理内存和交换分区 (swap)。<br>\n<strong>13. /proc/modules</strong><strong>：</strong>存放当前加载了哪些核心模块信息。<br>\n<strong>14. /proc/net</strong><strong>：</strong>网络协议状态信息。<br>\n<strong>15. /proc/self</strong><strong>：</strong>存放到查看<strong>/proc</strong>的 程序的进程目录的符号连接。当2个进程查看<strong>/proc</strong>时，这将会是不同<br>\n的连接。这主要便于程序得到它自己的进程目录。<br>\n<strong>16. /proc/stat</strong><strong>：</strong>系统的不同状态，例如，系统启动后页面发生错误的次数。<br>\n<strong>17. /proc/uptime</strong><strong>：</strong>系统启动的时间长度。<br>\n<strong>18. /proc/version</strong><strong>：</strong>核心版本。</p>\n<p><strong>/usr/local</strong><strong>下一般是你安装软件的目录，这个目录就相当于在</strong><strong>windows</strong><strong>下的</strong><strong>programefiles</strong><strong>这个目录</strong><strong>  </strong></p>\n<p><strong>/opt</strong><strong>这个目录是一些大型软件的安装目录，或者是一些服务程序的安装目录</strong></p>\n<p><strong>举个例子：刚才装的测试版</strong><strong>firefox</strong><strong>，就可以装到</strong><strong>/opt/firefox_beta</strong><strong>目录下，</strong><strong>/opt/firefox_beta</strong><strong>目录下面就包含了运 行</strong><strong>firefox</strong><strong>所需要的所有文件、库、数据等等。要删除</strong><strong>firefox</strong><strong>的时候，你只需删除</strong><strong>/opt/firefox_beta</strong><strong>目录即可，非常简单。</strong></p>\n<p><strong>/usr/local</strong></p>\n<p><strong>This is where most manually installed (ie. outside of your package manager) software goes. It has the same structure as /usr. It is a good idea to leave /usr to your package manager and put any custom scripts and things into /usr/local, since nothing important normally lives in /usr/local.</strong></p>\n<p><strong>/usr/local</strong></p>\n<p><strong>这里主要存放那些手动安装的软件，即 不是通过“新立得”或</strong><strong>apt-get</strong><strong>安装的软件 。 它和</strong><strong>/usr</strong><strong>目录具有相类似的目录结构 。让软件包管理器来管理</strong><strong>/usr</strong><strong>目录，而把自定义的脚本</strong><strong>(scripts)</strong><strong>放到</strong><strong>/usr/local</strong><strong>目录下面，我想这应该是个不错的主意。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113519\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113519votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113519\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113519/", "comment_nums": 0, "create_date": "2018/01/23", "tags": "IT技术,Linux", "url_object_id": "a47bbcc27d28cbfe845e666d99ca70ba", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"fav_nums": 1, "praise_nums": "1", "title": "加密货币的本质", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/bef7a3f8ed2559670abdc6661cf18f97.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2018/01/cryptocurrency-tutorial.html\">阮一峰</a>   </div><p>去年，比特币暴涨，其他币也像雨后春笋一样冒出来，已经有1000多种了。</p>\n<p>很多人都在问，加密货币（cryptocurrency）的时代，真的来临了吗？将来会不会人类不再使用美元、人民币，改用加密货币？那么多品种，我应该使用哪一种币？要不要现在就去投资一些？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/bef7a3f8ed2559670abdc6661cf18f97.jpg\" alt=\"\"></p>\n<p>这些问题的答案，我也想知道，就花了很多时间查阅资料、研究协议。前两周发表的《<a href=\"http://blog.jobbole.com/113428/\" target=\"_blank\">区块链入门教程</a>》和《<a href=\"http://blog.jobbole.com/113429/\" target=\"_blank\">比特币入门教程</a>》，是我的学习心得。但是，那两篇教程主要介绍基本概念、探讨协议的可行性，没回答一个根本的问题：加密货币到底是什么？</p>\n<p>下面就是我对这个问题的思考。阅读之前，如果你已经了解区块链和比特币，那很好；如果不了解，也没关系，本文不涉及技术，只讨论最基本的原理。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/fd3ad3b10d7062c58d25e1ac53b7bdab.jpg\" alt=\"\"></p>\n<h2>一、钱是什么？</h2>\n<p>我们都知道，人民币是钱，美元是钱，金银财宝是钱。我问一个问题，它们为什么能成为钱？</p>\n<p>你可能回答，因为它们有价值，或者是价值的代表。但是，有价值的东西多了，为什么只有这些品种成为了钱？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/52ba95f9ee0be605e00dc85475d14fc4.jpg\" alt=\"\"></p>\n<p>答案很容易想到，因为人们普遍相信（认同）它们的价值，其他东西的价值难以得到普通认同，无法成为钱。比如，邮票的价值就没有普遍的认同，除了集邮爱好者，其他地方都不能当钱用。一般来说，认同的人越多，这种钱的通用性就越高。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/c40d04cc878a3cc4e12d2325218af122.jpg\" alt=\"\"></p>\n<p>我曾经去俄罗斯旅行，当地货币是卢布。可是，一旦离开俄国，没人相信它的购买力，所以卢布离开俄国就没用了。相反，全世界人民都相信美元的价值，所以全世界都能用。我用美元付账的时候，我发现那些俄国人都很满意。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8b875c22fba551f03d909426f641e8c1.jpg\" alt=\"\"></p>\n<p>所以，<strong>钱的本质，或者说货币的本质，就是它的可信性。</strong>它必须使人们相信，它是有价值的，然后才能成为钱，才能被收藏和支付。</p>\n<h2>二、可信性</h2>\n<p>为什么钱必须是可信的？因为对方必须相信它的价值，否则你没法支付出去。那么，接下来的问题就是，可信的东西是否就是钱？</p>\n<p>我的回答是 Yes。<strong>一样东西能否成为钱，只取决于人们是否相信它的价值，至于它是不是真的有价值，根本不重要。</strong></p>\n<p>如果马云在一张纸条上写”这张纸条价值10000元”，下面签了他的名，并且附上防伪标记。你说这纸条是钱吗？我跟你保证，这就是钱，你用来支付，人们都会接受，马云等同于发行了一种新的纸币。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f3bf0fd699f782c72c3e852c061437c8.jpg\" alt=\"\"></p>\n<p>比特币也是如此，它是什么，其实不太重要。重要的是，它必须保证自己是可信的，这样才能让足够的人相信它的价值，然后才能成为钱。</p>\n<h2>三、比特币的可信性</h2>\n<p><strong>比特币要解决的核心问题，就是创造一种可信的数字凭证。</strong>由于这种凭证可信，所以能够当做货币。</p>\n<p>比特币的技术基础是加密学，因为只有加密学才能保证它的可信性。一旦加密被破解，它就没法当作货币了。这也是这一类数字凭证被称为”加密货币”的原因。</p>\n<p>技术人员对比特币感兴趣，还有一个重要原因。任何需要可靠的数字凭证的场合，也许都可以用到这种技术。</p>\n<h2>四、比特币的特点</h2>\n<p>比特币有三个特点，就是因为做到了这三点，所以它可信，能够当作钱。</p>\n<p><strong>首先，它不会被（轻易）偷走。</strong>或者反过来说，它使得你无法去偷别人，你只能花你自己的钱。因为必须要有别人的私钥，才能取出他的钱。正常情况下，你拿不到别人的私钥。</p>\n<p><strong>其次，它无法伪造。</strong>每一个比特币都能追溯来源，而所有比特币都来源于矿工获得的奖励。矿工只有新建区块，才能获得奖励，这是很难的事情，所以无法伪造比特币。</p>\n<p><strong>最后，它无法大批生成。</strong>原因跟上一条一样，比特币的发行速度是稳定的，现在每10分钟新增12.5个，然后每四年减半，最终停止增长。因此不会像纸币那样，政府滥发导致通货膨胀。</p>\n<h2>五、比特币有实体吗？</h2>\n<p>由于后面要提到的原因，比特币不可能拥有实体，没法做到”从口袋里掏出一个币”这种场景，交易都必须通过互联网完成。</p>\n<p>你可能会说，钱都有实体，怎么可能存在无形的钱呢？答案正好相反，<strong>钱就应该是无形的，那些实体的钱其实是对物质材料的浪费，由于技术不够发达，不得不做成实体。</strong></p>\n<p>我小时候买东西，都必须用现金，否则没法证明，自己拥有购买力。只有通过实体的钱，才能保证对方确实收到了钱。如果银行业发达，就不用现金了，可以使用信用卡。支付的时候，对方抄一下信用卡号码，查询银行”这个账户有钱吗”。银行回答有钱，OK，成交。</p>\n<p>但是，互联网使得实体的信用卡也不需要了。如果存在一个开放的中央记账系统，任何人都可以查询，你把钱划到老板的账户，老板查询一下，发现收到了，交易自动成交，整个过程都是无形的，还需要什么信用卡呢？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/2d3dcf8c2a61aab348b0f3bc437ce5ee.jpg\" alt=\"\"></p>\n<p>这个中央记账系统已经实现了，就叫做区块链。</p>\n<h2>六、区块链的作用</h2>\n<p><strong>区块链就是一个数据库，记载了所有的交易，用作中央记账系统。</strong></p>\n<p><strong>每笔交易的核心，就是一句话，比如”张三向李四转移了1个比特币”。</strong>为了证明这句话可信，张三为它加上了数字签名。任何人都可以用张三的公钥，证明这确实是张三本人的行为。另一方面，其他人无法伪造张三的数字签名，所以不可能伪造这笔交易。</p>\n<p>矿工们收到这句话，首先验证数字签名的可信性，然后验证张三确实拥有这些比特币（每一笔交易都有上一笔交易的编号，用来查询比特币的来源）。验证通过以后，就着手把这句话写入区块链了。一旦写入区块链，所有人就都可以查询到，因此这笔比特币就被认为，从张三转移到了李四。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/a68850fbc6e8dcaf9efaee6e1e074dc0.png\" alt=\"\"></p>\n<p><strong>区块链的作用就是把这句话永久保存下来了，让任何人都可以查看，并且任何人（包括张三本人在内）都无法再修改了。</strong></p>\n<p><strong>货币是什么？其实就是这句话。这一句话就完成了一次支付。</strong>我们平时用人民币支付，其实只是用纸币表达这条信息。如果每个人都可以实时写入/读取中央记账系统（区块链），那么完全可以不携带货币。</p>\n<h2>七、双重支出</h2>\n<p>前面说过，交易不可能被伪造。但是，由于每一笔交易都是一串二进制信号，因此可能被复制。举例来说，”张三向李四转移了1个比特币”这句话，可能被其他人复制，也可能被张三自己复制，提交到区块链。</p>\n<p><strong>如果这句话被两次写入区块链，就意味着张三可以把同一笔钱花掉两次。</strong>但是，第二次写入的时候，查询区块链可以发现张三已经把这笔钱花掉了，从而认定这是不合法的交易，不能写入区块链。因此，复制交易是不可能的。</p>\n<p><strong>比较麻烦的是另一种情况，就是张三把同一笔钱付给两个人。</strong>他先向区块链提交一个交易”张三向李四转移了1个比特币”，然后又提交了另一个交易”张三向王五转移了1个比特币”。这两个交易都可能被认为是真实的交易，从而进入区块链。因此，必须有办法防止出现这种情况。</p>\n<p>情况一：同一个矿工收到了这两个交易。那么他会察觉到，它们不可能同时成立，因此选择其中的一笔写入区块链。</p>\n<p>情况二：矿工 A 收到了第一笔交易，矿工 B 收到了第二笔交易，他们各自都会认定这是合法的交易，分别把这两笔交易写入了两个区块，这时区块链就出现了分叉。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/9656f03454ce9623e4d533498029a21d.png\" alt=\"\"></p>\n<p>比特币协议规定，分叉点之后最先达到6个区块的那个分支，被认定为正式的区块链，其他分支都将被放弃。由于区块的生成速度由计算能力决定，所以到底哪一笔交易最后会被写入区块链，完全由它所在的分支能吸引多少计算能力决定。<strong>隐藏的逻辑是，如果大多数人（计算能力）选择相信某一笔交易，那么它就应该是真的。</strong></p>\n<p>综上所述，双重支出不可能发生。因为中央记账系统总有办法发现，你把同一笔钱花了两遍。但是，这也说明了比特币的一个代价，就是交易不能实时确认，必须等待至少一个小时。</p>\n<p><strong>八、参考链接</strong></p>\n<ul>\n<li><a href=\"http://www.michaelnielsen.org/ddi/how-the-bitcoin-protocol-actually-works/\">How the Bitcoin protocol actually works</a>, by Michael Nielsen</li>\n</ul>\n<p>（完）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113463\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113463votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113463\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113463/", "comment_nums": 0, "create_date": "2018/01/11", "tags": "IT技术,加密货币,比特币", "url_object_id": "34d6afcd431ba0245ad71a58bd857c6e", "front_image_path": "full/0736ffd1b456491f58808486bda5cb84bdaac7e8.jpg"}
{"fav_nums": 1, "praise_nums": "1", "title": "操作系统级虚拟化概述", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/kelvinxupt/blog/1602990\">宅蓝三木</a>   </div><h1>操作系统级虚拟化</h1>\n<div>\n<p>KVM、XEN等虚拟化技术允许各个虚拟机拥有自己独立的操作系统。与KVM、XEN等虚拟化技术不同，所谓操作系统级虚拟化，也被称作容器化，是操作系统自身的一个特性，它允许多个相互隔离的用户空间实例的存在。这些用户空间实例也被称作为容器。普通的进程可以看到计算机的所有资源而容器中的进程只能看到分配给该容器的资源。通俗来讲，操作系统级虚拟化将操作系统所管理的计算机资源，包括进程、文件、设备、网络等分组，然后交给不同的容器使用。容器中运行的进程只能看到分配给该容器的资源。从而达到隔离与虚拟化的目的。</p>\n<p>实现操作系统虚拟化需要用到Namespace及cgroups技术。</p>\n<h1>命名空间(Namespace)</h1>\n<p>在编程语言中，引入命名空间的概念是为了重用变量名或者服务例程名。在不同的命名空间中使用同一个变量名而不会产生冲突。Linux系统引入命名空间也有类似的作用。例如，在没有操作系统级虚拟化的Linux系统中，用户态进程从1开始编号(PID)。引入操作系统虚拟化之后，不同容器有着不同的PID命名空间，每个容器中的进程都可以从1开始编号而不产生冲突。</p>\n<p>目前，Linux中的命名空间有6种类型，分别对应操作系统管理的6种资源：</p>\n<ul>\n<li>挂载点(mount point) CLONE_NEWNS</li>\n<li>进程(pid) CLONE_NEWPID</li>\n<li>网络(net) CLONE_NEWNET</li>\n<li>进程间通信(ipc) CLONE_NEWIPC</li>\n<li>主机名(uts) CLONE_NEWUTS</li>\n<li>用户(uid) CLONW_NEWUSER</li>\n</ul>\n<p>将来还会引入时间、设备等对应的namespace.</p>\n<p>Linux 2.4.19版本引入了第一个命名空间——挂载点，因为那时还没有其他类型的命名空间，所以clone系统调用中引入的flag就叫做CLONE_NEWNS</p>\n<h2>与命名空间相关的三个系统调用(system calls)</h2>\n<p>下面3个系统调用用来操作命名空间：</p>\n<ul>\n<li>clone() —— 用来创建新的进程及新的命名空间，新的进程会被放到新的命名空间中</li>\n<li>unshare() —— 创建新的命名空间但并不创建新的子进程，之后创建的子进程会被放到新创建的命名空间中去</li>\n<li>setns() —— 将进程加入到已经存在的命名空间中</li>\n</ul>\n<p>注意：这３个系统调用都不会改变调用进程(calling process)的pid命名空间，而是会影响其子进程的pid命名空间</p>\n<p>命名空间本身并没用名字(囧)，不同的命名空间用不同的inode号来标识，这也符合Linux用文件一统天下的惯例。可以在proc文件系统中查看一个进程所属的命名空间，例如，查看PID为4123的进程所属的命名空间：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a55934538535\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkelvin@desktop:~$ ls -l /proc/4123/ns/\r\n总用量 0\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 cgroup -&gt; cgroup:[4026531835]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 ipc -&gt; ipc:[4026531839]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 mnt -&gt; mnt:[4026531840]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 net -&gt; net:[4026531963]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 pid -&gt; pid:[4026531836]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 user -&gt; user:[4026531837]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 uts -&gt; uts:[4026531838]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a55934538535-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a55934538535-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a55934538535-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a55934538535-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a55934538535-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a55934538535-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a55934538535-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a55934538535-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a55934538535-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a55934538535-1\"><span class=\"crayon-v\">kelvin</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4123</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ns</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a55934538535-2\">总用量<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a55934538535-3\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531835</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a55934538535-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipc</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531839</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a55934538535-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mnt</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531840</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a55934538535-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531963</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a55934538535-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531836</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a55934538535-8\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531837</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a55934538535-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uts</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531838</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>下面的代码演示了如何利用上述3个系统调用来操作进程的命名空间：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a62555010155\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define _GNU_SOURCE\r\n#include &lt;sys/types.h&gt;\r\n#include &lt;sys/wait.h&gt;\r\n#include &lt;sched.h&gt;\r\n#include &lt;signal.h&gt;\r\n#include &lt;unistd.h&gt;\r\n#include &lt;stdio.h&gt;\r\n#include &lt;string.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;errno.h&gt;\r\n#include &lt;sys/types.h&gt;\r\n#include &lt;sys/stat.h&gt;\r\n#include &lt;fcntl.h&gt;\r\n\r\n#define STACK_SIZE (10 * 1024 * 1024)\r\n\r\nchar child_stack[STACK_SIZE];\r\n\r\nint child_main(void* args) {\r\n    pid_t child_pid = getpid();\r\n    printf(\"I'm child process and my pid is %d \\n\", child_pid);\r\n    // 子进程会被放到clone系统调用新创建的pid命名空间中, 所以其pid应该为1\r\n    sleep(300);\r\n    // 命名空间中的所有进程退出后该命名空间的inode将会被删除, 为后续操作保留它\r\n    return 0;\r\n}\r\n\r\nint main() {\r\n    /* Clone */\r\n    pid_t child_pid = clone(child_main, child_stack + STACK_SIZE, \\\r\n        CLONE_NEWPID | SIGCHLD, NULL);\r\n    if(child_pid &lt; 0) {\r\n        perror(\"clone failed\");\r\n    }\r\n\r\n    /* Unshare */\r\n    int ret = unshare(CLONE_NEWPID); // 父进程调用unshare, 创建了一个新的命名空间,\r\n    //但不会创建子进程. 之后再创建的子进程将会被加入到新的命名空间中\r\n    if (ret &lt; 0) {\r\n        perror(\"unshare failed\");\r\n    }\r\n    int fpid = fork();\r\n    if (fpid &lt; 0) {\r\n        perror(\"fork error\");\r\n    } else if (fpid == 0) {\r\n        printf(\"I am child process. My pid is %d  \\n\", getpid());\r\n        // Fork后的子进程会被加入到unshare创建的命名空间中, 所以pid应该为1\r\n        exit(0);\r\n    } else {\r\n    }\r\n    waitpid(fpid, NULL, 0);\r\n\r\n    /* Setns */\r\n    char path[80] = \"\";\r\n    sprintf(path, \"/proc/%d/ns/pid\", child_pid);\r\n    int fd = open(path, O_RDONLY);\r\n    if (fd == -1)\r\n        perror(\"open error\");\r\n    if (setns(fd, 0) == -1)\r\n    // setns并不会改变当前进程的命名空间, 而是会设置之后创建的子进程的命名空间\r\n        perror(\"setns error\");\r\n    close(fd);\r\n\r\n    int npid = fork();\r\n    if (npid &lt; 0) {\r\n        perror(\"fork error\");\r\n    } else if (npid == 0) {\r\n        printf(\"I am child process. My pid is %d  \\n\", getpid());\r\n        // 新的子进程会被加入到第一个子进程的pid命名空间中, 所以其pid应该为2\r\n        exit(0);\r\n    } else {\r\n    }\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a62555010155-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a62555010155-74\">74</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-1\"><span class=\"crayon-p\">#define _GNU_SOURCE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-2\"><span class=\"crayon-p\">#include &lt;sys/types.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-3\"><span class=\"crayon-p\">#include &lt;sys/wait.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-4\"><span class=\"crayon-p\">#include &lt;sched.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-5\"><span class=\"crayon-p\">#include &lt;signal.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-6\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-7\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-8\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-9\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-10\"><span class=\"crayon-p\">#include &lt;errno.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-11\"><span class=\"crayon-p\">#include &lt;sys/types.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-12\"><span class=\"crayon-p\">#include &lt;sys/stat.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-13\"><span class=\"crayon-p\">#include &lt;fcntl.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-15\"><span class=\"crayon-p\">#define STACK_SIZE (10 * 1024 * 1024)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-17\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_stack</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">STACK_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-19\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I'm child process and my pid is %d \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 子进程会被放到clone系统调用新创建的pid命名空间中, 所以其pid应该为1</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 命名空间中的所有进程退出后该命名空间的inode将会被删除, 为后续操作保留它</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-28\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Clone */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">clone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_main</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_stack</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">STACK_SIZE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">CLONE_NEWPID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SIGCHLD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"clone failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Unshare */</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unshare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CLONE_NEWPID</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 父进程调用unshare, 创建了一个新的命名空间,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//但不会创建子进程. 之后再创建的子进程将会被加入到新的命名空间中</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unshare failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fork error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I am child process. My pid is %d  \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Fork后的子进程会被加入到unshare创建的命名空间中, 所以pid应该为1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">waitpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-52\"> </div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Setns */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/proc/%d/ns/pid\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_RDONLY</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"open error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">setns</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// setns并不会改变当前进程的命名空间, 而是会设置之后创建的子进程的命名空间</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"setns error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fork error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I am child process. My pid is %d  \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 新的子进程会被加入到第一个子进程的pid命名空间中, 所以其pid应该为2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a62555010155-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a62555010155-74\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0082 seconds] -->\r\n<p>运行结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a68008176342\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo ./ns\r\nI'm child process and my pid is 1 \r\nI am child process. My pid is 1  \r\nI am child process. My pid is 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a68008176342-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a68008176342-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a68008176342-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a68008176342-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a68008176342-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">ns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a68008176342-2\"><span class=\"crayon-i\">I</span>'<span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a68008176342-3\"><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">am </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">My </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a68008176342-4\"><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">am </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">My </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h1>控制组(Cgroups)<br>\n<span id=\"OSC_h1_4\"></span></h1>\n<h1></h1>\n<p>如果说命名空间是从命名和编号的角度进行隔离，而控制组则是将进程进行分组，并真正的将各组进程的计算资源进行限制、隔离。控制组是一种内核机制，它可以对进程进行分组、跟踪限制其使用的计算资源。对于每一类计算资源，控制组通过所谓的子系统(subsystem)来进行控制，现阶段已有的子系统包括：</p>\n<ul>\n<li>cpusets: 用来分配一组CPU给指定的cgroup，该cgroup中的进程只等被调度到该组CPU上去执行</li>\n<li>blkio : 限制cgroup的块IO</li>\n<li>cpuacct : 用来统计cgroup中的CPU使用</li>\n<li>devices : 用来黑白名单的方式控制cgroup可以创建和使用的设备节点</li>\n<li>freezer : 用来挂起指定的cgroup，或者唤醒挂起的cgroup</li>\n<li>hugetlb : 用来限制cgroup中hugetlb的使用</li>\n<li>memory : 用来跟踪限制内存及交换分区的使用</li>\n<li>net_cls : 用来根据发送端的cgroup来标记数据包，流量控制器(traffic controller)会根据这些标记来分配优先级</li>\n<li>net_prio : 用来设置cgroup的网络通信优先级</li>\n<li>cpu :用来设置cgroup中CPU的调度参数</li>\n<li>perf_event : 用来监控cgroup的CPU性能</li>\n</ul>\n<p>与命名空间不同，控制组并没有增加系统调用，而是实现了一个文件系统，通过文件及目录操作来管理控制组。下面通过一个例子来看一看cgroup是如何利用cpuset子系统来把进程绑定到指定的CPU上去执行的。</p>\n<p>1. 创建一个一直执行的shell脚本</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a6f785338666\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\n\r\nx=0\r\n\r\nwhile [ True ];do\r\n    :\r\ndone;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a6f785338666-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a6f785338666-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a6f785338666-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a6f785338666-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a6f785338666-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a6f785338666-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a6f785338666-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a6f785338666-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a6f785338666-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6905d211a6f785338666-3\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a6f785338666-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6905d211a6f785338666-5\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a6f785338666-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a6f785338666-7\"><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>2. 在后台执行这个脚本</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a73526488745\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# bash run.sh &amp;\r\n[1] 20553</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a73526488745-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a73526488745-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a73526488745-1\"><span class=\"crayon-p\"># bash run.sh &amp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a73526488745-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20553</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>3. 查看该脚本在哪个CPU上运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a77031938395\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep\r\nroot     20553   3 bash run.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a77031938395-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a77031938395-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a77031938395-1\"><span class=\"crayon-p\"># ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a77031938395-2\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">20553</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">run</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>可以看到PID为20553的进程运行在编号为3的CPU上，下面利用cgroups将其绑定到编号为2的CPU上去执行</p>\n<p>4. 挂载cgroups类型的文件系统到一个新创建的目录cgroups中</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a7a186330869\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mkdir cgroups\r\n# mount -t cgroup -o cpuset cgroups ./cgroups/\r\n# ls cgroups/\r\ncgroup.clone_children   cpuset.memory_pressure_enabled\r\ncgroup.procs            cpuset.memory_spread_page\r\ncgroup.sane_behavior    cpuset.memory_spread_slab\r\ncpuset.cpu_exclusive    cpuset.mems\r\ncpuset.cpus             cpuset.sched_load_balance\r\ncpuset.effective_cpus   cpuset.sched_relax_domain_level\r\ncpuset.effective_mems   docker\r\ncpuset.mem_exclusive    tasks\r\ncpuset.mem_hardwall     notify_on_release\r\ncpuset.memory_migrate   release_agent\r\ncpuset.memory_pressure</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a7a186330869-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a7a186330869-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a7a186330869-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a7a186330869-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a7a186330869-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a7a186330869-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a7a186330869-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a7a186330869-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a7a186330869-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a7a186330869-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a7a186330869-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a7a186330869-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a7a186330869-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a7a186330869-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a7a186330869-1\"><span class=\"crayon-p\"># mkdir cgroups</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a7a186330869-2\"><span class=\"crayon-p\"># mount -t cgroup -o cpuset cgroups ./cgroups/</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a7a186330869-3\"><span class=\"crayon-p\"># ls cgroups/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a7a186330869-4\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone_children   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_pressure_enabled</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a7a186330869-5\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">procs            </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_page</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a7a186330869-6\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sane_behavior    </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_slab</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a7a186330869-7\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpu_exclusive    </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mems</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a7a186330869-8\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpus             </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_load_balance</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a7a186330869-9\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_cpus   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_relax_domain_level</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a7a186330869-10\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_mems   </span><span class=\"crayon-e\">docker</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a7a186330869-11\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_exclusive    </span><span class=\"crayon-e\">tasks</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a7a186330869-12\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_hardwall     </span><span class=\"crayon-e\">notify_on_release</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a7a186330869-13\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_migrate   </span><span class=\"crayon-e\">release_agent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a7a186330869-14\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">memory_pressure</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>5. 创建一个新的组group0</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a80333021611\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mkdir group0\r\n# ls group0/\r\ncgroup.clone_children  cpuset.mem_exclusive       cpuset.mems\r\ncgroup.procs           cpuset.mem_hardwall        cpuset.sched_load_balance\r\ncpuset.cpu_exclusive   cpuset.memory_migrate      cpuset.sched_relax_domain_level\r\ncpuset.cpus            cpuset.memory_pressure     notify_on_release\r\ncpuset.effective_cpus  cpuset.memory_spread_page  tasks\r\ncpuset.effective_mems  cpuset.memory_spread_slab</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a80333021611-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a80333021611-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a80333021611-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a80333021611-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a80333021611-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a80333021611-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a80333021611-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a80333021611-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a80333021611-1\"><span class=\"crayon-p\"># mkdir group0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a80333021611-2\"><span class=\"crayon-p\"># ls group0/</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a80333021611-3\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone_children  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_exclusive       </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mems</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a80333021611-4\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">procs           </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_hardwall        </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_load_balance</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a80333021611-5\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpu_exclusive   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_migrate      </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_relax_domain_level</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a80333021611-6\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpus            </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_pressure     </span><span class=\"crayon-e\">notify_on_release</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a80333021611-7\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_cpus  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_page  </span><span class=\"crayon-e\">tasks</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a80333021611-8\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_mems  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">memory_spread_slab</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>6. 将上面的进程20553加入到新建的控制组中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a83859736891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# echo 20553 &gt;&gt; group0/tasks \r\n# cat group0/tasks \r\n20553</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a83859736891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a83859736891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a83859736891-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a83859736891-1\"><span class=\"crayon-p\"># echo 20553 &gt;&gt; group0/tasks </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a83859736891-2\"><span class=\"crayon-p\"># cat group0/tasks </span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a83859736891-3\"><span class=\"crayon-cn\">20553</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>7. 限制该组的进程只能运行在编号为2的CPU上</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a87322273015\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# echo 2 &gt; group0/cpuset.cpus\r\n# cat group0/cpuset.cpus\r\n2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a87322273015-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a87322273015-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a87322273015-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a87322273015-1\"><span class=\"crayon-p\"># echo 2 &gt; group0/cpuset.cpus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a87322273015-2\"><span class=\"crayon-p\"># cat group0/cpuset.cpus</span></div><div class=\"crayon-line\" id=\"crayon-5a6905d211a87322273015-3\"><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>8. 查看PID为20553的进程所运行的CPU编号</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6905d211a8a395605019\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep\r\nroot     20553   2 bash run.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6905d211a8a395605019-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6905d211a8a395605019-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6905d211a8a395605019-1\"><span class=\"crayon-p\"># ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6905d211a8a395605019-2\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">20553</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">run</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>上面的例子简单的展示了如何使用控制组。控制组通过文件和目录来操作，文件系统又是树形结构，因此如果不对cgroups的使用做一些限制的话，配置会变得异常复杂和混乱。因此，在新版的cgroups中做了一些限制。</p>\n<h1>小结</h1>\n<p>本文简要介绍了操作系统虚拟化的概念，以及实现操作系统虚拟化的技术——命名空间及控制组。并通过两个简单的例子演示了命名空间及控制组的使用方法。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113459\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113459votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113459\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113459/", "comment_nums": 0, "create_date": "2018/01/09", "tags": "IT技术,虚拟化", "url_object_id": "f9947ec196965902f6858b2ff93b9565", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "区块链初学者指南", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/f758d0488e42bad4bf6c57205e400bac.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/a-beginners-guide-to-blockchain-d04266844e7\">Febin John James</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/a-beginners-guide-to-blockchain\">oschina/LeoXu</a>   </div><div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f758d0488e42bad4bf6c57205e400bac.png\" width=\"1200\" height=\"495\"></p>\n<p>我并不明白为什么人们会觉得要理解<a href=\"http://amzn.to/2EtascE\" target=\"_blank\" rel=\"nofollow\">区块链</a>会有点难，而我也想知道为什么自己并没有。那是在 2013 年，我第一次听说有比特币这个东西（是的，知道的太晚啦）。我穷得连一个都买不起，看到这儿你也许已经对此文无爱了。后来，我想要去了解一下它所依赖的底层技术，也就<a href=\"http://amzn.to/2EtascE\" target=\"_blank\" rel=\"nofollow\">区块链</a>。 不过因为太忙了，所以迟迟没有开始(那就并不存在什么 开始不开始了)。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/09b9cf95aeab080a265cbe2de97f5f53.png\" width=\"506\" height=\"499\"></p>\n<h3><em>那么这个 “区块链”到底是什么呢?</em></h3>\n<p>其实是两个东西：一个是区块一个是链。说玄虚一点，就是一链子的区块。因为它是存在于计算机中的东西，所以我们可以厘定它的一个物理形态是啥样子的，就是数字信息被分成一个一个区块然后把这些区块链接起来。举个例子，下图中的方块，每一个都表示一个国家，而且每一个都包含了对应国家的城市名称。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/326c76d0690f6998d2c601f0624bcfdb.png\" width=\"577\" height=\"246\"></p>\n<p>等等，其实还有更多东西来着。这里的每一个方块都一个叫做哈希的东西。一个哈希就是一串字符 (比如 “1hi515AHA5H” )。哈希是根据方块里面所包含的信息来得到的。 U.S.A 的方块拥有 New York, Los Angeles, 还有 Chicago 这几个城市，所以它的哈希就是像 “NYLAC” 的东西了 (技术上其实远非如此，但你理会精要就行了)。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/ee35d08d4e9f32eabbdf3bc7a8aedea9.png\" width=\"588\" height=\"255\"></p>\n<p>每一个接续的方块都会包含前一个方块的哈希，所以这个就是（强制性的）将它们绑到一起的纽带。如果有人擅自篡改了第一个方块，加入了城市 Boston，那么新的哈希就会是 “NYLACB”，然而后面接续的 India 这个方块已经存着的哈希还是 “NYLAC”，这种不匹配就会把链条打断。所以哈希的目的就是确保没有人可以篡改区块。</p>\n<p><strong><em>那如果有人修改了一个方块的内容，然后把后面的接续方块的哈希也一并更新会如何呢?</em> </strong>这也是有可能的，不过有一件事情我还没有告诉你。区块链的数据并不只是存在于仅仅一台计算机里面。一台计算机里面的区块链数据并不能骗到人，因为它会被复制到网络中每一个用户的计算机里面去。如果你加入了一个区块链网络，那么你的计算机就会去下载这些区块数据，如果有人篡改了他拥有的版本，整个网络也会考虑占多数的人的计算机上所拥有的版本才是正确的。</p>\n<p>还有一件事，在一个区块链网络中，不仅是数据，就连整个系统的程序都被复制到了所有的电脑中。大多数互联网应用都是集中话的，比如 Facebook，她的数据和程序都被放在了她的服务器上，你的计算机会从 Facebook 的服务器上获取到你一个人需要知道的信息。但在区块链的世界理，就没有存在于中心的东西，它依赖的是用户的计算机来容纳自己的程序。是的，这就意味着，如果整个区块链网络中的每一台电脑都关机了，那么这个区块链系统就死翘翘了。</p>\n<h3>公共区块链</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/7dc1523fe13c77bc057309f8cbf6cde0.png\" width=\"587\" height=\"265\"></p>\n<p><strong><em>这是不是就意味着区块链系统其实就是由一群心怀善意自愿让他们的计算机保持运行的人来组成的呢? 还有这些防篡改的区块是用来干嘛的呢?</em></strong></p>\n<p>区块链网络的功效不胜枚举。比特币是一种数据货币和一个支付系统。它所有的防篡改区块中所保存的就是全部交易的分类账。那些贡献了他们自己的计算机的人被称为矿工。系统会给他们提供比特币作为奖励。</p>\n<p>Ethereum 有意向附加功能。它可以承载你的代码，从头开始发展出一个区块链系统，而要构建一个属于你自己的系统也许会非常地困难（记住这得看有人为你牺牲他们的计算机运行能力才行哦）。Ethereum 就维护着这些耗损巨大的运算能力，而你则需要为这些计算消耗买单。</p>\n<p>区块链应用并不非得是支付系统或者加密货币。它可以任何东西，像是一个社交网络，一个像 <a href=\"https://tokensale.liveedu.tv/\" target=\"_blank\" rel=\"nofollow\">LiveEdu</a> 这样的学习平台，等等。</p>\n<h3>私有区块链</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/dcf2c797be62efe817e265508f012f1b.png\" width=\"284\" height=\"85\"></p>\n<p><strong><em>Bitcoin, Ethereum 等等这些都是公共区块链的例子，任何人都可以成为其中的一分子。那如果我们想要有一个私有的区块链网络该如何呢？有些人想要一个私有的区块链是想干嘛呢？那就来瞧瞧下面的故事吧。</em></strong></p>\n<p><strong><em>Mark 和 Sara</em></strong></p>\n<p>Mark 已经五个月没交房租了，当 Sara 找他要的时候，他就说晚点会给她。她付不起律师费，而法院强制执行诉讼就需要8个月甚至一年，所以唯一的选择就是去说服 Mark。</p>\n<p><strong><em>Joe 的生意</em></strong></p>\n<p>Joe 是一个商人，他经常要跟不同的公司做生意。几个月之前他和一家零售商签了一份合同，尽管合同条款都已经履约了，可零售商确拒绝付款。这帮人利用法律制度中的漏洞来游说 Joe，想以此达到少付钱的目的。Joe 在这以前就是有这方面经验的，在某些情况下，他会找法院求助，但这样做所耗费的时间和金钱却要损失他自己的利润。</p>\n<p><strong><em>我们该如何帮助 Sara 和 Joe 呢?</em></strong></p>\n<p>我们是不是能在其它地方解决这个问题呢? 在 Sara 遇到的这种情况中，我们需要让 Mark  按月支付房租，这其实就是一个基于时间的触发机制。你的日历程序使用这样的触发器来给你提供预设事件的通知。</p>\n<p>在 Joe 遇到的场景中，一旦合约中的条款都满足了，当事人就得付款，这其实就是一个基于条件的触发机制。你想想上次从 Amazon 买电子书的时候，是不是得先确认付款了，Amazon 才会把电子书发给你？</p>\n<p>重点是，计算机程序会始终如一的执行诸如此类的指令。当你点击着这篇文章，向下滚动，诸如这类的操作，它也会照着执行不误。为了能帮助到 Sara ，我们需要将合同的条款转变成代码。</p>\n<p><strong><em>Sara 和 Mark 之间所订立的智能合同的伪代码</em></strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691215b1926781524985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nIf today’s date is 30th and rent is not paid then\r\nTransfer $500 from Mark’s account to Sara’s account</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691215b1926781524985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691215b1926781524985-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691215b1926781524985-1\"><span class=\"crayon-st\">If</span> <span class=\"crayon-i\">today</span>’<span class=\"crayon-i\">s</span> <span class=\"crayon-i\">date</span> <span class=\"crayon-st\">is</span> <span class=\"crayon-cn\">30th</span> <span class=\"crayon-st\">and</span> <span class=\"crayon-i\">rent</span> <span class=\"crayon-st\">is</span> <span class=\"crayon-st\">not</span> <span class=\"crayon-i\">paid</span> <span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691215b1926781524985-2\"><span class=\"crayon-i\">Transfer</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">500</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-i\">Mark</span>’<span class=\"crayon-i\">s</span> <span class=\"crayon-i\">account</span> <span class=\"crayon-st\">to</span> <span class=\"crayon-i\">Sara</span>’<span class=\"crayon-i\">s</span> <span class=\"crayon-v\">account</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>可是我们在哪儿部署这些代码呢? 它就应该被部署到所有参与者的计算机上。Sara 的还有 Mark 的银行都会是这一个私有区块链网络的一部分。Joe 和 Sara 会签署一份编码的协议(也就是智能合同)，然后这份协议会被分发到网络中去，Mark 的和 Sara 的银行都会有一份拷贝。在每个月的 30 号，当时钟跳动到 12 点整，协议好的金额就会从 Mark 的账户转移到 Sara 的账户上去。Joe 也开始使用智能合同来强制让他的客户支付协议好的货款。</p>\n<blockquote><p>Sara 高兴了，因为她再也不用去烦心 Mark 会不会如约付房租了。Joe 也高兴，因为他也不用找法院要说法了，省下这些精力，他可以继续发展自己的生意了。</p></blockquote>\n<p>私有区块链只限于业务中涉及到的相关各方，因此 Joe 不会是 Sara 和 Mark 所属区块链网络的一部分。</p>\n<h3>前行之路</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/38e666d2c9a39c10ef030ceebb769262.png\" width=\"447\" height=\"573\"></p>\n<p>现在你对此已经有点概念了，也许应该尝试一下 <a href=\"https://www.edx.org/course/blockchain-business-introduction-linuxfoundationx-lfs171x\" target=\"_blank\" rel=\"nofollow\">edX 上的课程</a>(免费的哦)，它会教你怎么在区块链上构建应用。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113467\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113467votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113467\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113467/", "comment_nums": 1, "create_date": "2018/01/12", "tags": "IT技术,区块链", "url_object_id": "df1b3184923f603d7a7a92af3546ce30", "front_image_path": "full/ea1c3434ff90c4ebce5f7f45d3293c6309a42a0a.jpg"}
{"fav_nums": 1, "praise_nums": "2", "title": "在 Linux 的终端上伪造一个好莱坞黑客的屏幕", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/008d9c47f50ab5eac3f349d238b3b6dc.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://itsfoss.com/hollywood-hacker-screen/\">itsfoss</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9228-1.html\">Linux中国</a>   </div><blockquote><p>摘要：这是一个简单的小工具，可以把你的 Linux 终端变为好莱坞风格的黑客入侵的实时画面。</p></blockquote>\n<p>我攻进去了！</p>\n<p>你可能会几乎在所有的好莱坞电影里面会听说过这句话，此时的荧幕正在显示着一个入侵的画面。那可能是一个黑色的终端伴随着 ASCII 码、图标和连续不断变化的十六进制编码以及一个黑客正在击打着键盘，仿佛他/她正在打一段愤怒的论坛回复。</p>\n<p>但是那是好莱坞大片！黑客们想要在几分钟之内破解进入一个网络系统除非他花费了几个月的时间来研究它。不过现在我先把对好莱坞黑客的评论放在一边。</p>\n<p>因为我们将会做相同的事情，我们将会伪装成为一个好莱坞风格的黑客。</p>\n<p>这个小工具运行一个脚本在你的 Linux 终端上，就可以把它变为好莱坞风格的实时入侵终端：</p>\n<p>看到了吗？就像这样，它甚至在后台播放了一个 Mission Impossible 主题的音乐。此外每次运行这个工具，你都可以获得一个全新且随机的入侵的终端。</p>\n<p>让我们看看如何在 30 秒之内成为一个好莱坞黑客。</p>\n<h3 id=\"toc_1\">如何安装 Hollywood 入侵终端在 Linux 之上</h3>\n<p>这个工具非常适合叫做 Hollywood 。从根本上说，它运行在 Byobu ——一个基于文本的窗口管理器，而且它会创建随机数量、随机尺寸的分屏，并在每个里面运行一个混乱的文字应用。</p>\n<p><a href=\"http://byobu.co/\">Byobu</a> 是一个在 Ubuntu 上由 Dustin Kirkland 开发的有趣工具。在其他文章之中还有更多关于它的有趣之处，让我们先专注于安装这个工具。</p>\n<p>Ubuntu 用户可以使用简单的命令安装 Hollywood：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a697a4b4dcab996415024\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt install hollywood</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a697a4b4dcab996415024-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a697a4b4dcab996415024-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">apt </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">hollywood</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果上面的命令不能在你的 Ubuntu 或其他例如 Linux Mint、elementary OS、Zorin OS、Linux Lite 等等基于 Ubuntu 的 Linux 发行版上运行，你可以使用下面的 PPA 来安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a697a4b4dcb5700424266\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt-add-repository ppa:hollywood/ppa\r\nsudo apt-get update\r\nsudo apt-get install byobu hollywood</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a697a4b4dcb5700424266-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a697a4b4dcb5700424266-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a697a4b4dcb5700424266-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a697a4b4dcb5700424266-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">add</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">repository </span><span class=\"crayon-v\">ppa</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">hollywood</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ppa</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a697a4b4dcb5700424266-2\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line\" id=\"crayon-5a697a4b4dcb5700424266-3\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">byobu </span><span class=\"crayon-v\">hollywood</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>你也可以在它的 GitHub 仓库之中获得其源代码： <a href=\"https://github.com/dustinkirkland/hollywood\">Hollywood 在 GitHub</a> 。</p>\n<p>一旦安装好，你可以使用下面的命令运行它，不需要使用 sudo ：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a697a4b4dcb9108933567\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhollywood</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a697a4b4dcb9108933567-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a697a4b4dcb9108933567-1\"><span class=\"crayon-v\">hollywood</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>因为它会先运行 Byosu ，你将不得不使用 <code>Ctrl+C</code> 两次并再使用 <code>exit</code> 命令来停止显示入侵终端的脚本。</p>\n<p>这里面有一个伪装好莱坞入侵的视频。</p>\n<p><video controls=\"controls\" width=\"640\" height=\"360\"></video></p>\n<p>这是一个让你朋友、家人和同事感到吃惊的有趣小工具，甚至你可以在酒吧里给女孩们留下深刻的印象，尽管我不认为这对你在那方面有任何的帮助，</p>\n<p>并且如果你喜欢 Hollywood 入侵终端，或许你也会喜欢另一个可以<a href=\"https://itsfoss.com/sneakers-movie-effect-linux/\">让 Linux 终端产生 Sneaker 电影效果的工具</a>。</p>\n<p>如果你知道更多有趣的工具，可以在下面的评论栏里分享给我们。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113471\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113471votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113471\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113471/", "comment_nums": 0, "create_date": "2018/01/12", "tags": "IT技术,Linux", "url_object_id": "2f2cb92eda8ea71b6d6fba94287e069b", "front_image_path": "full/80b4614d2c41c6d4f76f79bebe8e4d4beca33f43.jpg"}
{"fav_nums": 2, "praise_nums": "1", "title": "把docker镜像当作桌面系统来用", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/382b1251c2cdb32cf334445596f97085.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://zasdfgbnm.github.io/2017/12/28/%E6%8A%8Adocker%E9%95%9C%E5%83%8F%E5%BD%93%E4%BD%9C%E6%A1%8C%E9%9D%A2%E7%B3%BB%E7%BB%9F%E6%9D%A5%E7%94%A8/\">zasdfgbnm</a>   </div><div>\n<p>博主一直都很喜欢思考怎样管理装在自己电脑上的桌面系统，这篇算是前作<a href=\"http://blog.jobbole.com/111672/\">能当主力，能入虚拟机，还能随时打包带走，Linux就是这么强大</a>的后续探索吧。</p>\n<p>近些年来，Docker由于提供了一套非常方便地创建并运行应用容器的方法，而在全球掀起了一股容器化的热潮。容器通过将软件及其所需要的运行环境一同打包带走，从而将人们从依赖的苦海中拯救出来。虽然Docker设计的初衷并不是操作系统容器，更不是一个直接运行在裸机上的操作系统，但是docker这套强大的工具也会给我们管理操作系统带来巨大的便利。</p>\n<p>为什么要用Docker镜像当作桌面系统？这就要从普通桌面系统的不方便之处说起。通常我们都拥有不止一台电脑，我们希望这些电脑能够保持一致。这里所说的“一致”，用一个例子来讲，就是我在一台电脑上编辑了一半的文件，不需要认为拷贝到另一台电脑上，而是直接打开电脑就能编辑。如果这个文件只是一个纯文本文件，或者一个Microsoft Word文档，那么实现这个一致性非常简单：把文件扔到Dropbox之类的云同步盘就好。然而对于专业用户来讲，这种一致性的保持并非单纯的扔到Dropbox里面那么简单：比如说你最近忙于一个项目，这个项目要用到若干编程语言，然后在电脑里装了一堆库，一堆工具软件，有图形界面的，也有命令行的。在工作的过程中，你有可能不断安装新的工具，或者决定弃用某个之前计划使用的库或者工具。要让你的工作在你的若干台电脑上都能工作，就要一直维护不同机器的环境的一致性：在一台机器上安装的工具，要在所有机器上重新安装一遍。在一台机器上升级了的库，要在所有机器上都升级，稍微有所差池，就有可能出现某个脚本/程序在一台机器上跑的好好的，在另一台机器上却无法运行的问题。</p>\n<h1 id=\"docker哲学\">docker哲学</h1>\n<p>不熟悉docker的读者可以戳<a href=\"https://docs.docker.com/get-started/\" target=\"_blank\" rel=\"noopener\">这里</a>来了解docker。Docker的使用非常简单：我们通过写一个Dockerfile，在Dockerfile中写入相应的命令来安装以及配置我们想要的库跟工具。不熟悉docker的读者可以看一下下面这个<a href=\"https://github.com/kstaken/dockerfile-examples/blob/master/nodejs/Dockerfile\" target=\"_blank\" rel=\"noopener\">抄来的Dockerfile的例子</a>，来了解一下Dockerfile长啥样子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69106573187708962481\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM ubuntu\r\nMAINTAINER Kimbro Staken\r\nRUN apt-get install -y software-properties-common python\r\nRUN add-apt-repository ppa:chris-lea/node.js\r\nRUN echo \"deb http://us.archive.ubuntu.com/ubuntu/ precise universe\" &gt;&gt; /etc/apt/sources.list\r\nRUN apt-get update\r\nRUN apt-get install -y nodejs\r\n#RUN apt-get install -y nodejs=0.6.12~dfsg1-1ubuntu1\r\nRUN mkdir /var/www\r\nADD app.js /var/www/app.js\r\nCMD [\"/usr/bin/node\", \"/var/www/app.js\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69106573187708962481-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69106573187708962481-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69106573187708962481-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69106573187708962481-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69106573187708962481-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69106573187708962481-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69106573187708962481-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69106573187708962481-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69106573187708962481-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69106573187708962481-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69106573187708962481-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69106573187708962481-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69106573187708962481-2\"><span class=\"crayon-e\">MAINTAINER </span><span class=\"crayon-e\">Kimbro </span><span class=\"crayon-e\">Staken</span></div><div class=\"crayon-line\" id=\"crayon-5a69106573187708962481-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">software</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">properties</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common </span><span class=\"crayon-e\">python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69106573187708962481-4\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">add</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">repository </span><span class=\"crayon-v\">ppa</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">chris</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lea</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js</span></div><div class=\"crayon-line\" id=\"crayon-5a69106573187708962481-5\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"deb http://us.archive.ubuntu.com/ubuntu/ precise universe\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sources</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69106573187708962481-6\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line\" id=\"crayon-5a69106573187708962481-7\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodejs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69106573187708962481-8\"><span class=\"crayon-p\">#RUN apt-get install -y nodejs=0.6.12~dfsg1-1ubuntu1</span></div><div class=\"crayon-line\" id=\"crayon-5a69106573187708962481-9\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">www</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69106573187708962481-10\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">js</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js</span></div><div class=\"crayon-line\" id=\"crayon-5a69106573187708962481-11\"><span class=\"crayon-i\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"/usr/bin/node\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/var/www/app.js\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>有了Dockerfile，只需要<code>docker build</code>一条命令就可以创建一个docker镜像。同时Docker公司提供一个叫做DockerHub的服务，可以免费托管公开镜像。只需要使用<code>docker push</code>就可以直接把镜像上传到DockerHub。在不同的电脑上只需要<code>docker pull</code>就可以从DockerHub获取最新版的镜像。DockerHub还支持自动构建，通过把DockerHub帐号跟GitHub帐号关联起来，就可以让DockerHub在GitHub上面的Dockerfile出现更改的时候自动重新生成镜像。</p>\n<p>本文开头所说的这种一致性的维护，docker实际上已经在给我们提供答案了：我们通过构建一个docker镜像，让这个镜像包含着我们项目所需要的所有的一切。这样的话，我们开发，测试，部署等等一切任务，都可以在先用<code>docker run</code>来开启一个容器，然后在容里面进行所有的工作。当我们决定修改运行环境，比如引入新的库的时候，就在Dockerfile中进行相应的修改，重新生成镜像，然后在不同的机器上用<code>docker pull</code>来更新一下就好。这种使用哲学，通过一个中心化了的仓库，非常优雅地解决了不同机器上环境一致的问题。美中不足的是，并不是所有的程序都能在容器里运行的，也并不是所有的程序都方便在容器里运行的。如果你用到了图形界面的程序，或者说是一些系统级别的程序，那么在容器里面使用这些程序会麻烦很多，有的甚至根本无法实现。于是自然地就会想到，如果我们能够在每次开机的时候，直接把某个docker生成的镜像挂载起来当根目录来使用，就可以让这个镜像直接在裸机上（而不是在容器中）运行，来做我们的日常桌面系统了。</p>\n<p>这种做法，除了在保持一致性方面带来的便利以外，还有一些其他的好处：</p>\n<ul>\n<li>整个系统保存在云端，本地的内容仅仅是云端的一份缓存而已，这样就完全没有必要定期对系统进行备份了。</li>\n<li>你的系统是如何从零开始一步一步配置成你想要的样子的，所有的一切都清晰地展现在Dockerfile里面。Dockerfile就是你最好的笔记。</li>\n<li>完全不用担心系统长时间使用产生一些残余的垃圾文件、或者某些系统中某些程序的数据出现损坏，因为每次开机，我们用的都是一个全新的系统。</li>\n<li>要装一台新机器，并不需要从头安装操作系统，只要从DockerHub拉取镜像拿来用就好，安装系统这个过程变得极其方便。</li>\n<li>系统更新的过程实际上就是根据Dockerfile从最新的软件仓库重新从头安装生成docker镜像的过程，不会出现某些更新遇到文件冲突或者依赖无法处理，需要人为干预才能完成的问题。</li>\n</ul>\n<h1 id=\"docker存储驱动的工作原理\">docker存储驱动的工作原理</h1>\n<p>Docker的存储驱动<a href=\"https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/\" target=\"_blank\" rel=\"noopener\">官方有介绍其工作原理</a>，这里只是简单概括一下。Docker使用了层的概念，docker在构建镜像的时候，会逐行执行我们的Dockerfile中的每一行，每执行一行的时候，docker就会创建出一个新的层来存放新的内容。当我们执行<code>docker pull</code>或者<code>docker push</code>的时候，docker实际上传跟下载的是这些层之间的增量。每当执行<code>docker run</code>，docker就会把这些下载下来的层组合到一起，组合成一个完整的镜像，然后新建一个读写层，所有运行过程中的写入都会被写入到读写层中，而镜像本身则是保持只读，不会被更改。“层”这个概念具体实现起来，根据docker目录（通常为<code>/var/lib/docker</code>这个目录）所在的文件系统的不同而不同，具体的实现在docker中被称为graph driver，docker自带的graph driver包括aufs、 overlay、btrfs、zfs、devicemapper等。这些graph driver大多使用了写时复制的技术，这样在把各个层组合在一起的过程不需要重新拷贝一份数据，实际的拷贝是在写入的时候发生的。</p>\n<p>由于笔者使用的是btrfs，所以本文就以btrfs为例子来介绍怎么让系统启动到docker镜像上去。btrfs是一个写时复制的系统，由于docker的镜像是由一个一个的层叠在一起组成的，docker在使用btrfs的时候，每往上叠一层，docker就会创建一个原来层的快照，然后把新层的内容写到快照里面去。然后docker会在从镜像创建容器的时候，给镜像的最顶层做个快照，把这个快照当作容器读写层来用。</p>\n<h1 id=\"启动到docker镜像中去\">启动到docker镜像中去</h1>\n<p>明白了docker存储驱动的工作原理，还需要知道Linux的启动过程才能达成我们的目标。Linux在启动的时候，一般会让启动器给内核装载一个内存盘initramfs，然后内核完成简单的早期初始化以后，就会解压内存盘的内容到根目录<code>/</code>，然后启动内存盘中的init程序（一般为<code>/init</code>），这个init程序会进行进一步的初始化（比如说加载文件系统的驱动，对文件系统进行fsck等），这一步初始化完成了以后，这个init程序就会根据内核选项中的<code>root</code>、<code>rootflags</code>等内容挂载真正的根目录，然后通过<code>switch_root</code>程序启动真正根目录中的init程序，这个init程序则会完成最后的初始化工作，比如挂载fstab、加载图形界面等等。很多发行版都提供制作initramfs的工具，比如archlinux的mkinitcpio，这些工具通常都是模块化的，允许用户自己添加hook。</p>\n<p>让系统启动到docker镜像所需要的知识已经完备了。思路也清晰了：通过给initramfs中添加hook，让initramfs中的init在挂载root之前从docker本地缓存中的镜像中创建出一个快照作为读写层，然后把这个读写层当作真正的root来挂载。具体操作上，在启动管理器里面写启动项的内核选项的时候，<code>root</code>就写<code>/var/lib/docker</code>所在的分区，而<code>rootflags</code>里面至少要有一项<code>subvol=XXXXX</code>，其中XXXXX是我们打算创建的读写层的位置。然后重中之重则是，写一个hook，这个hook干的事情是：找到想要的docker镜像对应的btrfs子卷，给这个子卷创建一个快照，命名为XXXXX（跟内核选项中的名字保持一致）。这样的话，在Linux把控制权交给initramfs中的init程序以后，init程序会先去从docker缓存中的子卷创造出XXXXX快照，然后把XXXXX快照当作root来挂载以及进行接下来的操作。如果读者跟笔者一样使用Arch Linux的话，那么所有的这些工作笔者已经做了，读者可以直接拿来用。</p>\n<p>笔者的源码位于GitHub： <a href=\"https://github.com/zasdfgbnm/mkinitcpio-docker-hooks\" target=\"_blank\" rel=\"noopener\">https://github.com/zasdfgbnm/mkinitcpio-docker-hooks</a> ，同时读者也可以直接从AUR中搜索<code>mkinitcpio-docker-hooks</code>来安装笔者的hook。下面就来介绍一下这个hook的使用方法。</p>\n<h1 id=\"mkinitcpio-docker-hooks的使用\">mkinitcpio-docker-hooks的使用</h1>\n<p>mkinitcpio-docker-hooks的使用流程大概分为如下几步：</p>\n<ol>\n<li>确保你的<code>/var/lib/docker</code>位于某个btrfs分区中</li>\n<li>准备一个适合在裸机上启动的docker镜像</li>\n<li>然后在这个镜像中安装并配置mkinitcpio-docker-hooks</li>\n<li>准备内核跟initramfs</li>\n<li>准备top layer的内容</li>\n<li>设置启动管理器</li>\n</ol>\n<h2 id=\"docker镜像的准备\">docker镜像的准备</h2>\n<p>要想启动到docker镜像中去，首先你得有一个适合在裸机上启动的docker镜像。很多docker镜像，为了减小镜像的大小，是不会附带只有裸机上才能用到的软件包（比如<code>dhcpcd</code>）的，所以读者可能需要在Dockerfile中手动安装这些软件包，对于Arch Linux来讲，只需要安装base组就可以了。由于接下来要安装<code>mkinitcpio-docker-hooks</code>，这里推荐使用一个已经内置yaourt的镜像，笔者使用的是自己的archlinux-yaourt镜像<a href=\"https://cloud.docker.com/swarm/zasdfgbnm/repository/docker/zasdfgbnm/archlinux-yaourt/general\" target=\"_blank\" rel=\"noopener\">zasdfgbnm/archlinux-yaourt</a>。所以，Dockerfile的开头看起来是这个样子的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69106573197177925405\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM zasdfgbnm/archlinux-yaourt\r\nUSER root\r\nRUN pacman -Syu --noconfirm base</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69106573197177925405-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69106573197177925405-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69106573197177925405-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69106573197177925405-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">zasdfgbnm</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">yaourt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69106573197177925405-2\"><span class=\"crayon-e\">USER </span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-5a69106573197177925405-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Syu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">base</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>作为示例，这里就不安装base之外的其他软件了，读者请自己根据需要安装其他软件。</p>\n<h2 id=\"安装并配置mkinitcpio-docker-hooks\">安装并配置mkinitcpio-docker-hooks</h2>\n<p><code>mkinitcpio-docker-hooks</code>的安装是在docker里面而不是当前运行在裸机上的系统中进行的。之所以要把这个软件包安装在docker镜像里面，很重要的原因是因为Linux内核不提供ABI的稳定性，所以内核模块跟内核的版本必须严格对应，不然模块是无法加载的。为了保持这种一致性，我们采取的措施是，在docker里面安装<code>mkinitcpio-docker-hooks</code>，在docker中生成initramfs，并且在启动的时候用镜像里面的内核启动，就可以确保内核、initramfs中的模块、启动到镜像以后的<code>/lib/modules</code>三者保持一致。安装过程在Dockerfile中的写法如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6910657319b976053509\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRUN sudo -u user yaourt -S --noconfirm mkinitcpio-docker-hooks</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6910657319b976053509-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6910657319b976053509-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">hooks</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>安装完了<code>mkinitcpio-docker-hooks</code>以后还需要配置，配置文件在<code>/etc/docker-btrfs.json</code>，初始内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6910657319f095481348\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n    \"docker_image\": \"archlinux/base\",\r\n    \"docker_tag\": \"latest\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6910657319f095481348-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6910657319f095481348-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6910657319f095481348-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6910657319f095481348-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6910657319f095481348-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6910657319f095481348-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"docker_image\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"archlinux/base\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a6910657319f095481348-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"docker_tag\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"latest\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6910657319f095481348-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们需要做的就是把这两个变量的值替换为我们想要的值，比如说这里我打算把我的docker镜像的名字叫做“sample_image”。同时，我们还需要在<code>/etc/mkinitcpio.conf</code>中添加<code>docker-btrfs</code>这个hook。<br>\n综上，可以在Dockerfile中使用如下命令来配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691065731a2825120272\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRUN sed -i 's/archlinux\\/base/sample_image/g' /etc/docker-btrfs.json\r\nRUN perl -i -p -e 's/(?&lt;=^HOOKS=<span class=\"MathJax_Preview\">\\()(.*)(?=\\)</span>)/$1 docker-btrfs/g' /etc/mkinitcpio.conf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691065731a2825120272-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691065731a2825120272-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691065731a2825120272-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/archlinux\\/base/sample_image/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">btrfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691065731a2825120272-2\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">perl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/(?&lt;=^HOOKS=<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>(.*)(?=<span class=\"MathJax_Preview\">\\()/$1 docker-btrfs/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span></span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>??????????????Dockerfile??</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691065731a6594277929\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"?????\"></span><div class=\"crayon-button crayon-nums-button\" title=\"?????????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"???????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"??????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"??????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"?????????\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM zasdfgbnm/archlinux-yaourt\r\nUSER root\r\nRUN pacman -Syu --noconfirm base\r\nRUN sudo -u user yaourt -S --noconfirm mkinitcpio-docker-hooks\r\nRUN sed -i 's/archlinux\\/base/sample_image/g' /etc/docker-btrfs.json\r\nRUN perl -i -p -e 's/(?&lt;=^HOOKS=\\))(.*)(?=<span class=\"MathJax_Preview\">\\()/$1 docker-btrfs/g' /etc/mkinitcpio.conf</span></textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691065731a6594277929-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691065731a6594277929-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691065731a6594277929-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691065731a6594277929-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691065731a6594277929-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691065731a6594277929-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691065731a6594277929-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">zasdfgbnm</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">yaourt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691065731a6594277929-2\"><span class=\"crayon-e\">USER </span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-5a691065731a6594277929-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Syu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-e\">base</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691065731a6594277929-4\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">hooks</span></div><div class=\"crayon-line\" id=\"crayon-5a691065731a6594277929-5\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/archlinux\\/base/sample_image/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">btrfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691065731a6594277929-6\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">perl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/(?&lt;=^HOOKS=<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>(.*)(?=\\)</span>)/$1 docker-btrfs/g'<span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>\n</p></div>\n<div>\n<p>只需要通过<code>docker build . -t sample_image</code>就可以构建自己的镜像了。</p>\n<h2 id=\"准备内核跟initramfs\">准备内核跟initramfs</h2>\n<p>镜像生成好了以后，下一步就是准备内核跟构建initramfs了。注意这一步操作尽量在你打算用来启动docker镜像的机器上进行，因为mkinitcpio会自动根据机器把相应的内核模块放入initramfs中去，如果在别的机器上进行的话，那就可能会有一些驱动没有被自动装入initramfs中。如前所述，这一步的工作是在docker容器中进行的。首先运行容器并开启一个shell：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691065731a9758225827\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocker run -v $(pwd):/workspace -w /workspace -it sample_image bash</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691065731a9758225827-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691065731a9758225827-1\"><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pwd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">workspace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">workspace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">sample_image </span><span class=\"crayon-v\">bash</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>然后在容器中执行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691065731ad204054013\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkinitcpio -p linux\r\ncp /boot/* .\r\nexit</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691065731ad204054013-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691065731ad204054013-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691065731ad204054013-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691065731ad204054013-1\"><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691065731ad204054013-2\"><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a691065731ad204054013-3\"><span class=\"crayon-v\">exit</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后就可以在当前目录下看到准备好的<code>initramfs-linux-fallback.img</code>、<code>initramfs-linux.img</code>以及<code>vmlinuz-linux</code>了。</p>\n<h2 id=\"准备top-layer的内容\">准备top layer的内容</h2>\n<p>Top layer是<code>mkinitcpio-docker-hooks</code>引入的新概念，它指的是某个驱动器中的某个目录，这个目录会在启动的时候读写层创建之后，真正的root挂载之前，通过busybox的<code>cp -a</code>命令整个拷贝到读写层里面去。为什么需要top layer呢？因为我们需要在多台机器上启动同一个镜像，而不同机器上的往往会根据需要配置不同的配置文件，比如<code>/etc/fstab</code>以及<code>/etc/X11/xorg.conf</code>。另外，DockerHub免费账户上的镜像都是公开的，<code>/etc/passwd</code>、<code>/etc/shadow</code>等的私密性文件也不适合放在镜像里面存储。</p>\n<p>准备top layer的内容，实际上就是找一个文件夹，把需要单独配置的文件，按照从根目录算起的相对路径存放在这个文件夹里面。比如说如果你想给某台机器单独配置<code>/etc/fstab</code>，那么你就应该在top layer的目录中添加<code>etc/fstab</code>这个文件。这里推荐的具体的操作流程是：首先通过<code>docker run -v $(pwd):/workspace -w /workspace -it sample_image bash</code>进入容器中的shell，然后在其中做各种配置，比如<code>useradd ...</code>，完了以后把新生成的配置文件拷贝到top layer的文件夹中去</p>\n<h2 id=\"设置启动管理器\">设置启动管理器</h2>\n<p>设置好了top layer以后，我们基本上可以算是万事具备只差东风了。我们只需要简单设置一下启动管理器就可以启动我们的系统了。这里以refind为例子，这里假设我们的所有东西放在一个label为“linux”的btrfs分区中，docker目录（也就是你系统启动以后会挂载到<code>/var/lib/docker</code>的目录）存放在这个分区根目录下的一个叫做“docker”的子卷中，而内核、initramfs以及top layer都是位于分区根目录下的“boot_docker”文件夹中，而我们希望创建的读写层名字叫做“docker_rwlayer”，那么相应的<code>refind.conf</code>中的菜单项的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691065731b1425720261\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmenuentry archlinux-docker {\r\n        icon EFI/refind/icons/os_arch.png\r\n        volume linux\r\n        loader boot_docker/vmlinuz-linux\r\n        initrd boot_docker/initramfs-linux.img\r\n        options \"root=LABEL=linux rootflags=subvol=docker_rwlayer rw docker_path=docker toplayer=LABEL=linux toplayer_path=boot_docker\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691065731b1425720261-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691065731b1425720261-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691065731b1425720261-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691065731b1425720261-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691065731b1425720261-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691065731b1425720261-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691065731b1425720261-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691065731b1425720261-1\"><span class=\"crayon-e\">menuentry</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">docker</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691065731b1425720261-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">icon </span><span class=\"crayon-v\">EFI</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">refind</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">icons</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">os_arch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">png</span></div><div class=\"crayon-line\" id=\"crayon-5a691065731b1425720261-3\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">volume </span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691065731b1425720261-4\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">loader </span><span class=\"crayon-v\">boot_docker</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vmlinuz</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line\" id=\"crayon-5a691065731b1425720261-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">initrd </span><span class=\"crayon-v\">boot_docker</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">initramfs</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">linux</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">img</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691065731b1425720261-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-i\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"root=LABEL=linux rootflags=subvol=docker_rwlayer rw docker_path=docker toplayer=LABEL=linux toplayer_path=boot_docker\"</span></div><div class=\"crayon-line\" id=\"crayon-5a691065731b1425720261-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>其中内核选项中，我们通过<code>root</code>来指定docker目录所在的分区，<code>rootflags</code>中的<code>subvol</code>来指定读写层的位置，<code>docker_path</code>来指定docker目录在<code>root</code>中的相对位置；通过<code>toplayer</code>来指定top layer目录所在的分区，<code>toplayerflags</code>来指定top layer所在分区的挂载选项，<code>toplayer_path</code>来指定top layer的目录在<code>toplayer</code>分区中的相对位置。</p>\n<p>一切就绪，重启并享受吧！</p>\n<p>另外，有兴趣的读者可以看一下笔者自用的docker镜像作为参考：<br>\n<a href=\"https://cloud.docker.com/swarm/zasdfgbnmsystem/repository/docker/zasdfgbnmsystem/archlinux-kde/general\" target=\"_blank\" rel=\"noopener\">https://cloud.docker.com/swarm/zasdfgbnmsystem/repository/docker/zasdfgbnmsystem/archlinux-kde/general</a><br>\n<a href=\"https://github.com/zasdfgbnm-dockers/archlinux-kde\" target=\"_blank\" rel=\"noopener\">https://github.com/zasdfgbnm-dockers/archlinux-kde</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113448\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113448votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113448\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113448/", "comment_nums": 0, "create_date": "2018/01/08", "tags": "IT技术,Docker", "url_object_id": "7b88426617fb1d20ba1260658b57c9c2", "front_image_path": "full/67490ccebef720732b63d9ddb9e17fb0a590e30a.jpg"}
{"fav_nums": 1, "praise_nums": "2", "title": "回顾 2017 年发布的 10 个新数据库系统", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/2ac94408c2b9b608ef46f4789480c6e8.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/a-look-at-ten-new-database-systems-released-in-2017-94a3aa4c2aab\">hackernoon</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/a-look-at-ten-new-database-systems-released-in-2017?print\">oschina</a>   </div><div>\n<p>作为 <a href=\"https://dbweekly.com/\" target=\"_blank\" rel=\"nofollow\">Database Weekly</a> 的编辑（Database Weekly 是一份关于数据库和数据存储世界新内容的每周时事资讯），我喜欢在新的数据库系统中闲逛，看看在未来的几十年里，哪些想法可能会影响到日常的开发人员。</p>\n<p>数据库世界并不是每周都有让人不可思议的新闻，但在一年的时间里，我还是惊讶地发现，我们看到了很多新事物，以及该领域坚持不懈地发展。2017 年也不例外，所以我想回顾一下一些有趣的新发行版，包括<strong>一个事务性图表数据库，</strong><strong>一个可复制的</strong><strong>地理</strong><strong>多模型数据库，以及一个新的高性能键/值存储数据库</strong>。</p>\n<h1>TimescaleDB  — 一款基于 Postgres 的能自动分区的时间序列数据库</h1>\n<p>其中一个令人兴奋的新扩展源于 PostgreSQL，<a href=\"https://github.com/timescale/timescaledb/\" target=\"_blank\" rel=\"nofollow\">Timescale</a> 基于 Apache 2.0 的许可，它是由一个名为 <a href=\"http://www.timescale.com/about\" target=\"_blank\" rel=\"nofollow\">PhD-packed</a> 的机构支持启动的。</p>\n<p>Timescale 通过自动分区为 Postgres 添加时间序列存储功能，但是却包含在寻常的 Postgres 界面和工具中。 查询是使用常规的 SQL 对“提供与时间序列数据的接口” 的 “hypertable” 进行的。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/40b30a4a177a78bd9adccf76a0750af7.png\" width=\"1064\" height=\"552\"></p>\n<h3>Microsoft Azure Cosmos DB  — 微软的多模式数据库</h3>\n<p><a href=\"https://docs.microsoft.com/en-us/azure/cosmos-db/introduction\" target=\"_blank\" rel=\"nofollow\">Cosmos DB</a> 本质上是 Azure 的旧的 <em>DocumentDB </em>的品牌重塑和重新构建，但是它很容易实现将全球分布式数据跟 Azure 的多样数据中心交叉。全球分布是 Cosmos DB 的杀手锏，并且它可以将数据库请求路由到包含数据的最近区域，而不需要更改配置。</p>\n<p>“多模式”的部分也很重要。虽然一切都在无模式的 JSON 的引擎盖下，但依然有一个 SQL 查询 API ，以及 MongoDB API、Cassandra API，甚至一个图形数据库 API（基于 <a href=\"https://tinkerpop.apache.org/gremlin.html\" target=\"_blank\" rel=\"nofollow\">Gremlin</a> ）。</p>\n<p>学习更多关于 Cosmos 的较好的方式之一是这个微软的第9频道的 <a href=\"https://channel9.msdn.com/Shows/Azure-Friday/Introducing-Azure-Cosmos-DB\" target=\"_blank\" rel=\"nofollow\">15 分钟视频介绍</a>。</p>\n<h1>Cloud Spanner  —  Google 全球分布式关系数据库</h1>\n<p>Google 的 <a href=\"https://cloud.google.com/spanner/\" target=\"_blank\" rel=\"nofollow\">Cloud Spanner</a> 已经工作了很长一段时间了，起初是在 2012 年一篇非常有趣的<a href=\"https://research.google.com/archive/spanner.html\" target=\"_blank\" rel=\"nofollow\">学术论文</a>中公开阐释的（虽然开发始于 2007 年）。最初的开发是因为 Google 需要一个全球化分布式的高可用性存储系统，但其现在也向公众开放。</p>\n<p>谷歌认识到，使 Cloud Spanner 适合其自身用途的功能对企业也很有吸引力，因此它承诺 99.999％ 的可用性、无计划停机时间和“企业级”安全性。</p>\n<p>Cloud Spanner 支持 ANSI 2011 SQL ，为已熟悉关系数据库概念的开发人员提供了经过战斗级测试的高可用性水平扩展的关系数据库。</p>\n<h1>Neptune  —  Amazon 的全面管理图形数据库服务</h1>\n<p>Microsoft 和 Google 我们都已经讲到了, 所以怎么能漏了 Amazon 呢? 这是另外一个受限于特定云服务的数据库,  Amazon 在最近召开的 re:Invent 大会上展示了 <a href=\"https://aws.amazon.com/blogs/aws/amazon-neptune-a-fully-managed-graph-database-service/\" target=\"_blank\" rel=\"nofollow\">Neptune</a> 的预览。</p>\n<p>Neptune 承诺会是一个快速且可靠的图形数据库服务，其目的是能迅速地为开发者提供图形数据库服务，并且不会让他们感到麻烦，当然这些是要付费的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8f0c13cb0e12a7d59ea6a96244a9be6d.png\" width=\"1600\" height=\"829\"></p>\n<p>Neptune 支持用两种标准来对你的图形库进行查询, 一个是得到越来越多的支持的 <a href=\"https://tinkerpop.apache.org/gremlin.html\" target=\"_blank\" rel=\"nofollow\">Gremlin</a> 的“黄金”标准，还有就是 SPARQL (你的图形会被当作是一个 RDF )。</p>\n<h1>YugaByte  —  一个开源的云原生数据库</h1>\n<p>YugaByte 今年因其“隐形模式”脱颖而出，它提供了一个支持 SQL 和 NoSQL 操作模式的数据库。目的是在云中直接使用，充当对容器的有状态补充。</p>\n<p>YugaByte 使用 C ++ 构建并开源，支持 Cassandra 查询语言（CQL）以及 Redis 协议。 对 PostgreSQL 协议的支持正在进行中，Spark 应用可在上面运行。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8e53217015a1de7c879dca55e0c9148b.png\"></p>\n<p>YugaByte 是另一个启动后才受到支持的项目（由扩展了 Apache HBase 平台的一位 Facebook 工程师创建），其业务模式初定是会有一个“企业版”，在开源社区版的基础上增加多云集群协调 ，监视和警报，分层存储和支持等特性。</p>\n<h1>Peloton  —  一个自驱动的 SQL DBMS</h1>\n<p>Peloton 探索了一些有趣的想法，特别是在使用 AI 来自动优化数据库的领域。它还支持字节寻址 NVM 存储技术，并且是使用 Apache 许可开源的。</p>\n<p>“自驱动”数据库背后的想法是，DBMS 可以自主操作和调整自身。它可以预测工作负载的趋势，并据此做好准备，而无需 DBA 或操作员掌控。</p>\n<p>也许毫不奇怪的是，Peloton 源于一个学术项目（特别是来自卡内基梅隆大学），其创建者之一写了一篇关于<a href=\"http://www.cs.cmu.edu/~pavlo/blog/2017/03/building-a-new-database-management-system-in-academia.html\" target=\"_blank\" rel=\"nofollow\">为什么它被创建</a>的系列文章。它已经开发好几年了，但在 2017 年变得更加开放。</p>\n<h1>JanusGraph  —  一个基于 Java 的分布式图形数据库</h1>\n<p><a href=\"http://janusgraph.org/\" target=\"_blank\" rel=\"nofollow\">JanusGraph</a> 是一个实用的、随时可用的数据库，其中包含大量的集成，并且建立在 <a href=\"https://www.datanami.com/2017/01/13/janusgraph-picks-titandb-left-off/\" target=\"_blank\" rel=\"nofollow\">TitanDB</a> 的坚实基础之上。它针对可扩展性、存储及查询巨大图形数据库做了优化，同时支持事务和大量并发用户。</p>\n<p>它可以使用 Cassandra、HBase、Google Cloud Bigtable 和 BerkeleyDB 作为存储后端，并且可以与 Spark、Giraph 和 Hadoop 直接整合。它甚至支持与 ElasticSearch、Solr 或 Lucene 集成的全文和地理位置检索。</p>\n<h1>Aurora Serverless  — AWS 上即时可伸缩，“即付即用”的关系型数据库</h1>\n<p>另一个来自 Amazo re:Invent 会议的公告是他们成功的 Aurora 数据库服务的无服务器版本，<a href=\"https://aws.amazon.com/blogs/aws/in-the-works-amazon-aurora-serverless/\" target=\"_blank\" rel=\"nofollow\">Aurora Serverless</a>。</p>\n<p>随着整合到“无服务器”平台的最新趋势，这个平台将永远消除你在扩展和操作上的难题，Aurora Serverless背后的理念是许多数据库用例不需要一致的性能或使用水平，相反，你可以“随时付费”（逐秒付费），以便按需调整数据库的大小。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/4809d02fc77b45a482ea3af14eb2bb60.png\" width=\"755\" height=\"642\"></p>\n<p>它目前仅是预览版，但承诺在 2018 年会有重大进展。</p>\n<h1>TileDB  — 用于存储大密度及稀疏矩阵数组</h1>\n<p><a href=\"https://www.tiledb.io/\" target=\"_blank\" rel=\"nofollow\">TileDB</a> 是起源自麻省理工学院和英特尔的数据库，用于存储多维阵列数据，这是类似基因科学、医学成像和金融时间序列等领域常见的要求。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/6770c8c2000de96d806a5af2bd65a7cd.png\" width=\"1182\" height=\"638\"></p>\n<p>它支持许多压缩机制（如 gzip、lz4、Blosc 和 RLE ）和存储后端（如 GFS、S3 和 HDFS ）。</p>\n<h1>Memgraph  —  一个高性能、可内存驻留的图形数据库</h1>\n<p><a href=\"https://blog.memgraph.com/hello-memgraph-44f51032434a\" target=\"_blank\" rel=\"nofollow\">Memgraph</a> 背后的驱动力是为快速分析和使用来自人造和机器智能的数据以及设备和物联网不断增长的互联性提供工具。因此，优先事项是“速度、可伸缩和简单性”。</p>\n<p>在 Memgraph 的生命周期中，它还处于早期阶段，它不是开源的，但可以通过 <a href=\"https://memgraph.com/signup/\" target=\"_blank\" rel=\"nofollow\">request</a> 下载。它支持 openCypher 图形查询语言，支持内存中的 ACID 事务，并具有基于磁盘的持久化机制。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113486\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113486votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113486\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113486/", "comment_nums": 0, "create_date": "2018/01/15", "tags": "IT技术,数据库", "url_object_id": "c076daad60b2381e80d746469f1a1e75", "front_image_path": "full/f4d2b6028968839733a5ab5609044374c75c82af.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "Pick：一款 Linux 上的命令行模糊搜索工具", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/7d112f146569e6ad0cf3eb62defddc10.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/pick-commandline-fuzzy-search-tool-linux/\">Sk</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9234-1.html\">lujun9972</a>   </div><p>今天，我们要讲的是一款有趣的命令行工具，名叫 Pick。它允许用户通过 ncurses(3X) 界面来从一系列选项中进行选择，而且还支持模糊搜索的功能。当你想要选择某个名字中包含非英文字符的目录或文件时，这款工具就很有用了。你根本都无需学习如何输入非英文字符。借助 Pick，你可以很方便地进行搜索、选择，然后浏览该文件或进入该目录。你甚至无需输入任何字符来过滤文件/目录。这很适合那些有大量目录和文件的人来用。</p>\n<h3 id=\"toc_1\">安装 Pick</h3>\n<p>对 Arch Linux 及其衍生品来说，Pick 放在 <a href=\"https://aur.archlinux.org/packages/pick/\">AUR</a> 中。因此 Arch 用户可以使用类似 <a href=\"https://www.ostechnix.com/install-pacaur-arch-linux/\">Pacaur</a>，<a href=\"https://www.ostechnix.com/install-packer-arch-linux-2/\">Packer</a>，以及 <a href=\"https://www.ostechnix.com/install-yaourt-arch-linux/\">Yaourt</a> 等 AUR 辅助工具来安装它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb4e420459871\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacaur -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb4e420459871-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb4e420459871-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb4e420459871-1\"><span class=\"crayon-v\">pacaur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb4e420459871-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb57999382853\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacker -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb57999382853-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb57999382853-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb57999382853-1\"><span class=\"crayon-v\">packer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb57999382853-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb5b340380714\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nyaourt -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb5b340380714-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb5b340380714-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb5b340380714-1\"><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb5b340380714-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>Debian，Ubuntu，Linux Mint 用户则可以通过运行下面命令来安装 Pick。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb5e797109180\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt-get install pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb5e797109180-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb5e797109180-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb5e797109180-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb5e797109180-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>其他的发行版则可以从<a href=\"https://github.com/calleerlandsson/pick/releases/\">这里</a>下载最新的安装包，然后按照下面的步骤来安装。在写本指南时，其最新版为 1.9.0。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb62787697172\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget https://github.com/calleerlandsson/pick/releases/download/v1.9.0/pick-1.9.0.tar.gz\r\ntar -zxvf pick-1.9.0.tar.gz\r\ncd pick-1.9.0/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb62787697172-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb62787697172-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb62787697172-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb62787697172-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb62787697172-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/calleerlandsson/pick/releases/download/v1.9.0/pick-1.9.0.tar.gz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb62787697172-2\"><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">zxvf </span><span class=\"crayon-v\">pick</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.9.0.tar.gz</span></div><div class=\"crayon-line\" id=\"crayon-5a6942d42cb62787697172-3\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">pick</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.9.0</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb62787697172-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>使用下面命令进行配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb65444853709\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n./configure\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb65444853709-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb65444853709-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb65444853709-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">configure</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb65444853709-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>最后，构建并安装 Pick：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb68153510359\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmake\r\nsudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb68153510359-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb68153510359-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb68153510359-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb68153510359-1\"><span class=\"crayon-e\">make</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb68153510359-2\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line\" id=\"crayon-5a6942d42cb68153510359-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">用法</h3>\n<p>通过将它与其他命令集成能够大幅简化你的工作。我这里会给出一些例子，让你理解它是怎么工作的。</p>\n<p>让们先创建一堆目录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb6c093842347\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkdir -p abcd/efgh/ijkl/mnop/qrst/uvwx/yz/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb6c093842347-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb6c093842347-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb6c093842347-1\"><span class=\"crayon-v\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">abcd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">efgh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ijkl</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnop</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">qrst</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">uvwx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">yz</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb6c093842347-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在，你想进入目录 <code>/ijkl/</code>。你有两种选择。可以使用 <code>cd</code> 命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb6f468263328\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd abcd/efgh/ijkl/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb6f468263328-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb6f468263328-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb6f468263328-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">abcd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">efgh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ijkl</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb6f468263328-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，创建一个<a href=\"https://www.ostechnix.com/create-shortcuts-frequently-used-directories-shell/\">快捷方式</a> 或者说别名指向这个目录，这样你可以迅速进入该目录。</p>\n<p>但，使用 <code>pick</code> 命令则问题变得简单的多。看下面这个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb72075059650\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd $(find . -type d | pick)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb72075059650-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb72075059650-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb72075059650-1\"><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pick</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb72075059650-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这个命令会列出当前工作目录下的所有目录及其子目录，你可以用上下箭头选择你想进入的目录，然后按下回车就行了。</p>\n<p>像这样：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/7d112f146569e6ad0cf3eb62defddc10.png\" alt=\"\"></p>\n<p>而且，它还会根据你输入的内容过滤目录和文件。比如，当我输入 “or” 时会显示如下结果。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/1db4853003ed6321a72b1ac1ff473d3d.png\" alt=\"\"></p>\n<p>这只是一个例子。你也可以将 <code>pick</code> 命令跟其他命令一起混用。</p>\n<p>这是另一个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb76375359463\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind -type f | pick | xargs less\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb76375359463-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb76375359463-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb76375359463-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pick</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xargs </span><span class=\"crayon-i\">less</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb76375359463-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>该命令让你选择当前目录中的某个文件并用 <code>less</code> 来查看它。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/cbfa180365bc1990e9121309b81fb5ee.png\" alt=\"\"></p>\n<p>还想看其他例子？还有呢。下面命令让你选择当前目录下的文件或目录，并将之迁移到其他地方去，比如这里我们迁移到 <code>/home/sk/ostechnix</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb7a096631955\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmv \"$(find . -maxdepth 1 |pick)\" /home/sk/ostechnix/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb7a096631955-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb7a096631955-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb7a096631955-1\"><span class=\"crayon-i\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$(find . -maxdepth 1 |pick)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb7a096631955-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/6187091d46b0b73336ddb482c5ae6f40.png\" alt=\"\"></p>\n<p>通过上下按钮选择要迁移的文件，然后按下回车就会把它迁移到 <code>/home/sk/ostechnix/</code> 目录中的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b7df7f0dcb71b09605e0bb76d84f68b7.png\" alt=\"\"></p>\n<p>从上面的结果中可以看到，我把一个名叫 <code>abcd</code> 的目录移动到 <code>ostechnix</code> 目录中了。</p>\n<p>使用方式是无限的。甚至 Vim 编辑器上还有一个叫做 <a href=\"https://github.com/calleerlandsson/pick.vim/\">pick.vim</a> 的插件让你在 Vim 中选择更加方便。</p>\n<p>要查看详细信息，请参阅它的 man 页。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6942d42cb7d550348450\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6942d42cb7d550348450-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6942d42cb7d550348450-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6942d42cb7d550348450-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6942d42cb7d550348450-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>我们的讲解至此就结束了。希望这款工具能给你们带来帮助。如果你觉得我们的指南有用的话，请将它分享到您的社交网络上，并向大家推荐我们。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113480\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113480votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113480\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113480/", "comment_nums": 0, "create_date": "2018/01/15", "tags": "工具与资源,Linux,Pick", "url_object_id": "d9bc9c062a769388a3915d069b5fe2f3", "front_image_path": "full/c45857466a0e2dd99c4e857f56ca13903c5eac72.jpg"}
{"fav_nums": 2, "praise_nums": "2", "title": "为小白准备的重要 Docker 命令说明", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/382b1251c2cdb32cf334445596f97085.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://linuxtechlab.com/important-docker-commands-beginners/\">Shusain </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9227-1.html\">lujun9972</a>   </div><p>在早先的教程中，我们学过了<a href=\"http://linuxtechlab.com/create-first-docker-container-beginners-guide/\">在 RHEL CentOS 7 上安装 Docker 并创建 docker 容器</a>。 在本教程中，我们会学习管理 docker 容器的其他命令。</p>\n<h3 id=\"toc_1\">Docker 命令语法</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a502326106971\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker [option] [command] [arguments]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a502326106971-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a502326106971-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a502326106971-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">docker</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a502326106971-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>要列出 docker 支持的所有命令，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a50c817326068\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a50c817326068-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a50c817326068-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a50c817326068-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">docker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a50c817326068-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>我们会看到如下结果，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a510416266420\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nattach Attach to a running container\r\nbuild  Build an image from a Dockerfile\r\ncommit  Create a new image from a container's changes\r\ncp  Copy files/folders between a container and the local filesystem\r\ncreate  Create a new container\r\ndiff  Inspect changes on a container's filesystem\r\nevents  Get real time events from the server\r\nexec  Run a command in a running container\r\nexport  Export a container's filesystem as a tar archive\r\nhistory  Show the history of an image\r\nimages  List images\r\nimport  Import the contents from a tarball to create a filesystem image\r\ninfo  Display system-wide information\r\ninspect  Return low-level information on a container or image\r\nkill  Kill a running container\r\nload  Load an image from a tar archive or STDIN\r\nlogin  Log in to a Docker registry\r\nlogout  Log out from a Docker registry\r\nlogs  Fetch the logs of a container\r\nnetwork  Manage Docker networks\r\npause  Pause all processes within a container\r\nport  List port mappings or a specific mapping for the CONTAINER\r\nps  List containers\r\npull  Pull an image or a repository from a registry\r\npush  Push an image or a repository to a registry\r\nrename  Rename a container\r\nrestart  Restart a container\r\nrm  Remove one or more containers\r\nrmi  Remove one or more images\r\nrun  Run a command in a new container\r\nsave  Save one or more images to a tar archive\r\nsearch  Search the Docker Hub for images\r\nstart  Start one or more stopped containers\r\nstats  Display a live stream of container(s) resource usage statistics\r\nstop  Stop a running container\r\ntag  Tag an image into a repository\r\ntop  Display the running processes of a container\r\nunpause  Unpause all processes within a container\r\nupdate  Update configuration of one or more containers\r\nversion  Show the Docker version information\r\nvolume  Manage Docker volumes\r\nwait  Block until a container stops, then print its exit code\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a510416266420-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a510416266420-43\">43</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-1\"><span class=\"crayon-e\">attach </span><span class=\"crayon-e\">Attach </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-2\"><span class=\"crayon-e\">build  </span><span class=\"crayon-e\">Build </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dockerfile</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-3\"><span class=\"crayon-e\">commit  </span><span class=\"crayon-i\">Create</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">container</span><span class=\"crayon-s\">'s changes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-4\"><span class=\"crayon-s\">cp  Copy files/folders between a container and the local filesystem</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-5\"><span class=\"crayon-s\">create  Create a new container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-6\"><span class=\"crayon-s\">diff  Inspect changes on a container'</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-7\"><span class=\"crayon-e\">events  </span><span class=\"crayon-e\">Get </span><span class=\"crayon-e\">real </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">events </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-8\"><span class=\"crayon-e\">exec  </span><span class=\"crayon-i\">Run</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-9\"><span class=\"crayon-e\">export  </span><span class=\"crayon-i\">Export</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">container</span>'<span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-10\"><span class=\"crayon-e\">history  </span><span class=\"crayon-e\">Show </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">history </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-11\"><span class=\"crayon-e\">images  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-12\"><span class=\"crayon-e\">import  </span><span class=\"crayon-e\">Import </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">contents </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tarball </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-13\"><span class=\"crayon-e\">info  </span><span class=\"crayon-e\">Display </span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">wide </span><span class=\"crayon-e\">information</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-14\"><span class=\"crayon-e\">inspect  </span><span class=\"crayon-st\">Return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">low</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">level </span><span class=\"crayon-e\">information </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-15\"><span class=\"crayon-e\">kill  </span><span class=\"crayon-i\">Kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-16\"><span class=\"crayon-e\">load  </span><span class=\"crayon-e\">Load </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STDIN</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-17\"><span class=\"crayon-e\">login  </span><span class=\"crayon-e\">Log </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-18\"><span class=\"crayon-e\">logout  </span><span class=\"crayon-e\">Log </span><span class=\"crayon-e\">out </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-19\"><span class=\"crayon-e\">logs  </span><span class=\"crayon-e\">Fetch </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">logs </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-20\"><span class=\"crayon-e\">network  </span><span class=\"crayon-e\">Manage </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">networks</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-21\"><span class=\"crayon-e\">pause  </span><span class=\"crayon-e\">Pause </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">within</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-22\"><span class=\"crayon-e\">port  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">port </span><span class=\"crayon-e\">mappings </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">specific </span><span class=\"crayon-e\">mapping </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">CONTAINER</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-23\"><span class=\"crayon-e\">ps  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-24\"><span class=\"crayon-e\">pull  </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-25\"><span class=\"crayon-e\">push  </span><span class=\"crayon-e\">Push </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-26\"><span class=\"crayon-e\">rename  </span><span class=\"crayon-i\">Rename</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-27\"><span class=\"crayon-e\">restart  </span><span class=\"crayon-i\">Restart</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-28\"><span class=\"crayon-e\">rm  </span><span class=\"crayon-e\">Remove </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-29\"><span class=\"crayon-e\">rmi  </span><span class=\"crayon-e\">Remove </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-30\"><span class=\"crayon-e\">run  </span><span class=\"crayon-i\">Run</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-31\"><span class=\"crayon-e\">save  </span><span class=\"crayon-e\">Save </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">images </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-32\"><span class=\"crayon-e\">search  </span><span class=\"crayon-e\">Search </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">Hub </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-33\"><span class=\"crayon-e\">start  </span><span class=\"crayon-e\">Start </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">stopped </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-34\"><span class=\"crayon-e\">stats  </span><span class=\"crayon-i\">Display</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">live </span><span class=\"crayon-e\">stream </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">container</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">resource </span><span class=\"crayon-e\">usage </span><span class=\"crayon-e\">statistics</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-35\"><span class=\"crayon-e\">stop  </span><span class=\"crayon-i\">Stop</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-36\"><span class=\"crayon-e\">tag  </span><span class=\"crayon-e\">Tag </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-37\"><span class=\"crayon-e\">top  </span><span class=\"crayon-e\">Display </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-38\"><span class=\"crayon-e\">unpause  </span><span class=\"crayon-e\">Unpause </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">within</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-39\"><span class=\"crayon-e\">update  </span><span class=\"crayon-e\">Update </span><span class=\"crayon-e\">configuration </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-40\"><span class=\"crayon-e\">version  </span><span class=\"crayon-e\">Show </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">version </span><span class=\"crayon-e\">information</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-41\"><span class=\"crayon-e\">volume  </span><span class=\"crayon-e\">Manage </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">volumes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a510416266420-42\"><span class=\"crayon-e\">wait  </span><span class=\"crayon-e\">Block </span><span class=\"crayon-i\">until</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container </span><span class=\"crayon-v\">stops</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print </span><span class=\"crayon-e\">its </span><span class=\"crayon-e\">exit </span><span class=\"crayon-i\">code</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a510416266420-43\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0088 seconds] -->\r\n<p>要进一步查看某个命令支持的选项，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a515323885688\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker docker-subcommand info\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a515323885688-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a515323885688-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a515323885688-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">subcommand </span><span class=\"crayon-i\">info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a515323885688-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>就会列出 docker 子命令所支持的选项了。</p>\n<h3 id=\"toc_2\">测试与 Docker Hub 的连接</h3>\n<p>默认，所有镜像都是从 Docker Hub 中拉取下来的。我们可以从 Docker Hub 上传或下载操作系统镜像。为了检查我们是否能够正常地通过 Docker Hub 上传/下载镜像，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a518511852274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker run hello-world\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a518511852274-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a518511852274-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a518511852274-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">hello</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">world</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a518511852274-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>结果应该是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a51c942215454\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHello from Docker.\r\nThis message shows that your installation appears to be working correctly.\r\n…\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a51c942215454-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a51c942215454-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a51c942215454-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a51c942215454-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a51c942215454-1\"><span class=\"crayon-e\">Hello </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Docker</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a51c942215454-2\"><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">message </span><span class=\"crayon-e\">shows </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">installation </span><span class=\"crayon-e\">appears </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be </span><span class=\"crayon-e\">working </span><span class=\"crayon-v\">correctly</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a696bee4a51c942215454-3\">…</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a51c942215454-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输出结果表示你可以访问 Docker Hub 而且也能从 Docker Hub 下载 docker 镜像。</p>\n<h3 id=\"toc_3\">搜索镜像</h3>\n<p>搜索容器的镜像，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a51f452771337\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker search Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a51f452771337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a51f452771337-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a51f452771337-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">search </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a51f452771337-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我们应该会得到可用的 Ubuntu 镜像的列表。记住，如果你想要的是官方的镜像，请检查 <code>official</code> 这一列上是否为 <code>[OK]</code>。</p>\n<h3 id=\"toc_4\">下载镜像</h3>\n<p>一旦搜索并找到了我们想要的镜像，我们可以运行下面语句来下载它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a522232091427\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker pull Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a522232091427-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a522232091427-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a522232091427-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">pull </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a522232091427-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>要查看所有已下载的镜像，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a526562834528\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker images\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a526562834528-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a526562834528-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a526562834528-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a526562834528-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_5\">运行容器</h3>\n<p>使用已下载镜像来运行容器，使用下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a529705369920\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker run -it Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a529705369920-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a529705369920-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a529705369920-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">it </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a529705369920-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这里，使用 <code>-it</code> 会打开一个 shell 与容器交互。容器启动并运行后，我们就可以像普通机器那样来使用它了，我们可以在容器中执行任何命令。</p>\n<h3 id=\"toc_6\">显示所有的 docker 容器</h3>\n<p>要列出所有 docker 容器，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a52c106684458\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker ps\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a52c106684458-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a52c106684458-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a52c106684458-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">ps</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a52c106684458-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>会输出一个容器列表，每个容器都有一个容器 id 标识。</p>\n<h3 id=\"toc_7\">停止 docker 容器</h3>\n<p>要停止 docker 容器，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a530082515857\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker stop container-id\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a530082515857-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a530082515857-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a530082515857-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">stop </span><span class=\"crayon-v\">container</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a530082515857-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">从容器中退出</h3>\n<p>要从容器中退出，执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a533078005907\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ exit\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a533078005907-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a533078005907-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a533078005907-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a533078005907-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_9\">保存容器状态</h3>\n<p>容器运行并更改后（比如安装了 apache 服务器），我们可以保存容器状态。这会在本地系统上保存新创建镜像。</p>\n<p>运行下面语句来提交并保存容器状态：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a536343564288\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker commit 85475ef774 repository/image_name\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a536343564288-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a536343564288-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a536343564288-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85475ef774</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">repository</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">_</span>name</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a536343564288-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这里，<code>commit</code> 命令会保存容器状态，<code>85475ef774</code>，是容器的容器 id，<code>repository</code>，通常为 docker hub 上的用户名 （或者新加的仓库名称）<code>image_name</code>，是新镜像的名称。</p>\n<p>我们还可以使用 <code>-m</code> 和 <code>-a</code> 来添加更多信息。通过 <code>-m</code>，我们可以留个信息说 apache 服务器已经安装好了，而 <code>-a</code> 可以添加作者名称。</p>\n<p>像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696bee4a53a101895600\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n docker commit -m \"apache server installed\"-a \"Dan Daniels\" 85475ef774 daniels_dan/Cent_container\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696bee4a53a101895600-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696bee4a53a101895600-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696bee4a53a101895600-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apache server installed\"</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Dan Daniels\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85475ef774</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">daniels_dan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Cent</span><span class=\"crayon-sy\">_</span>container</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696bee4a53a101895600-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>我们的教程至此就结束了，本教程讲解了一下 Docker 中的那些重要的命令，如有疑问，欢迎留言。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113490\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113490votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113490\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113490/", "comment_nums": 1, "create_date": "2018/01/16", "tags": "IT技术,Docker", "url_object_id": "148acfe5c7841aeb6acee354b96cab45", "front_image_path": "full/67490ccebef720732b63d9ddb9e17fb0a590e30a.jpg"}
{"fav_nums": 4, "praise_nums": "3", "title": "AI 玩跳一跳的正确姿势，跳一跳 Auto-Jump 算法详解", "front_image_url": ["http://wx1.sinaimg.cn/mw690/63918611gy1fnig1hdnpdj20gx0c2wez.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32636329\">肖泰洪 + 安捷</a>   </div><p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1hdnpdj20gx0c2wez.jpg\" width=\"609\" height=\"434\"></p>\n<p>最近，微信小游戏跳一跳可以说是火遍了全国，从小孩子到大孩子仿佛每一个人都在刷跳一跳，作为无（zhi）所（hui）不（ban）能（zhuan）的AI程序员，我们在想，能不能用人工智能（AI）和计算机视觉（CV）的方法来玩一玩这个游戏？于是，我们开发了微信跳一跳Auto-Jump算法，重新定义了玩跳一跳的正确姿势，我们的算法不仅远远超越了人类的水平，在速度和准确度上也远远超越了目前已知的所有算法，可以说是跳一跳界的state-of-the-art，下面我们详细介绍我们的算法。</p>\n<p>算法的第一步是获取手机屏幕的截图并可以控制手机的触控操作，我们的<a href=\"https://github.com/Prinsphield/Wechat_AutoJump\">github仓库</a>里详细介绍了针对Android和IOS手机的配置方法。</p>\n<p>你只需要按照将手机连接电脑，按照教程执行就可以完成配置。在获取到屏幕截图之后，就是个简单的视觉问题。我们需要找的就是小人的位置和下一次需要跳的台面的中心。</p>\n<p>如图所示，绿色的点代表小人当前的位置，红点代表目标位置。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1hqbj2j20k00hoglp.jpg\" width=\"690\" height=\"610\"></p>\n<h2>多尺度搜索（Multiscale Search）</h2>\n<p>这个问题可以有非常多的方法去解，为了糙快猛地刷上榜，我一开始用的方式是多尺度搜索。我随便找了一张图，把小人抠出来，就像下面这样。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1j5ysoj201e03wdfl.jpg\" width=\"50\" height=\"140\"></p>\n<p>另外，我注意到小人在屏幕的不同位置，大小略有不同，所以我设计了多尺度的搜索，用不同大小的进行匹配，最后选取置信度（confidence score）最高的。</p>\n<p>多尺度搜索的代码长这样</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6952ad0f53b370581807\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef multi_scale_search(pivot, screen, range=0.3, num=10):\r\n    H, W = screen.shape[:2]\r\n    h, w = pivot.shape[:2]\r\n\r\n    found = None\r\n    for scale in np.linspace(1-range, 1+range, num)[::-1]:\r\n        resized = cv2.resize(screen, (int(W * scale), int(H * scale)))\r\n        r = W / float(resized.shape[1])\r\n        if resized.shape[0] &lt; h or resized.shape[1] &lt; w:\r\n            break\r\n        res = cv2.matchTemplate(resized, pivot, cv2.TM_CCOEFF_NORMED)\r\n\r\n        loc = np.where(res &gt;= res.max())\r\n        pos_h, pos_w = list(zip(*loc))[0]\r\n\r\n        if found is None or res.max() &gt; found[-1]:\r\n            found = (pos_h, pos_w, r, res.max())\r\n\r\n    if found is None: return (0,0,0,0,0)\r\n    pos_h, pos_w, r, score = found\r\n    start_h, start_w = int(pos_h * r), int(pos_w * r)\r\n    end_h, end_w = int((pos_h + h) * r), int((pos_w + w) * r)\r\n    return [start_h, start_w, end_h, end_w, score]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f53b370581807-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f53b370581807-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">multi_scale_search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">range</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">H</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scale </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">linspace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">range</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">range</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">resized</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">W *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scale</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">H *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scale</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">matchTemplate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TM_CCOEFF_NORMED</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">loc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">found</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-21\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">start_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">pos_h *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">pos_w *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f53b370581807-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">end_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f53b370581807-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">start_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0070 seconds] -->\r\n<p>我们来试一试，效果还不错，应该说是又快又好，我所有的实验中找小人从来没有失误。</p>\n<p>不过这里的位置框的底部中心并不是小人的位置，真实的位置是在那之上一些。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1jnfs0j20k00zkq33.jpg\" width=\"690\" height=\"1227\"></p>\n<p>同理，目标台面也可以用这种办法搜索，但是我们需要收集一些不同的台面，有圆形的，方形的，便利店，井盖，棱柱等等。由于数量一多，加上多尺度的原因，速度上会慢下来。这时候，我们就需要想办法加速了。首先可以注意到目标位置始终在小人的位置的上面，所以可以操作的一点就是在找到小人位置之后把小人位置以下的部分都舍弃掉，这样可以减少搜索空间。但是这还是不够，我们需要进一步去挖掘游戏里的故事。小人和目标台面基本上是关于屏幕中心对称的位置的。这提供了一个非常好的思路去缩小搜索空间。假设屏幕分辨率是（1280，720）的，小人底部的位置是（h1, w1),那么关于中心对称点的位置就是（1280 – h1， 720 – w1），以这个点为中心的一个边长300的正方形内，我们再去多尺度搜索目标位置，就会又快有准了。效果见下图，蓝色框是（300，300）的搜索区域，红色框是搜到的台面，矩形中心就是目标点的坐标了。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1k9kyxj20k00zkq36.jpg\" width=\"690\" height=\"1227\"></p>\n<h2>加速的奇技淫巧（Fast-Search）</h2>\n<p>玩游戏需要细心观察。我们可以发现，小人上一次如果跳到台面中心，那么下一次目标台面的中心会有一个白点，就像刚才所展示的图里的。更加细心的人会发现，白点的RGB值是（245，245，245），这就让我找到了一个非常简单并且高效的方式，就是直接去搜索这个白点，注意到白点是一个连通区域，像素值为（245，245，245）的像素个数稳定在280-310之间，所以我们可以利用这个去直接找到目标的位置。这种方式只在前一次跳到中心的时候可以用，不过没有关系，我们每次都可以试一试这个不花时间的方法，不行再考虑多尺度搜索。</p>\n<p>讲到这里，我们的方法已经可以运行的非常出色了，基本上是一个永动机。下面是用我的手机玩了一个半小时左右，跳了859次的状态，我们的方法正确的计算出来了小人的位置和目标位置，不过我选择狗带了，因为手机卡的已经不行了。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1kwberj20k00bzt8u.jpg\" width=\"690\" height=\"413\"></p>\n<p>这里有一个示例视频，欢迎观看!</p>\n<p><a href=\"https://v.vzuu.com/video/932359600779309056\" target=\"_blank\">点击查看视频</a></p>\n<p><b>到这里就结束了吗？那我们和业余玩家有什么区别？下面进入正经的学术时间，非战斗人员请迅速撤离！</b></p>\n<h2>CNN Coarse-to-Fine 模型</h2>\n<p>考虑到IOS设备由于屏幕抓取方案的限制（WebDriverAgent获得的截图经过了压缩，图像像素受损，不再是原来的像素值，原因不详，欢迎了解详情的小伙伴提出改进意见~）无法使用fast-search，同时为了兼容多分辨率设备，我们使用卷积神经网络构建了一个更快更鲁棒的目标检测模型，下面分数据采集与预处理，coarse模型，fine模型，cascade四部分介绍我们的算法。</p>\n<h2>数据采集与预处理</h2>\n<p>基于我们非常准确的multiscale-search、fast-search模型，我们采集了7次实验数据，共计大约3000张屏幕截图，每一张截图均带有目标位置标注，对于每一张图，我们进行了两种不同的预处理方式，并分别用于训练coarse模型和fine模型，下面分别介绍两种不同的预处理方式。</p>\n<h2>Coarse 模型数据预处理</h2>\n<p>由于每一张图像中真正对于当前判断有意义的区域只在屏幕中央位置，即人和目标物体所在的位置，因此，每一张截图的上下两部分都是没有意义的，因此，我们将采集到的大小为1280*720的图像沿x方向上下各截去320*720大小，只保留中心640*720的图像作为训练数据。</p>\n<p>我们观察到，游戏中，每一次当小人落在目标物中心位置时，下一个目标物的中心会出现一个白色的圆点，</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnig1m4jdtj20k00zk74f.jpg\" width=\"690\" height=\"1227\"></p>\n<p>考虑到训练数据中fast-search会产生大量有白点的数据，为了杜绝白色圆点对网络训练的干扰，我们对每一张图进行了去白点操作，具体做法是，用白点周围的纯色像素填充白点区域。</p>\n<h2>Fine 模型数据预处理</h2>\n<p>为了进一步提升模型的精度，我们为fine模型建立了数据集，对训练集中的每一张图，在目标点附近截取320*320大小的一块作为训练数据，</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1mrlqyj208w08wdfo.jpg\" width=\"320\" height=\"320\"></p>\n<p>为了防止网络学到trivial的结果，我们对每一张图增加了50像素的随机偏移。fine模型数据同样进行了去白点操作。</p>\n<h2>Coarse 模型</h2>\n<p>我们把这一问题看成了回归问题，coarse模型使用一个卷积神经网络回归目标的位置，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6952ad0f549717831279\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef forward(self, img, is_training, keep_prob, name='coarse'):\r\n    with tf.name_scope(name):\r\n        with tf.variable_scope(name):\r\n            out = self.conv2d('conv1', img, [3, 3, self.input_channle, 16], 2)\r\n            # out = tf.layers.batch_normalization(out, name='bn1', training=is_training)\r\n            out = tf.nn.relu(out, name='relu1')\r\n\r\n            out = self.make_conv_bn_relu('conv2', out, [3, 3, 16, 32], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv3', out, [5, 5, 32, 64], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv4', out, [7, 7, 64, 128], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv5', out, [9, 9, 128, 256], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = tf.reshape(out, [-1, 256 * 20 * 23])\r\n            out = self.make_fc('fc1', out, [256 * 20 * 23, 256], keep_prob)\r\n            out = self.make_fc('fc2', out, [256, 2], keep_prob)\r\n\r\n    return out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f549717831279-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f549717831279-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">forward</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'coarse'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">variable_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conv2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">input_channle</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># out = tf.layers.batch_normalization(out, name='bn1', training=is_training)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'relu1'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv5'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f549717831279-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f549717831279-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0092 seconds] -->\r\n<p>经过十小时的训练，coarse模型在测试集上达到了6像素的精度，实际测试精度大约为10像素，在测试机器（MacBook Pro Retina, 15-inch, Mid 2015, 2.2 GHz Intel Core i7）上inference时间0.4秒。这一模型可以很轻松的拿到超过1k的分数，这已经远远超过了人类水平和绝大多数自动算法的水平，日常娱乐完全够用，不过，你认为我们就此为止那就大错特错了~</p>\n<h2>Fine 模型</h2>\n<p>fine模型结构与coarse模型类似，参数量稍大，fine模型作为对coarse模型的refine操作，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6952ad0f54f218775022\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef forward(self, img, is_training, keep_prob, name='fine'):\r\n    with tf.name_scope(name):\r\n        with tf.variable_scope(name):\r\n            out = self.conv2d('conv1', img, [3, 3, self.input_channle, 16], 2)\r\n            # out = tf.layers.batch_normalization(out, name='bn1', training=is_training)\r\n            out = tf.nn.relu(out, name='relu1')\r\n\r\n            out = self.make_conv_bn_relu('conv2', out, [3, 3, 16, 64], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv3', out, [5, 5, 64, 128], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv4', out, [7, 7, 128, 256], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv5', out, [9, 9, 256, 512], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = tf.reshape(out, [-1, 512 * 10 * 10])\r\n            out = self.make_fc('fc1', out, [512 * 10 * 10, 512], keep_prob)\r\n            out = self.make_fc('fc2', out, [512, 2], keep_prob)\r\n\r\n    return out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6952ad0f54f218775022-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6952ad0f54f218775022-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">forward</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'fine'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">variable_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conv2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">input_channle</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># out = tf.layers.batch_normalization(out, name='bn1', training=is_training)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'relu1'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv5'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6952ad0f54f218775022-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6952ad0f54f218775022-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0091 seconds] -->\r\n<p>经过十小时训练，fine模型测试集精度达到了0.5像素，实际测试精度大约为1像素，在测试机器上的inference时间0.2秒。</p>\n<h2>Cascade</h2>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1nfkakj20k004va9x.jpg\" width=\"690\" height=\"168\"></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1gyb8ej20k00c00st.jpg\" width=\"690\" height=\"414\"></p>\n<p>总体精度1像素左右，时间0.6秒。</p>\n<h2>总结</h2>\n<p>针对这一问题，我们利用AI和CV技术，提出了合适适用于IOS和Android设备的完整解决方案，稍有技术背景的用户都可以实现成功配置、运行，我们提出了Multiscale-Search，Fast-Search，CNN Coarse-to-Fine三种解决这一问题的算法，三种算法相互配合，可以实现快速准确的搜索、跳跃，用户针对自己的设备稍加调整跳跃参数即可接近实现“永动机”。讲到这里，似乎可以宣布，我们的工作terminate了这个问题，微信小游戏跳一跳game over！</p>\n<p><b>友情提示：适度游戏益脑，沉迷游戏伤身，技术手段的乐趣在于技术本身而不在游戏排名，希望大家理性对待游戏排名和本文提出的技术，用游戏娱乐自己的生活</b></p>\n<p><b>声明：本文提出的算法及开源代码符合MIT开源协议，以商业目的使用该算法造成的一切后果须由使用者本人承担</b></p>\n<p>Git仓库地址：</p>\n<p>https://github.com/Prinsphield/Wechat_AutoJump</p>\n<p>https://github.com/Richard-An/Wechat_AutoJump</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113493\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113493votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113493\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 10 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113493/", "comment_nums": 10, "create_date": "2018/01/16", "tags": "IT技术,小游戏,跳一跳", "url_object_id": "9f93ee8d23796b520f6499f5d14f230d", "front_image_path": "full/d1a65618926b13451ddf200c0f8441e20f466de3.jpg"}
{"fav_nums": 5, "praise_nums": "3", "title": "比特币入门教程", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/63509403a5b3f6d5f982aa86a1d386ef.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html\">阮一峰</a>   </div><div id=\"main-content\"><!-- div class=\"asset-body\" -->比特币（bitcoin）诞生于2008年的一篇<a href=\"https://bitcoin.org/en/bitcoin-paper\">论文</a>。\n<p><!-- /div --> <!-- div id=\"more\" class=\"asset-more\" --></p>\n<p>一个署名为中本聪的人，提出了革命性的构想：让我们创造一种不受政府或其他任何人控制的货币！这个想法堪称疯狂：一串数字，背后没有任何资产支持，也没有任何人负责，你把它当作钱付给对方，怎么会有人愿意接受？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/63509403a5b3f6d5f982aa86a1d386ef.jpg\" alt=\"\"></p>\n<p>但是，狂想居然变成了现实。随后的几年，在全世界无数爱好者的支持下，比特币网络运行起来了，越来越多的人和资本参与，星星之火，终成燎原。刚刚过去的2017年，比特币迎来了爆发式的增长，从年初的1000美元，最高涨到了2万美元，全世界都为之震动，上到政府，下到普通百姓都在关注。事实就是比特币已经并将继续改变世界。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/27309973c9e7f2fbc7e80eb62494fc77.png\" alt=\"\"></p>\n<p>新闻媒体往往只关注它的火爆表现，忽视或者无法回答一些基本的问题。</p>\n<blockquote>\n<ul>\n<li>比特币的原理是什么？</li>\n<li>为什么这个无人管理的体系可以成功运作？</li>\n<li>比特币交易的流程是怎么回事？</li>\n<li>它与区块链又是什么关系？</li>\n</ul>\n</blockquote>\n<p>下面，我尝试回答这些问题，希望帮助大家理解比特币。抛开技术细节，还是很容易解释的。</p>\n<p>有一点说明，本文只讨论技术问题，不涉及如何投资比特币，更不会预测价格走势。事实上，我也不知道，如果我知道怎么发财，可能就不会在这里写博客了。</p>\n<h2>一、非对称加密</h2>\n<p>首先，理解比特币，必须理解<a href=\"http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html\">非对称加密</a>。</p>\n<p>你可能听说过这个词，所谓非对称加密，其实很简单，就是加密和解密需要两把钥匙：一把公钥和一把私钥。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f8fb5b5c73dd908f09a6ded5e0308b41.png\" alt=\"\"></p>\n<p>公钥是公开的，任何人都可以获取。私钥是保密的，只有拥有者才能使用。他人使用你的公钥加密信息，然后发送给你，你用私钥解密，取出信息。反过来，你也可以用私钥加密信息，别人用你的公钥解开，从而证明这个信息确实是你发出的，且未被篡改，这叫做数字签名（更详细的介绍请看<a href=\"http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html\">《什么是数字签名》</a>）。</p>\n<p>现在请设想，<strong>如果公钥加密的不是普通的信息，而是加密了一笔钱，发送给你，这会怎样？</strong></p>\n<p>首先，你能解开加密包，取出里面的钱，因为私钥在你手里。其次，别人偷不走这笔钱，因为他们没有你的私钥。因此，支付可以成功。</p>\n<p>这就是比特币（以及其他数字货币）的原理：非对称加密保证了支付的可靠性。</p>\n<p>由于支付的钱必须通过私钥取出，所以你是谁并不重要，重要的是谁拥有私钥。只有拥有了私钥，才能取出支付给你的钱。（事实上，真实的交易流程稍有不同，私钥保证的不是取出支付给你的钱，而是保证只有你能把这些属于你的钱支付出去，详见后文。）</p>\n<h2>二、比特币钱包</h2>\n<p>对于比特币来说，钱不是支付给个人的，而是支付给某一把私钥。这就是交易匿名性的根本原因，因为没有人知道，那些私钥背后的主人是谁。</p>\n<p>所以，<strong>比特币交易的第一件事，就是你必须拥有自己的公钥和私钥。</strong></p>\n<p>你去网上那些比特币交易所开户，它们会让你首先生成一个比特币钱包（wallet）。<strong>这个钱包不是用来存放比特币，而是存放你的公钥和私钥。</strong>软件会帮你生成这两把钥匙，然后放在钱包里面。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/4333573063fb5a3756b527b494563f5f.png\" alt=\"\"></p>\n<p>根据协议，公钥的长度是512位。这个长度不太方便传播，因此协议又规定，要为公钥生成一个160位的指纹。所谓指纹，就是一个比较短的、易于传播的哈希值。160位是二进制，写成十六进制，大约是26到35个字符，比如 1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2。这个字符串就叫做钱包的地址，它是唯一的，即每个钱包的地址肯定都是不一样的。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/174928d2d1378ea027f6e05859ccf9fd.png\" alt=\"\"></p>\n<p>你向别人收钱时，只要告诉对方你的钱包地址即可，对方向这个地址付款。由于你是这个地址的拥有者，所以你会收到这笔钱。</p>\n<p>由于你是否拥有某个钱包地址，是由私钥证明的（具体的证明方法稍后介绍），所以一定要保护好私钥。这是极其重要的，如果你的私钥被偷了，你的比特币也就等于没了，因为他人可以冒用你的身份了，把钱包里面的钱都转走。</p>\n<p>同样的，你向他人支付比特币，千万不能写错他人的钱包地址，否则你的比特币就支付到了另一个不同的人了。</p>\n<h2>三、交易过程</h2>\n<p>下面，我把整个流程串起来，看看比特币如何完成一笔交易。</p>\n<p><strong>一笔交易就是一个地址的比特币，转移到另一个地址。</strong>由于比特币的交易记录全部都是公开的，哪个地址拥有多少比特币，都是可以查到的。因此，支付方是否拥有足够的比特币，完成这笔交易，这是可以轻易验证的。</p>\n<p>问题出在怎么防止其他人，冒用你的名义申报交易。举例来说，有人申报了一笔交易：地址 A 向地址 B 支付10个比特币。我怎么知道这个申报是真的，申报人就是地址 A 的主人？</p>\n<p>比特币协议规定，申报交易的时候，除了交易金额，转出比特币的一方还必须提供以下数据。</p>\n<blockquote>\n<ul>\n<li>上一笔交易的 Hash（你从哪里得到这些比特币）</li>\n<li>本次交易双方的地址</li>\n<li>支付方的公钥</li>\n<li>支付方的私钥生成的数字签名</li>\n</ul>\n</blockquote>\n<p>验证这笔交易是否属实，需要三步。</p>\n<blockquote><p>第一步，找到上一笔交易，确认支付方的比特币来源。</p>\n<p>第二步，算出支付方公钥的指纹，确认与支付方的地址一致，从而保证公钥属实。</p>\n<p>第三步，使用公钥去解开数字签名，保证私钥属实。</p></blockquote>\n<p>经过上面三步，就可以认定这笔交易是真实的。</p>\n<h2>四、交易确认与区块链</h2>\n<p>确认交易的真实性以后，交易还不算完成。<strong>交易数据必须写入数据库，才算成立，对方才能真正收到钱。</strong></p>\n<p>比特币使用的是一种特殊的数据库，叫做区块链（blockchain），详细的介绍请看<a href=\"http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html\">《区块链入门教程》</a>。本文只讨论交易如何写入区块链。</p>\n<p>首先，所有的交易数据都会传送到矿工那里。矿工负责把这些交易写入区块链。</p>\n<p>根据比特币协议，一个区块的大小最大是 1MB，而一笔交易大概是500字节左右，因此一个区块最多可以包含2000多笔交易。矿工负责把这2000多笔交易打包在一起，组成一个区块，然后计算这个区块的 Hash。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d2a41b71d213dcdc3e23259cec5181b0.jpg\" alt=\"\"></p>\n<p>计算 Hash 的过程叫做采矿，这需要大量的计算。矿工之间也在竞争，谁先算出 Hash，谁就能第一个添加新区块进入区块链，从而享受这个区块的全部收益，而其他矿工将一无所获。</p>\n<p>一笔交易一旦写入了区块链，就无法反悔了。这里需要建立一个观念：<strong>比特币不存放在钱包或其他别的地方，而是只存在于区块链上面。</strong>区块链记载了你参与的每一笔交易，你得到过多少比特币，你又支付了多少比特币，因此可以算出来你拥有多少资产。</p>\n<h2>五、矿工的收益</h2>\n<p>交易的确认离不开矿工。为什么有人愿意做矿工呢？</p>\n<p>比特币协议规定，挖到新区块的矿工将获得奖励，一开始（2008年）是50个比特币，然后每4年减半，目前（2018年）是12.5个比特币。这也是比特币的供给增加机制，流通中新增的比特币都是这样诞生的。</p>\n<p>你可能看出来了，每4年奖励减半，那么到了2140年，矿工将得不到任何奖励，比特币的数量也将停止增加。这时，矿工的收益就完全依靠交易手续费了。</p>\n<p>所谓交易手续费，就是矿工可以从每笔交易抽成，具体的金额由支付方自愿决定。你完全可以一毛不拔，一分钱也不给矿工，但是那样的话，你的交易就会没人处理，迟迟无法写入区块链，得到确认。矿工们总是优先处理手续费最高的交易。</p>\n<p>目前由于交易数量猛增，手续费已经水涨船高，一个区块2000多笔交易的手续费总额可以达到3～10个比特币。如果你的手续费给低了，很可能过了一个星期，交易还没确认。</p>\n<p>一个区块的奖励金12.5个比特币，再加上手续费，收益是相当可观的。按照目前的价格，可以达到100万～200万人民币。想想看，运气好的话，几分钟就能挖到一个区块，拿到这样一大笔钱，怪不得人们对挖矿趋之若鹜。</p>\n<h2>六、区块的扩容</h2>\n<p><a href=\"http://blog.jobbole.com/113428/\">《区块链入门教程》</a>说过，比特币协议规定，平均10分钟诞生一个区块。区块的大小只有 1MB，最多只能包含2000多笔交易。也就是说，比特币网络每10分钟，最多只能处理2000多笔交易，换算一下，就是处理速度为3～5笔/秒。</p>\n<p>全世界的比特币交易这么多，可是区块链每秒最多只能处理5笔，这已经成为制约比特币发展的一个瓶颈。</p>\n<p>很早就有人呼吁，改革比特币协议，提升处理速度。这件事在2017年8月有了一点眉目，当时区块链发生了一次分叉，诞生了一个新协议，称为 <a href=\"https://en.wikipedia.org/wiki/Bitcoin_Cash\">Bitcoin Cash</a>（简称 BCH）。这种新货币其他方面都与比特币一致，就是每个区块的大小从 1MB 增加到了 8MB，因此处理速度提升了8倍，手续费也低得多。该协议是对原有区块链的分叉，因此当时持有比特币的人，等于一人获赠了一份同样数量的 BCH。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/39c38fe0e181acf13e1c7aa9a0bbfda7.png\" alt=\"\"></p>\n<p>BCH 等于创造了一种新货币，还有人提议，原始比特币的区块大小提升到 2MB，这称为 <a href=\"https://en.wikipedia.org/wiki/SegWit2x\">SegWit2x</a> 。这个建议原定于2017年11月实施，但是最后一刻由于缺乏共识，就被取消了，目前还在讨论中。</p>\n<h2>七、点对点网络</h2>\n<p>比特币是一个全世界的开放网络，只要你有服务器，就能加入这个网络，成为一个节点。每个节点都包含了整个区块链（目前大概 100多 GB），并且节点之间时刻不停地在同步信息。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/a28ca9a094a80d2ae06a24523b4fc759.png\" alt=\"\"></p>\n<p>当你发生了一笔支付，你所在的节点就会把这笔交易告诉另一个节点，直至传遍整个网络。矿工从网上收集各种新发生的交易，将它们打包写入区块链。一旦写入成功， 矿工所在节点的区块链，就成为最新版本，其他节点都会来复制新增的区块，保证全网的区块链都是一致的。</p>\n<p>最后，你所在的节点也拿到了最新的区块链，从而得知你早先的那笔交易，已经写在里面了，至此交易确认成功。</p>\n<h2>八、还有一个问题</h2>\n<p>写到这里，我就介绍完了比特币的基本知识，希望你已经明白了比特币是怎么回事。但是还有一个根本的问题，我没有回答：比特币的本质到底是什么？</p>\n<p>说到底，比特币只是区块链的一条记录，是凭空生成的，为什么可以当钱用？举例来说，矿工获得12.5个比特币的奖励，其实就是区块链有一个记录：”xxx地址获得12.5个比特币”。正是这行记录，导致该矿工获得了大笔金钱。如果区块链突然增加了一条记录，记载你的地址获得了1000个比特币，你就真的会有1000个比特币。这到底是为什么？</p>\n<p>这篇文章已经够长了，这个问题就留到下次再谈，欢迎关注本系列的最后一篇文章《数字货币的本质》。</p>\n<h2>九、参考链接</h2>\n<ul>\n<li><a href=\"https://arstechnica.com/tech-policy/2017/12/how-bitcoin-works/\">How Bitcoin works</a> , by Timothy B. Lee</li>\n<li><a href=\"http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html\">Bitcoins the hard way: Using the raw Bitcoin protocol</a>, by Ken Shirriff</li>\n</ul>\n<p>（完）</p>\n<p><!-- /div --></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113429\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113429votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113429\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113429/", "comment_nums": 0, "create_date": "2018/01/04", "tags": "IT技术,比特币", "url_object_id": "8cde19a52cb038302a7b2e77c7e9fc88", "front_image_path": "full/ddae0a332762a0378654c76a5bf56c4122737863.jpg"}
{"fav_nums": 2, "praise_nums": "1", "title": "通过实例学习 tcpdump 命令", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/5ebb3cabbd33c5371bc0c678d230f5fd.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://linuxtechlab.com/learn-use-tcpdump-command-examples/\">Shusain</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9210-1.html\"> DarkSun</a>   </div><p><code>tcpdump</code> 是一个很常用的网络包分析工具，可以用来显示通过网络传输到本系统的 TCP/IP 以及其他网络的数据包。<code>tcpdump</code> 使用 libpcap 库来抓取网络报，这个库在几乎在所有的 Linux/Unix 中都有。</p>\n<div id=\"article_content\">\n<p><code>tcpdump</code> 可以从网卡或之前创建的数据包文件中读取内容，也可以将包写入文件中以供后续使用。必须是 root 用户或者使用 sudo 特权来运行 <code>tcpdump</code>。</p>\n<p>在本文中，我们将会通过一些实例来演示如何使用 <code>tcpdump</code> 命令，但首先让我们来看看在各种 Linux 操作系统中是如何安装 <code>tcpdump</code> 的。</p>\n<ul>\n<li>推荐阅读：<a href=\"http://linuxtechlab.com/monitoring-network-bandwidth-iftop-command/\">使用 iftop 命令监控网络带宽 </a></li>\n</ul>\n<h1 id=\"toc_1\">安装</h1>\n<p><code>tcpdump</code> 默认在几乎所有的 Linux 发行版中都可用，但若你的 Linux 上没有的话，使用下面方法进行安装。</p>\n<h2 id=\"toc_2\">CentOS/RHEL</h2>\n<p>使用下面命令在 CentOS 和 RHEL 上安装 <code>tcpdump</code>，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee25b910614355\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo yum install tcpdump*</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee25b910614355-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee25b910614355-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">yum </span><span class=\"crayon-e\">install </span><span class=\"crayon-e \">tcpdump*</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_3\">Fedora</h2>\n<p>使用下面命令在 Fedora 上安装 <code>tcpdump</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee265899115267\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ dnf install tcpdump</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee265899115267-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee265899115267-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">tcpdump</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h2 id=\"toc_4\">Ubuntu/Debian/Linux Mint</h2>\n<p>在 Ubuntu/Debain/Linux Mint 上使用下面命令安装 <code>tcpdump</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee269128687050\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ apt-get install tcpdump</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee269128687050-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee269128687050-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">tcpdump</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>安装好 <code>tcpdump</code> 后，现在来看一些例子。</p>\n<h1 id=\"toc_5\">案例演示</h1>\n<h2 id=\"toc_6\">从所有网卡中捕获数据包</h2>\n<p>运行下面命令来从所有网卡中捕获数据包：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee26c812975964\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i any</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee26c812975964-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee26c812975964-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_7\">从指定网卡中捕获数据包</h2>\n<p>要从指定网卡中捕获数据包，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee270915827743\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee270915827743-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee270915827743-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_8\">将捕获的包写入文件</h2>\n<p>使用 <code>-w</code> 选项将所有捕获的包写入文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee273691250388\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth1 -w packets_file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee273691250388-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee273691250388-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">packets_file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"toc_9\">读取之前产生的 tcpdump 文件</h2>\n<p>使用下面命令从之前创建的 tcpdump 文件中读取内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee276908248851\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -r packets_file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee276908248851-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee276908248851-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">packets_file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_10\">获取更多的包信息，并且以可读的形式显示时间戳</h2>\n<p>要获取更多的包信息同时以可读的形式显示时间戳，使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee279875244487\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -ttttnnvvS</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee279875244487-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee279875244487-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ttttnnvvS</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_11\">查看整个网络的数据包</h2>\n<p>要获取整个网络的数据包，在终端执行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee27c491462313\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump net 192.168.1.0/24</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee27c491462313-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee27c491462313-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">net</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.0</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">24</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_12\">根据 IP 地址查看报文</h2>\n<p>要获取指定 IP 的数据包，不管是作为源地址还是目的地址，使用下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee280481870839\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump host 192.168.1.100</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee280481870839-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee280481870839-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>要指定 IP 地址是源地址或是目的地址则使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee283335221663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100\r\n$ tcpdump dst 192.168.1.100</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee283335221663-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691063ee283335221663-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee283335221663-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691063ee283335221663-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">dst</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"toc_13\">查看某个协议或端口号的数据包</h2>\n<p>要查看某个协议的数据包，运行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee286247747915\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump ssh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee286247747915-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee286247747915-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-v\">ssh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>要捕获某个端口或一个范围的数据包，使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee289839008623\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump port 22\r\n$ tcpdump portrange 22-125</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee289839008623-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691063ee289839008623-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee289839008623-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691063ee289839008623-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">portrange</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">125</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们也可以与 <code>src</code> 和 <code>dst</code> 选项连用来捕获指定源端口或指定目的端口的报文。</p>\n<p>我们还可以使用“与” （<code>and</code>，<code>&amp;&amp;</code>）、“或” （<code>or</code>，<code>||</code> ) 和“非”（<code>not</code>，<code>!</code>） 来将两个条件组合起来。当我们需要基于某些条件来分析网络报文是非常有用。</p>\n<h2 id=\"toc_14\">使用“与”</h2>\n<p>可以使用 <code>and</code> 或者符号 <code>&amp;&amp;</code> 来将两个或多个条件组合起来。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee28c219574265\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100 &amp;&amp; port 22 -w ssh_packets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee28c219574265-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee28c219574265-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssh_packets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h2 id=\"toc_15\">使用“或”</h2>\n<p>“或”会检查是否匹配命令所列条件中的其中一条，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee290843660134\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100 or dst 192.168.1.50 &amp;&amp; port 22 -w ssh_packets\r\n$ tcpdump port 443 or 80 -w http_packets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee290843660134-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691063ee290843660134-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee290843660134-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dst</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.50</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssh</span><span class=\"crayon-sy\">_</span>packets</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691063ee290843660134-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">443</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http_packets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h2 id=\"toc_16\">使用“非”</h2>\n<p>当我们想表达不匹配某项条件时可以使用“非”，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691063ee293946210645\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth0 src port not 22</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691063ee293946210645-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691063ee293946210645-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eth0 </span><span class=\"crayon-e\">src </span><span class=\"crayon-e\">port </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这会捕获 eth0 上除了 22 号端口的所有通讯。</p>\n<p>我们的教程至此就结束了，在本教程中我们讲解了如何安装并使用 <code>tcpdump</code> 来捕获网络数据包。如有任何疑问或建议，欢迎留言。<a href=\"http://jbcdn2.b0.upaiyun.com/2018/01/1d3caa159d6e8c89c120010fd89a25be.png\"><br>\n</a></p>\n<p> </p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113452\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113452votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113452\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113452/", "comment_nums": 0, "create_date": "2018/01/09", "tags": "IT技术,命令", "url_object_id": "4dc4d70b33802e7da16f0e631551759d", "front_image_path": "full/36166d0ecc27103ef7e4ded0df8d95ba560feac4.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "请停止结对编程", "front_image_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>（根据真实事件改编，情节有所夸张，请勿对号入座。）</p>\n<p>这是一个风和日丽的星期五下午，Ben 和 Martin 本应该在 Costa 咖啡馆喝一杯下午茶，一起聊聊周末的计划，然而 PM 的一个微信通知打乱了这一切。原来产品出现了一个bug需要紧急修复，下班之前必须要搞定。两人收到消息疾步走回到岗位，也没了心情去喝刚泡好的咖啡，连忙打开邮箱查看问题报告。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg\" alt=\"\" width=\"940\" height=\"627\"></a></p>\n<h3>开始</h3>\n<blockquote><p><strong>Ben：</strong>看来这不是一个很大的问题，就是处理一个来自于远端服务的异常。现在的情况是BFF(backend for frontends)在内部的远端服务有异常，会将异常直接返回到客户端，这样只要一个保单出了问题，前端所有的保单也都没法用了。</p>\n<p><strong>Martin：</strong>那怎么解决？</p>\n<p><strong>Ben：</strong>感觉可以在异常的地方加一个异常处理。这个涉及到RxJava和Java8的stream特性，我不是太熟悉，要不我们一起Pair吧</p>\n<p><strong>Martin：</strong>好。</p></blockquote>\n<p>两人喝了一口炙热的咖啡，摆好键盘鼠标，打开了IntelliJ工程。几分钟后，这个故障重现了。</p>\n<blockquote><p><strong>Martin：</strong>可以重现的故障通常比较好解决。我们在这里先弄个try…catch试试。 两人似乎很有信心，然而重启项目后，故障并没有按照预期停下来。</p>\n<p><strong>Ben：</strong>hmm，这里为什么停不下来呢？</p>\n<p><strong>Martin：</strong>可能是RxJava的延迟处理，没有正确的捕捉到。这样，你在这里再写一个逻辑，然后在这里设个断点……</p></blockquote>\n<h3>焦急</h3>\n<p>在这个过程中，Martin只是对着屏幕指指点点，时不时看看手机、在微信上聊聊天。Ben对RxJava并不是很熟悉，他想紧紧跟随Martin的思路，然而增加多个逻辑以后，依然都不能解决问题。15分钟已经过去，Ben这时候心生怀疑，是不是哪些地方没弄对？</p>\n<blockquote><p><strong>Ben：</strong>我们理一下思路看看？</p>\n<p><strong>Martin：</strong>恩，来吧，一起看一下代码。</p></blockquote>\n<p>Martin领着Ben一起看了一下代码，并且一直在旁边指点Ben进行单步调试。由于RxJava的延迟特性，使得断点很难设置。而抛出异常的调用栈会出现在某些莫名其妙的地方，这让他们根本不知道把try…catch放在哪里才能奏效。</p>\n<blockquote><p><strong>Ben：</strong>可能是要这样，在这里加一个OnError看能不能解决。</p></blockquote>\n<p>看似问题能够解决，其实是又一次的失败。在两人的激烈讨论中，时间过得很快，一晃眼已经是1个小时以后，咖啡早已经凉了，然而两个人完全没有心情，甚至都忘了咖啡的存在。</p>\n<p>Ben对Martin的解决方案越来越没有信心，两人开始重新讨论起解决方案。然而方案是越讨论越复杂，看起来想在下班前解决这个问题是不可能了，通宵是必然了。</p>\n<h3><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/2.jpeg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/2.jpeg\" alt=\"\" width=\"940\" height=\"627\"></a></h3>\n<h3>简化</h3>\n<p>Zen是组里的Tech Lead，今天在忙另外一个事情。这个周五真是不得安宁，恨不得想到美国去过过昨天。</p>\n<p>Zen听到两个人的讨论，虽然并不了解这个问题的细节，但直觉上认为是跑偏了。马上提醒Ben和Martin：</p>\n<blockquote><p>这不是一个很难的问题，我感觉你们想复杂了？是不是走偏了？能给我说一下你们怎么想的么？</p></blockquote>\n<p>被Zen打断的Martin说了一下之前的解决方案，也说试过了其他的方案了，都不行。由于Zen对这个事情也不是很了解，所以只是提了一个醒：</p>\n<blockquote><p>“Keep it simple，别把事情整复杂了。”</p></blockquote>\n<p>两个人的讨论依然在继续，Ben有点无法跟上Martin的思路，艰难地写着代码，但每次都不对。Pair的气氛犹如冬日里冰冷的咖啡一样凝结，不知道孰是孰非。Ben已经有些不高兴，Martin则依然在一旁指指点点但并不动手。</p>\n<p>Zen一看表已经3点钟了，又插了一句嘴：</p>\n<blockquote><p>Martin，既然你对这个更熟悉，你来操刀吧。你来写代码吧。</p></blockquote>\n<p>可能由于之前的讨论过于激烈，Martin反驳Zen：</p>\n<blockquote><p>我们在Pair啊，他对RxJava不熟悉，我应该指导他。我看着他写就可以了。</p></blockquote>\n<p>Zen说，</p>\n<blockquote><p>你们的解决方案是什么，给我看看。</p></blockquote>\n<p>解释了一通以后，Zen也没有更多的想法，就让他们继续吧。但Zen建议道：</p>\n<blockquote><p>在这个紧要的关头，我们应该改变一下Pair的方式。现在不是教授知识，而是要高效的解决问题。在这种压力的情境下，你可以直接实现自己的思路，带着别人飞就好了。</p></blockquote>\n<h3><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/3.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/3-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></h3>\n<h3>分歧</h3>\n<p>Martin稍微冷静了下，拿过键盘，继续开始修复问题。Ben这时候在一旁观察，也适当的休息一下，之前手忙脚乱的按F8、F9的神经也得以缓和。</p>\n<blockquote><p>Ben：看来还是不行。我们再理一下代码吧。</p>\n<p>Martin：你说的这些我之前都试过，都不行，要这样才行。</p>\n<p>Ben：我说的是这样做的，既然我们还没讨论清楚，我们再来看一下代码吧。</p></blockquote>\n<p>两人拿出了纸和笔，对着屏幕一边画一边讨论，然而Ben并不认可Martin的方案，说要采用另外个方案。Martin则坚持认为这是一个可行的方案，得试试。Ben拿过键盘，准备按照Martin的方案写代码，但心里面颇为不爽，一直在想说服Martin采用他的方案试试。</p>\n<h3>怒气</h3>\n<p>到此时，时间都已经不知不觉过去两个小时了，然而问题似乎离真相总是忽远忽近。两个人已经疲劳不堪，再加上解决方案的不一致，两人的言语中开始显露出一些怒气。</p>\n<p>Zen在运行测试的空档，打断了两人的对话，建议道：</p>\n<blockquote><p>既然大家已经产生了分歧，要不然两个人分开，各自实现一个，看谁能够先实现，然后再来讨论。</p></blockquote>\n<p>Martin对于Zen并不认同，认为Zen指责他和Ben没有Pair好。</p>\n<p>Zen解释道：</p>\n<blockquote><p>其实我听出了两人意见的不统一，言语中已经有一些怒火，这样下去Pair的效率很低。首先，大家带着不爽来干活，互相质疑。更关键的是，解决问题已经用去了两个多小时，大家都比较疲惫，可以适当休息。我让你们分开的目的是让大家冷静一下，在不受打扰的情况下工作一段时间，可能会不一样。</p></blockquote>\n<h3>冷静</h3>\n<p>Martin回到了电脑面前，按照他的思路一步一步做下去。Ben去上了个厕所，倒掉了那杯冷冰冰的咖啡，泡了杯热茶。回到电脑前专注的重新按照他的思路一步一步走下去。</p>\n<p>其实两个人已经接近了真相，只是这之间不停的对话把注意力消耗殆尽。两人企图达到一个统一，然而口头的对话并不能解决问题，反而暂缓了这个过程。</p>\n<p>10分钟后，Ben兴高采烈的说已经搞出来了一套可以运行的方案，叫Martin一同过来看看。Ben的临时解决方案比较简单好理解，但并不完美。熟悉RxJava的Martin指出了一些可以改进的地方。</p>\n<p>然后两人又开始了新一轮的Pair，重新将这个方案完善。有了这个基础的解决方案，两人都很高兴，是朝着一个正确的方向大步向前。</p>\n<h3>尾声</h3>\n<p>下午6点半，虽然比正常下班晚了半个多小时，但还好整个解决方案都正常了，交付的任务也顺利完成。</p>\n<p>Ben和Martin都总结道，我们应该停止结对，当：</p>\n<ul>\n<li>两人的思路不统一但无法说服对方时：我们可以考虑分开一阵，安静一下，各自用可运行的代码来证明思路的可行。这里只需要相对粗糙的代码即可。</li>\n<li>时间已经超过番茄时间而感到疲惫时：人的专注力是有限的，在Pair时非常累，特别是在能力方面存在较大差距的时候。在这时候我们可以试试番茄工作法，让大脑得到休息。</li>\n<li>注意力不集中或者有其他事务要处理时：在Pair的时候，彼此要尊重对方，不要玩手机、看其他无关的网页，除非事先取得别人的同意，否则就要等到停止结对、处理完事务后再继续。</li>\n</ul>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113474\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113474votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113474\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 78</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113474/", "comment_nums": 2, "create_date": "2018/01/13", "tags": "开发,结对编程", "url_object_id": "141819302e0a324b8883aa51f6c059d7", "front_image_path": "full/5b209ef18b0ddc4867f0966539835ac1a09275ec.jpg"}
{"fav_nums": 5, "praise_nums": "1", "title": "绝不要用的 Linux 命令 ！", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/98f8ce146e703f781626982be880cdf5.jpeg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.hpe.com/us/en/insights/articles/the-linux-commands-you-should-never-use-1712.html\">Steven Vaughan-nichols</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9206-1.html\"> ChenYi</a>   </div><p><strong>当然，除非你想干掉你的机器。</strong></p>\n<div id=\"article_content\">\n<p>蜘蛛侠有这样的一句信条，“权力越大，责任越大。” 对于 Linux 系统管理员们来说，这也是一种应当采用的明智态度。</p>\n<p>不，真的，真心感谢 DevOps 的沟通协作和云编排技术，让一个 Linux 管理员不仅能掌控一台服务器，甚者能控制成千上万台服务器实例。只需要一个愚蠢的举动，你甚至可以毁掉一个价值数十亿美元的企业，就像 <a href=\"http://www.zdnet.com/article/equifax-blames-open-source-software-for-its-record-breaking-security-breach/\">没有打补丁的 Apache Struts</a> 一样。</p>\n<p>如果不能跑在安全补丁之前，这将会带来一个远超过系统管理员工资水平的战略性业务问题。这里就有一些足以搞死 Linux 服务器的简单方式掌握在系统管理员手中。很容易想象到，只有新手才会犯这些错误，但是，我们需要了解的更多。</p>\n<p>下列是一些著名的命令，任何拥有 root 权限的用户都能借助它们对服务器造成严重破坏。</p>\n<p><strong>警告：千万不要在生产环境运行这些命令，它们会危害你的系统。不要在家里尝试，也不要在办公室里测试。</strong></p>\n<p>那么，继续！</p>\n<h1 id=\"toc_1\">rm -rf /</h1>\n<p>想要干脆利落的毁掉一个 Linux 系统吗？你无法超越这个被誉为“史上最糟糕”的经典，它能删除一切，我说的是，能删除所有存在你系统里的内容！</p>\n<p>和大多数 <a href=\"https://www.hpe.com/us/en/insights/articles/16-linux-server-monitoring-commands-you-really-need-to-know-1703.html\">Linux 命令</a>一样，<strong>rm</strong> 这个核心命令使用起来非常方便。即便是最顽固的文件它也能帮你删除。结合起后面两个参数理解 <strong>rm</strong> 指令时，你很容易陷入大麻烦：<strong>-r</strong>，强制递归删除所有子目录，<strong>-f</strong>，无需确认，强制删除所有只读文件。如果你在根目录运行这条指令，将清除整个驱动器上的所有数据。</p>\n<p>如果你真这么干了，想想该怎么和老板解释吧！</p>\n<p>现在，也许你会想，“我永远不会犯这么愚蠢的错误。”朋友，骄兵必败。吸取一下经验教训吧， <a href=\"https://www.reddit.com/r/sysadmin/comments/732skq/after_21_years_i_finally_made_the_rm_boo_boo/\">这个警示故事来自于一个系统管理员在 Reddit 上的帖子</a>：</p>\n<blockquote><p>我在 IT 界工作了很多年，但是今天，作为 Linux 系统 root 用户，我在错误的系统路径运行了 <strong>rm- f</strong></p>\n<p>长话短说，那天，我需要复制一大堆目录从一个目录到另一个目录，和你一样，我敲了几个 <strong>cp -R</strong> 去复制我需要的内容。</p>\n<p>以我的聪明劲，我持续敲着上箭头，在命令记录中寻找可以复制使用的类似命令名，但是它们混杂在一大堆其他命令当中。</p>\n<p>不管怎么说，我一边在 Skype、Slack 和 WhatsApp 的网页上打字，一边又和 Sage 通电话，注意力严重分散，我在敲入 <strong>rm -R ./videodir/* ../companyvideodirwith651vidsin/</strong> 这样一条命令时神游物外。</p></blockquote>\n<p>然后，当文件化为乌有时其中也包括了公司的视频。幸运的是，在疯狂敲击 <strong>control -C</strong> 后，在删除太多文件之前，系统管理员中止了这条命令。但这是对你的警告：任何人都可能犯这样的错误。</p>\n<p>事实上，绝大部分现代操作系统都会在你犯这些错误之前，用一段醒目的文字警告你。然而，如果你在连续敲击键盘时忙碌或是分心，你将会把你的系统键入一个黑洞。（LCTT 译注：幸运的是，可能在根目录下删除整个文件系统的人太多了额，后来 <strong>rm</strong> 默认禁止删除根目录，除非——你手动加上 <strong>–no-preserve-root</strong> 参数！）</p>\n<p>这里有一些更为隐蔽的方式调用 <strong>rm -rf</strong>。思考一下下面的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68f4793b9c3594513409\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchar esp[] __attribute__ ((section(“.text”))) = “\\xeb\\x3e\\x5b\\x31\\xc0\\x50\\x54\\x5a\\x83\\xec\\x64\\x68”\r\n“\\xff\\xff\\xff\\xff\\x68\\xdf\\xd0\\xdf\\xd9\\x68\\x8d\\x99”\r\n“\\xdf\\x81\\x68\\x8d\\x92\\xdf\\xd2\\x54\\x5e\\xf7\\x16\\xf7”\r\n“\\x56\\x04\\xf7\\x56\\x08\\xf7\\x56\\x0c\\x83\\xc4\\x74\\x56”\r\n“\\x8d\\x73\\x08\\x56\\x53\\x54\\x59\\xb0\\x0b\\xcd\\x80\\x31”\r\n“\\xc0\\x40\\xeb\\xf9\\xe8\\xbd\\xff\\xff\\xff\\x2f\\x62\\x69”\r\n“\\x6e\\x2f\\x73\\x68\\x00\\x2d\\x63\\x00”\r\n“cp -p /bin/sh /tmp/.beyond; chmod 4755\r\n/tmp/.beyond;”;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9c3594513409-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68f4793b9c3594513409-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9c3594513409-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68f4793b9c3594513409-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9c3594513409-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68f4793b9c3594513409-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9c3594513409-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68f4793b9c3594513409-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9c3594513409-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68f4793b9c3594513409-1\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">esp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__attribute__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">section</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-sy\">.</span><span class=\"crayon-i\">text</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xeb</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x3e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5b</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x31</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x50</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5a</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x83</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xec</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x64</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x68</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68f4793b9c3594513409-2\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd9</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x99</span>”</div><div class=\"crayon-line\" id=\"crayon-5a68f4793b9c3594513409-3\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x81</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x92</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd2</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x16</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">xf7</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68f4793b9c3594513409-4\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x04</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x08</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x0c</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x83</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc4</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x74</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x56</span>”</div><div class=\"crayon-line\" id=\"crayon-5a68f4793b9c3594513409-5\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x73</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x08</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x53</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x59</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xb0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x0b</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xcd</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x80</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x31</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68f4793b9c3594513409-6\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x40</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xeb</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf9</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xe8</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xbd</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2f</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x62</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x69</span>”</div><div class=\"crayon-line\" id=\"crayon-5a68f4793b9c3594513409-7\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x6e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2f</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x73</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x00</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x63</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x00</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68f4793b9c3594513409-8\">“<span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">beyond</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4755</span></div><div class=\"crayon-line\" id=\"crayon-5a68f4793b9c3594513409-9\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">beyond</span><span class=\"crayon-sy\">;</span>”<span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0044 seconds] -->\r\n<p>这是什么？这是 16 进制的 <strong>rm -rf</strong> 写法。在你不明确这段代码之前，请千万不要运行这条命令！</p>\n<h1 id=\"toc_2\">fork 炸弹</h1>\n<p>既然我们讨论的都是些奇怪的代码，不妨思考一下这一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68f4793b9d0393929927\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:(){ :|: &amp; };:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9d0393929927-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68f4793b9d0393929927-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>对你来说，这可能看起来有些神秘，但是我看来，它就是那个臭名昭著的 <a href=\"https://linux.cn/article-5685-1.html\">Bash fork 炸弹</a>。它会反复启动新的 Bash shell，直到你的系统资源消耗殆尽、系统崩溃。</p>\n<p>不应该在最新的 Linux 系统上做这些操作。注意，我说的是<strong>不应该</strong>。我没有说<strong>不能</strong>。正确设置用户权限，Linux 系统能够阻止这些破坏性行为。通常用户仅限于分配使用机器可用内存。但是如果作为 root 用户的你运行了这行命令（或者它的变体 <a href=\"https://unix.stackexchange.com/questions/283496/why-do-these-bash-fork-bombs-work-differently-and-what-is-the-significance-of\">Bash fork 炸弹变体</a>），你仍然可以反复虐待服务器，直到系统重启了。</p>\n<h1 id=\"toc_3\">垃圾数据重写硬盘</h1>\n<p>有时候你想彻底清除硬盘的数据，你应该使用 <a href=\"https://dban.org/\">Darik’s Boot and Nuke （DBAN）</a> 工具去完成这项工作。</p>\n<p>但是如果仅仅想让你的存储器乱套，那很简单：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68f4793b9d7414419526\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n任意命令 &gt; /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9d7414419526-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68f4793b9d7414419526-1\">任意命令<span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我说的“任意命令”，是指有输出的任意命令，比如:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68f4793b9db479940349\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls -la &gt; /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9db479940349-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68f4793b9db479940349-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">la</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>……将目录列表通过管道送到你的主存储设备。给我 root 权限和足够的时间，就能覆盖整个硬盘设备。这是让你开始盲目恐慌的一天的好办法，或者，可以把它变成 <a href=\"https://www.hpe.com/us/en/insights/articles/13-ways-to-tank-your-it-career-1707.html\">职业禁入方式</a>。</p>\n<h1 id=\"toc_4\">擦除硬盘！</h1>\n<p>另一个一直受欢迎的擦除硬盘的方式是执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68f4793b9df015628156\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndd if=/dev/zero of=/dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9df015628156-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68f4793b9df015628156-1\"><span class=\"crayon-e\">dd </span><span class=\"crayon-st\">if</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">zero </span><span class=\"crayon-v\">of</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>你可以用这条命令写入数据到你的硬盘设备。<strong>dd</strong> 命令可以从特殊文件中获取无尽个 <strong>0</strong> 字符，并且将它全部写入你的设备。</p>\n<p>可能现在听起来 <strong>/dev/zero</strong> 是个愚蠢的想法，但是它真的管用。比如说，你可以使用它来 <a href=\"https://unix.stackexchange.com/questions/44234/clear-unused-space-with-zeros-ext3-ext4\">用零清除未使用的分区空间</a>。它能使分区的镜像压缩到更小，以便于数据传输或是存档使用。</p>\n<p>在另一方面，它和 <strong>dd if=/dev/random of=/dev/hda</strong> 相近，除了能毁掉你的一天之外，不是一个好事。如果你运行了这个指令（千万不要），你的存储器会被随机数据覆盖。作为一个隐藏你要接管办公室咖啡机的秘密计划的半吊子方法，倒是不错，但是你可以使用 DBAN 工具去更好的完成你的任务。</p>\n<h1 id=\"toc_5\">/dev/null 的损失</h1>\n<p>也许因为数据珍贵，我们对备份的数据没有什么信心，确实很多“永远不要这样做！”的命令都会导致硬盘或其它存储仓库的数据被擦除。一个鲜明的实例：另一个毁灭你的存储设备的方式，运行 <strong>mv / /dev/null</strong> 或者 <strong>&gt;mv /dev/null</strong>。</p>\n<p>在前一种情况下，你作为 root 用户，把整个磁盘数据都送进这个如饥似渴的 <strong>/dev/null</strong>。在后者，你仅仅把家目录喂给这个空空如也的仓库。任何一种情况下，除非还原备份，你再也不会再看见你的数据了。</p>\n<p>见鬼，难道会计真的不需要最新的应收账款文件了吗？</p>\n<h1 id=\"toc_6\">格式化错了驱动器</h1>\n<p>有时候你需要使用这一条命令格式化驱动器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68f4793b9e3867674751\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkfs.ext3 /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9e3867674751-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68f4793b9e3867674751-1\"><span class=\"crayon-v\">mkfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ext3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>……它会用 ext3 文件系统格式化主硬盘驱动器。别，请等一下！你正在格式化你的主驱动器！难道你不需要用它？</p>\n<p>当你要格式化驱动器的时候，请务必加倍确认你正在格式化的分区是真的需要格式化的那块而不是你正在使用的那块，无论它们是 SSD、闪存盘还是其他氧化铁磁盘。</p>\n<h1 id=\"toc_7\">内核崩溃</h1>\n<p>一些 Linux 命令不能让你的机器长时间停机。然而，一些命令却可以导致内核崩溃。这些错误通常是由硬件问题引起的，但你也可以自己搞崩。</p>\n<p>当你遭遇内核崩溃，重新启动系统你才可以恢复工作。在一些情况下，这只是有点小烦；在另一些情况下，这是一个大问题，比如说，高负荷运作下的生产环境。下面有一个案例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68f4793b9e9392534733\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndd if=/dev/random of=/dev/port\r\necho 1 &gt; /proc/sys/kernel/panic\r\ncat /dev/port\r\ncat /dev/zero &gt; /dev/mem</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9e9392534733-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68f4793b9e9392534733-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9e9392534733-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68f4793b9e9392534733-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68f4793b9e9392534733-1\"><span class=\"crayon-e\">dd </span><span class=\"crayon-st\">if</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">random </span><span class=\"crayon-v\">of</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">port</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68f4793b9e9392534733-2\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">kernel</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">panic</span></div><div class=\"crayon-line\" id=\"crayon-5a68f4793b9e9392534733-3\"><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">port</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68f4793b9e9392534733-4\"><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zero</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mem</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这些都会导致内核崩溃。</p>\n<p>绝不要运行你并不了解它功能的命令，它们都在提醒我…</p>\n<h1 id=\"toc_8\">提防未知脚本</h1>\n<p>年轻或是懒惰的系统管理员喜欢复制别人的脚本。何必重新重复造轮子？所以，他们找到了一个很酷的脚本，承诺会自动检查所有备份。他们就这样运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68f4793b9ed578404404\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget https://ImSureThisIsASafe/GreatScript.sh -O- | sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68f4793b9ed578404404-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68f4793b9ed578404404-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//ImSureThisIsASafe/GreatScript.sh -O- | sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这会下载该脚本，并将它送到 shell 上运行。很明确，别大惊小怪，对吧？不对。这个脚本也许已经被恶意软件感染。当然，一般来说 Linux 比大多数操作系统都要安全，但是如果你以 root 用户运行未知代码，什么都可能会发生。这种危害不仅在恶意软件上，脚本作者的愚蠢本身同样有害。你甚至可能会因为一个未调试的代码吃上一堑——由于你没有花时间去读它。</p>\n<p>你认为你不会干那样的事？告诉我，所有那些 <a href=\"https://www.oreilly.com/ideas/five-security-concerns-when-using-docker\">你在 Docker 里面运行的容器镜像在干什么</a>？你知道它们到底在运行着什么吗？我见过太多的没有验证容器里面装着什么就运行它们的系统管理员。请不要和他们一样。</p>\n<h1 id=\"toc_9\">结束</h1>\n<p>这些故事背后的道理很简单。在你的 Linux 系统里，你有巨大的控制权。你几乎可以让你的服务器做任何事。但是在你使用你的权限的同时，请务必做认真的确认。如果你没有，你毁灭的不只是你的服务器，而是你的工作甚至是你的公司。像蜘蛛侠一样，负责任的使用你的权限。</p>\n<p>我有没有遗漏什么？在 <a href=\"http://www.twitter.com/sjvn\">@sjvn</a> 或 <a href=\"http://www.twitter.com/enterprisenxt\">@enterprisenxt</a> 上告诉我哪些 Linux 命令在你的“<a href=\"https://www.youtube.com/watch?v=v79fYnuVzdI\">绝不要运行！</a>”的清单上。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113437\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113437votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113437\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113437/", "comment_nums": 4, "create_date": "2018/01/07", "tags": "IT技术,命令", "url_object_id": "e3a2ad757e369fe8e6d1f11af56e0091", "front_image_path": "full/eddbdfa6ee3b7f537ff14b7a523f5b3bffa5d38d.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "可视化解释压缩算法的工作原理", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/b9ef8d0caa5ba5128d42f1ab6956e047.jpeg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2018329974\">nEoYe</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://unwttng.com/compression-decompressed\">unwttng</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>压缩技术在生活中无处不在，硬盘上存储数据、发送电视信号、网页传输、流媒体、电子游戏……现代计算几乎没有一个重要领域不使用压缩技术。</p>\n<h3>那么压缩技术到底是什么？</h3>\n<p>无论你使用过很多年的电脑压缩软件还是从没想过这个问题，本文将尝试解释，当你压缩一个文件或传输一段视频时，其中的数据到底发生了什么变化。我们将探寻这些重要问题的答案，在此过程中，也许会提出一些新的问题。</p>\n<ul>\n<li>对被压缩对象进行压缩，意味着什么？</li>\n<li>如何能将目标对象变得比原来更小？</li>\n<li>如何具体实现压缩技术</li>\n</ul>\n<p>让我们来一一解答吧！</p>\n<p><iframe width=\"480\" height=\"480\" src=\"https://giphy.com/embed/l0Iy1ZcHArR9aAQta\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen=\"allowfullscreen\"></iframe></p>\n<p><a href=\"https://giphy.com/gifs/twitter-reaction-happy-l0Iy1ZcHArR9aAQta\">via GIPHY</a></p>\n<h3>基础知识</h3>\n<p>在研究压缩技术和数字信息之前，这里有一段通俗易懂的压缩技术介绍。让我们来看看下方的英文字母：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph6hij8kj203j01xa9t.jpg\" width=\"127\" height=\"69\"></p>\n<p>看看我们用来表现这个单词（Tree）的字符，加起来一共是 4 个：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph6hij8kj203j01xa9t.jpg\" width=\"127\" height=\"69\"></p>\n<p>看起来还行。如果我们用汉字会发生什么？</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnph6i6zpej202o01t0rs.jpg\" width=\"96\" height=\"65\"></p>\n<p>天哪！只用了一个字符！我们有改变它要传达的意思和任何信息么？并没有。但是，我们降低了75%的网页空间，来表达“tree”的含义。那么我们到底做了什么？</p>\n<p>没什么神奇的 —— 我们只是用另一种方式去表达了这个含义。我们选择了一种不同的、更加高效的信息表现方式。Spoiler：接下来是本文最重要的部分，请仔细阅读。</p>\n<p><strong>那么，如果是像素级的图片呢？</strong></p>\n<p>你肯定会觉得惊讶，如何将上面的例子应用于严谨的数字图像数据呢？让我们来看一下最近很流行的一类数据 —— 图片。现阶段，让我们先从简单的像素级图片入手，而不是一上来就尝试去压缩一张高分辨率的 Instagram 图片或其他类似的复杂图片。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnph4do8wyj208u08u741.jpg\" width=\"318\" height=\"318\"></p>\n<p>不怎么好看对吗？因为这是我自己画的。上面是一个 10*10 的网格，每一种颜色都可以用‘B’、‘Y’和‘G’中的一个字符来表示。</p>\n<p>我们怎么用数字化的方式表示上面的图像？以原始的方式存储这张图片的文件可能包含下面的内容：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnph9vfgjlj20be04oglm.jpg\" width=\"410\" height=\"168\"></p>\n<p>我们所做的只是从左到右，从上到下，为每个像素写下了代表其颜色的字符。正如你预期的那样，总共会有 100 个字符。我们假设这 100 个字符会占用硬盘上的 100 个字节。这种存储方式，定义了一个合理的存储文件大小上限。任何其他存储方式，只要其文件大小大于上述方法，都是无意义的，或者尝试去存储除了图片数据之外的信息（比如元数据或其他数据）。我想你们应该能认同我的这种观点。</p>\n<p>在你往下看之前，开动下你的大脑。如果我让你用少于 100 个字符来表示这张图片，你会怎么做呢？喝一杯茶，仔细想一想，我等着你。</p>\n<p>想到什么方法了吗？很好，我也想到了一个。</p>\n<p>我准备将我的方法命名为<strong>行程长度压缩算法（RLE）</strong>。开玩笑的啦，这个方法不是我想出来的，也不是我命名的。至少从六十年代起，它已经成为了一种基本的压缩技术。我打赌，你们之中有些人刚刚才想出这种方法。</p>\n<p>我们将行程长度压缩算法应用于上面的图片。在上方，我们写了很多一连串的相同颜色字符。让我们从那些‘B’字符下手。那么我们能够压缩这些重复的字符么？</p>\n<p>当然可以！抛弃下面这种方式：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnph46yjm4j20ew020mwz.jpg\" width=\"536\" height=\"72\"></p>\n<p>取而代之：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnph47f2qfj203p01wgld.jpg\" width=\"133\" height=\"68\"></p>\n<p>看起来有戏。通过缩写这一长串相同字符，我们将 17 个字符减少到了 3 个。顺便说下，我们将这些重复的字符串称之为 <strong>runs</strong>。所以<strong>行程长度压缩算法</strong>是通过记下 <strong>runs</strong> 的长度，而不是记下每一个字符，对数据进行压缩编码。这种压缩方式并没有信息丢失。能够解析前一个文件的程序，稍微修改下，就能解析我们的新文件格式。2 者解析出来的图片应该是一样的。</p>\n<p>下面的实时 demo 展示了原始图像和它的 2 种存储编码方式：原始版本和行程长度压缩编码版。</p>\n<p>通过点击任意像素点，你可以改变其颜色，下方的存储字符也会随之变化。</p>\n<blockquote><p><span style=\"color: red;\">编注：英文原文此处有 Demo，本文无法再现，请在 https://unwttng.com/compression-decompressed 查看。</span></p></blockquote>\n<p>随着你不断改变原始图像的像素颜色，你会发现我们能够压缩的比例和图片本身有关。如果整张图片只有一种颜色，或者颜色的连续区域很长，我们可以得到很小的输出。使用行程长度压缩算法能够得到的最小存储大小是 4 字节：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnph4913l4j20hu0hu0sj.jpg\" width=\"642\" height=\"642\"></p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph49g1fpj204o02h0si.jpg\" width=\"168\" height=\"89\"></p>\n<p>当然，这个算法在某些场景下也会表现的十分糟糕。实际上，用这个算法压缩出来的文件，可以比原始一个像素一个像素表示的方式都要大。你会发现，当需要表示‘1B’或’1G’时，它会使用 2 个字符。如果在你的像素图片中，每个颜色的连续长度只有 1 ，会发生什么？</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnph49s48fj20jv0jwq2r.jpg\" width=\"690\" height=\"691\"></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnph4a84rcj20j602ua9v.jpg\" width=\"690\" height=\"102\"></p>\n<p>惊讶吧。</p>\n<p>是时候学习些术语了。</p>\n<h3>压缩率</h3>\n<p>如何衡量我们的压缩算法到底使数据缩小了多少？你可能已经猜到了 —— 计算数据压缩前后的大小比。</p>\n<p>比如，我们使用算法将 100 字节的像素图片压缩至 42 字节，那么我们计算出的压缩率为 (100 / 42) ≈ 2.38。最好的情况是只有一种颜色的图片，这种算法的压缩率高达 (100 / 4) = 25！然而，当该算法作用于每个颜色的连续长度只有 1 的图片上时，压缩率只有 (100 / 200) = 0.5。Protip：压缩率小于 1 简直是糟糕透了。</p>\n<p>我们可以看出，这种基础 RLE 算法的压缩率对于输入的数据结构十分敏感。对于这类简单的算法，这种现象很常见。该算法对于数据的结构做了若干假设，如果要使该算法能够输出理想结果，原始输入数据中必须存在重复相邻的相同字节。一个更智能的 RLE 算法实现可能会尝试使用重复的子串来对数据进行压缩编码。</p>\n<p>甚至我直接用英语文字描述这张图片，压缩率都比 2 要大！运用这种方法，可以将数据压缩存储成一种友好、简洁的文件格式，相比第一次尝试我们又迈出了一小步。</p>\n<h2>数据到底能被压缩到多小？</h2>\n<p>这是一个很大很宽泛的问题。当然，人们认为，对于任何输入数据，一个合理设计的压缩算法，应该至少能将数据压缩那么一点（这里的一点点，既指口语上的，也表示学术上的）。</p>\n<p>不幸的是，事情并没有那么简单。假设我们有一个算法 A，对于任何的输入，能够使压缩率始终严格大于 1。对于某些输入，压缩率可以为 2.5；对于另一些输入，压缩率可能为 1.000000002。</p>\n<p>如果这种算法存在，我们可以无限迭代调用它。对于某个输入，我们计算 A(A(A(data)))，对每一次的输出不断调用 A()。我们每调用一次，数据的大小至少会被压缩一点点。不难看出，到最后，我们能将数据压缩至 1 字节，甚至 0 字节？</p>\n<p>这看起来不太现实。事实也确实如此。我们甚至不需要使用递归法去证明该算法的可行性，试想下这种情况：有 9 个不同的文件，没有任何方法能够在不丢失数据的情况下，将这 9 个文件都压缩至 3 字节。</p>\n<p>3 个字节一共只能表示 8 种不同的数据：000、001、010、100、011、101、110、111。即使我们有某个十分强大的压缩算法，能够将前 8 个文件分别压缩成前面这 8 种字节表示，第 9 个文件也只能压缩为其中之一。对于该算法，任意 8 个以上的未压缩数据片段，都无法找到更多不同的 3 个字节来表示。</p>\n<p>这里有一条重要的原则：<strong>对常见数据的压缩，任何算法的压缩率都有严格的限制</strong>。你可以不断地使用某个算法对数据进行压缩，直到无法将数据压缩得更小，然后换种算法继续尝试。这种做法也许会将数据压缩得更小（实际上，很多线上的软件都是这么做的），但最终，你会遇到你永远无法再次压缩的数据。其实，你对不同的算法的重复调用，到头来又变成了另一种压缩算法。这条规则现在仍然适用。</p>\n<h3>柯氏复杂性</h3>\n<p>看到下面你也许会更加失望。对于压缩率的大小，不仅仅在算法上有着理论的限制 —— 数据本身的复杂度对其也会有很大的影响</p>\n<p>让我们来看下下面的 2 个字符串：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph4ay4q1j20c70140si.jpg\" width=\"439\" height=\"40\"></p>\n<p>和：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnph4bbd5cj20ci0170sk.jpg\" width=\"450\" height=\"43\"></p>\n<p>2 者是完全相同的长度，但是，你可以很轻易地看出来，后者明显要更加复杂。说的更具体点，使用 RLE 压缩算法，我们可以将第一个字符串压缩至最多 3 个字符（“24a”）。</p>\n<p><a href=\"https://wikipedia.org/wiki/Kolmogorov_complexity\">柯氏复杂性</a>（一位苏联数学家 <a href=\"https://en.wikipedia.org/wiki/Andrey_Kolmogorov\">Andrey Nikolaevich Kolmogorov</a> 的伟大发明）将上述内容阐述地很好。当然，一个事物的度量方式有很多种，柯氏复杂性是一种比较不错的度量方式。<strong>数据的柯氏复杂性是指，通过计算机程序输出的，能够描述这个字符串的最短长度</strong>。</p>\n<p>显然，对于柯氏复杂性，任何字符串‘S’的长度上界就是其本身。上述说法将算法进行了一定的简化，其实数据的柯氏复杂性还需加上整个程序的长度 —— 包括解释器或编译后的代码。但是就本文讨论的范围来说，没有必要。直接把它认为是你能生成的该数据的最短长度。</p>\n<p>柯氏复杂性对于你选择什么编程语言并不是很敏感。程序语言的选择只会对复杂度的一个常数因子产生影响。下面这句话很重要：<strong>无论你选择什么语言来描述数据，所带来的长度变化是有限的</strong>。有些数据就是需要比一百万个绿色像素点更多的空间来表示，怎么也减少不了。</p>\n<h2>数据丢失</h2>\n<p>但是，别放弃希望。我们之前讨论的都是<strong>无损压缩</strong>。无损压缩是指，<strong>通过压缩之后的数据，能够完全还原压缩之前的原始数据</strong>。也就是说，如果 C 是我们的压缩算法，D 是相应的解压缩算法，<span style=\"color: #ff0000;\">D(C(x)) = x 对于任何输入数据 x 永远成立</span>。</p>\n<p>无损压缩是十分有用的！当压缩一些文献或博文、税收档案、低分辨率的像素图片等类似的文本数据时，你肯定想要做到无损压缩。对于这些数据，保证数据的精确和每个字符的顺序，是很重要的。</p>\n<p>但是也有其他选择。有损压缩是指，不保证压缩的数据解压之后与压缩之前的数据完全一致。这种压缩算法十分常见。</p>\n<p>有损压缩应用十分广泛。人类的感官对于一些微小错误或瑕疵是比较有容忍度的。数据丢失主要体现在压缩图片、音频（或视频）文件时。</p>\n<p>需要例子吗？请看下面 2 张奥巴马的图片。</p>\n<div class=\"_3Ubq9VOb1UrxcVCNkyeHvy\" data-reactid=\"2170\"><img class=\"_2KvafgTG8gHR5gjd_JB3mD\" src=\"https://unwttng.com/i/barack.png?v=v8.3.0\" data-reactid=\"2171\"></div>\n<div class=\"_3Ubq9VOb1UrxcVCNkyeHvy\" data-reactid=\"2170\">第一张图片是大小约为 335 千字节的 PNG 文件（PNG 是一种无损图片压缩格式）。这将作为我们的参照物。</div>\n<div class=\"_3Ubq9VOb1UrxcVCNkyeHvy\" data-reactid=\"2170\"></div>\n<div class=\"_3Ubq9VOb1UrxcVCNkyeHvy\" data-reactid=\"2172\"><img class=\"_2KvafgTG8gHR5gjd_JB3mD\" src=\"https://unwttng.com/i/barack.jpg?v=v8.3.0\" data-reactid=\"2173\"></div>\n<p>第二张图片，是第一张图片保存为 JPEG 格式的结果，这是一种会丢失许多数据的有损压缩。第二张图片的大小约为 22 千字节，相比原始图片，压缩率约为 15，这么大的压缩率并不表示数据丢失会很严重。</p>\n<p>你能看出这 2 张图片的区别么？也许能看出一点点。如果你尽可能靠近你的屏幕，眯起眼睛，转头环视下这张图片。接着你去看他的头发细节，一根一根地数头发，在没有头发的地方你会发现一些模糊。关键点不在于第二张图是不是一个完美的复制品，而在于它是不是足够好用。当你通过互联网传输数据时，十五倍的压缩率比起一张毫无损失的 PNG 图片更有价值。</p>\n<p>但这并不是说在任何情况下，它都如此出色。为了达到这种压缩效果，JPEG 必须丢掉很多数据，尽管同时它尽力避免丢失太多数据，但是你可以尝试探索下它的极限。通过下面的实时 demo，你可以看出 JPEG 格式的图片质量下限能到多少。同时在图片清晰度变得无法容忍之前，注意看下图片质量是多少。像我之前说的那样，人类的视觉容忍度是很高的。</p>\n<blockquote><p><span style=\"color: #ff0000;\">编注：英文原文此处有一个 Demo，本文无法再现，请在 https://unwttng.com/compression-decompressed 查看</span></p></blockquote>\n<p>像 Netflix 和 YouTube 上的视频流服务，以及 Spotify 和 Soundcloud 上的音频流服务，都是使用的有损压缩。缓冲或延迟是一个用户无法忍受的，所以在保证音视频质量的同时，这些服务尽可能地去压缩数据。你经常会看到数据的动态压缩， 一开始视频会比较模糊，当检测到你的网络速度可以接受更小的压缩率时，视频的清晰度会随之提高。</p>\n<p>看到下面这张来自 Giphy 网站上的动图了么？数据的动态压缩在这里同样适用。看看他们是如何处理网速慢的情况下的动图加载（没错，我在 Giphy 网站上将这个加载过程做成了一张动图，并将它嵌入了进来，看出什么问题了么？）：</p>\n<p><iframe width=\"480\" height=\"377\" src=\"https://giphy.com/embed/l1J3QaZoHeNZ9JFU4\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen=\"allowfullscreen\"></iframe></p>\n<p>（<a href=\"https://giphy.com/gifs/l1J3QaZoHeNZ9JFU4\">via GIPHY</a>）</p>\n<p>看起来很奇怪对么？首先，他们加载了这张动图的第一帧低清晰度图片。接着，当更大的数据传输过来后，出现了动图。但是还不完全，只有仅仅几帧。然后，越来越多帧图片被传输了过来，直到最后完全加载整张动图。</p>\n<p>这就是现代的流媒体压缩技术：混合的压缩策略几乎完全是为了，以尽可能少的字节（大小越小，时间也越短），提供给用户流畅的内容。针对文件的无损压缩技术，比如上面说到的 RLE，也有用武之地，而且它仍然是很多最好的桌面文件压缩工具的核心模块。但是，多亏了有损压缩，你才能在电视上流畅地观看《权利的游戏》。</p>\n<h2>数据压缩无处不在</h2>\n<p>关于压缩技术本文我们就先介绍到这里，但这只是冰山一角。</p>\n<p>我们学习了压缩技术的基本思想，从这些技术中得出了一条很重要的哲学道理：</p>\n<p><strong>图像，文字，视频，音乐 —— 任何数据都没有唯一正确的表现形式。区别只是在于有多少种表现数据的有效方式。</strong></p>\n<p>压缩技术就是不断寻找更加有效的方式来存储你的数据，最强大的压缩算法，对于任何数据，它都能找到一种高效的方法对其进行压缩。</p>\n<p>感谢阅读，如果你认可我在文中制作的那些实时 demo，请随时与你的朋友分享。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113505\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113505votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113505\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2018329974\">nEoYe</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2018329974\">\r\n\t\t\t<img src=\"http://tp4.sinaimg.cn/2018329974/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢唱歌和游戏的程序员        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2018329974\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2018329974/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2018329974/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://neoyeelf.github.io\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2018329974\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113505/", "comment_nums": 0, "create_date": "2018/01/22", "tags": "IT技术,压缩,算法", "url_object_id": "b9b171295ec64f98fee2fb5b2e84e1b9", "front_image_path": "full/78e713b8eb8fef3bd02c3d3719902b1ba8c74965.jpg"}
{"fav_nums": 1, "praise_nums": "2", "title": "利用副项目找 IT 工作，需要满足这 3 个原则", "front_image_url": ["http://ww1.sinaimg.cn/mw690/7cc829d3gw1eizj4ql2huj20eq0b0wfx.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://hackcareer.com/side-project/\">DJ Chung</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><div>\n<h3>确保副项目不是在浪费你的时间</h3>\n<p id=\"0d40\" class=\"graf graf--p graf-after--figure\">为了在 IT 科技领域谋求一份工作而做副项目，这要不就是极好利用时间，就是在极大浪费时间。</p>\n<p>特别当你有一个非技术的背景时，副项目可以帮助你进入科技行业。或者恰好相反，即便你花了很多精力与时间，也不会有任何帮助和影响。</p>\n<p>仅仅拥有一个副项目并不意味着它能帮你找到工作。</p>\n<p><img class=\"alignnone\" src=\"http://ww1.sinaimg.cn/mw690/7cc829d3gw1eizj4ql2huj20eq0b0wfx.jpg\" width=\"530\" height=\"396\"></p>\n<h3>你的副项目本身可能不会给你带来工作</h3>\n<p id=\"3289\" class=\"graf graf--p graf-after--h3\">为了在求职时凸显或加强你的工作经验，这里有两种不同类型的副项目：</p>\n<p id=\"10b3\" class=\"graf graf--h4 graf-after--p\"><strong>1. “梦幻成真”般的副项目</strong></p>\n<p> </p>\n<p>这是那种“做了就会有人主动上门”的副项目。它本身非常吸引人，所以即使没有积极地找工作，你也能得到工作机会。</p>\n<p>* 如果你没有这方面的推荐，可以看看电影《 Field of Dreams | 梦幻成真》”。</p>\n<p id=\"a474\" class=\"graf graf--p graf-after--p\">每年都会发生类似的事情，就是某个人做了个惊人的副项目，然后被他人主动提供了工作机会。</p>\n<p id=\"c7a0\" class=\"graf graf--p graf-after--p\">我能想到的例子，是 <a class=\"markup--anchor markup--p-anchor\" href=\"https://feross.org/\" target=\"_blank\" rel=\"nofollow noopener\">Feross Aboukhadijeh</a> 在 2010 年做的副项目 <a class=\"markup--anchor markup--p-anchor\" href=\"http://ytinstant.com/\" target=\"_blank\" rel=\"nofollow noopener\">YouTube Instant</a>，它还是在六小时内完成的！此项目一炮而红，成为了媒体焦点，并<a class=\"markup--anchor markup--p-anchor\" href=\"https://feross.org/youtube-instant-media-frenzy/\" target=\"_blank\" rel=\"nofollow noopener\">让他直接从 YouTube 联合创始人 Chad Hurley 那里获得了一份工作</a>。</p>\n<p id=\"ed69\" class=\"graf graf--p graf-after--p\">我阅读这篇文章的时候受到启发，一个副项目可以获得如此多的关注，甚至是一个现成的工作机会，特别当我寻求名牌科技公司工作机会的时候，感受更加深刻。但与此同时，我也禁不住有点泄气，YouTube Instant 是能够谋求技术工作的副项目标准吗？<strong>（不是这样的！）</strong></p>\n<p>不用说，即使项目自身的创建没有花费很长时间，但“梦想之地”级别的副项目也依赖于世界级的技能，而这些技能的开发和培养可能需要数年的时间。</p>\n<p id=\"b7c6\" class=\"graf graf--h4 graf-after--p\"><strong>2、“尽量努力（A for effort）”副项目</strong></p>\n<p>“尽量努力”副项目意味着，你不能再花多余的时间去做一些有趣的事情了。无论如何，你所生产的东西可能不会令人惊奇到雇主们会提供给你工作机会。老实说，大部分的副项目都是此类型的。</p>\n<p class=\"graf graf--p graf-after--p\"><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fn9bkdf0e1g20dc07ahdt.gif\" width=\"480\" height=\"262\"></p>\n<p id=\"cd07\" class=\"graf graf--p graf-after--p\">或许你学了编程，并做了个小的应用程序来跟踪读过的书；或许你做了个带有旅行故事的照片博客。又或许你围绕着喜欢的主题（如烹饪等），做了个 YouTube 创意视频库。</p>\n<p>不管怎么说，“尽量努力”副项目是你可以自豪地放在简历上，来体现工作质量的。</p>\n<p id=\"e874\" class=\"graf graf--p graf-after--p\"><em>旁注：学习一项技能不是一个副项目，你必须做成一些事情。上完周末的 JavaScript 课程不是一个副项目，放在简历上也无足轻重。</em></p>\n<p id=\"f1b7\" class=\"graf graf--p graf-after--p\">那么，如何确保“尽量努力”副项目为你的应用程序增加了价值，而不是白白浪费了你的时间呢？</p>\n<h3 id=\"3481\" class=\"graf graf--h3 graf-after--p\">优质副项目的 3 个原则</h3>\n<p id=\"ef0d\" class=\"graf graf--p graf-after--h3\">在申请工作时，能为你增加额外价值的优质副项目，必须是相关的、有深度的，并且至少经历两次迭代。</p>\n<h4 id=\"e338\" class=\"graf graf--h4 graf-after--p\">1. 你的副项目是否与申请的工作相关？</h4>\n<p id=\"a241\" class=\"graf graf--p graf-after--h4\">相关的副项目可以在你的简历中提供更多的优势，但更重要的是，它们可以帮助体现你的工作经验。</p>\n<p>举个例子，如果你有一个非技术的背景，但申请的岗位更倾向于技术背景（如一些产品管理角色），那么学习做一个简单 iPhone 应用程序的编程项目，就可以成为一个好的副项目。如果能成功地将 iPhone 应用程序发布到 App Store，不仅可以学习到技术概念，还可以将这份经验应用到从头构建软件产品中去。</p>\n<p id=\"6d9b\" class=\"graf graf--p graf-after--p\">又或者你正在申请一个内容营销的岗位，但没有直接的工作经验。一个相关的副项目可以是建立一个博客（尽管可能会很小），放些你感兴趣的小众话题，吸引那些对话题有忠诚度和参与感的围观群众。</p>\n<h4 id=\"6c3f\" class=\"graf graf--h4 graf-after--p\">2. 你的副项目有深度吗？</h4>\n<p id=\"b2dd\" class=\"graf graf--p graf-after--h4\">这是一个主观向的原则。它的另一种问法是，你的项目是否表明你投入了思想和努力，或者它只是你为了显示其存在而匆忙拼凑出的东西？</p>\n<p>你的副项目并不一定是下一个新的病毒社交媒体应用程序，但它必须是你做出来能引以为豪的东西。</p>\n<p id=\"7544\" class=\"graf graf--p graf-after--p\">继续使用 iPhone 应用程序副项目做例子，如果有人下载使用它，以此为基础，它是否能够正常工作？再进一步地问，它是否展示出你考虑过用户体验，使它相对易用？你是否考虑过边界情况并尝试解决它们？</p>\n<p id=\"8b63\" class=\"graf graf--p graf-after--p\">在一天结束的时候，问问自己，你的副项目是否是对你实际工作质量的精准体现，因为你要申请的公司就是这么想的。</p>\n<h4 id=\"92bb\" class=\"graf graf--h4 graf-after--p\">3. 你的副项目经历至少两次迭代吗？</h4>\n<p id=\"650e\" class=\"graf graf--p graf-after--h4\">你要证明你对自己的工作有足够的关心，并在积极地寻求改进。</p>\n<p class=\"graf graf--p graf-after--p\">如果你做了个应用程序，在发布了初版后，你是止步不前，还是从一些用户那里获取反馈并做出相应的改进？</p>\n<p class=\"graf graf--p graf-after--p\">如果你开始写博客，你是只写了几篇文章，还是写了几十篇文章？来表明你不仅致力于制作高质量的内容，而且还想完成一整套的作品。</p>\n<p>展示你的副项目，不仅只是把它放在简历上，让别人看到你投入时间和精力做出的成果，并且让审查人员觉得花费额外的时间来看看其背后深层次的内容和想法。</p>\n<h3 id=\"1e6b\" class=\"graf graf--h3 graf-after--p\">你必须让人注意到你的副项目</h3>\n<p id=\"be37\" class=\"graf graf--p graf-after--h3\">即使你的副项目遵循了这三条原则，如果你的副项目在审查简历或面试的过程中被人忽视，那就毫无作用，等于白做了。</p>\n<p id=\"8683\" class=\"graf graf--p graf-after--p\">如果你认为副项目真的能在职位申请中有所帮助，那就把它加入简历中，并注意放在简历的顶端。想清楚该怎样描述它的内容，以及你是如何进行的，这样才能让这份宝贵的经验更有价值。如果仍有余力，你还可以给出信用指标，比如可以度量的数值或者成就，包括用户数量、App Store 评级和发布功能等等。</p>\n<p>另外，不管你的副项目是什么，你都要在公众能够访问的站点上，比如你的个人博客或 Medium，发帖记录你所取得的进展，并把网站链接放入简历中。</p>\n<p>帖子中必须反映出你在进行副项目的过程中，学到的东西、获得的成就，以及面临的挑战。同时，利用截屏、演示视频或其他相关的记录方式，全方位多角度地展示你的项目。务必在 LinkedIn、Facebook 和 Twitter 的所有数字档案中加入网站的链接。</p>\n<p>你已经将大量的时间花在了副项目上，而这些时间原本可以用于别处，所以请务必展现出对自己辛勤工作的由衷自豪感！</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113443\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113443votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113443\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113443/", "comment_nums": 0, "create_date": "2018/01/08", "tags": "职场,程序员,职场", "url_object_id": "53d4edab180cf29ce21917e0cf1f3361", "front_image_path": "full/3dec15374f3b9e62441c4d320c8998dd12c43dc8.jpg"}
{"fav_nums": 2, "praise_nums": "1", "title": "汇编语言入门教程", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/03/6a6583a113036f92733762f47f315de4.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2018/01/assembly-language-primer.html\">阮一峰</a>   </div><p>学习编程其实就是学高级语言，即那些为人类设计的计算机语言。</p>\n<p>但是，计算机不理解高级语言，必须通过编译器转成二进制代码，才能运行。学会高级语言，并不等于理解计算机实际的运行步骤。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/3443f0ce5016cecae87f1ee60b81a33b.png\" alt=\"\"></p>\n<p>计算机真正能够理解的是低级语言，它专门用来控制硬件。汇编语言就是低级语言，直接描述/控制 CPU 的运行。如果你想了解 CPU 到底干了些什么，以及代码的运行步骤，就一定要学习汇编语言。</p>\n<p>汇编语言不容易学习，就连简明扼要的介绍都很难找到。下面我尝试写一篇最好懂的汇编语言教程，解释 CPU 如何执行代码。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f2d4d958fda459a28b8c56e033b7cfc7.jpg\" alt=\"\"></p>\n<h2>一、汇编语言是什么？</h2>\n<p>我们知道，CPU 只负责计算，本身不具备智能。你输入一条指令（instruction），它就运行一次，然后停下来，等待下一条指令。</p>\n<p>这些指令都是二进制的，称为操作码（opcode），比如加法指令就是<code>00000011</code>。<a href=\"http://www.ruanyifeng.com/blog/2014/11/compiler.html\">编译器</a>的作用，就是将高级语言写好的程序，翻译成一条条操作码。</p>\n<p>对于人类来说，二进制程序是不可读的，根本看不出来机器干了什么。为了解决可读性的问题，以及偶尔的编辑需求，就诞生了汇编语言。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d0f9b002c0b4cab2faeb7bc4fb342857.jpg\" alt=\"\"></p>\n<p><strong>汇编语言是二进制指令的文本形式</strong>，与指令是一一对应的关系。比如，加法指令<code>00000011</code>写成汇编语言就是 ADD。只要还原成二进制，汇编语言就可以被 CPU 直接执行，所以它是最底层的低级语言。</p>\n<h2>二、来历</h2>\n<p>最早的时候，编写程序就是手写二进制指令，然后通过各种开关输入计算机，比如要做加法了，就按一下加法开关。后来，发明了纸带打孔机，通过在纸带上打孔，将二进制指令自动输入计算机。</p>\n<p>为了解决二进制指令的可读性问题，工程师将那些指令写成了八进制。二进制转八进制是轻而易举的，但是八进制的可读性也不行。很自然地，最后还是用文字表达，加法指令写成 ADD。内存地址也不再直接引用，而是用标签表示。</p>\n<p>这样的话，就多出一个步骤，要把这些文字指令翻译成二进制，这个步骤就称为 assembling，完成这个步骤的程序就叫做 assembler。它处理的文本，自然就叫做 aseembly code。标准化以后，称为 assembly language，缩写为 asm，中文译为汇编语言。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/06e7e54cdaef72255f4c3b5d1a97f6ff.jpg\" alt=\"\"></p>\n<p>每一种 CPU 的机器指令都是不一样的，因此对应的汇编语言也不一样。本文介绍的是目前最常见的 x86 汇编语言，即 Intel 公司的 CPU 使用的那一种。</p>\n<h2>三、寄存器</h2>\n<p>学习汇编语言，首先必须了解两个知识点：寄存器和内存模型。</p>\n<p>先来看寄存器。CPU 本身只负责运算，不负责储存数据。数据一般都储存在内存之中，CPU 要用的时候就去内存读写数据。但是，CPU 的运算速度远高于内存的读写速度，为了避免被拖慢，CPU 都自带一级缓存和二级缓存。基本上，CPU 缓存可以看作是读写速度较快的内存。</p>\n<p>但是，CPU 缓存还是不够快，另外数据在缓存里面的地址是不固定的，CPU 每次读写都要寻址也会拖慢速度。因此，除了缓存之外，CPU 还自带了寄存器（register），用来储存最常用的数据。也就是说，那些最频繁读写的数据（比如循环变量），都会放在寄存器里面，CPU 优先读写寄存器，再由寄存器跟内存交换数据。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/9a7335e708252c99b00b6fff4fdfe027.png\" alt=\"\"></p>\n<p>寄存器不依靠地址区分数据，而依靠名称。每一个寄存器都有自己的名称，我们告诉 CPU 去具体的哪一个寄存器拿数据，这样的速度是最快的。有人比喻寄存器是 CPU 的零级缓存。</p>\n<h2>四、寄存器的种类</h2>\n<p>早期的 x86 CPU 只有8个寄存器，而且每个都有不同的用途。现在的寄存器已经有100多个了，都变成通用寄存器，不特别指定用途了，但是早期寄存器的名字都被保存了下来。</p>\n<blockquote>\n<ul>\n<li>EAX</li>\n<li>EBX</li>\n<li>ECX</li>\n<li>EDX</li>\n<li>EDI</li>\n<li>ESI</li>\n<li>EBP</li>\n<li>ESP</li>\n</ul>\n</blockquote>\n<p>上面这8个寄存器之中，前面七个都是通用的。ESP 寄存器有特定用途，保存当前 Stack 的地址（详见下一节）。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/dfaf4aea08b128207a5b2e64808a37b7.png\" alt=\"\"></p>\n<p>我们常常看到 32位 CPU、64位 CPU 这样的名称，其实指的就是寄存器的大小。32 位 CPU 的寄存器大小就是4个字节。</p>\n<h2>五、内存模型：Heap</h2>\n<p>寄存器只能存放很少量的数据，大多数时候，CPU 要指挥寄存器，直接跟内存交换数据。所以，除了寄存器，还必须了解内存怎么储存数据。</p>\n<p>程序运行的时候，操作系统会给它分配一段内存，用来储存程序和运行产生的数据。这段内存有起始地址和结束地址，比如从<code>0x1000</code>到<code>0x8000</code>，起始地址是较小的那个地址，结束地址是较大的那个地址。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/7f1f51353a99a62ee70454c2c5030c92.png\" alt=\"\"></p>\n<p>程序运行过程中，对于动态的内存占用请求（比如新建对象，或者使用<code>malloc</code>命令），系统就会从预先分配好的那段内存之中，划出一部分给用户，具体规则是从起始地址开始划分（实际上，起始地址会有一段静态数据，这里忽略）。举例来说，用户要求得到10个字节内存，那么从起始地址<code>0x1000</code>开始给他分配，一直分配到地址<code>0x100A</code>，如果再要求得到22个字节，那么就分配到<code>0x1020</code>。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f056b4759e9eb74123d522070693a83a.png\" alt=\"\"></p>\n<p>这种因为用户主动请求而划分出来的内存区域，叫做 Heap（堆）。它由起始地址开始，从低位（地址）向高位（地址）增长。Heap 的一个重要特点就是不会自动消失，必须手动释放，或者由垃圾回收机制来回收。</p>\n<h2>六、内存模型：Stack</h2>\n<p>除了 Heap 以外，其他的内存占用叫做 Stack（栈）。简单说，Stack 是由于函数运行而临时占用的内存区域。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/83b5e7fb052711d40315bc7ab57631df.png\" alt=\"\"></p>\n<p>请看下面的例子。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b64f3464998794\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nint main() {\r\n   int a = 2;\r\n   int b = 3;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b64f3464998794-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b64f3464998794-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b64f3464998794-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b64f3464998794-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b64f3464998794-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b64f3464998794-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b64f3464998794-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b64f3464998794-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b64f3464998794-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b64f3464998794-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b64f3464998794-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b64f3464998794-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面代码中，系统开始执行<code>main</code>函数时，会为它在内存里面建立一个帧（frame），所有<code>main</code>的内部变量（比如<code>a</code>和<code>b</code>）都保存在这个帧里面。<code>main</code>函数执行结束后，该帧就会被回收，释放所有的内部变量，不再占用空间。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/27189d0282df82fbf7c1ac4d0cf0ffe1.png\" alt=\"\"></p>\n<p>如果函数内部调用了其他函数，会发生什么情况？</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b64fd145504812\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nint main() {\r\n   int a = 2;\r\n   int b = 3;\r\n   return add_a_and_b(a, b);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b64fd145504812-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b64fd145504812-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b64fd145504812-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b64fd145504812-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b64fd145504812-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b64fd145504812-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b64fd145504812-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b64fd145504812-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b64fd145504812-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b64fd145504812-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b64fd145504812-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b64fd145504812-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_a_and_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b64fd145504812-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b64fd145504812-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面代码中，<code>main</code>函数内部调用了<code>add_a_and_b</code>函数。执行到这一行的时候，系统也会为<code>add_a_and_b</code>新建一个帧，用来储存它的内部变量。也就是说，此时同时存在两个帧：<code>main</code>和<code>add_a_and_b</code>。一般来说，调用栈有多少层，就有多少帧。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f50d85219ea91b9a57e41b0a96b41a0a.png\" alt=\"\"></p>\n<p>等到<code>add_a_and_b</code>运行结束，它的帧就会被回收，系统会回到函数<code>main</code>刚才中断执行的地方，继续往下执行。通过这种机制，就实现了函数的层层调用，并且每一层都能使用自己的本地变量。</p>\n<p>所有的帧都存放在 Stack，由于帧是一层层叠加的，所以 Stack 叫做栈。生成新的帧，叫做”入栈”，英文是 push；栈的回收叫做”出栈”，英文是 pop。Stack 的特点就是，最晚入栈的帧最早出栈（因为最内层的函数调用，最先结束运行），这就叫做”后进先出”的数据结构。每一次函数执行结束，就自动释放一个帧，所有函数执行结束，整个 Stack 就都释放了。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b09567a32cd68105cd5f48b12c096cea.jpg\" alt=\"\"></p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/2e07fe50fc379886e4928b060cd6a679.jpg\" alt=\"\"></p>\n<p>Stack 是由内存区域的结束地址开始，从高位（地址）向低位（地址）分配。比如，内存区域的结束地址是<code>0x8000</code>，第一帧假定是16字节，那么下一次分配的地址就会从<code>0x7FF0</code>开始；第二帧假定需要64字节，那么地址就会移动到<code>0x7FB0</code>。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/4ce2ece87cfc3354ada81668ceabc810.png\" alt=\"\"></p>\n<h2>七、CPU 指令</h2>\n<h3>7.1 一个实例</h3>\n<p>了解寄存器和内存模型以后，就可以来看汇编语言到底是什么了。下面是一个简单的程序<code>example.c</code>。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6503564300674\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nint add_a_and_b(int a, int b) {\r\n   return a + b;\r\n}\r\n\r\nint main() {\r\n   return add_a_and_b(2, 3);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6503564300674-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6503564300674-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6503564300674-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6503564300674-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6503564300674-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6503564300674-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6503564300674-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6503564300674-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6503564300674-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6503564300674-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6503564300674-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_a_and_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6503564300674-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6503564300674-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6503564300674-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6503564300674-6\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6503564300674-7\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_a_and_b</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6503564300674-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6503564300674-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>\n</p></blockquote>\n<p>gcc 将这个程序转成汇编语言。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6506491471426\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\n$ gcc -S example.c\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6506491471426-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6506491471426-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6506491471426-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6506491471426-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6506491471426-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6506491471426-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的命令执行以后，会生成一个文本文件<code>example.s</code>，里面就是汇编语言，包含了几十行指令。这么说吧，一个高级语言的简单操作，底层可能由几个，甚至几十个 CPU 指令构成。CPU 依次执行这些指令，完成这一步操作。</p>\n<p><code>example.s</code>经过简化以后，大概是下面的样子。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b650a147950130\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\n_add_a_and_b:\r\n   push   %ebx\r\n   mov    %eax, [%esp+8] \r\n   mov    %ebx, [%esp+12]\r\n   add    %eax, %ebx \r\n   pop    %ebx \r\n   ret  \r\n\r\n_main:\r\n   push   3\r\n   push   2\r\n   call   _add_a_and_b \r\n   add    %esp, 8\r\n   ret\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650a147950130-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650a147950130-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650a147950130-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650a147950130-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650a147950130-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650a147950130-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650a147950130-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650a147950130-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650a147950130-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650a147950130-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650a147950130-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650a147950130-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650a147950130-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650a147950130-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650a147950130-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650a147950130-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b650a147950130-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650a147950130-2\"><span class=\"crayon-v\">_add_a_and_b</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b650a147950130-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">%</span><span class=\"crayon-e\">ebx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650a147950130-4\"><span class=\"crayon-e\">   </span><span class=\"crayon-v\">mov</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">eax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b650a147950130-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">mov</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">ebx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650a147950130-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">add</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">eax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-e\">ebx </span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b650a147950130-7\"><span class=\"crayon-e\">   </span><span class=\"crayon-v\">pop</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-e\">ebx </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650a147950130-8\"><span class=\"crayon-e\">   </span><span class=\"crayon-e\">ret  </span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b650a147950130-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650a147950130-10\"><span class=\"crayon-v\">_main</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b650a147950130-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650a147950130-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b650a147950130-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">call   </span><span class=\"crayon-e\">_add_a_and_b </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650a147950130-14\"><span class=\"crayon-e\">   </span><span class=\"crayon-v\">add</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b650a147950130-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">ret</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650a147950130-16\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>\n</p></blockquote>\n<p>可以看到，原程序的两个函数<code>add_a_and_b</code>和<code>main</code>，对应两个标签<code>_add_a_and_b</code>和<code>_main</code>。每个标签里面是该函数所转成的 CPU 运行流程。</p>\n<p>每一行就是 CPU 执行的一次操作。它又分成两部分，就以其中一行为例。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b650d338662942\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npush   %ebx\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650d338662942-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b650d338662942-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b650d338662942-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b650d338662942-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b650d338662942-2\"><span class=\"crayon-v\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">ebx</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b650d338662942-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>这一行里面，<code>push</code>是 CPU 指令，<code>%ebx</code>是该指令要用到的运算子。一个 CPU 指令可以有零个到多个运算子。</p>\n<p>下面我就一行一行讲解这个汇编程序，建议读者最好把这个程序，在另一个窗口拷贝一份，省得阅读的时候再把页面滚动上来。</p>\n<h3>7.2 push 指令</h3>\n<p>根据约定，程序从<code>_main</code>标签开始执行，这时会在 Stack 上为<code>main</code>建立一个帧，并将 Stack 所指向的地址，写入 ESP 寄存器。后面如果有数据要写入<code>main</code>这个帧，就会写在 ESP 寄存器所保存的地址。</p>\n<p>然后，开始执行第一行代码。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6511710699140\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npush   3\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6511710699140-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6511710699140-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6511710699140-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6511710699140-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6511710699140-2\"><span class=\"crayon-i\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6511710699140-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p><code>push</code>指令用于将运算子放入 Stack，这里就是将<code>3</code>写入<code>main</code>这个帧。</p>\n<p>虽然看上去很简单，<code>push</code>指令其实有一个前置操作。它会先取出 ESP 寄存器里面的地址，将其减去4个字节，然后将新地址写入 ESP 寄存器。使用减法是因为 Stack 从高位向低位发展，4个字节则是因为<code>3</code>的类型是<code>int</code>，占用4个字节。得到新地址以后， 3 就会写入这个地址开始的四个字节。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6515490006635\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npush   2\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6515490006635-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6515490006635-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6515490006635-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6515490006635-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6515490006635-2\"><span class=\"crayon-i\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6515490006635-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>第二行也是一样，<code>push</code>指令将<code>2</code>写入<code>main</code>这个帧，位置紧贴着前面写入的<code>3</code>。这时，ESP 寄存器会再减去 4个字节（累计减去8）。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/deef5de3fddb527578e216f5bae7f88d.png\" alt=\"\"></p>\n<h3>7.3 call 指令</h3>\n<p>第三行的<code>call</code>指令用来调用函数。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6518897207492\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\ncall   _add_a_and_b\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6518897207492-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6518897207492-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6518897207492-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6518897207492-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6518897207492-2\"><span class=\"crayon-e\">call   </span><span class=\"crayon-v\">_add_a_and</span><span class=\"crayon-sy\">_</span>b</div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6518897207492-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码表示调用<code>add_a_and_b</code>函数。这时，程序就会去找<code>_add_a_and_b</code>标签，并为该函数建立一个新的帧。</p>\n<p>下面就开始执行<code>_add_a_and_b</code>的代码。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b651b010396460\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npush   %ebx\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b651b010396460-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b651b010396460-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b651b010396460-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b651b010396460-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b651b010396460-2\"><span class=\"crayon-v\">push</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">ebx</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b651b010396460-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>这一行表示将 EBX 寄存器里面的值，写入<code>_add_a_and_b</code>这个帧。这是因为后面要用到这个寄存器，就先把里面的值取出来，用完后再写回去。</p>\n<p>这时，<code>push</code>指令会再将 ESP 寄存器里面的地址减去4个字节（累计减去12）。</p>\n<h3>7.4 mov 指令</h3>\n<p><code>mov</code>指令用于将一个值写入某个寄存器。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b651f864283188\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nmov    %eax, [%esp+8] \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b651f864283188-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b651f864283188-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b651f864283188-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b651f864283188-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b651f864283188-2\"><span class=\"crayon-v\">mov</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">eax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b651f864283188-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>\n</p></blockquote>\n<p>这一行代码表示，先将 ESP 寄存器里面的地址加上8个字节，得到一个新的地址，然后按照这个地址在 Stack 取出数据。根据前面的步骤，可以推算出这里取出的是<code>2</code>，再将<code>2</code>写入 EAX 寄存器。</p>\n<p>下一行代码也是干同样的事情。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6522353546331\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nmov    %ebx, [%esp+12] \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6522353546331-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6522353546331-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6522353546331-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6522353546331-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6522353546331-2\"><span class=\"crayon-v\">mov</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">ebx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6522353546331-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码将 ESP 寄存器的值加12个字节，再按照这个地址在 Stack 取出数据，这次取出的是<code>3</code>，将其写入 EBX 寄存器。</p>\n<h3>7.5 add 指令</h3>\n<p><code>add</code>指令用于将两个运算子相加，并将结果写入第一个运算子。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6526505576729\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nadd    %eax, %ebx\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6526505576729-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6526505576729-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6526505576729-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6526505576729-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6526505576729-2\"><span class=\"crayon-v\">add</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">eax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">ebx</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6526505576729-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码将 EAX 寄存器的值（即2）加上 EBX 寄存器的值（即3），得到结果5，再将这个结果写入第一个运算子 EAX 寄存器。</p>\n<h3>7.6 pop 指令</h3>\n<p><code>pop</code>指令用于取出 Stack 最近一个写入的值（即最低位地址的值），并将这个值写入运算子指定的位置。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6529001047271\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\npop    %ebx\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6529001047271-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6529001047271-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6529001047271-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6529001047271-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6529001047271-2\"><span class=\"crayon-v\">pop</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">ebx</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6529001047271-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码表示，取出 Stack 最近写入的值（即 EBX 寄存器的原始值），再将这个值写回 EBX 寄存器（因为加法已经做完了，EBX 寄存器用不到了）。</p>\n<p>注意，<code>pop</code>指令还会将 ESP 寄存器里面的地址加4，即回收4个字节。</p>\n<h3>7.7 ret 指令</h3>\n<p><code>ret</code>指令用于终止当前函数的执行，将运行权交还给上层函数。也就是，当前函数的帧将被回收。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b652d374319697\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nret\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b652d374319697-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b652d374319697-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b652d374319697-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b652d374319697-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b652d374319697-2\"><span class=\"crayon-i\">ret</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b652d374319697-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>可以看到，该指令没有运算子。</p>\n<p>随着<code>add_a_and_b</code>函数终止执行，系统就回到刚才<code>main</code>函数中断的地方，继续往下执行。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6530542239908\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nadd    %esp, 8 \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6530542239908-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6530542239908-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6530542239908-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6530542239908-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6530542239908-2\"><span class=\"crayon-v\">add</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">esp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6530542239908-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>\n</p></blockquote>\n<p>上面的代码表示，将 ESP 寄存器里面的地址，手动加上8个字节，再写回 ESP 寄存器。这是因为 ESP 寄存器的是 Stack 的写入开始地址，前面的<code>pop</code>操作已经回收了4个字节，这里再回收8个字节，等于全部回收。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6975d1b6533790379708\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\r\nret\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6533790379708-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6975d1b6533790379708-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6975d1b6533790379708-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6975d1b6533790379708-1\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6975d1b6533790379708-2\"><span class=\"crayon-i\">ret</span></div><div class=\"crayon-line\" id=\"crayon-5a6975d1b6533790379708-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>\n</p></blockquote>\n<p>最后，<code>main</code>函数运行结束，<code>ret</code>指令退出程序执行。</p>\n<h2>八、参考链接</h2>\n<ul>\n<li><a href=\"http://kakaroto.homelinux.net/2017/11/introduction-to-reverse-engineering-and-assembly/\">Introduction to reverse engineering and Assembly</a>, by Youness Alaoui</li>\n<li><a href=\"http://www.cs.virginia.edu/~evans/cs216/guides/x86.html\">x86 Assembly Guide</a>, by University of Virginia Computer Science</li>\n</ul>\n<p><!-- /div --></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113509\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113509votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113509\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113509/", "comment_nums": 0, "create_date": "2018/01/21", "tags": "IT技术,汇编", "url_object_id": "18c4d836f5ced027a8bc7f3f561f8a48", "front_image_path": "full/517254353a9a1cc83501e1159bfc92f230e6e50c.jpg"}
{"fav_nums": 2, "praise_nums": "1", "title": "当你在 Linux 上启动一个进程时会发生什么？", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/9aeba2223d66a3c6692233694383abce.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://jvns.ca/blog/2016/10/04/exec-will-eat-your-brain/\">Julia Evans</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9256-1.html\">Linux中国/jessie-pang</a>   </div><p>本文是关于 fork 和 exec 是如何在 Unix 上工作的。你或许已经知道，也有人还不知道。几年前当我了解到这些时，我惊叹不已。</p>\n<p>我们要做的是启动一个进程。我们已经在博客上讨论了很多关于<strong>系统调用</strong>的问题，每当你启动一个进程或者打开一个文件，这都是一个系统调用。所以你可能会认为有这样的系统调用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6935beb427f604807635\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstart_process([\"ls\", \"-l\", \"my_cool_directory\"])\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6935beb427f604807635-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb427f604807635-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6935beb427f604807635-1\"><span class=\"crayon-e\">start_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"ls\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-l\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"my_cool_directory\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb427f604807635-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这是一个合理的想法，显然这是它在 DOS 或 Windows 中的工作原理。我想说的是，这并不是 Linux 上的工作原理。但是，我查阅了文档，确实有一个 <a href=\"http://man7.org/linux/man-pages/man3/posix_spawn.3.html\">posix_spawn</a> 的系统调用基本上是这样做的，不过这不在本文的讨论范围内。</p>\n<h3 id=\"toc_1\">fork 和 exec</h3>\n<p>Linux 上的 <code>posix_spawn</code> 是通过两个系统调用实现的，分别是 <code>fork</code> 和 <code>exec</code>（实际上是 <code>execve</code>），这些都是人们常常使用的。尽管在 OS X 上，人们使用 <code>posix_spawn</code>，而 <code>fork</code> 和 <code>exec</code> 是不提倡的，但我们将讨论的是 Linux。</p>\n<p>Linux 中的每个进程都存在于“进程树”中。你可以通过运行 <code>pstree</code> 命令查看进程树。树的根是 <code>init</code>，进程号是 1。每个进程（<code>init</code> 除外）都有一个父进程，一个进程都可以有很多子进程。</p>\n<p>所以，假设我要启动一个名为 <code>ls</code> 的进程来列出一个目录。我是不是只要发起一个进程 <code>ls</code> 就好了呢？不是的。</p>\n<p>我要做的是，创建一个子进程，这个子进程是我（<code>me</code>）本身的一个克隆，然后这个子进程的“脑子”被吃掉了，变成 <code>ls</code>。</p>\n<p>开始是这样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6935beb4289723238215\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6935beb4289723238215-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb4289723238215-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb4289723238215-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6935beb4289723238215-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb4289723238215-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb4289723238215-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后运行 <code>fork()</code>，生成一个子进程，是我（<code>me</code>）自己的一份克隆：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6935beb428e649913966\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- clone of me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6935beb428e649913966-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb428e649913966-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb428e649913966-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb428e649913966-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6935beb428e649913966-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb428e649913966-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb428e649913966-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb428e649913966-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后我让该子进程运行 <code>exec(\"ls\")</code>，变成这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6935beb4291279796870\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- ls\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6935beb4291279796870-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb4291279796870-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb4291279796870-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb4291279796870-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6935beb4291279796870-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb4291279796870-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb4291279796870-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb4291279796870-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>当 ls 命令结束后，我几乎又变回了我自己：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6935beb4294122400585\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- ls (zombie)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6935beb4294122400585-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb4294122400585-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb4294122400585-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb4294122400585-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6935beb4294122400585-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb4294122400585-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb4294122400585-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">zombie</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb4294122400585-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在这时 <code>ls</code> 其实是一个僵尸进程。这意味着它已经死了，但它还在等我，以防我需要检查它的返回值（使用 <code>wait</code> 系统调用）。一旦我获得了它的返回值，我将再次恢复独自一人的状态。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6935beb4298881486655\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6935beb4298881486655-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb4298881486655-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb4298881486655-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6935beb4298881486655-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb4298881486655-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb4298881486655-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">fork 和 exec 的代码实现</h3>\n<p>如果你要编写一个 shell，这是你必须做的一个练习（这是一个非常有趣和有启发性的项目。Kamal 在 Github 上有一个很棒的研讨会：<a href=\"https://github.com/kamalmarhubi/shell-workshop\">https://github.com/kamalmarhubi/shell-workshop</a>）。</p>\n<p>事实证明，有了 C 或 Python 的技能，你可以在几个小时内编写一个非常简单的 shell，像 bash 一样。（至少如果你旁边能有个人多少懂一点，如果没有的话用时会久一点。）我已经完成啦，真的很棒。</p>\n<p>这就是 <code>fork</code> 和 <code>exec</code> 在程序中的实现。我写了一段 C 的伪代码。请记住，<a href=\"https://rachelbythebay.com/w/2014/08/19/fork/\">fork 也可能会失败哦。</a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6935beb429b768588738\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint pid = fork();\r\n// 我要分身啦\r\n// “我”是谁呢？可能是子进程也可能是父进程\r\nif (pid == 0) {\r\n    // 我现在是子进程\r\n    // “ls” 吃掉了我脑子，然后变成一个完全不一样的进程\r\n    exec([\"ls\"])\r\n} else if (pid == -1) {\r\n    // 天啊，fork 失败了，简直是灾难！\r\n} else {\r\n    // 我是父进程耶\r\n    // 继续做一个酷酷的美男子吧\r\n    // 需要的话，我可以等待子进程结束\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6935beb429b768588738-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb429b768588738-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb429b768588738-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb429b768588738-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb429b768588738-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb429b768588738-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb429b768588738-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb429b768588738-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb429b768588738-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb429b768588738-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb429b768588738-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb429b768588738-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb429b768588738-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6935beb429b768588738-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6935beb429b768588738-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6935beb429b768588738-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb429b768588738-2\"><span class=\"crayon-c\">// 我要分身啦</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb429b768588738-3\"><span class=\"crayon-c\">// “我”是谁呢？可能是子进程也可能是父进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb429b768588738-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb429b768588738-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我现在是子进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb429b768588738-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// “ls” 吃掉了我脑子，然后变成一个完全不一样的进程</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb429b768588738-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"ls\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb429b768588738-8\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb429b768588738-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 天啊，fork 失败了，简直是灾难！</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb429b768588738-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb429b768588738-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我是父进程耶</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb429b768588738-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 继续做一个酷酷的美男子吧</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb429b768588738-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 需要的话，我可以等待子进程结束</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6935beb429b768588738-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6935beb429b768588738-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">上文提到的“脑子被吃掉”是什么意思呢？</h3>\n<p>进程有很多属性：</p>\n<ul>\n<li>打开的文件（包括打开的网络连接）</li>\n<li>环境变量</li>\n<li>信号处理程序（在程序上运行 Ctrl + C 时会发生什么？）</li>\n<li>内存（你的“地址空间”）</li>\n<li>寄存器</li>\n<li>可执行文件（<code>/proc/$pid/exe</code>）</li>\n<li>cgroups 和命名空间（与 Linux 容器相关）</li>\n<li>当前的工作目录</li>\n<li>运行程序的用户</li>\n<li>其他我还没想到的</li>\n</ul>\n<p>当你运行 <code>execve</code> 并让另一个程序吃掉你的脑子的时候，实际上几乎所有东西都是相同的！ 你们有相同的环境变量、信号处理程序和打开的文件等等。</p>\n<p>唯一改变的是，内存、寄存器以及正在运行的程序，这可是件大事。</p>\n<h3 id=\"toc_4\">为何 fork 并非那么耗费资源（写入时复制）</h3>\n<p>你可能会问：“如果我有一个使用了 2GB 内存的进程，这是否意味着每次我启动一个子进程，所有 2 GB 的内存都要被复制一次？这听起来要耗费很多资源！”</p>\n<p>事实上，Linux 为 <code>fork()</code> 调用实现了写时复制copy on write，对于新进程的 2GB 内存来说，就像是“看看旧的进程就好了，是一样的！”。然后，当如果任一进程试图写入内存，此时系统才真正地复制一个内存的副本给该进程。如果两个进程的内存是相同的，就不需要复制了。</p>\n<h3 id=\"toc_5\">为什么你需要知道这么多</h3>\n<p>你可能会说，好吧，这些细节听起来很厉害，但为什么这么重要？关于信号处理程序或环境变量的细节会被继承吗？这对我的日常编程有什么实际影响呢？</p>\n<p>有可能哦！比如说，在 Kamal 的博客上有一个很有意思的 <a href=\"http://kamalmarhubi.com/blog/2015/06/30/my-favourite-bug-so-far-at-the-recurse-center/\">bug</a>。它讨论了 Python 如何使信号处理程序忽略了 <code>SIGPIPE</code>。也就是说，如果你从 Python 里运行一个程序，默认情况下它会忽略 <code>SIGPIPE</code>！这意味着，程序从 Python 脚本和从 shell 启动的表现会<strong>有所不同</strong>。在这种情况下，它会造成一个奇怪的问题。</p>\n<p>所以，你的程序的环境（环境变量、信号处理程序等）可能很重要，都是从父进程继承来的。知道这些，在调试时是很有用的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113506\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113506votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113506\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113506/", "comment_nums": 0, "create_date": "2018/01/20", "tags": "IT技术,Linux", "url_object_id": "163e3c6dadc221edbe975926bad55ee5", "front_image_path": "full/a0c1bbf258eb5064ea3d6b896485a481525b7f95.jpg"}
{"fav_nums": 1, "praise_nums": "1", "title": "用系统日志了解你的 Linux 系统", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/812cccb1d3c1ebac3ef67409d53aaa3d.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.suse.com/c/system-logs-understand-linux-system/\">SUSE</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9150-1.html\">Linux中国/DarkSun</a>   </div><p>本文摘自为 Linux 小白（或者非资深桌面用户）传授技巧的系列文章。该系列文章旨在为 LinuxMagazine 发布的第 30 期特别版 “<a href=\"http://www.linux-magazine.com/Resources/Special-Editions/30-Getting-Started-with-Linux\">Linux 入门</a>” （基于 <a href=\"https://en.opensuse.org/Portal:42.3\">openSUSE Leap</a> ）提供补充说明。</p>\n<p>本文作者是 Romeo S.，她是一名基于 PDX 的企业 Linux 专家，专注于为创新企业提供富有伸缩性的解决方案。</p>\n<p>Linux 系统日志非常重要。后台运行的程序（通常被称为守护进程或者服务进程）处理了你 Linux 系统中的大部分任务。当这些守护进程工作时，它们将任务的详细信息记录进日志文件中，作为它们做过什么的“历史”信息。这些守护进程的工作内容涵盖从使用原子钟同步时钟到管理网络连接。所有这些都被记录进日志文件，这样当有错误发生时，你可以通过查阅特定的日志文件来看出发生了什么。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/812cccb1d3c1ebac3ef67409d53aaa3d.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>Photo by Markus Spiske on Unsplash</em></p>\n<p>在你的 Linux 计算机上有很多不同的日志。历史上，它们一般以纯文本的格式存储到 <code>/var/log</code> 目录中。现在依然有很多日志这样做，你可以很方便的使用 <code>less</code> 来查看它们。</p>\n<p>在新装的 openSUSE Leap 42.3 以及大多数现代操作系统上，重要的日志由 <code>systemd</code> 初始化系统存储。 <code>systemd</code>这套系统负责启动守护进程，并在系统启动时让计算机做好被使用的准备。由 <code>systemd</code> 记录的日志以二进制格式存储，这使得它们消耗的空间更小，更容易被浏览，也更容易被导出成其他各种格式，不过坏处就是你必须使用特定的工具才能查看。好在这个工具已经预安装在你的系统上了：它的名字叫 <code>journalctl</code>，而且默认情况下，它会将每个守护进程的所有日志都记录到一个地方。</p>\n<p>只需要运行 <code>journalctl</code> 命令就能查看你的 <code>systemd</code> 日志了。它会用 <code>less</code> 分页器显示各种日志。为了让你有个直观的感受, 下面是 <code>journalctl</code> 中摘录的一条日志记录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1c9aa9f278561334\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nJul 06 11:53:47 aaathats3as pulseaudio[2216]: [pulseaudio] alsa-util.c: Disabling timer-based scheduling because running inside a VM.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1c9aa9f278561334-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1c9aa9f278561334-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1c9aa9f278561334-1\"><span class=\"crayon-i\">Jul</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">53</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">47</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aaathats3as </span><span class=\"crayon-v\">pulseaudio</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2216</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">pulseaudio</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Disabling </span><span class=\"crayon-v\">timer</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">based </span><span class=\"crayon-e\">scheduling </span><span class=\"crayon-e\">because </span><span class=\"crayon-e\">running </span><span class=\"crayon-i\">inside</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">VM</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1c9aa9f278561334-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这条独立的日志记录以此包含了记录的日期和时间、计算机名、记录日志的进程名、记录日志的进程 PID，以及日志内容本身。</p>\n<p>若系统中某个程序运行出问题了，则可以查看日志文件并搜索（使用 <code>/</code> 加上要搜索的关键字）程序名称。有可能导致该程序出问题的错误会记录到系统日志中。 有时，错误信息会足够详细到让你能够修复该问题。其他时候，你需要在 Web 上搜索解决方案。 Google 就很适合来搜索奇怪的 Linux 问题。不过搜索时请注意你只输入了日志的实际内容，行首的那些信息（日期、主机名、进程 ID) 对搜索来说是无意义的，会干扰搜索结果。</p>\n<p>解决方法一般在搜索结果的前几个连接中就会有了。当然，你不能只是无脑得运行从互联网上找到的那些命令：请一定先搞清楚你要做的事情是什么，它的效果会是什么。据说，搜索系统日志中的特定条目要比直接描述该故障通用关键字要有用的多。因为程序出错有很多原因，而且同样的故障表现也可能由多种问题引发的。</p>\n<p>比如，系统无法发声的原因有很多，可能是播放器没有插好，也可能是声音系统出故障了，还可能是缺少合适的驱动程序。如果你只是泛泛的描述故障表现，你会找到很多无关的解决方法，而你也会浪费大量的时间。而专门搜索日志文件中的实际内容，你也许会查询出其它人也有相同日志内容的结果。</p>\n<p>你可以对比一下图 1 和图 2。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/d3eed31f44df624aa333855bb658e12b.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图 1 搜索系统的故障表现只会显示泛泛的，不精确的结果。这种搜索通常没什么用。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4610a872c4bf145821d14f805ee95ace.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图 2 搜索特定的日志行会显示出精确的，有用的结果。这种搜索通常很有用。</p>\n<p>也有一些系统不用 <code>journalctl</code> 来记录日志。在桌面系统中最常见的这类日志包括用于记录 openSUSE 包管理器的行为的 <code>/var/log/zypper.log</code>； 记录系统启动时消息的 <code>/var/log/boot.log</code> ，开机时这类消息往往滚动的特别快，根本看不过来；<code>/var/log/ntp</code> 用来记录 Network Time Protocol （NTP）守护进程同步时间时发生的错误。 另一个存放硬件故障信息的地方是 “Kernel Ring Buffer”（内核环状缓冲区），你可以输入 <code>demesg -H</code> 命令来查看（这条命令也会调用 <code>less</code> 分页器来查看）。“Kernel Ring Buffer” 存储在内存中，因此会在重启电脑后丢失。不过它包含了 Linux 内核中的重要事件，比如新增了硬件、加载了模块，以及奇怪的网络错误.</p>\n<p>希望你已经准备好深入了解你的 Linux 系统了! 祝你玩的开心!</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113363\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113363votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113363\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113363/", "comment_nums": 0, "create_date": "2017/12/22", "tags": "IT技术,Linux", "url_object_id": "cb06a4d36e47328f43948f73aae5d512", "front_image_path": "full/2561f1d80bb5f24ecd600a61944033b80834f163.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "Linux 的 fmt 命令用法与案例", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/linux-fmt-command/%20\">Himanshu Arora </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9240-1.html\">lujun9972</a>   </div><div id=\"article_content\">\n<div>有时你会发现需要格式化某个文本文件中的内容。比如，该文本文件每行一个单词，而任务是把所有的单词都放在同一行。当然，你可以手工来做，但没人喜欢手工做这么耗时的工作。而且，这只是一个例子 – 事实上的任务可能千奇百怪。</div>\n<p>好在，有一个命令可以满足至少一部分的文本格式化的需求。这个工具就是 <code>fmt</code>。本教程将会讨论 <code>fmt</code> 的基本用法以及它提供的一些主要功能。文中所有的命令和指令都在 Ubuntu 16.04LTS 下经过了测试。</p>\n<h3 id=\"toc_1\">Linux fmt 命令</h3>\n<p><code>fmt</code> 命令是一个简单的文本格式化工具，任何人都能在命令行下运行它。它的基本语法为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696a01ddb34522645084\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt [-WIDTH] [OPTION]... [FILE]...\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696a01ddb34522645084-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696a01ddb34522645084-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696a01ddb34522645084-1\"><span class=\"crayon-i\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">WIDTH</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FILE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696a01ddb34522645084-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>它的 man 页是这么说的：</p>\n<blockquote><p>重新格式化文件中的每一个段落，将结果写到标准输出。选项 <code>-WIDTH</code> 是 <code>--width=DIGITS</code> 形式的缩写。</p></blockquote>\n<p>下面这些问答方式的例子应该能让你对 <code>fmt</code> 的用法有很好的了解。</p>\n<h3 id=\"toc_2\">Q1、如何使用 fmt 来将文本内容格式成同一行？</h3>\n<p>使用 <code>fmt</code> 命令的基本形式（省略任何选项）就能做到这一点。你只需要将文件名作为参数传递给它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696a01ddb40129641473\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696a01ddb40129641473-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696a01ddb40129641473-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696a01ddb40129641473-1\"><span class=\"crayon-i\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696a01ddb40129641473-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>下面截屏是命令的执行结果：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-basic-usage.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/435b2ea3a3a986139f36c1d3ba19f5db.png\" alt=\"format contents of file in single line\"></a></p>\n<p>你可以看到文件中多行内容都被格式化成同一行了。请注意，这并不会修改原文件（file1）。</p>\n<h3 id=\"toc_3\">Q2、如何修改最大行宽？</h3>\n<p>默认情况下，<code>fmt</code> 命令产生的输出中的最大行宽为 75。然而，如果你想的话，可以用 <code>-w</code> 选项进行修改，它接受一个表示新行宽的数字作为参数值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696a01ddb44583637196\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -w [n] [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696a01ddb44583637196-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696a01ddb44583637196-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696a01ddb44583637196-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696a01ddb44583637196-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>下面这个例子把行宽削减到了 20：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-w-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d104ae214b626206e10c813ff6da7dd2.png\" alt=\"change maximum line width\"></a></p>\n<h3 id=\"toc_4\">Q3、如何让 fmt 突出显示第一行？</h3>\n<p>这是通过让第一行的缩进与众不同来实现的，你可以使用 <code>-t</code> 选项来实现。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696a01ddb48292321289\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -t [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696a01ddb48292321289-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696a01ddb48292321289-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696a01ddb48292321289-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696a01ddb48292321289-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-t-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/20eefe77b7ac2caa4e2d1868d5ee9548.png\" alt=\"make fmt highlight the first line\"></a></p>\n<h3 id=\"toc_5\">Q4、如何使用 fmt 拆分长行？</h3>\n<p>fmt 命令也能用来对长行进行拆分，你可以使用 <code>-s</code> 选项来应用该功能。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696a01ddb4c007630811\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -s [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696a01ddb4c007630811-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696a01ddb4c007630811-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696a01ddb4c007630811-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696a01ddb4c007630811-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>下面是一个例子：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-s-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b5087c0f6ec116a53f90d84902fe07cd.png\" alt=\"make fmt split long lines\"></a></p>\n<h3 id=\"toc_6\">Q5、如何在单词与单词之间，句子之间用空格分开？</h3>\n<p>fmt 命令提供了一个 <code>-u</code> 选项，这会在单词与单词之间用单个空格分开，句子之间用两个空格分开。你可以这样用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a696a01ddb50676706689\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -u [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a696a01ddb50676706689-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a696a01ddb50676706689-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a696a01ddb50676706689-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a696a01ddb50676706689-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>注意，在我们的案例中，这个功能是默认开启的。</p>\n<h3 id=\"toc_7\">总结</h3>\n<p>没错，<code>fmt</code> 提供的功能不多，但不代表它的应用就不广泛。因为你永远不知道什么时候会用到它。在本教程中，我们已经讲解了 <code>fmt</code> 提供的主要选项。若想了解更多细节，请查看该工具的 <a href=\"https://linux.die.net/man/1/fmt\">man 页</a>。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113479\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113479votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113479\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113479/", "comment_nums": 0, "create_date": "2018/01/15", "tags": "IT技术,fmt,Linux", "url_object_id": "4f058a89ae4912bf130d1b37274a904d", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"fav_nums": 6, "praise_nums": "2", "title": "区块链入门教程", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/40f9a81cba62930d7bdcff68162b27c0.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html\">阮一峰</a>   </div><div id=\"main-content\">\n<p><!-- div class=\"asset-body\" -->区块链（blockchain）是眼下的大热门，新闻媒体大量报道，宣称它将创造未来。</p>\n<p><!-- /div --> <!-- div id=\"more\" class=\"asset-more\" --></p>\n<p>可是，简单易懂的入门文章却很少。区块链到底是什么，有何特别之处，很少有解释。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/40f9a81cba62930d7bdcff68162b27c0.jpg\" alt=\"\"></p>\n<p>下面，我就来尝试，写一篇最好懂的区块链教程。毕竟它也不是很难的东西，核心概念非常简单，几句话就能说清楚。我希望读完本文，你不仅可以理解区块链，还会明白什么是挖矿、为什么挖矿越来越难等问题。</p>\n<p>需要说明的是，我并非这方面的专家。虽然很早就关注，但是仔细地了解区块链，还是从今年初开始。文中的错误和不准确的地方，欢迎大家指正。</p>\n<h2>一、区块链的本质</h2>\n<p>区块链是什么？一句话，它是一种特殊的分布式数据库。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/2e489c6146b763fb4b6e39aed2409203.png\" alt=\"\"></p>\n<p>首先，区块链的主要作用是储存信息。任何需要保存的信息，都可以写入区块链，也可以从里面读取，所以它是数据库。</p>\n<p>其次，任何人都可以架设服务器，加入区块链网络，成为一个节点。区块链的世界里面，没有中心节点，每个节点都是平等的，都保存着整个数据库。你可以向任何一个节点，写入/读取数据，因为所有节点最后都会同步，保证区块链一致。</p>\n<h2>二、区块链的最大特点</h2>\n<p>分布式数据库并非新发明，市场上早有此类产品。但是，区块链有一个革命性特点。</p>\n<p><strong>区块链没有管理员，它是彻底无中心的。</strong>其他的数据库都有管理员，但是区块链没有。如果有人想对区块链添加审核，也实现不了，因为它的设计目标就是防止出现居于中心地位的管理当局。</p>\n<p>正是因为无法管理，区块链才能做到无法被控制。否则一旦大公司大集团控制了管理权，他们就会控制整个平台，其他使用者就都必须听命于他们了。</p>\n<p>但是，没有了管理员，人人都可以往里面写入数据，怎么才能保证数据是可信的呢？被坏人改了怎么办？请接着往下读，这就是区块链奇妙的地方。</p>\n<h2>三、区块</h2>\n<p>区块链由一个个区块（block）组成。区块很像数据库的记录，每次写入数据，就是创建一个区块。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/58c42848736a08f501c8e777ca2500c5.png\" alt=\"\"></p>\n<p>每个区块包含两个部分。</p>\n<blockquote>\n<ul>\n<li>区块头（Head）：记录当前区块的元信息</li>\n<li>区块体（Body）：实际数据</li>\n</ul>\n</blockquote>\n<p>区块头包含了当前区块的多项元信息。</p>\n<blockquote>\n<ul>\n<li>生成时间</li>\n<li>实际数据（即区块体）的 Hash</li>\n<li>上一个区块的 Hash</li>\n<li>…</li>\n</ul>\n</blockquote>\n<p>这里，你需要理解什么叫 <a href=\"https://baike.baidu.com/item/%E5%93%88%E5%B8%8C%E5%80%BC\">Hash</a>，这是理解区块链必需的。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/090eb817d652e840b3ce66ff3476dab5.png\" alt=\"\"></p>\n<p>所谓 Hash 就是计算机可以对任意内容，计算出一个长度相同的特征值。区块链的 Hash 长度是256位，这就是说，不管原始内容是什么，最后都会计算出一个256位的二进制数字。而且可以保证，只要原始内容不同，对应的 Hash 一定是不同的。</p>\n<p>举例来说，字符串<code>123</code>的 Hash 是<code>a8fdc205a9f19cc1c7507a60c4f01b13d11d7fd0</code>（十六进制），转成二进制就是256位，而且只有<code>123</code>能得到这个 Hash。</p>\n<p>因此，就有两个重要的推论。</p>\n<blockquote>\n<ul>\n<li>推论1：每个区块的 Hash 都是不一样的，可以通过 Hash 标识区块。</li>\n<li>推论2：如果区块的内容变了，它的 Hash 一定会改变。</li>\n</ul>\n</blockquote>\n<h2>四、 Hash 的不可修改性</h2>\n<p>区块与 Hash 是一一对应的，每个区块的 Hash 都是针对”区块头”（Head）计算的。</p>\n<blockquote><p>Hash = SHA256(区块头)</p></blockquote>\n<p>上面就是区块 Hash 的计算公式，Hash 由区块头唯一决定，<code>SHA256</code>是区块链的 Hash 算法。</p>\n<p>前面说过，区块头包含很多内容，其中有当前区块体的 Hash（注意是”区块体”的 Hash，而不是整个区块），还有上一个区块的 Hash。这意味着，如果当前区块的内容变了，或者上一个区块的 Hash 变了，一定会引起当前区块的 Hash 改变。</p>\n<p>这一点对区块链有重大意义。如果有人修改了一个区块，该区块的 Hash 就变了。为了让后面的区块还能连到它，该人必须同时修改后面所有的区块，否则被改掉的区块就脱离区块链了。由于后面要提到的原因，Hash 的计算很耗时，同时修改多个区块几乎不可能发生，除非有人掌握了全网51%以上的计算能力。</p>\n<p>正是通过这种联动机制，区块链保证了自身的可靠性，数据一旦写入，就无法被篡改。这就像历史一样，发生了就是发生了，从此再无法改变。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/902f65004f561616ce8f1bc84975df65.png\" alt=\"\"></p>\n<p>每个区块都连着上一个区块，这也是”区块链”这个名字的由来。</p>\n<h2>五、采矿</h2>\n<p>由于必须保证节点之间的同步，所以新区块的添加速度不能太快。试想一下，你刚刚同步了一个区块，准备基于它生成下一个区块，但这时别的节点又有新区块生成，你不得不放弃做了一半的计算，再次去同步。因为每个区块的后面，只能跟着一个区块，你永远只能在最新区块的后面，生成下一个区块。所以，你别无选择，一听到信号，就必须立刻同步。</p>\n<p>所以，区块链的发明者中本聪（这是假名，真实身份至今未知）故意让添加新区块，变得很困难。他的设计是，平均每10分钟，全网才能生成一个新区块，一小时也就六个。</p>\n<p>这种产出速度不是通过命令达成的，而是故意设置了海量的计算。也就是说，只有通过极其大量的计算，才能得到当前区块的有效 Hash，从而把新区块添加到区块链。由于计算量太大，所以快不起来。</p>\n<p>这个过程就叫做采矿（mining），因为计算有效 Hash 的难度，好比在全世界的沙子里面，找到一粒符合条件的沙子。计算 Hash 的机器就叫做矿机，操作矿机的人就叫做矿工。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/ed0a5783ff70c62bdbab1add89a4c479.jpg\" alt=\"\"></p>\n<h2>六、难度系数</h2>\n<p>读到这里，你可能会有一个疑问，人们都说采矿很难，可是采矿不就是用计算机算出一个 Hash 吗，这正是计算机的强项啊，怎么会变得很难，迟迟算不出来呢？</p>\n<p>原来不是任意一个 Hash 都可以，只有满足条件的 Hash 才会被区块链接受。这个条件特别苛刻，使得绝大部分 Hash 都不满足要求，必须重算。</p>\n<p>原来，区块头包含一个<a href=\"http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html\">难度系数</a>（difficulty），这个值决定了计算 Hash 的难度。举例来说，<a href=\"https://blockexplorer.com/block/000000000003ba27aa200b1cecaad478d2b00432346c3f1f3986da1afd33e506\">第100000个区块</a>的难度系数是 14484.16236122。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b3851ad9686bdd85d7c5352e206809c6.png\" alt=\"\"></p>\n<p>区块链协议规定，使用一个常量除以难度系数，可以得到目标值（target）。显然，难度系数越大，目标值就越小。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/a847efd8e55e217d2cc3c25740826f4c.png\" alt=\"\"></p>\n<p>Hash 的有效性跟目标值密切相关，只有小于目标值的 Hash 才是有效的，否则 Hash 无效，必须重算。由于目标值非常小，Hash 小于该值的机会极其渺茫，可能计算10亿次，才算中一次。这就是采矿如此之慢的根本原因。</p>\n<p>区块头里面还有一个 Nonce 值，记录了 Hash 重算的次数。第 100000 个区块的 Nonce 值是<code>274148111</code>，即计算了 2.74 亿次，才得到了一个有效的 Hash，该区块才能加入区块链。</p>\n<h2>七、难度系数的动态调节</h2>\n<p>就算采矿很难，但也没法保证，正好十分钟产出一个区块，有时一分钟就算出来了，有时几个小时可能也没结果。总体来看，随着硬件设备的提升，以及矿机的数量增长，计算速度一定会越来越快。</p>\n<p>为了将产出速率恒定在十分钟，中本聪还设计了难度系数的动态调节机制。他规定，难度系数每两周（2016个区块）调整一次。如果这两周里面，区块的平均生成速度是9分钟，就意味着比法定速度快了10%，因此难度系数就要调高10%；如果平均生成速度是11分钟，就意味着比法定速度慢了10%，因此难度系数就要调低10%。</p>\n<p>难度系数越调越高（目标值越来越小），导致了采矿越来越难。</p>\n<h2>八、区块链的分叉</h2>\n<p>即使区块链是可靠的，现在还有一个问题没有解决：如果两个人同时向区块链写入数据，也就是说，同时有两个区块加入，因为它们都连着前一个区块，就形成了分叉。这时应该采纳哪一个区块呢？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/3ab5f5cc8511aaa711e0349eabfd198d.png\" alt=\"\"></p>\n<p>现在的规则是，新节点总是采用最长的那条区块链。如果区块链有分叉，将看哪个分支在分叉点后面，先达到6个新区块（称为”六次确认”）。按照10分钟一个区块计算，一小时就可以确认。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/e29e5a6fa98d243b940a3adf89d324d0.png\" alt=\"\"></p>\n<p>由于新区块的生成速度由计算能力决定，所以这条规则就是说，拥有大多数计算能力的那条分支，就是正宗的比特链。</p>\n<h2>九、总结</h2>\n<p>区块链作为无人管理的分布式数据库，从2009年开始已经运行了8年，没有出现大的问题。这证明它是可行的。</p>\n<p>但是，为了保证数据的可靠性，区块链也有自己的代价。一是效率，数据写入区块链，最少要等待十分钟，所有节点都同步数据，则需要更多的时间；二是能耗，区块的生成需要矿工进行无数无意义的计算，这是非常耗费能源的。</p>\n<p>因此，区块链的适用场景，其实非常有限。</p>\n<blockquote>\n<ol start=\"1\">\n<li>不存在所有成员都信任的管理当局</li>\n<li>写入的数据不要求实时使用</li>\n<li>挖矿的收益能够弥补本身的成本</li>\n</ol>\n</blockquote>\n<p>如果无法满足上述的条件，那么传统的数据库是更好的解决方案。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/0f7857e7b2a1d2e4ba4799f4a85b6898.png\" alt=\"\"></p>\n<p>目前，区块链最大的应用场景（可能也是唯一的应用场景），就是以比特币为代表的加密货币。下一篇文章，我将会介绍<a href=\"http://blog.jobbole.com/113429/\" target=\"_blank\">比特币的入门知识</a>。</p>\n<h2>十、参考链接</h2>\n<ul>\n<li><a href=\"https://medium.freecodecamp.org/how-does-blockchain-really-work-i-built-an-app-to-show-you-6b70cd4caf7d\">How does blockchain really work?</a>, by Sean Han</li>\n<li><a href=\"http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html\">Bitcoin mining the hard way: the algorithms, protocols, and bytes</a>, by Ken Shirriff</li>\n</ul>\n<p>（完）</p>\n<p><!-- /div --></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113428\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113428votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113428\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113428/", "comment_nums": 3, "create_date": "2018/01/04", "tags": "IT技术,区块链", "url_object_id": "7585aea4a928848a1b6aff7fffcd33d9", "front_image_path": "full/6f8e539ebd60294ea83d44f2957418887cfa6a70.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "说了这么久的“Linux 桌面年”，为什么还没来？", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/08/2e327580770370cc02c696e176d4cb77.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://oschina.net/news/91721/year-of-the-linux-desktop\">开源中国</a>   </div><p>有许多关于Linux经久不衰的话题，“Linux桌面年”就是其中之一。</p>\n<p>你一定会听过这样的预言：“这将是Linux走向桌面的一年。”事实上，这样的预言我们不止听过一次，2012 年，2008 年，甚至是更早是时间，几乎每一年我们都听到过这样的“预言”。那么，说了这么久的“ Linux 桌面年”，它到底来了吗？</p>\n<p>2017 年的确发生了一些事件，让 Linux 看起来以往有所不同。</p>\n<p><strong>11 月入围世界 Top 500 的超级计算机都在运行 Linux</strong></p>\n<p>在今年 11 月公布的世界超级计算机排行榜中，Top 500 的计算机都在运行 Linux。Linux 首次被 Top 500 的超级计算机使用是在 1998 年，当时的超算还是由 Unix 操作系统统治。然而从 2003 年起，超算开始被 Linux 系统支配，至 2004 年，Linux 已经在超算中占据主导地位。</p>\n<p>当时专家将 Linux 入榜的主要原因总结如下：</p>\n<ul>\n<li>世界上最顶级的超算都是作为特定研究机器构建，因此每台机器都是一个独立项目，具有独特的特性和优化要求。</li>\n<li>为节省成本，没有人愿意为一台计算开发一个定制的操作系统。</li>\n<li>而使用 Linux，研究团队可以按照设计需求，轻松对 Linux 的源码进行修改和优化，因此可以节省大量成本。</li>\n</ul>\n<p><strong>2017 Linux Kernel 开发报告称：Linux 在统治着计算机世界</strong></p>\n<p>就在不久前，知名外媒ZDNet 公布了一份 Linux 基金会的调查报告，报告显示，Linux 运行着 90% 的公共云工作量，世界上 82% 的智能手机，62% 的嵌入式市场，以及几乎占领了 99% 的超级计算机市场。所有的这些都基于 Linux 内核。</p>\n<p>自2005年以来，Linux Kernel 采用 Git 版本控制系统，来自 1,400 多家公司的 15,637 名开发者为 Linux 内核做出了贡献。去年以来，来自 500 多家公司的 4300 多名开发者对内核做出了贡献。其中 1,670 个是首次贡献，约占贡献者的三分之一。</p>\n<p>去年，Linux 内核的十大企业贡献者包括 Intel, Red Hat, Linaro, IBM, Samsung, SUSE, Google, AMD, Renesas 和 Mellanox。微软也仍在贡献，但不再是最大的贡献者。</p>\n<p>Linux 内核开发者和 LWN.net 的编辑 Jonathan Corbet 以及稳定的 Linux 内核维护者 Greg Kroah-Hartman 说到：</p>\n<p>Linux 内核是迄今为止最大和最成功的开源项目之一，巨大的变革率和个人贡献者人数显示，它拥有一个充满活力和活跃的社区，参与其中的开发着和公司的数量也在增加；到目前为止，开发过程已经证明是能够无障碍地扩展到更高的速度。</p>\n<p><strong>Linus 在大会上表示：Linux 依然让他惊讶</strong></p>\n<p>今年，Linus Torvalds 首次出席了在中国举行的 LinuxCon + ContainerCon + CloudOpen China 会议，谈论了 Linux 诞生二十五年来仍然让他感到惊讶和激励他的事情。</p>\n<p>Linus 说，“令我感到有意思的是，我认为已经稳定的代码仍然在持续得到改进；有些代码我们已经很多年没有接触，然后有人现身提出了改进，或者针对我认为没人使用的代码递交了 bug 报告。</p>\n<p>Linus 称，他们的工作流程能持续更长时间，Linux 仍然有强有力的维护者团队，当维护者变老变胖，会有新人来接替。他不认为需要担心未来二十年。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/033852ef05e89dc6e98dd4c4b70f6d23.jpeg\" alt=\"\"></p>\n<p>还有 Linux 的忠实用户发表博客，表达了对 Linux 的支持与热爱。作者在文中表示，Linux 具有高安全、高可用、易于维护、开源等优秀特点，深得人们喜爱。内容详情请看：十点总结，为何 Linux 如此深得人心</p>\n<p>在2017年，Linux 在一定程度上取得了不小的进步，但这些似乎并不足以推动“Linux 桌面年”的到来。</p>\n<p><strong>为什么“Linux 桌面年”还没来？</strong></p>\n<p>近日，红帽高级软件工程经理、GNOME / Fedora 的开发者 Christian Schaller ，还就“Linux 桌面年”失约多年的事在其博客上分享了他的观点。</p>\n<p>Christian 在文中列出了数个他认为影响 Linux 桌面发展的因素，大致总结后，包括：</p>\n<ul>\n<li>Linux 桌面分发版本太多，市场太过碎片化；</li>\n<li>早年严重缺乏应用支持，常用软件和字体支持不足。现在已改善了许多；</li>\n<li>缺乏 API 和 ABI 稳定性；</li>\n<li>受 MacOSX 冲击；</li>\n<li>Linux 桌面发展前 10 年，微软在某种程度上将 Linux 作为竞争对手，并成功打压；</li>\n<li>获取盗版 Windows 相对简单，有了“免费”的操作系统后没有需求使用 Linux （主要指向中国o(□)o ）；</li>\n<li>以 Linux 桌面起家的红帽改变业务方向；</li>\n<li>没有标准的商业模式；</li>\n<li>缺乏硬件厂商支持</li>\n</ul>\n<p>身为乐观主义者的 Christian 还在文中表示，虽然 Linux 桌面目前的市场份额还没达到 10% ，但这并不意味着它不会发生。有别于专有软件，Linux 桌面的开源，意味着它非常难以被“杀”死。只要有一个强大的社区有兴趣推动它，它仍然前途无量。</p>\n<p>拿 “Year Of The Linux Desktop” 这句话去 Google 一下，我们会发现大量关于“Linux 桌面年”的相关信息，有些信息距今已将近 10 年。这意味着我们见证 10 年预言的同时，也见证了 10 年预言的破灭。</p>\n<p>所以要问“Linux 桌面年”何时会来？没人能给出准确答案。但是，目前我们能看到的是，在 Linux、Windows 或其他的什么系统共存和竞争的大环境下，身为普通用户的我们能够不断享受到竞争带来的创新，和越来越好的体验。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113361\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113361votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113361\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113361/", "comment_nums": 1, "create_date": "2017/12/22", "tags": "IT技术,Linux", "url_object_id": "4f72efb5ca5c32be1a85f919cb1f083c", "front_image_path": "full/dd1cc9aabc819ded578b6acfe94b7f995ee5ea2d.jpg"}
{"fav_nums": 2, "praise_nums": "2", "title": "10 个例子教你学会 ncat (nc) 命令", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/1d34dd467641215c527e32ede94fe494.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linuxtechi.com/nc-ncat-command-examples-linux-systems/\">Pradeep Kumar </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9190-1.html\">DarkSun </a>   </div><p><code>ncat</code> 或者说 <code>nc</code> 是一款功能类似 <code>cat</code> 的工具，但是是用于网络的。它是一款拥有多种功能的 CLI 工具，可以用来在网络上读、写以及重定向数据。 它被设计成可以被脚本或其他程序调用的可靠的后端工具。同时由于它能创建任意所需的连接，因此也是一个很好的网络调试工具。</p>\n<p><code>ncat</code>/<code>nc</code> 既是一个端口扫描工具，也是一款安全工具，还能是一款监测工具，甚至可以做为一个简单的 TCP 代理。 由于有这么多的功能，它被誉为是网络界的瑞士军刀。 这是每个系统管理员都应该知道并且掌握它。</p>\n<p>在大多数 Debian 发行版中，<code>nc</code> 是默认可用的，它会在安装系统的过程中自动被安装。 但是在 CentOS 7 / RHEL 7 的最小化安装中，<code>nc</code> 并不会默认被安装。 你需要用下列命令手工安装。<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed4e321999870\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@linuxtechi ~]# yum install nmap-ncat -y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed4e321999870-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed4e321999870-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">linuxtechi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># yum install nmap-ncat -y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>系统管理员可以用它来审计系统安全，用它来找出开放的端口然后保护这些端口。 管理员还能用它作为客户端来审计 Web 服务器、telnet 服务器、邮件服务器等， 通过 <code>nc</code> 我们可以控制发送的每个字符，也可以查看对方的回应。</p>\n<p>我们还可以用它捕获客户端发送的数据以此来了解这些客户端是做什么的。</p>\n<p>在本文中，我们会通过 10 个例子来学习如何使用 <code>nc</code> 命令。</p>\n<h3 id=\"toc_1\">例子： 1) 监听入站连接</h3>\n<p>通过 <code>-l</code> 选项，<code>ncat</code> 可以进入监听模式，使我们可以在指定端口监听入站连接。 完整的命令是这样的：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed58993692041\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l port_number</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed58993692041-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed58993692041-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port_number</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>比如，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed64525672996\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed64525672996-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed64525672996-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>服务器就会开始在 8080 端口监听入站连接。</p>\n<h3 id=\"toc_2\">例子： 2) 连接远程系统</h3>\n<p>使用下面命令可以用 <code>nc</code> 来连接远程系统，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed68875662802\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat IP_address port_number</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed68875662802-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed68875662802-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ncat </span><span class=\"crayon-e\">IP_address </span><span class=\"crayon-v\">port_number</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>让我们来看个例子，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed6b529178623\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 80</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed6b529178623-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed6b529178623-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这会创建一个连接，连接到 IP 为 192.168.1.100 的服务器上的 80 端口，然后我们就可以向服务器发送指令了。 比如我们可以输入下面内容来获取完整的网页内容<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed6f443681199\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed6f443681199-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed6f443681199-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>或者获取页面名称，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed72966506665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed72966506665-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed72966506665-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>或者我们可以通过以下方式获得操作系统指纹标识，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed75951361044\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed75951361044-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed75951361044-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这会告诉我们使用的是什么软件来运行这个 web 服务器的。</p>\n<h3 id=\"toc_3\">例子： 3) 连接 UDP 端口</h3>\n<p>默认情况下，<code>nc</code> 创建连接时只会连接 TCP 端口。 不过我们可以使用 <code>-u</code> 选项来连接到 UDP 端口，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed78737000465\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l -u 1234</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed78737000465-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed78737000465-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1234</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在我们的系统会开始监听 UDP 的 1234 端口，我们可以使用下面的 <code>netstat</code> 命令来验证这一点，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed7b387266494\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ netstat -tunlp | grep 1234\r\nudp           0          0 0.0.0.0:1234                 0.0.0.0:*               17341/nc\r\nudp6          0          0 :::1234                      :::*                    17341/nc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed7b387266494-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5ed7b387266494-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed7b387266494-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed7b387266494-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">netstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tunlp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1234</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5ed7b387266494-2\"><span class=\"crayon-i\">udp</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1234</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">17341</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nc</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed7b387266494-3\"><span class=\"crayon-i\">udp6</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1234</span><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                    </span><span class=\"crayon-cn\">17341</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>假设我们想发送或者说测试某个远程主机 UDP 端口的连通性，我们可以使用下面命令，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed7e671228166\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -v -u {host-ip} {udp-port}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed7e671228166-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed7e671228166-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ip</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">udp</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>比如：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed81899236411\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@localhost ~]# ncat -v -u 192.168.105.150 53\r\nNcat: Version 6.40 ( http://nmap.org/ncat )\r\nNcat: Connected to 192.168.105.150:53。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed81899236411-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5ed81899236411-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed81899236411-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed81899236411-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ncat -v -u 192.168.105.150 53</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5ed81899236411-2\"><span class=\"crayon-v\">Ncat</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Version</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.40</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//nmap.org/ncat )</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed81899236411-3\"><span class=\"crayon-v\">Ncat</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connected </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.105.150</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">53</span>。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">例子： 4) 将 <code>nc</code> 作为聊天工具</h3>\n<p><code>nc</code> 也可以作为聊天工具来用，我们可以配置服务器监听某个端口，然后从远程主机上连接到服务器的这个端口，就可以开始发送消息了。 在服务器这端运行：<code></code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed85204015628\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed85204015628-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed85204015628-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在远程客户端主机上运行：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed88854369504\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed88854369504-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed88854369504-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>之后开始发送消息，这些消息会在服务器终端上显示出来。</p>\n<h3 id=\"toc_5\">例子： 5) 将 <code>nc</code> 作为代理</h3>\n<p><code>nc</code> 也可以用来做代理。比如下面这个例子，<br>\n<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed8b666599897\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080 | ncat 192.168.1.200 80</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed8b666599897-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed8b666599897-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.200</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>所有发往我们服务器 8080 端口的连接都会自动转发到 192.168.1.200 上的 80 端口。 不过由于我们使用了管道，数据只能被单向传输。 要同时能够接受返回的数据，我们需要创建一个双向管道。 使用下面命令可以做到这点:<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed8e791963506\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mkfifo 2way\r\n$ ncat -l 8080 0&lt;2way | ncat 192.168.1.200 80 1&gt;2way</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed8e791963506-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5ed8e791963506-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed8e791963506-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mkfifo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2way</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5ed8e791963506-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2way</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.200</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">2way</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>现在你可以通过 <code>nc</code> 代理来收发数据了。</p>\n<h3 id=\"toc_6\">例子： 6) 使用 <code>nc</code> 拷贝文件</h3>\n<p><code>nc</code> 还能用来在系统间拷贝文件，虽然这么做并不推荐，因为绝大多数系统默认都安装了 <code>ssh</code>/<code>scp</code>。 不过如果你恰好遇见个没有 <code>ssh</code>/<code>scp</code> 的系统的话， 你可以用 <code>nc</code> 来作最后的努力。</p>\n<p>在要接受数据的机器上启动 <code>nc</code> 并让它进入监听模式：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed94363751318\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l  8080 &gt; file.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed94363751318-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed94363751318-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在去要被拷贝数据的机器上运行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed97873016146\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 8080 --send-only &lt; data.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed97873016146-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed97873016146-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">send</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">only</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这里，<code>data.txt</code> 是要发送的文件。 <code>-–send-only</code> 选项会在文件拷贝完后立即关闭连接。 如果不加该选项， 我们需要手工按下 <code>ctrl+c</code> 来关闭连接。</p>\n<p>我们也可以用这种方法拷贝整个磁盘分区，不过请一定要小心。</p>\n<h3 id=\"toc_7\">例子： 7) 通过 <code>nc</code> 创建后门</h3>\n<p><code>nc</code> 命令还可以用来在系统中创建后门，并且这种技术也确实被黑客大量使用。 为了保护我们的系统，我们需要知道它是怎么做的。 创建后门的命令为：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed9b833530382\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 10000 -e /bin/bash</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed9b833530382-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed9b833530382-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>-e</code> 标志将一个 bash 与端口 10000 相连。现在客户端只要连接到服务器上的 10000 端口就能通过 bash 获取我们系统的完整访问权限：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5ed9e869107153\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 10000</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5ed9e869107153-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5ed9e869107153-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">例子： 8) 通过 <code>nc</code> 进行端口转发</h3>\n<p>我们通过选项 <code>-c</code> 来用 <code>nc</code> 进行端口转发，实现端口转发的语法为：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5eda1603653106\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -u -l  80 -c  'ncat -u -l 8080'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5eda1603653106-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5eda1603653106-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\">  </span><span class=\"crayon-s\">'ncat -u -l 8080'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这样，所有连接到 80 端口的连接都会转发到 8080 端口。</p>\n<h3 id=\"toc_9\">例子： 9) 设置连接超时</h3>\n<p><code>nc</code> 的监听模式会一直运行，直到手工终止。 不过我们可以通过选项 <code>-w</code> 设置超时时间:<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5eda4537517125\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -w 10 192.168.1.100 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5eda4537517125-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5eda4537517125-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这回导致连接 10 秒后终止，不过这个选项只能用于客户端而不是服务端。</p>\n<h3 id=\"toc_10\">例子： 10) 使用 <code>-k</code> 选项强制 <code>nc</code> 待命</h3>\n<p>当客户端从服务端断开连接后，过一段时间服务端也会停止监听。 但通过选项 <code>-k</code> 我们可以强制服务器保持连接并继续监听端口。 命令如下：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5eda8876378565\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l -k 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5eda8876378565-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5eda8876378565-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在即使来自客户端的连接断了也依然会处于待命状态。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113410\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113410votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113410\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113410/", "comment_nums": 0, "create_date": "2018/01/02", "tags": "IT技术,nc,ncat", "url_object_id": "b388a0a9722b034c4adad7ff85714f26", "front_image_path": "full/11a48b07810c909fd0ce4f50b3b33355d43f04e2.jpg"}
{"fav_nums": 1, "praise_nums": "1", "title": "10 个用于 AI 开发的框架和库", "front_image_url": ["https://dashbouquet.com/assets/img/blog/tensorflow-example.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dashbouquet.com/blog/web-development/progressive-tools-10-great-frameworks-and-libraries-for-ai\">dashbouquet</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>尽管人工智能（AI ）已经存在很长时间了，但因为这一领域取得的巨大进步，它最近成为了一个流行词。</p>\n<p>AI 曾被认为是狂热爱好者和天才的专属领域，但由于各种库和框架的蓬勃发展，它慢慢成为了一个不那么排外的 IT 领域，并吸引了大量的人才投入其中。</p>\n<p>在本文中，我们将介绍那些用于 AI 开发的高质量库，并谈谈它们的优缺点，以及特性。</p>\n<p>现在，让我们进入并探索 AI 库的世界吧。</p>\n<hr>\n<h3>TensorFlow</h3>\n<h5><strong>“使用数据流程图对可拓展的机器学习进行计算”</strong></h5>\n<h4><img class=\"aligncenter\" title=\"Tensorflow image recognition\" src=\"https://dashbouquet.com/assets/img/blog/tensorflow-example.png\" alt=\"How does a deep learning network work?\" width=\"800\" height=\"452\"></h4>\n<h4><strong>语言：C++</strong></h4>\n<h4><strong>84 725 ★</strong></h4>\n<p>初接触 AI 时，你听说的首批框架应该包含了谷歌的 TensorFlow。</p>\n<p>TensorFlow 是一个使用数据流程图进行数值计算的开源软件。这个不错的框架因其架构而闻名，它允许在任何 CPU 或 GPU 上进行计算，不管是桌面、服务器，还是移动设备。它可在 Python 编程语言中使用。</p>\n<p>TensorFlow 主要是通过数据层进行排序，而我们可以调用节点，并根据所得到的信息进行决策。<a href=\"https://www.tensorflow.org/\" target=\"_blank\">点击查看</a>！</p>\n<p><a href=\"http://playground.tensorflow.org/#activation=tanh&amp;batchSize=10&amp;dataset=circle&amp;regDataset=reg-plane&amp;learningRate=0.03&amp;regularizationRate=0&amp;noise=0&amp;networkShape=4,2&amp;seed=0.45748&amp;showTestData=false&amp;discretize=false&amp;percTrainData=50&amp;x=true&amp;y=true&amp;xTimesY=false&amp;xSquared=false&amp;ySquared=false&amp;cosX=false&amp;sinX=false&amp;cosY=false&amp;sinY=false&amp;collectStats=false&amp;problem=classification&amp;initZero=false&amp;hideText=false\" target=\"_blank\"><img class=\"aligncenter\" title=\"Tensorflow\" src=\"https://dashbouquet.com/assets/img/blog/tensorfrlow-concept.png\" alt=\"Deep learning concept of Tensorflow\" width=\"800\" height=\"453\"></a></p>\n<p>优点：</p>\n<ul>\n<li>使用简单易学的语言，如 Python。</li>\n<li>使用计算图进行抽象。</li>\n<li>可以使用 TensorBoard 获得可视化。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>运行速度慢，因为 Python 不是最快的语言。</li>\n<li>缺乏许多预训练的模型。</li>\n<li>不完全开源。</li>\n</ul>\n<h3>Microsoft CNTK</h3>\n<h5><strong>“开源的深度学习工具包”</strong></h5>\n<h4><img title=\"Microsoft CNTK\" src=\"https://dashbouquet.com/assets/img/blog/micrisift-cntk-banner.png\" alt=\"Microsoft Cognitive Toolkit\" width=\"1259\" height=\"472\"></h4>\n<h4><strong>语言：C++</strong></h4>\n<h4><strong>13 516 ★</strong></h4>\n<p>我们是否可以将它看作是微软对谷歌 TensorFlow 的回应？</p>\n<p>微软的 CNTK（计算网络工具包）是一个用来增强模块化和保持计算网络分离的库，提供学习算法和模型描述。</p>\n<p>在需要大量服务器进行计算的情况下，CNTK 可以同时利用多台服务器。</p>\n<p>据说 CNTK 在功能上接近谷歌的 TensorFlow，但速度比对方要快一些。<a href=\"https://github.com/Microsoft/CNTK\" target=\"_blank\">了解更多</a>。</p>\n<p><a href=\"https://docs.microsoft.com/en-us/cognitive-toolkit/\" target=\"_blank\"><img title=\"CNTK architecture\" src=\"https://dashbouquet.com/assets/img/blog/microsoft-cntk-architecture.png\" alt=\"Microsoft CNTK architecture\" width=\"1400\" height=\"721\"></a></p>\n<p>优点：</p>\n<ul>\n<li>高度灵活。</li>\n<li>允许分布式训练。</li>\n<li>支持 C++、C#、Java 和 Python。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>它由一种新的语言——NDL（网络描述语言）实现。</li>\n<li>缺乏可视化。</li>\n</ul>\n<h3>Theano</h3>\n<h5><strong>“数值计算库”</strong></h5>\n<h5><strong><img title=\"Theaono\" src=\"https://dashbouquet.com/assets/img/blog/theano.png\" alt=\"Theano framework\" width=\"558\" height=\"164\"></strong></h5>\n<h4><strong>语言：Python</strong></h4>\n<h4><strong>7 550 ★</strong></h4>\n<p>作为 TensorFlow 的强有力竞争对手，Theano 是一个强大的 Python 库，它允许使用高效多维数组进行数值计算。</p>\n<p>它不使用 CPU，而是透明地使用 GPU，用于数据密集型计算，所以效率很高。</p>\n<p>因此，在大约 10 年内，Theano 一直被用于大规模的数据密集型计算。</p>\n<p>然而，在 2017 年 9 月 28 日当日，开发团队宣称，将在 2017 年 11 月 15 日发布 1.0 版后，停止对它的主要开发。</p>\n<p>但这并没有削弱它的强大实力，你仍可以使用它，随时进行深入学习的研究。<a href=\"https://github.com/Theano/Theano\" target=\"_blank\">了解更多</a>。</p>\n<p><a href=\"http://www.wildml.com/2015/09/speeding-up-your-neural-network-with-theano-and-the-gpu/\" target=\"_blank\"><img title=\"Multilayer perceptron with one hidden layer and a softmax output layer.\" src=\"https://dashbouquet.com/assets/img/blog/theano-data-visualization.png\" alt=\"d3viz: Interactive visualization of Theano compute graphs\" width=\"1019\" height=\"645\"></a></p>\n<p>优点：</p>\n<ul>\n<li>对 CPU 和 GPU 进行了适当优化。</li>\n<li>高效的数值计算任务。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>与其他库相比，原始的 Theano 有点儿低级。</li>\n<li>需要与其他库一起使用，以获得较高级的抽象。</li>\n<li>在 AWS 上使用有点小 Bug。</li>\n</ul>\n<h3>Caffe</h3>\n<h5><strong>“应对深入学习的快速开放架构”</strong></h5>\n<h5><strong><strong><img class=\"aligncenter\" title=\"Caffe\" src=\"https://dashbouquet.com/assets/img/blog/caffe-banner.png\" alt=\"Caffe machine learning framework\" width=\"600\" height=\"325\"></strong></strong></h5>\n<h4><strong>语言：C++</strong></h4>\n<h4><strong>22 111 ★</strong></h4>\n<p>Caffe 是一个强大的深度学习框架。</p>\n<p>和这个列表中的其他框架一样，它对于深入学习的研究而言，是非常快速和有效的。</p>\n<p>使用 Caffe，你可以轻易地构建一个用于图像分类的 CNN（卷积神经网络）。它在 GPU 上运行良好，使得运行速度非常快。查看<a href=\"http://caffe.berkeleyvision.org/\" target=\"_blank\">主页</a>。<br>\n<a href=\"https://leonardoaraujosantos.gitbooks.io/artificial-inteligence/content/deep_learning_libraries.html\" target=\"_blank\"><img class=\"aligncenter\" title=\"Caffe overview\" src=\"https://dashbouquet.com/assets/img/blog/CaffeOverview.png\" alt=\"Caffe main classes\" width=\"430\" height=\"493\"></a></p>\n<p>上图是 Caffe 的主类。</p>\n<p>优点：</p>\n<ul>\n<li>可以与 Python 和 MATLAB 绑定使用。</li>\n<li>高性能。</li>\n<li>无需编写代码，即可训练模型。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>对递归网络支持不好。</li>\n<li>对新架构来说不是很好。</li>\n</ul>\n<h3>Keras</h3>\n<h5><strong>“针对人类的深度学习”</strong></h5>\n<h5><strong><strong><img title=\"Keras\" src=\"https://dashbouquet.com/assets/img/blog/keras.png\" alt=\"Keras frameowork\" width=\"666\" height=\"347\"></strong></strong></h5>\n<h4><strong>语言：Python</strong></h4>\n<h4><strong>23 711 ★</strong></h4>\n<p>Keras 是一个用 Python 编写的开源神经网络库。</p>\n<p>不似 TensorFlow、CNTK、Theano、Keras 这种端到端（End-to-End）的机器学习框架，</p>\n<p>相反，它是一个接口，提供了高层次的抽象，使得神经网络的配置变得更加简单，而不必考虑所在的框架。</p>\n<p>谷歌的 TensorFlow 目前支持 Keras 作为后端，而微软的 CNTK 也将在短时间内获得支持。<a href=\"https://keras.io/\" target=\"_blank\">了解更多</a>。</p>\n<p><img class=\"fancyimg\" title=\"Keras cheat sheet\" src=\"https://dashbouquet.com/assets/img/blog/Keras_Cheat_Sheet_Python-1.jpg\" alt=\"Keras Cheat Sheet: Neural Networks in Python\" width=\"2339\" height=\"1654\"></p>\n<p>优点：</p>\n<ul>\n<li>它对用户友好，易于上手。</li>\n<li>高度拓展。</li>\n<li>可以在 CPU 或 GPU 上无缝运行。</li>\n<li>完美兼容 Theano 和 TensorFlow。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>不能有效地作为一个独立的框架来使用。</li>\n</ul>\n<h3>Torch</h3>\n<h5 class=\"public \"><strong>“开源机器学习库”</strong></h5>\n<h5 class=\"public \"><strong><img class=\"aligncenter\" title=\"Torch\" src=\"https://dashbouquet.com/assets/img/blog/torch-tw.png\" alt=\"Torch framework\" width=\"630\" height=\"356\"></strong></h5>\n<h4><strong>语言：C</strong></h4>\n<h4><strong>7 584 ★</strong></h4>\n<p>Torch 是一个用于科学计算和数值计算的开源机器学习库。</p>\n<p>它是一个基于  Lua 编程语言（终于不再是 Python）的库。</p>\n<p>通过提供大量算法，使得深入学习的研究更加容易，并提高了效率和速度。它有一个强大的 N 维数组，帮助进行类似切片和索引这样的计算，并提供线性代数程序和神经网络模型。<a href=\"http://torch.ch/\" target=\"_blank\">了解更多</a>。</p>\n<p><a href=\"https://github.com/soumith/cvpr2015/blob/master/cvpr-torch.pdf\" target=\"_blank\"><img title=\"Torch example\" src=\"https://dashbouquet.com/assets/img/blog/cvpr-torch-example.png\" alt=\"Torch - convolutional network, for natural images\" width=\"2845\" height=\"2134\"></a></p>\n<p>优点：</p>\n<ul>\n<li>高度灵活。</li>\n<li>速度快，效率高。</li>\n<li>大量的预训练模型可用。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>说明文档不够清晰。</li>\n<li>缺乏立即使用的即插即用代码。</li>\n<li>它基于一个不怎么流行的编程语言 Lua。</li>\n</ul>\n<h3>Accord.NET</h3>\n<h5><strong>“针对 .NET 的机器学习、计算机视觉、统计学和通用科学计算”</strong></h5>\n<h5><strong><strong><img class=\"aligncenter\" title=\"Accord.net\" src=\"https://dashbouquet.com/assets/img/blog/accord-net.jpg\" alt=\"Accord.net machine learning framework\" width=\"746\" height=\"563\"></strong></strong></h5>\n<h4><strong>语言：C＃</strong></h4>\n<h4><strong>2 424 ★</strong></h4>\n<p>这是为 C# 程序员准备的。</p>\n<p>Accord.NET 框架是一个 .NET 机器学习框架，使得音频和图像的处理变得更加简单。</p>\n<p>该框架可以有效地解决数值优化、人工神经网络，甚至给出了可视化的特征。此外，Accord.NET 对计算机视觉和信号处理具有强大的功能，并且易于算法实现。查看<a href=\"http://accord-framework.net/\" target=\"_blank\">主页</a>。</p>\n<p><a href=\"http://accord-framework.net/samples.html\" target=\"_blank\"><img title=\"Accord.net samples\" src=\"https://dashbouquet.com/assets/img/blog/accrod-net-samples.jpg\" alt=\"Machine learning samples\" width=\"1040\" height=\"548\"></a></p>\n<p>优点：</p>\n<ul>\n<li>它拥有一个庞大且活跃的开发团队。</li>\n<li>说明文档非常不错。</li>\n<li>高质量的可视化。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>这不是一个非常流行的框架。</li>\n<li>与 TensorFlow 相比，速度慢。</li>\n</ul>\n<h3>Spark MLlib</h3>\n<h5><strong>“可扩展的机器学习库”</strong></h5>\n<h5><strong><strong><img class=\"aligncenter\" title=\"Spark MLlib\" src=\"https://dashbouquet.com/assets/img/blog/spark-runs-everywhere.png\" alt=\"Spark MLlib runs everywhere\" width=\"545\" height=\"425\"></strong></strong></h5>\n<h4><strong>语言：Scala</strong></h4>\n<h4><strong>15 708 ★</strong></h4>\n<p>Apache 的 Spark MLlib 是一个具有高度拓展性的机器学习库。</p>\n<p>它在 Java、Scala、Python 甚至 R 语言中都非常有用，因为它使用 Python 和 R 中类似 Numpy 这样的库，能够进行高效的交互。</p>\n<p>MLlib 可以很容易地插入 Hadoop 工作流程中。它提供了机器学习算法，如分类、回归、聚类等。</p>\n<p>这个强大的库在处理大规模的数据时，速度非常快。在<a href=\"https://spark.apache.org/mllib/\" target=\"_blank\">网站</a>上了解更多。</p>\n<p><a href=\"https://spark.apache.org/docs/2.1.1/ml-pipeline.html#code-examples\" target=\"_blank\"><img title=\"MLlib pipeline\" src=\"https://dashbouquet.com/assets/img/blog/ml-Pipeline.png\" alt=\"MLlib pipeline example\" width=\"1379\" height=\"352\"></a></p>\n<p>优点：</p>\n<ul>\n<li>对于大规模数据处理来说，非常快。</li>\n<li>可用于多种语言。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>陡峭的学习曲线。</li>\n<li>仅 Hadoop 支持即插即用。</li>\n</ul>\n<h3>Sci-Kit Learn</h3>\n<h5><strong>“Python 中的机器学习”</strong></h5>\n<h4><img class=\"fancyimg\" title=\"Sci-Kit Learn algorithm\" src=\"https://dashbouquet.com/assets/img/blog/sci-kit-learn-estimator.png\" alt=\"Choosing the right estimator\" width=\"1388\" height=\"865\"></h4>\n<h4><strong>语言：Python</strong></h4>\n<h4><strong>24 369 ★</strong></h4>\n<p>Sci-kit learn 是一个针对机器学习的强大 Python 库，主要用于构建模型。</p>\n<p>使用诸如 Numpy、SciPy 和 Matplotlib 等其他库构建，对于统计建模技术（如分类、回归、集群等）非常有效。</p>\n<p>Sci-Kit learn的特性包括监督式学习算法、非监督式学习算法和交叉验证。<a href=\"http://scikit-learn.org/\" target=\"_blank\">点击查看</a>。</p>\n<p><a href=\"http://scikit-learn.org/stable/auto_examples/neural_networks/plot_mlp_alpha.html\" target=\"_blank\"><img title=\"‘alpha’ on synthetic datasets\" src=\"https://dashbouquet.com/assets/img/blog/scikit-alpha-map.png\" alt=\"Varying regularization in Multi-layer Perceptron\" width=\"1700\" height=\"900\"></a></p>\n<p>优点：</p>\n<ul>\n<li>可以使用许多 shell 算法。</li>\n<li>高效的数据挖掘。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>不是最好的模型构建库。</li>\n<li>GPU 使用不高效。</li>\n</ul>\n<h3>MLPack</h3>\n<h5><strong>“可扩展的 C++ 机器学习库”</strong></h5>\n<h5><strong><strong><img title=\"MLPack\" src=\"https://dashbouquet.com/assets/img/blog/mlpack-main.png\" alt=\"MLPack framework\" width=\"700\" height=\"147\"></strong></strong></h5>\n<h4><strong>语言：C++</strong></h4>\n<h4><strong>1 856 ★</strong></h4>\n<p>MLPack 是一个使用 C++ 实现的可扩展的机器学习库。在 C++ 中，你可以猜到，它的内存管理非常出色。</p>\n<p>拥有高质量的机器学习算法与库，MLPack 的运行速度非常快。它对新手十分友好，因为它提供了一个可供使用的简单 API。<a href=\"http://mlpack.org/\" target=\"_blank\">点击查看</a>。</p>\n<p><a href=\"http://mlpack.org/docs/mlpack-git/doxygen/classmlpack_1_1hmm_1_1HMM.html#details\" target=\"_blank\"><img class=\"aligncenter\" style=\"border: 0px; vertical-align: middle; text-decoration: none !important; width: 660px; height: auto; margin-bottom: 20px; margin-top: 10px;\" title=\" MLPack master\" src=\"https://dashbouquet.com/assets/img/blog/classmlpack-inherit-graph.png\" alt=\"Inheritance diagram for HMM &lt;Distribution&gt;\" width=\"723\" height=\"235\"></a></p>\n<p>优点：</p>\n<ul>\n<li>高度拓展。</li>\n<li>可以与 Python 和 C++ 绑定。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>说明文档不够清晰。</li>\n</ul>\n<hr>\n<h1>总结</h1>\n<p>本文所讨论的库都非常高效，并经过了时间的考验，质量上乘。五大巨头 Facebook、谷歌、雅虎、苹果、微软都在使用这些库进行深度学习和机器学习项目。</p>\n<p>你有什么理由不用哪？</p>\n<p>你能想到其他经常使用，但不在列表上的库吗？请在评论部分与我们分享。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113499\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113499votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113499\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113499/", "comment_nums": 0, "create_date": "2018/01/19", "tags": "IT技术,人工智能", "url_object_id": "779ed9fa24a799a2c0bbfc7a4dcb5020", "front_image_path": "full/d1425f03e7e9722a55806f54fdc1d3bc1a00a373.jpg"}
{"fav_nums": 1, "praise_nums": "1", "title": "软件开发工作的第一现场", "front_image_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling-1024x683.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>我的同事王健最近写了一篇文章——<a href=\"http://insights.thoughtworks.cn/self-organizing-all-round-team/\">《从汽车贴膜看专业团队》</a>。看了之后感触良多，特别是文中提到的现场管理和全功能团队两点。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></p>\n<p>我有一个观点，说到专业性，传统行业比我们IT行业要强得多。从这篇文章可以看出，不管是管理人员的现场管理能力，还是全功能团队中一线人员的全栈能力，传统行业都比我们要强一些。相信有人会有些不服，不管什么现场管理，全功能团队我们也在做呀。</p>\n<p>说的没有错，但是，在IT行业里还真不容易找到这么专业的一个团队。而在传统行业里，这种水平的一个团队已经越来越常见了。这是为什么呢？按说大家都是人，通常来讲，IT行业的人能力素质不是还高一点吗？在我们这个行业中，专业团队不是应该更常见吗？虽然我们不一定要比你强，但是也不会比你弱得这么明显啊。</p>\n<p>当然，一方面是由于我们这个行业的工作比较复杂，不容易做到全栈，但我觉得更重要的是，IT行业属于知识工作，知识工作者的现场非常不明显，极难做到现场管理。</p>\n<p>我们IT行业的管理者，不管是项目经理，产品经理，还是技术领导者，大家也基本都和团队坐在一起。但是坐在一起，并不意味着就能够真的在现场。</p>\n<p>我们看到在那个贴膜团队里，团队领导只需要看一眼，发现有气泡，就知道质量有问题。也就是说，在传统行业进行现场管理的时候，问题都是非常直观的，非常容易发现。在软件行业想做到一点就难的多，记得几年前我的同事熊节也曾经写过一篇文章，文章的核心洞见就是软件开发的现场在代码里。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/0-2.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/0-2-1024x645.jpg\" alt=\"\" width=\"700\" height=\"441\"></a></p>\n<p>这个想法在ThoughtWorks有很多拥护者，公司里有很多人提出过类似的观点，于是我们的很多方法就是构建于这些类似的观点之上。</p>\n<p>然而，如果我们想要追求IT工作者开发效率的极限，这个洞见还不够极致。经过几年的工作，我发现，代码只是软件开发工作的第二现场，软件开发工作的第一现场，在语言里。</p>\n<p>这里说的语言，不是编程语言，也不是广义的人类语言，比如汉语、英语。指的是我们在从事软件开发工作中所使用的一系列术语和相关的一系列呈现方式和沟通工具。借用一个技术术语，我们所说的语言是一套仅供软件开发所有相关人员使用的、组合的DSL，DSL全称：Domain specific language，中文名叫做：领域特定语言。</p>\n<p>DSL就DSL，还组合的DSL，为什么要说的这么拗口呢？什么叫组合的DSL?我们知道在软件开发的过程当中，需要各种不同的角色参与。每个角色有自己特定的领域，泛泛的讲可以分为三类：我们把产品经理和设计人员所使用的领域特定语言叫做设计语言；把开发和测试使用的语言叫做技术语言；把业务人员、组织管理者使用的语言，叫做业务语言。</p>\n<p>所以我们使用的这套领域特定语言是把这三类语言组合在一起而形成的一套语言。这就意味着我们这套语言非常容易充满歧义，造成每个角色自说自话却难以被发现。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/hide.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/hide-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></p>\n<p>软件工程里的核心观点是：一个问题被发现的越晚，修正的成本就越高。比代码更早的是沟通，比沟通更早的就是语言。我们用语言去描述沟通的错误，去描述代码中的错误，我们用什么来描述语言的错误呢？还是语言，这就使得整个工作困难重重，难以达成共识。所以我们更需要非常严肃的对待软件开发工作的第一现场。</p>\n<p>之前一些方法试图建立纯粹的统一语言，所有人都说一套语言，事实上这个方法已经被行业放弃了，我们要承认，各自不同的语言有些部分可以简单统一成一种表达以消除歧义，有些部分只能结合。也就是说相关人员要懂多门语言。这个现实是我们必须接受的，软件正在吞噬世界，语言只会越来越复杂。就像我们再努力消除污染，也不能幻想世界回到工业文明以前了。无论我们多么努力的去建立统一语言，也不可能形成一门简单的语言，只能是多门DSL的一个杂合体。</p>\n<p>不过由于历史的原因，在行业放弃的过程中，由于“反对预先设计”走的过了头，“不谈建模，不谈标准化”成了一种奇怪的政治正确，导致很多优秀的工具和方法被边缘化了。其实我们憎恨的只是预先设计造成的反馈速度变慢，只是在这个过程中连带上了憎恨预先设计时代的一些工具，这就有点上纲上线了。</p>\n<p>幸而最近几年，各种领域建模的设计方法又重新回归。最近大行其道的领域驱动设计，就是在很严肃的对待业务语言的设计和使用。而在前端领域，Design System试图解决前端开发和设计师之间的语言分歧问题。我个人在从事软件开发工程师的培养方面发现，很多传统的可视化工具，比如说UML。如果不以繁重的预先设计为目的，来使用这些工具，仅把它们用作提高沟通效率的工具，他们的威力是十分惊人的。</p>\n<p>以我本人的团队为例，我们使用ant design为基础，设计了design system。使得我们可以在三天之内得到一个可以点击的软件原型，并在此基础上，进行各利益相关方之间的需求交流和反馈。在交流的过程当中，我们也刻意的统一了语言，使得我们尽管是一个远程团队，但是在交流的时候，能够很清楚的知道我们在对信息架构在哪一层进行反馈。这不但使得业务方可以反馈技术方，其实技术方也在引导业务方。语言的影响是双向的。</p>\n<p>在技术领域里，我们也选择了隔离性更好的技术架构，使得MVP的代码不会变成我们演进道路上必须长期背负的负累。而之所以在一篇聊“语言”的文章里提技术架构，是因为我们认为真正的架构不是纸上的，也不是代码里的，而是每个团队成员心里的架构。实施一个架构必然也是要进行大量沟通，也需要统一语言。</p>\n<p>而在交流业务的时候，我们刻意的划分了各种不同的子领域，又在每个领域当中统一了名词。统一名词还是比较简单的，最难的是划分领域，我们为此投入了大量的工作，也犯了一些错误，但这些付出是值得的，这之后，我们的沟通变得非常流畅。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/communication.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/communication-1024x695.jpg\" alt=\"\" width=\"700\" height=\"475\"></a></p>\n<p>具体的实践有机会再跟大家分享。在这里仅仅聊一下沟通顺畅带来的价值，沟通顺畅的威力并不仅仅表现在沟通的时候可以很顺畅的传递信息，最重要的是当有团队成员对信息理解出现错误的时候，可以很容易的发现和给予反馈。</p>\n<p>这个优势在IT行业至关重要。IT行业的人员流动率接近25%，这意味着每年我们团队中至少有1/4的新人加入。即便我们想尽方法让我们的团队保持稳定，随着敏捷和精益创业的相关思想慢慢成为我们的工作常识，每个项目存在的时间都不会太长，这使得IT团队经常性的重组，有时是团队被打散，有时是同一个系统从一个团队交给了另一个团队。如果缺乏一种有效的反馈机制，那么无论是人员流动还是组织重组，所造成的切换成本都是一个很大的。尽管这个切换成本无法消除，但是尽量减少切换成本是我们每个专业人员应该追求的，尤其是团队中的技术领导者。</p>\n<p>技术领导者重音在“领导”，而不在“技术”。尤其在Tech@Core的今天，技术就是业务。优秀的技术领导者更不能把自己变成一个救火队员，只是被动的响应，尽管救火队员常常因为很容易被人看到而获得一些关注和赞扬，但在中国的文化里，我们都知道还有更高一层的境界，这个境界存在于很多典故中，比如上医治未病，善战者无赫赫之功。同理，软件开发领域的技术领导者们也应该努力使大多数问题发生的基础消灭于无形，这就需要我们走出舒适区，深入到软件开发的第一现场，进行现场管理。</p>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113385\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113385votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113385\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 78</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113385/", "comment_nums": 0, "create_date": "2017/12/26", "tags": "其他,软件开发", "url_object_id": "6ff9807fcfd11f7bd4902c340a1ce2ff", "front_image_path": "full/8a53378b3e591a4a50c50300cfe2923a99650981.jpg"}
{"fav_nums": 2, "praise_nums": "1", "title": "12 条用于 Linux 的 MySQL/MariaDB 安全最佳实践", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/ede5c3a86638315dfe34f9b1a88065fe.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.tecmint.com/mysql-mariadb-security-best-practices-for-linux/\">tecmint</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/mysql-mariadb-security-best-practices-for-linux?print\">oschina</a>   </div><p>MySQL 是世界上最流行的开源数据库系统，MariaDB(一个 MySQL 分支)是世界上增长最快的开源数据库系统。在安装 MySQL 服务器之后，在默认配置下是不安全的，确保数据库安全通常是通用数据库管理的基本任务之一。</p>\n<div>\n<p>这将有助于增强和提升整个 Linux 服务器的安全性，因为攻击者总是扫描系统任意部分的漏洞，而数据库在过去是重点目标区域。一个常见的例子是对 MySQL 数据库的 root 密码的强制破解。</p>\n<p>在本指南中，我们将会讲解对开发者有帮助的 MySQL/MariaDB 的 Linux 最佳安全实践。</p>\n<h1>1. 安全地安装 MySQL</h1>\n<p>这是安装 MySQL 服务器后第一个建议的步骤，用于保护数据库服务器。这个脚本可以帮助您提高 MySQL 服务器的安全性：</p>\n<ul>\n<li>如果您在安装期间没有设置 root 帐户的密码，马上设置它</li>\n<li>通过删除可从本地主机外部访问的 root 帐户来禁用远程 root 用户登录</li>\n<li>删除匿名用户帐户和测试数据库，默认情况下，所有用户、甚至匿名用户都可以访问这些帐户和测试数据库</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac943b537055123\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#&amp;nbsp;mysql_secure_installation</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac943b537055123-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac943b537055123-1\"><span class=\"crayon-p\">#&amp;nbsp;mysql_secure_installation</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在运行上述命令之后，设置 root 密码并通过输入 [Yes/Y] 和按下 [Enter] 键来回答一系列问题。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f36cccbc6907b330961ecc571419f939.png\"></p>\n<p style=\"text-align: center\"><em>安全安装 MySQL 情况界面</em></p>\n<h1>2. 将数据库服务器绑定到 Loopback 地址</h1>\n<p>此配置将限制来自远程机器的访问，它告诉 MySQL 服务器只接受来自本地主机的连接。你可以在主配置文件中进行设置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9444579838586\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# vi /etc/my.cnf\t                   [RHEL/CentOS]\t\r\n# vi /etc/mysql/my.conf                    [Debian/Ubuntu] \r\nOR\r\n# vi /etc/mysql/mysql.conf.d/mysqld.cnf    [Debian/Ubuntu]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9444579838586-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69300ac9444579838586-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9444579838586-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69300ac9444579838586-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9444579838586-1\"><span class=\"crayon-p\"># vi /etc/my.cnf\t                   [RHEL/CentOS]\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69300ac9444579838586-2\"><span class=\"crayon-p\"># vi /etc/mysql/my.conf                    [Debian/Ubuntu] </span></div><div class=\"crayon-line\" id=\"crayon-5a69300ac9444579838586-3\"><span class=\"crayon-st\">OR</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69300ac9444579838586-4\"><span class=\"crayon-p\"># vi /etc/mysql/mysql.conf.d/mysqld.cnf    [Debian/Ubuntu]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在 <code>[mysqld]</code> 部分中添加下面这一行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9449573319354\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbind-address = 127.0.0.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9449573319354-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9449573319354-1\"><span class=\"crayon-v\">bind</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">address</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">127.0.0.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>3. 禁用 MySQL 的 LOCAL INFILE</h1>\n<p>作为安全性增强的一部分，您需要禁用 <strong>local_infile</strong>，使用下面的指令以防止在 <code>[mysqld]</code> 部分从 MySQL 中访问底层文件系统。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac944d600503867\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal-infile=0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac944d600503867-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac944d600503867-1\"><span class=\"crayon-v\">local</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">infile</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h1>4. 修改 MySQL 的默认端口</h1>\n<p>设置端口变量用于监听 TCP/IP 连接的 MySQL 端口号。默认端口号是 3306，但是您可以在 <strong>[mysqld] </strong>中修改它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9450610014473\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPort=5000</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9450610014473-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9450610014473-1\"><span class=\"crayon-v\">Port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5000</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h1>5、启用 MySQL 日志</h1>\n<p>日志是了解服务运行过程中发生了什么的最好的方法之一，在受到任何攻击的时候都可以很容易的从日志里看到任何入侵相关的行为。可以通过将下边的变量添加到配置文件[mysqld]部分来开启mysql日志功能。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9454133195534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlog=/var/log/mysql.log</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9454133195534-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9454133195534-1\"><span class=\"crayon-v\">log</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>6、设置合适的 MySQL 文件的访问权限</h1>\n<p>确保你已经为所有的 mysql 服务文件和数据路径设置了合适的访问权限。文件 /etc/my.conf 只能由 root 用户修改，这样就可以阻止其他用户修改数据库服务的配置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9457893995063\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# chmod 644 /etc/my.cnf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9457893995063-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9457893995063-1\"><span class=\"crayon-p\"># chmod 644 /etc/my.cnf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h1>7、删除 MySQL shell 历史</h1>\n<p>你在 MySQL shell 中执行的所有的命令都会被 mysql 客户端保存到一个历史文件：~/.mysql_history。这样是很危险的，因为对于你创建过的任何用户账户，所有的在 shell 输入过的用户名和密码都会记录到历史文件里面。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac945a100981720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# cat /dev/null &gt; ~/.mysql_history</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac945a100981720-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac945a100981720-1\"><span class=\"crayon-p\"># cat /dev/null &gt; ~/.mysql_history</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h1>8. 不要在命令行中运行 MySQL 命令</h1>\n<p>正如你所知道的，你在终端上输入的所有命令都会被存储在一个历史文件中，具体取决于你正在使用的shell（例如 bash 的 shell 历史文件放在 <strong>~/.bash_history</strong>）。攻击者访问这个历史文件可以很容易地看到记录在那里的任何密码。</p>\n<p>非常不建议在命令行里面输入密码，如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac945e733772266\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -ppassword_</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac945e733772266-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac945e733772266-1\"><span class=\"crayon-p\"># mysql -u root -ppassword_</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f505f9f9145e6e2ddd243ec3d3ebf9f5.png\"><br>\n<em>使用密码连接 MySQL</em></p>\n<p>当你查看命令行历史文件的最后的部分时，可以看到之前输入过的密码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9461975949214\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# history</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9461975949214-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9461975949214-1\"><span class=\"crayon-p\"># history</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/ec120994b3b6eb87f569f32434861ce9.png\"><br>\n<em>查看命令行输入历史</em></p>\n<p>推荐连接 MySQL 的方式是</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9464072569508\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -p\r\nEnter password:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9464072569508-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69300ac9464072569508-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9464072569508-1\"><span class=\"crayon-p\"># mysql -u root -p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69300ac9464072569508-2\"><span class=\"crayon-i\">Enter</span> <span class=\"crayon-v\">password</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>9. 定义特定应用的数据库用户</h1>\n<p>对于每一个在服务器上运行的应用，只设置一个与该应用相关的数据库用户。例如你有一个 wordpress 网站，如下创建一个 wordpress 的数据库用户：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9468579019744\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -p\r\nMariaDB [(none)]&gt; CREATE DATABASE osclass_db;\r\nMariaDB [(none)]&gt; CREATE USER 'osclassdmin'@'localhost' IDENTIFIED BY 'osclass@dmin%!2';\r\nMariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON osclass_db.* TO 'osclassdmin'@'localhost';\r\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\r\nMariaDB [(none)]&gt; exit</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9468579019744-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69300ac9468579019744-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9468579019744-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69300ac9468579019744-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9468579019744-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69300ac9468579019744-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9468579019744-1\"><span class=\"crayon-p\"># mysql -u root -p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69300ac9468579019744-2\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">DATABASE</span> <span class=\"crayon-v\">osclass_db</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69300ac9468579019744-3\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">USER</span> <span class=\"crayon-s\">'osclassdmin'</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">'localhost'</span> <span class=\"crayon-i\">IDENTIFIED</span> <span class=\"crayon-i\">BY</span> <span class=\"crayon-s\">'osclass@dmin%!2'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69300ac9468579019744-4\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">GRANT</span> <span class=\"crayon-i\">ALL</span> <span class=\"crayon-i\">PRIVILEGES</span> <span class=\"crayon-i\">ON</span> <span class=\"crayon-v\">osclass_db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span> <span class=\"crayon-st\">TO</span> <span class=\"crayon-s\">'osclassdmin'</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">'localhost'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69300ac9468579019744-5\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">FLUSH</span> <span class=\"crayon-v\">PRIVILEGES</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69300ac9468579019744-6\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-v\">exit</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>并且要记住对于不再使用的数据库用户要删掉。</p>\n<h1>10. 使用额外的安全插件和库</h1>\n<p>MySQL 包含许多安全插件：验证客户端连接到 MySQL 服务器的请求、密码校验和敏感信息的安全存储等，这些都在免费版本中提供。</p>\n<p>在这里可查看更多：<a href=\"https://dev.mysql.com/doc/refman/5.7/en/security-plugins.html\" target=\"_blank\" rel=\"nofollow\">https://dev.mysql.com/doc/refman/5.7/en/security-plugins.html</a></p>\n<h1>11. 定期修改 MySQL 密码</h1>\n<p>定期修改密码是一个常见的信息/应用/系统安全建议。多久修改一次密码由你内部的安全策略决定。定期修改密码可以阻止长期跟踪你的“窥探者”，获取你的密码，登录你的 MySQL 服务器。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac946c592339147\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMariaDB [(none)]&gt; USE mysql;MariaDB [(none)]&gt; UPDATE user SET password=PASSWORD('YourPasswordHere') WHERE User='root' AND Host = 'localhost';MariaDB [(none)]&gt; FLUSH PRIVILEGES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac946c592339147-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac946c592339147-1\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-st\">USE</span> <span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">;</span><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">UPDATE</span> <span class=\"crayon-i\">user</span> <span class=\"crayon-i\">SET</span> <span class=\"crayon-v\">password</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">PASSWORD</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'YourPasswordHere'</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">WHERE</span> <span class=\"crayon-v\">User</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'root'</span> <span class=\"crayon-st\">AND</span> <span class=\"crayon-i\">Host</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'localhost'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">FLUSH</span> <span class=\"crayon-v\">PRIVILEGES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h1>12. 定期更新 MySQL Server 包</h1>\n<p>强烈建议定期从官方仓库更新 mysql/mariadb 包来获取最新的安全更新和错误改进。通常情况下操作系统中默认的包是过时的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9470387270323\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# yum update\r\n# apt update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9470387270323-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69300ac9470387270323-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9470387270323-1\"><span class=\"crayon-p\"># yum update</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69300ac9470387270323-2\"><span class=\"crayon-p\"># apt update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在对 mysql/mariadb server 进行任何修改之后，要重启服务。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69300ac9473033400049\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# systemctl restart mariadb\t\t#RHEL/CentOS\r\n# systemctl restart mysql\t\t#Debian/Ubuntu</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69300ac9473033400049-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69300ac9473033400049-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69300ac9473033400049-1\"><span class=\"crayon-p\"># systemctl restart mariadb\t\t#RHEL/CentOS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69300ac9473033400049-2\"><span class=\"crayon-p\"># systemctl restart mysql\t\t#Debian/Ubuntu</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>分享到此结束，欢迎大家在文章下面评论，并且和我们分享文章中没有提到的安全提示。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113422\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113422votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113422\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113422/", "comment_nums": 1, "create_date": "2018/01/03", "tags": "IT技术,Linux", "url_object_id": "bf8e18875ff5e8a6c9a717b3ae5bd56d", "front_image_path": "full/d72465e7819b8a9a352bc3cbe4e1a4e31851a59c.jpg"}
{"fav_nums": 4, "praise_nums": "2", "title": "十个不错的 Linux 网络监视工具", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxandubuntu.com/home/best-network-monitoring-tools-for-linux\">Linuxandubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9153-1.html\">LCTT</a>   </div><p>保持对我们的网络的管理，防止任何程序过度使用网络、导致整个系统操作变慢，对管理员来说是至关重要的。有几个网络监视工具可以用于不同的操作系统。在这篇文章中，我们将讨论从 Linux 终端中运行的 10 个网络监视工具。它对不使用 GUI 而希望通过 SSH 来保持对网络管理的用户来说是非常理想的。</p>\n<h1 id=\"toc_1\">iftop</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png\"><img class=\"aligncenter size-full wp-image-113368\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>iftop network monitoring tool</em></p>\n<p>Linux 用户通常都熟悉 <code>top</code> —— 这是一个系统监视工具，它允许我们知道在我们的系统中实时运行的进程，并可以很容易地管理它们。<code>iftop</code> 与 <code>top</code> 应用程序类似，但它是专门监视网络的，通过它可以知道更多的关于网络的详细情况和使用网络的所有进程。</p>\n<p>我们可以从 <a href=\"http://www.ex-parrot.com/pdw/iftop/\">这个链接</a> 获取关于这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_2\">vnstat</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/c7c242518c7677eec7e5c7b44d70d9ca.png\"><img class=\"aligncenter size-full wp-image-113369\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/c7c242518c7677eec7e5c7b44d70d9ca.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>vnstat network monitoring tool</em></p>\n<p><code>vnstat</code> 是一个缺省包含在大多数 Linux 发行版中的网络监视工具。它允许我们对一个用户选择的时间周期内发送和接收的流量进行实时控制。</p>\n<p>我们可以从 <a href=\"http://humdi.net/vnstat/\">这个链接</a> 获取关于这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_3\">iptraf</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd2e2df478b8ada815a3182f13f8471f.gif\"><img class=\"aligncenter size-full wp-image-113370\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd2e2df478b8ada815a3182f13f8471f.gif\" alt=\"180514hf11ozfuf1dvpgmk\"></a></p>\n<p class=\"article_img_desc\" style=\"text-align: center\"><em>iptraf monitoring tool for linux</em></p>\n<p>IPTraf 是一个基于控制台的 Linux 实时网络监视程序。它会收集经过这个网络的各种各样的信息作为一个 IP 流量监视器，包括 TCP 标志信息、ICMP 详细情况、TCP / UDP 流量故障、TCP 连接包和字节计数。它也收集接口上全部的 TCP、UDP、…… IP 协议和非 IP 协议 ICMP 的校验和错误、接口活动等等的详细情况。（LCTT 译注：此处原文有误，径改之）</p>\n<p>我们可以从 <a href=\"http://iptraf.seul.org/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_4\">Monitorix – 系统和网络监视</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/ee5444cf29a457d16b868d948ea12e2b.png\"><img class=\"aligncenter size-full wp-image-113371\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/ee5444cf29a457d16b868d948ea12e2b.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>monitorix system monitoring tool for linux</em></p>\n<p>Monitorix 是一个轻量级的免费应用程序，它设计用于去监视尽可能多的 Linux / Unix 服务器的系统和网络资源。它里面添加了一个 HTTP web 服务器，可以定期去收集系统和网络信息，并且在一个图表中显示它们。它跟踪平均系统负载、内存分配、磁盘健康状态、系统服务、网络端口、邮件统计信息（Sendmail、Postfix、Dovecot 等等）、MySQL 统计信息以及其它的更多内容。它设计用于去管理系统的整体性能，以及帮助检测故障、瓶颈、异常活动等等。</p>\n<p>下载及更多 <a href=\"http://www.monitorix.org\">信息在这里</a>。</p>\n<h1 id=\"toc_5\">dstat</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/bb645c76ca4667edb3fd2b18e8fade5c.png\"><img class=\"aligncenter size-full wp-image-113372\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/bb645c76ca4667edb3fd2b18e8fade5c.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>dstat network monitoring tool</em></p>\n<p>这个监视器相比前面的几个知名度低一些，但是，在一些发行版中已经缺省包含了。</p>\n<p>我们可以从 <a href=\"http://dag.wiee.rs/home-made/dstat/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_6\">bwm-ng</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/c06fbf012db3866acdb9cfcf64ae35a7.png\"><img class=\"aligncenter size-full wp-image-113373\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/c06fbf012db3866acdb9cfcf64ae35a7.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>bwm-ng monitoring tool</em></p>\n<p>这是最简化的工具之一。它允许你去从连接中交互式取得数据，并且，为了便于其它设备使用，在取得数据的同时，能以某些格式导出它们。</p>\n<p>我们可以从 <a href=\"http://sourceforge.net/projects/bwmng/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_7\">ibmonitor</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd3080fed79dc64b9b4e698d0316dc7a.jpg\"><img class=\"aligncenter size-full wp-image-113375\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd3080fed79dc64b9b4e698d0316dc7a.jpg\" alt=\"180516yvm7wevqenuxebnu\"></a></p>\n<p style=\"text-align: center\"><em>ibmonitor tool for linux</em></p>\n<p>与上面的类似，它显示连接接口上过滤后的网络流量，并且，明确地将接收流量和发送流量区分开。</p>\n<p>我们可以从 <a href=\"http://ibmonitor.sourceforge.net/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_8\">Htop – Linux 进程跟踪</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0e1a55542e556c9e11f2d16d59601154.png\"><img class=\"aligncenter size-full wp-image-113376\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0e1a55542e556c9e11f2d16d59601154.png\" alt=\"180517ddgb0xr4gr69dnbt\"></a></p>\n<p style=\"text-align: center\"><em>htop linux processes monitoring tool</em></p>\n<p>Htop 是一个更先进的、交互式的、实时的 Linux 进程跟踪工具。它类似于 Linux 的 top 命令，但是有一些更高级的特性，比如，一个更易于使用的进程管理界面、快捷键、水平和垂直的进程视图等更多特性。Htop 是一个第三方工具，它不包含在 Linux 系统中，你必须使用 <strong>YUM</strong> 或者 <strong>APT-GET</strong> 或者其它的包管理工具去安装它。关于安装它的更多信息，读<a href=\"http://wesharethis.com/knowledgebase/htop-and-atop/\">这篇文章</a>。</p>\n<p>我们可以从 <a href=\"http://hisham.hm/htop/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_9\">arpwatch – 以太网活动监视器</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/58bead3d8a40a0d640c3c5e93ef9a959.png\"><img class=\"aligncenter size-full wp-image-113379\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/58bead3d8a40a0d640c3c5e93ef9a959.png\" alt=\"180517ddgb0xr4gr69dnbt\"></a></p>\n<p style=\"text-align: center\"><em>arpwatch ethernet monitoring tool</em></p>\n<p>arpwatch 是一个设计用于在 Linux 网络中去管理以太网通讯的地址解析程序。它持续监视以太网通讯并记录一个网络中的 IP 地址和 MAC 地址的变化，该变化同时也会记录一个时间戳。它也有一个功能是当一对 IP 和 MAC 地址被添加或者发生变化时，发送一封邮件给系统管理员。在一个网络中发生 ARP 攻击时，这个功能非常有用。</p>\n<p>我们可以从 <a href=\"http://linux.softpedia.com/get/System/Monitoring/arpwatch-NG-7612.shtml\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_10\">Wireshark – 网络监视工具</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/3eeac5779e89f77d55ef32a89c2f174c.jpg\"><img class=\"aligncenter size-full wp-image-113380\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/3eeac5779e89f77d55ef32a89c2f174c.jpg\" alt=\"180520x8b9tis5rsyhh89w\"></a></p>\n<p style=\"text-align: center\"><em>wireshark network monitoring tool</em></p>\n<p><a href=\"https://www.wireshark.org/\">Wireshark</a> 是一个自由的应用程序，它允许你去捕获和查看前往你的系统和从你的系统中返回的信息，它可以去深入到数据包中并查看每个包的内容 —— 以分别满足你的不同需求。它一般用于去研究协议问题和去创建和测试程序的特别情况。这个开源分析器是一个被公认的分析器商业标准，它的流行要归功于其久负盛名。</p>\n<p>最初它被叫做 Ethereal，Wireshark 有轻量化的、易于理解的界面，它能分类显示来自不同的真实系统上的协议信息。</p>\n<h1 id=\"toc_11\">结论</h1>\n<p>在这篇文章中，我们看了几个开源的网络监视工具。虽然我们从这些工具中挑选出来的认为是“最佳的”，并不意味着它们都是最适合你的需要的。例如，现在有很多的开源监视工具，比如，OpenNMS、Cacti、和 Zennos，并且，你需要去从你的个体情况考虑它们的每个工具的优势。</p>\n<p>另外，还有不同的、更适合你的需要的不开源的工具。</p>\n<p>你知道的或者使用的在 Linux 终端中的更多网络监视工具还有哪些？</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113367\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113367votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113367\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113367/", "comment_nums": 5, "create_date": "2017/12/22", "tags": "IT技术,Linux", "url_object_id": "dcf461a9dec974620d1cae3390ca0ade", "front_image_path": "full/f45742993aebb40dc85b097aeb88d163712b18e7.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "学数字设计的软件工程师该了解的时钟知识", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/14464260f3d26e25c16cf5131a6b2a95.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q4000052677\">听风</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://zipcpu.com/blog/2017/09/18/clocks-for-sw-engineers.html\">zipcpu</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>如果你有软件工程师背景，想找一份数字设计工程师的工作，那么你需要做的第一件事就是尽可能早的学习时钟概念。对很多从软件工程师转来的初级硬件设计工程师来说，时钟概念都是一件恼人的事情。如果没有时钟，他们就可以将 HDL（Hardware Description Language，硬件描述语言）转换为一种编程语言，如 $display，if 和 for 循环，如同其他的任何编程语言一样。 然而，这些初级设计师所忽视的时钟，通常是数字设计中最基础的部分。</p>\n<p>没有什么时候会比在审查初级 HDL 设计工程师第一次设计的产品的时候，所发现的问题更多。现在，我已经和几位在我参与的论坛上发表过问题的人交谈过了。而当我深入了解后，发现他们正在做的是什么时，我为他们感到很尴尬。</p>\n<p>以我遇到的一个学生为例，他不理解为什么网络上没有人重视他的高级加密标准 (AES) 的HDL实现。此处，为了不让他因为名字或项目而尴尬，我暂且将他称之为学生。（不，我不是教授。）这个“学生”创建了一个 Verilog 设计，进行不止一轮的 AES 加密，但每一轮都是组合逻辑，且两者之间没有时钟。 我不记得他是在做 AES-128、AES-192 还是 AES-256，但 AES 需要进行 10 到 14 轮计算。 我记得，他的加密引擎在模拟器中运行完美，然而它只使用一个时钟来加密或解密他的数据。 他为自己的工作感到自豪，但不明白为什么那些看过这个项目的人都对他说，他的思考方式像一个软件工程师，而不是一个硬件设计师。</p>\n<p>事实上，我现在有机会给像这个“学生”一样的 HDL 新手软件工程师解释疑惑。 他们中的许多人对待 HDL 语言，就像对象另一种软件编程语言一样。 在编程之前，他们去寻找任何软件编程语言的基础知识：如何声明变量，如何创建一个 if 语句或 case 语句，如何编写循环等等。然后，他们编写代码就像编写一个计算机程序——一切都是顺序执行（图1），而完全忽略了数字设计中的基本事实，即所有运行都是并行的。</p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fmufh5ei8wj208p0h6dfr.jpg\"></p>\n<p style=\"text-align: center;\">图1：软件执行是顺序的</p>\n<p>有时这些程序员会使用模拟器，如 Verilator，iverilog 或者 EDA 平台。 然后，他们在逻辑代码中使用一堆$ display命令，将它们视为顺序的“printf”，并通过这些命令来使代码运行，而不是使用时钟。 他们的设计在模拟器中只是被单独地“执行”组合逻辑代码。</p>\n<p>这些学生向我描述他们的设计，并解释称他们的设计“不需要时钟就能执行”。</p>\n<p>天啊，这都是什么想法？</p>\n<p>实际上，任何数字逻辑设计如果使用没有时钟都是不能工作的。总有一些物理过程会创建输入。而 这些输入必须在某个开始时间都有效 ——这个时间在其设计中形成第一个时钟刻度。 同样地，在接收这些输入一段时间后就要输出。 对于给定的一组输入，所有输出的有效时间在“无时钟”设计中形成下一个“时钟”。 或许第一个时钟刻度是当他们调整好电路板上的最后一个开关的时候，而最后一个时钟刻度是当他们读取到结果的时候。时钟是如何形成的没关系：有一个时钟就可以。</p>\n<p>而这导致的结果就是，那些声称他们的设计“没有时钟”的人解释他正在以不切实际的方式使用模拟器，或者设计中存在一个外部时钟用于设置输入和读取输出 ——而这正是另外一种方式，表明设计中的确存在一个时钟。</p>\n<p>如果你发现你自己正试图以这种方式理解数字逻辑必须有一个时钟才能执行，或你认识的某人也是这么尝试理解的，那么本文正适合你们。</p>\n<p>接下来，让我们花一两分钟来讨论时钟，以及为什么围绕时钟来构建和设计你的数字逻辑很重要。</p>\n<h2>第一部分：硬件设计是并行的</h2>\n<p>硬件设计学习中的第一部分也是最难的部分，就是硬件设计是并行设计。所有的代码指令并不是依次执行，如同一条指令连着下一条指令（如图1所示），就像计算机程序一样。相反，所有的指令在同一时刻执行，如图2所示。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh4yz9wj20hb02y0sl.jpg\"></p>\n<p style=\"text-align: center;\">图2：硬件逻辑并行运行</p>\n<p>正是这一点，让很多东西变得不一样。</p>\n<p>首先需要改变的是开发人员。你需要学习以并行的方式思考。</p>\n<p>如果要通过举例说明两者的区别，硬件循环也许会是个不错的例子。</p>\n<p>软件设计中，一个循环是由一连串的指令构成，如图3所示。这些指令构造了一组初始化条件，而真正的逻辑在循环内部执行。通过使用一个循环变量来构造和定义一个循环逻辑，并且这个变量在每次循环中通常都是增加的。计算机CPU不停地重复执行循环中的指令和逻辑，直到循环变量达到了终止条件。循环运行的次数越多，它在程序中运行的时间也就越长。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh4j5drj20c40jvt8y.jpg\"></p>\n<p style=\"text-align: center;\">图3：软件循环</p>\n<p>而基于硬件的硬件描述语言循环与软件循环完全不同。恰恰相反，HDL 合成工具使用循环来使得所有逻辑的副本同时并行运行。而用来构造循环逻辑的代码，如定义索引、索引增长、检查索引是否达到终止条件等等，是不需要合成的，通常会被移除。此外，由于合成工具正在构建物理线路和逻辑块，所以执行循环的次数在合成时间之后不能改变。之后，硬件的数量是固定的，不能再改变。</p>\n<p>导致的结果便是，硬件循环结构（如下图4所示），与软件循环结构（如上图3所示）有很大的区别。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fmufh47lvsj20d802awec.jpg\"></p>\n<p style=\"text-align: center;\">图4：HDL循环</p>\n<p>这有几个后果。例如，硬件循环迭代与软件循环迭代不同，它不必依赖前期的循环迭代的输出。这导致的结果是，运行一个包含一组数据的逻辑循环很难在下一个时钟得到响应。</p>\n<p>但是…现在让我们再次回到时钟概念。</p>\n<p>时钟是任何 FPGA 设计的核心。一切都围绕着它展开。事实上，我认为所有的逻辑设计开发都应该从时钟开始。时钟不应该在设计完成后添加， 而是在你一开始思考如何设计架构时就要考虑。</p>\n<h2>为什么时钟很重要？</h2>\n<p>第一步，你要理解数字逻辑设计的一切操作在硬件上执行时都是需要时间的。不仅如此，不同的操作需要的时间总量也是不同的。从芯片上的一部分移动到另一部分也要花费时间。</p>\n<p>或许用图表的方式能更直观的解释这一点。我们将输入置于算法的顶部，逻辑放在中间，而输出则放在底部。时间为轴，从上到下运行，从一个时钟到下一个时钟。这种视觉效果看起来就如下图 5 所示：</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh3undmj20ko0ekmy8.jpg\"></p>\n<p style=\"text-align: center;\">图5：三个操作的逻辑耗时</p>\n<p>图例 5 展示了几个不同的操作：加法、乘法、以及多轮的 AES 算法——尽管为了讨论的目的，它可以是多轮任意其它算法。我在垂直方向上使用了方框的尺寸，以表示每个操作可能需要多少时间。此外，将依赖于其它操作的方框堆叠起来。因此，如果你想要在一个时钟里面做很多轮的 AES 算法，你要明白第二轮算法在第一轮算法结束后才会开始。因此，适应这一逻辑将会增加时钟之间的时间间隔，并减慢整体的时钟频率。</p>\n<p>现在让我们关注这个粉色方框。</p>\n<p>这个粉色框表示在硬件电路中浪费的运行能力，即你本可以用来做更多事情的时间，但因为需要等待时钟，或者等待输入被处理，而导致你什么也不能做。例如，在上面的概念图中，完成乘法运算所花费的时间不需要长达一轮 AES 算法的时间，加法也是。然而，当 AES 算法正在执行时，你不能够对这两个操作结果进行任何的动作，因为这些操作都需要等待下一个时钟来获取他们的下一个输入。这就是图 5 中粉色方框所表达的：空闲电路。另外，由于每一轮 AES 算法都会推迟下一个时钟的到来，所以图 5 中存在大量的空闲电路。因此，该设计的运行速度不会像硬件允许的那么快。</p>\n<p>如果我们只使用 AES 算法，那么每一个时钟都正好完成一轮的 AES 计算。如此一来，就可以减少运行能力的浪费，从而让整个设计运行得更快。</p>\n<p>图 6 展示了这种设计思想。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fmufh3duaqj20kj08ewf8.jpg\"></p>\n<p style=\"text-align: center;\">图6：分解操作加快时钟频率</p>\n<p>由于我们将操作分解为更小的操作，每一个都能在时钟单元内完成，因此，我们提高了运行能力。甚至，我们可以通过管道加密算法，而不是一次只加密一个数据块。这种逻辑设计的结果不会比上图 5 所示的更快，但是如果可以保持管道充满，则可以提高 AES 加密吞吐量至 10-14x 之间。</p>\n<p>所以，这个设计更赞。</p>\n<p>还可以有其它更好的方案吗？当然！如果你熟悉 AES ，你就知道 AES 算法的每一轮计算中都有一些独立的步骤。这些步骤可再次分解，从而可以再次提高每轮逻辑算法的整体时钟速度。而这可以增加你能执行的加法和乘法运算的次数，以及加密引擎的微管道，以便你能在每个时钟的基础上运行更多的数据。</p>\n<p>设计不错。</p>\n<p>不过，上图 6 中还有些其它的东西。</p>\n<p>首先，箭头表示路由延迟。（这个数字不是按比例绘制的，它仅仅是这个讨论例子的示例。）每一块逻辑都需要上一块逻辑将结果传递给它。这意味着即使某个逻辑块不需要时间执行——例如，只是重新排列线路或其它等等，将逻辑块从一个芯片的末端移动到另一块也是需要花费时间的。所以，即使你将操作极简化了，每一轮数据的传递仍旧存在延迟。</p>\n<p>其次，你可能注意到，没有一个箭头的起始处在时钟刻度上，即没有一个逻辑块一直运行到下个时钟开始。这是为了演示 启动时间和维持时间的概念。触发器电路，即一种捕获数据并同步到时钟的电路结构，在下一个时钟到达前需要一定的时间，此刻数据也已经是固定和确定的。另外，尽管时钟通常被认为是瞬时的，但它从来都不是。它在不同的时刻到达芯片的不同部位。而这再次要求操作之间需要一些缓冲。</p>\n<p>通过以上讨论，我们可以得出哪些结论呢？</p>\n<ol>\n<li>逻辑实现需要花费时间。</li>\n<li>逻辑越多花费的时间也越多。</li>\n<li>完成两个时钟刻度之间的逻辑所花费的时间总和（包含例行的延迟、启动和维持时间、时钟不确定性等），限制了时钟速度。时钟之间的逻辑处理越多，时钟速率就越慢。</li>\n<li>完成最慢操作所需的时钟速度，限制了最快操作的速度。正如上述例子中的加法操作。它的执行速度本可以比乘法以及任何一轮单独的 AES 算法都更快，但它的速度在该设计中被其余的逻辑拖慢了。</li>\n<li>硬件定义也会限制时钟速度。即使操作中不包含任何的逻辑，也是需要花费时间的。</li>\n</ol>\n<p>因此，平衡的设计尝试在整个设计中将大量相同的逻辑放在时钟之间。</p>\n<h2>时钟之间应该放多少逻辑量？</h2>\n<p>现在你已经知道你必须处理时钟，那么根据上述信息你该怎么修改和构思你的设计？答案是限制时钟之间的逻辑数量。但问题是，这个数量是多少呢？你又该如何得到这个数量呢？</p>\n<p>得出时钟之间你能放置多少逻辑数量的一个方法便是，将时钟速度设置为任意速度，然后在与你需要的硬件配套的工具套件中构建你的设计。无论何时，当你的设计无法满足其计时需求时，都需要返回并拆分设计中的组件，或减慢时钟速度。通过使用设计工具，你最终能够找到那条最长的路径。</p>\n<p>如果你这样做了，你将自学到一些探索方法，然后通过使用这些方法，就可以找到在运行的硬件的时钟之间可以放置的具体逻辑数量。</p>\n<p>例如，我倾向于在 Xilinx 7 系列零件中进行 100MHz 时钟速率的设计。这些设计通常运行在大约 80MHz 速率的Spartan-6 上，或者50MHz的 iCE40上——尽管这些都不是硬性关系。把在一个芯片上正常执行的程序放在另一个上执行，可能会超载，亦可能会时钟检查失败。</p>\n<p>下面有一些我曾经在使用时钟时得到的一些粗略的探索性经验。由于只是个人经验，这些方法并不适合所有的设计：</p>\n<p>1.通常，我在设计一个32 位的加法时，会使用一个时钟内有 4-8个条目的多路复用器。</p>\n<p style=\"padding-left: 30px;\">如果要使用一个较快的时钟，例如频率为 200 MHz，可能就需要将加法操作从多路复用器上剥离下来。</p>\n<p style=\"padding-left: 30px;\">ZipCPU 的最长路径，实际上是从 ALU 的输出到 ALU 的输入。</p>\n<p style=\"padding-left: 30px;\">这听起来很简单。它甚至符合前面的经验法则。</p>\n<p style=\"padding-left: 30px;\">但 ZipCPU 的问题在于，如何在较快的速度下将输出路由回输入。</p>\n<p style=\"padding-left: 30px;\">让我们跟踪一下这个路径：跟随 ALU，逻辑路径首先通过一个4路多路复用器来决定是否ALU，内存或分频输出需要回写。 然后将该回写结果馈送到旁路电路中，以确定是否需要将其立即传入 ALU 作为其两个输入之一。 只有在该多路复用器末端并且旁路路径执行 ALU 操作时，多路复用器才会产生。 因此，所有这些逻辑步骤都会在通过 ALU 时造成压力。 然而，由于ZipCPU的设计结构，任何在此路线的时钟都可能会按比例减缓 ZipCPU 运行速度。 这意味着有可能这条最长线路仍然是 ZipCPU 中最长的一段线路。</p>\n<p style=\"padding-left: 30px;\">我曾经对以更高的速度运行 ZipCPU 感兴趣，这是我尝试分解和优化的第一个逻辑路径。</p>\n<p>2.16×16位乘法器需要一个时钟。</p>\n<p style=\"padding-left: 30px;\">有时，在某些硬件上，我可以在一个时钟上运行 32×32 位的乘法。而在其他硬件上，我需要分解这个操作。 因此，如果我需要一个签名的 32×32 位乘法，我使用我专门为此建立的流水线例程。 该例程包含其中的几种乘法方法，允许我从适合我目前正在工作的硬件的选项中进行选择。</p>\n<p style=\"padding-left: 30px;\">你的硬件可能也还支持 18×18 位乘法。 一些 FPGA 还支持在一个优化的硬件时钟内进行乘法和累加。只要你对使用的硬件足够熟悉，你就知道你能用它做什么。</p>\n<p>3. 访问任何 RAM 块都需要一个时钟。 如果可以的话，应尽量避免在该时钟周期调整索引。 同样，避免在此时钟期间做任何有关输出的事情。</p>\n<p style=\"padding-left: 30px;\">尽管我认为这是一条很好的规则，但我已经在 100MHz 的 Xilinx 7 系列设备上违反了其中的两个部分，而没有产生（严重的）影响。 （在 iCE40 设备上有问题。）</p>\n<p style=\"padding-left: 30px;\">例如，ZipCPU 从寄存器读取数据，给结果加上一个即时数，然后从结果中选择是否应该在寄存器、PC上，还是条件代码寄存器中加上即时数——都在一个时钟内。</p>\n<p style=\"padding-left: 30px;\">另外一个例子就是，长期以来 Wishbone Scope 根据当前时钟是否从存储器进行读取，确定从缓冲区内读取的地址。 从这个依赖中断它，需要添加另一个延迟时钟，所以当前版本不会再破坏这个（自我强加的）规则。</p>\n<p>这些规则只是我随着时间积累下来的方法经验，用来判定单个时钟内可容纳的逻辑数量。 这些经验法则与设备和时钟速度有关，因此它们可能不适用于你的设计开发。 我建议你积累自己的探索经验，以便你知道在时钟周期之间能做些什么。</p>\n<h2>下一步</h2>\n<p>也许我能够提供给任何新的 FPGA 开发人员的最后建议，就是学习 HDL 时要在实际硬件上进行练习，而不仅仅是在模拟器上。与实际硬件组件相关联的工具，其在检查代码和计算所需时间方面都很出色。 此外，以高速时钟构建设计的想法是好的，但这不是硬件设计的最终结果。</p>\n<p>记住，硬件设计是并行的。 一切都从时钟开始。</p>\n<p>最后，如果本文有助于你更好地了解HDL，或者它让你更加困惑了，请随时联系告诉我。 这会让我知道，我将来是否有必要再次回来讨论这个话题。 谢谢！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113215\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113215votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113215\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">听风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/9538B04AD8C6883F49C38BC8ECDDAF3C/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q4000052677\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q4000052677/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 24</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113215/", "comment_nums": 2, "create_date": "2017/12/26", "tags": "开发", "url_object_id": "fda34f2acb731c915e85fe9c4c5dfeaa", "front_image_path": "full/3ad3595dc6e1f0ece9e8f816eeaeb9839f24a7ad.jpg"}
{"fav_nums": 1, "praise_nums": "2", "title": "面试软件工程师，这些准备工作你做了吗？", "front_image_url": ["http://ww1.sinaimg.cn/mw690/7cc829d3gw1f3wgmive0tj218g0p1gun.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://codeburst.io/the-2-types-of-software-engineering-interviews-and-how-to-prepare-for-them-2e7bd4daa0bhttps://codeburst.io/the-2-types-of-software-engineering-interviews-and-how-to-prepare-for-them-2e7bd4daa0b\">Connor Leech</a>   译文出处：<a target=\"_blank\" href=\"http://36kr.com/p/5107412.html\">36氪</a>   </div><p>本文作者 Connor Leech 是在湾区工作的一名 Web 开发人员，他在本文中面向那些正寻求找到一个软件工程师岗位的求职者，探讨了他们在面试环节可以采取的准备工作。虽然各个公司对于评估人才有自己不同的标准，但软件工程岗位面试大致可分为两类：特定领域知识面试和计算机科学基础知识面试。求职者了解公司评估方式之后，也就可以有的放矢，分别采取相应的准备策略。</p>\n<p><img class=\"alignnone\" src=\"http://ww1.sinaimg.cn/mw690/7cc829d3gw1f3wgmive0tj218g0p1gun.jpg\" width=\"690\" height=\"389\"></p>\n<hr>\n<p>作为一名软件工程师，能否通过技术面试对于自己的职业发展至关重要，但是求职者往往很难知道具体怎样去为面试做准备。因为不同的软件公司采用不同的方式对工程师进行评估，而在这种压力很大、同时又很重要的场合，毫无防备的前去面试似乎是最糟糕的一种状态。</p>\n<p>幸运的一点是，这些技术面试通常可以分为两大类：特定领域知识面试和计算机科学基础知识面试。对于想走上软件工程师职业发展道路的求职者来说，了解这些评估人才的不同方法是很重要的一点，从而可以在他们最需要改进的地方采取措施进行进一步的提升。本篇文章介绍了每种面试类型可能出现的问题，以及你可以采取的准备措施。</p>\n<p><strong>特定领域知识面试</strong></p>\n<p>特定领域知识面试通常涉及到你最熟悉的技术领域的具体知识点。例如，如果你主要使用 Angular 1.x 进行前端开发，并且面试公司又有 Angular 前端，那他们就可能问你关于 Angular 控制器、指令和服务的相关内容。也就是说，你需要做好准备去建立、展示和讨论 Angular。</p>\n<p>特定领域的面试重点关注的是你已经实际构建起来的东西，因此要想顺利通过这些面试，最好是你已经构建过相关技术的项目。你应该为自己的工作而感到自豪，不必感觉不好意思，而应该深入探讨具体项目的技术细节。项目最好是近阶段完成的，没人会愿意去听你去年写的那些代码，你自己也会对这种陈旧的项目感觉厌倦，面试效果也欠佳。</p>\n<p>特定领域面试的另一个常见策略是看求职者能否构建一些非常棒的产品或者是排除实际存在的一些问题和故障。这通常是让求职者带回家去完成的一种测试，求职者一般有 24-48 个小时的时间来完成这些测试。例如，如果你是一名 Laravel 开发人员，并且你面试的公司恰好也使用 Laravel，那他们可能会要求你构建公司产品或者是公司定期创建的产品的微缩版本。对于这种带回家做的测试，做好投入大量工作的心理准备。准备好启动模板，不要抗拒去 Google 搜索答案，发送电子邮件寻求帮助和使用外部工具包这些做法。因为能否通过特定领域面试最重要的一个衡量标准是你能否构建出有效的产品。</p>\n<p><strong>计算机科学基础知识面试</strong></p>\n<p>计算机科学和基础编程面试明显不同于上文所探讨的特定领域面试。计算机科学和基础编程面试是为了评估你解决问题的能力，更多的是关注找到最佳解决方案的能力，而不是简单的去完成某些特定任务。因此，面试官通常也不会问关于你是谁、你过去的工作经历或者你构建过的项目方面的问题。对于计算机科学基础面试这一类型来说，面试官的工作就是评估你的原始编程能力，通常他们是通过数据结构和算法相关的问题来进行评估。</p>\n<p>计算机科学基础面试的问题有章法可循。因为学习数据结构和算法需要大量的准备工作和长时间的学习，你需要了解你所选择的编程语言、数据结构和算法来解决问题。计算机科学基础知识面试通常可以用六种不同类型的算法来解决：</p>\n<ul>\n<li>深度优先搜索算法/广度优先搜索算法</li>\n<li>贪心算法</li>\n<li>滑动窗口算法</li>\n<li>分治算法</li>\n<li>递归算法</li>\n<li>动态规划算法</li>\n</ul>\n<p>你需要研究每一种算法，可以在 Pramp 上与其他软件工程师一起练习面试和面试问题。应对面试是一门独立于软件工程师之外的技能，你可以通过练习和重复来提升自己在面试时的表现。</p>\n<p>计算机科学基础知识面试通常遵循的那些问题结构对于求职者来说只有通过几个小时的练习和准备才能发现。即便这些知识中的一部分并不适用于日常的编程任务，但只要你坚持这样做，你就能抓住更多的面试机会，就能收到更多公司发来的 offer。如果你的目标是获得更多的工作机会，那你一定要看一下《Cracking The Coding Interview》这本书，并且查看<a href=\"https://github.com/connor11528/coding-interviews\" target=\"_self\">这一免费的面试资源</a>来进行相应的准备工作。</p>\n<p><strong>哪种方法适合你？</strong></p>\n<p>作为一名正在寻找工作的软件工程师来说，在构建产品、学习新工具和练习面试之间存在着一定程度的相互冲突。选择关注哪一点其实取决于你所寻找的工作类型，如果你想进入 Google、Twitch、亚马逊、Uber 或 Square 等大型知名科技公司工作，那你基础知识一定要过关。在这样的情况下，你是否构建过最好、最复杂的产品其实并不重要，如果你无法通过计算机科学基础知识面试，那这些大型科技公司是绝对不会雇用你的。</p>\n<p>相比较而言，小型初创企业通常是在与时间赛跑，他们会争取快速的构建出产品、推出产品并且推向市场。因此，这些公司通常会实行特定领域面试方式，因为他们希望了解捏可以构建什么样的产品，你最拿手的技术又是什么。</p>\n<p><strong>如何了解公司面试类型</strong></p>\n<p>在进行公司面试时，与你对接的招聘人员或者公司联系人就是你最好的朋友。你可以直接向他们询问关于公司的招聘流程以及他们用于评估候选人的标准等方面的问题。对于求职者来说，了解公司在招岗位的信息是非常重要的一点，因此他们需要主动提出这方面的问题并且仔细研究招聘职位描述信息。软件工程岗位招聘通常有好几个环节，可能包括电话面试、共享桌面远程面试和现场面试环节。</p>\n<p>如果面试环节包括共享桌面远程面试这一环节，那最有可能考察的是求职者的计算机科学基础知识。他们会提供给求职者一个需要解决的问题，面试官会在这个过程中观察求职者的操作，求职者也可以解释自己的想法。</p>\n<p>带回家做的项目通常考察的是特定领域的具体知识，这在一些机构和初创企业的招聘中比较常见，求职者需要在 24-48 小时内有所成就，之后再对你的代码进行展示。</p>\n<p>普通的电话面试通常了解的是求职者的态度，进行相应的沟通并了解一些背景信息、招聘人员很难通过这已通电话获得有关你能力方面的信息。</p>\n<p>现场面试可以涵盖任何问题，但通常是整个面试过程的最后一个环节。所以到这一环节，你应该是对你面前的这个机遇以及求职公司所用的评估方式有了一个清晰的认识。</p>\n<p>想了解各个公司使用的是哪种类型的面试，你可以通过浏览 Glassdoor、Angel.co 上的评论或者是通过 Linkedin 联系公司当前员工的方式来获知。</p>\n<p><strong>小结</strong></p>\n<p>求职者可以通过与求职公司的招聘人员和联系人员交谈，来了解大致的面试过程。如果你不熟悉数据结构和算法，可以通过 Pramp 进行练习。做好心理准备，你可能需要细数你过去的工作经历和你已经构建而成的软件。要想在软件工程领域找到一份新工作，构建过令人惊叹的产品与了解计算机课科学基础知识这两方面同等重要。</p>\n<p>“你越是不自信，就越是需要认真地采取行动。” – Tara Ploughman</p>\n<p>记住这一点，并不只是公司在面试你，同时你也在面试这个公司。面试过程中你需要去处理的问题和工作往往与你被聘用之后，在这个岗位上需要去完成的工作类似。所以，你需要思考这样几个问题：他们为你安排的挑战是你所喜欢的工作类型吗？这个公司的人好吗？他们尊重你的时间和能力吗？如果这些问题的答案都是否定的，那你可以考虑寻找别的工作机会了。了解自己的长处和短处，并且享受这个找工作的过程。面试是一个很好的认识人的方式，也可是一种学习到新技术并且了解自己需求的途径。</p>\n<p>失败和被拒本来就是生活的一部分，所以在任何时候，都要保持积极的心态，努力争取那些你所能控制的部分，对于超出自己控制的部分不要去过多的理会。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112148\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112148votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112148\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/112148/", "comment_nums": 4, "create_date": "2017/12/16", "tags": "职场,技术面试", "url_object_id": "2f993346404e0e00f4ebfc3ce3334962", "front_image_path": "full/bd771b06968108ecbf8c58a5a55983c0915a35f5.jpg"}
{"fav_nums": 10, "praise_nums": "2", "title": "日志的艺术（The art of logging）", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/e35c32748c5bfe52651ccc7d9338d0da.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xybaby/p/7954610.html\">xybaby</a>   </div><p>程序员学习每一门语言都是从打印“hello world”开始的，日志也是新手程序员学习、调试程序的一大利器。当项目上线之后，也会有各种各样的日志，比如记录用户的行为、服务器的状态、异常情况等等。打印日志似乎是一件很简单、不值得一提的事情。但是，当看到线上项目居然有这样的日志的时候，不禁想问问我们真的会打印日志吗？</p>\n<blockquote><p>***********************************</p>\n<p>Error Happened, F*ck</p>\n<p>User xxx can not login</p></blockquote>\n<p>在我看来，打印日志是一门艺术，而且长期被程序员所忽视，本文尝试回答以下几个问题，分享我对打印日志的一些思考：</p>\n<p>(1) why or when to log</p>\n<p>(2) what to log</p>\n<p>(3) how to log and tips</p>\n<p>注意：本文中会用<strong>“打印”</strong>日志来统一表示日志的输出，但不是我们狭义理解的输出到终端或者stdout、stderr， 而是泛指将日志内容输出到任何目标，包括但不限于终端、文件、网络传输。</p>\n<h1>why or when to log</h1>\n<p>为什么时候要打印日志，或者什么时候打印日志，在我看来是同一个问题，那就是打印日志的目的。不同的目的，决定了日志内容的格式，输出的频度，输出的目的地。那可能有哪些打印日志的原因？</p>\n<p>（1）调试开发</p>\n<p>目的是开发期调试程序使用，这种日志量比较大，且没有什么实质性的意义，只应该出现在开发期，而不应该在项目上线之后输出。如何控制这种类型的日志是否输出，后面也会详细讨论。</p>\n<p>（2）用户行为日志</p>\n<p>这种类型的日志，记录用户的操作行为，用于大数据分析，比如监控、风控、推荐等等。这种日志，一般是给其他团队分析使用，而且可能是多个团队，因此一般会有一定的格式要求，开发者应该按照这个格式来记录，便于其他团队的使用。当然，要记录哪些行为、操作，一般也是约定好的，因此，开发者主要是执行的角色。</p>\n<p>（3）程序运行日志</p>\n<p>记录程序的运行状况，特别是非预期的行为、异常情况，这种日志，主要是给开发、维护人员使用。什么时候记录，记录什么内容，完全取决于开发人员，开发者具有高度自主性。本文讨论的主要也是指这种类型的日志，因为作为一个服务端开发、运维人员，程序运行日志往往是解决线上问题的救命稻草。</p>\n<p>（4）记录系统或者机器的状态</p>\n<p>比如网络请求、系统CPU、内存、IO使用情况等等，这种日志主要是给运维人员使用，生成各种更直观的展现形式，在系统出问题的时候报警。</p>\n<h1>what to log</h1>\n<p>一条日志要包含哪些内容，我觉的应该包含 when、where、how、what、who、context，具体含义会在下面一个小节介绍。</p>\n<p>我们要记录日志，总是要在某个时机，比如用户的某个请求、某个网络调用、或者内部状态发生了改变。在后文中，统称为事件（event），即日志内容是对某个事件的描述。</p>\n<h2>when: the time event happens</h2>\n<p>when，就是我们打印日志的时间（时间戳），注意这里的时间指的是日志记录的事件的发生时间，而不是日志被最终输出的时间。比如如果日志的输出目标是文件，那么这里的when不是写入到文件的时间，因为往往有延迟。</p>\n<p>时间的重要性，在《<a href=\"http://book.mixu.net/distsys/time.html\" target=\"_blank\">Distributed systems for fun and profit</a>》中有很好的讲述。</p>\n<p>首先，时间可以被解读（Interpretaion）成具体的、现实的日期，让我们可以知道事件发生时的时间环境，比如出问题的时候是不是有什么活动、结合系统日志分析当时服务器的网络、CPU、IO是怎么样。具体的时间点也可以帮助我们分析事件的发生是不是存在某种规律，比如是不是每天、每周、每月的固定时间点都会出问题。</p>\n<p>其次，时间可以表示一个（一组）事件的持续时间（duration）。比如，可以监控处一段代码的执行时间，也可以记录一个网络请求的耗时。这个时间差也能给出我们很多信息，比如根据经验预判当时程序的运行状态，是否比较‘卡’。</p>\n<p>最后，时间代表了事件发生的顺序（order），我们将多个日志按照时间排序，这个顺序能帮助我们debug到底问题是怎么产生的，是按照什么样的时序。这对于多进程（多线程）、异步、分布式程序而言非常重要。虽然我们知道在分布式系统维护全局的时间（global clock）是很复杂的一件事情，但我们使用NTP协议，基本上能解决大部分的问题。</p>\n<h2>where: where the event happens</h2>\n<p>where，就是指日志是在哪里的被记录的，本质上来说，是事件的产生地点。根据情况，可以具体到是哪个模块、哪个文件，甚至是哪一个函数、哪一行代码。实践告知，至少应该包含模块信息。</p>\n<p>where的意义在于能够让自己或者其他程序员一眼就看出这条日志是在哪里产生的，这样就能大致定位问题处在哪里，而不用从日志内容全局grep代码</p>\n<h2>how：how importance of the event</h2>\n<p>how important，代表了事件的重要性，我们会打印很多各种类型的日志，但是不同的日志的重要性是不一样的。比如，调试日志是最不重要的，是不应该出现在线上项目的，但是程序运行报错日志却需要认真对待，因为代表程序已经出现了异常。即使是程序的报错日志，也有不同的紧急程度，一次网络请求超时跟子进程异常退出份量完全不一样。</p>\n<p>因此，每一条日志都应该有log level，log level代表了日志的重要性、紧急程度。不同的语言、框架的level细分有一定的差异，但都会包括debug，info，warn，error，fatal（critical）。其重要程度从名字就可以看出。</p>\n<p>当然，有时候，warn与error，或者error与fatal之间的界限不那么明显，这个需要在团队之间达成共识。在我们的线上项目，对于error、fatal级别的日志都会报警，如果出现了error日志，那么最迟需要第二天去处理，如果是fatal日志，即使是在大半夜，也得立刻起来分析、处理。</p>\n<h2>what：what is the log message</h2>\n<p>what是日志的主体内容，应该简明扼要的描述发生的什么事情。要求可以通过日志本身，而不是重新阅读产生日志的代码，来大致搞清楚发生了什么事情。所以，下面这个日志是不合格的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6919e254878932723265\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    if not valid_username(username):\r\n        logger.warn('Error Happened')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6919e254878932723265-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254878932723265-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254878932723265-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254878932723265-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254878932723265-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6919e254878932723265-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254878932723265-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_username</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254878932723265-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Error Happened'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254878932723265-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254878932723265-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>是的，我知道，出了问题了，但是日志应该告诉我出了什么问题，所以日志至少应该是这样的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6919e254883087926057\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    if not valid_username(username):\r\n        logger.warn('user_login failed due to unvalid_username')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6919e254883087926057-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254883087926057-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254883087926057-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254883087926057-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254883087926057-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6919e254883087926057-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254883087926057-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_username</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254883087926057-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to unvalid_username'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254883087926057-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254883087926057-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<h2>who：the uniq identify</h2>\n<p>who代表了事件产生者的唯一标识（identity），用于区分同样的事件。特别是在服务器端，都是大量用户、请求的并发，如果日志内容不包含唯一标识信息，那么这条日志就会淹没在茫茫大海中，比如下面这条日志：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6919e254887523257592\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6919e254887523257592-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254887523257592-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254887523257592-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254887523257592-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254887523257592-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254887523257592-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6919e254887523257592-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254887523257592-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254887523257592-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254887523257592-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254887523257592-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254887523257592-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>上面的代码给出了出了什么问题，但是没有包含是谁出了问题，至少应该是</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6919e25488b575190260\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password, username %s', username)\r\n        return</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6919e25488b575190260-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25488b575190260-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e25488b575190260-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25488b575190260-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e25488b575190260-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6919e25488b575190260-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25488b575190260-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e25488b575190260-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25488b575190260-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password, username %s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e25488b575190260-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>日志的唯一标识也能帮助我们检索、过滤，找出该唯一标识的最近一段时间的所有日志，再按照时间排序，就能还原日志主体的活动轨迹，比如一个用户在网站上的操作会发散到多个进程、服务。当通过用户名（用户的唯一标识）搜索日志时，就能还原该玩家的操作记录，这个在查线上问题的时候非常有效。</p>\n<p>当然，这个唯一标识是很广泛的，需要根据具体情况决定，如果网络请求，可能更好的是requestid、sessionid；如果是系统日志，那么可能是进程、线程ID；如果是分布式集群，那么可能是副本的唯一id</p>\n<h2>context: environment when event happens</h2>\n<p>日志记录的事件发生的上下文环境直观重要，能告知事件是在什么样的情况发生的。当然，上面提到的when、where、who都属于上下文，这些都是固定的，通用的。而在本小节，context专指高度依赖于具体的日志内容的信息，这些信息，是用于定位问题的具体原因。比如</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6919e25488f338583023\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password, username %s', username)\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6919e25488f338583023-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25488f338583023-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e25488f338583023-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25488f338583023-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e25488f338583023-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25488f338583023-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6919e25488f338583023-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25488f338583023-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e25488f338583023-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25488f338583023-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password, username %s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e25488f338583023-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25488f338583023-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>阅读代码，当password不符合规范，或者校验password失败的时候都会出错，但是到底是那种情况呢，日志内容并没有指出，所以这条日志仍然不合格。</p>\n<p>在我看来，这部分是弹性最大，但是又最重要的部分，造成异常的情况很多，记录哪些信息，完全取决于写代码的程序员。但事实上也很简单，遵循一个原则即可：<strong>想想加上哪些信息能定位问题发生的原因</strong>！</p>\n<h1>how to log and tips</h1>\n<h2>use logging framework</h2>\n<p>早期的编程语言提供的日志功能都比较初级，一般都是输出到终端或者文件，如C++、Java，而且不支持统一的输出格式的配置。对于这些语言，一般会有单独的log框架，如glog，log4cpp，log4j，elf4j等等。而更新的一些语言，一般都内置强大的logging模块，如python。</p>\n<p>在前面在讲述“what to log”的时候，我们指出要记录日志发生的时间、地点、等级等信息。那么这些信息是不是每次都在日志内容里面打印呢，这些内容确实是一条完整的日志所必须的，但是如果要程序员写每条日志的时候都得手动加上这些内容，那么无疑是一种负担。框架、模块的作用就是将程序员从这些繁文缛节中解放出来。比如在很多logging框架模块（thon logging、log4j）中，都有named logger这一概念，这个name就可以是module， filename， classname或者instance，这就解决了上一章节提到了“where the event happen”这个问题。</p>\n<p>在这里，对logging框架的介绍就不详细展开，只是总结一下logging框架、模块的功能</p>\n<p>（1）设置log的输出等级</p>\n<p>这样可以不改程序代码，仅仅修改log的输出等级，就能够控制哪些日志输出，哪些日志不输出。比如我们在开发期的调试日志，都可以设置为DEBUG，上线的时候设置输出等级为INFO，那么这些调试日志就不会被输出。</p>\n<p>（2）设置每条日志默认包含的内容</p>\n<p>以<a href=\"https://docs.python.org/2/library/logging.html#logrecord-attributes\" target=\"_blank\">Python logging</a>为例，可以通过formatter设置每条日志默认包含哪些信息，比如时间、文件、行号、进程、线程信息。</p>\n<p>（3）设置日志的输出目标</p>\n<p>通过配置，可以指定日志是输出到stdout，还是文件，还是网络。特别是在linux服务器上，将日志输出到syslog，再使用syslog强大的处理、分发功能，配合elk系统进行分析，是很多应用程序的通用做法。</p>\n<h2>log never throw</h2>\n<p>我们打印日志，是为了记录事故发生的现场，以便发现问题，解决问题。那么就得保证，打印日志这一行为本身不能引入新的问题，比如，不能出错抛异常。这就好比，处理车祸的消防车不能冲进现场一样。</p>\n<p>但是，越重要的日志，比如Error、 Fatal级别的日志，出现的概率应该是越低的，我们也不希望产生这样的日志，因为一旦出现就意味着异常或者线上事故。这样的日志，就一定要做好单元测试、覆盖率测试，保证日志本身是能够正常工作的。</p>\n<h2>log when u think something never happen</h2>\n<p>这一点，应该是针对why or when to log而言。就是说，当你认为某种情况一定不会发生，按照墨菲定律，它还是很可能会发生，那么就应该在万一发生的情况记录log，Error（Fatal）级别的log。尤其是在异步，并发的情况下，程序员任务的不可能都会成为可能。</p>\n<p>比如下面的伪代码</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6919e254894458756532\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef magic_func():\r\n    if check_ok():\r\n        do_something()\r\n\r\n    return</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6919e254894458756532-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254894458756532-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254894458756532-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254894458756532-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254894458756532-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6919e254894458756532-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">magic_func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254894458756532-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_ok</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254894458756532-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">do_something</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254894458756532-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6919e254894458756532-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>代码很简单，如果条件满足，那么就做相应处理，否则直接返回。这里有两种可能，第一种是条件不满足是可能的、可预期的情况，只是说，在这种情况下什么都不用作；第二种情况是程序员觉得条件一定会满足，一定不会出现else的情况，所以什么都没做。如果是第二种情况，那么就一定得加日志，因为一切都可能发生。</p>\n<h2>lazy logging</h2>\n<p>日志的内容，在最终输出的时候，应该是一个字符串，那么这个字符串是什么时候产生呢？前面提到，我们可以通过log level来控制一条日志是否被输出，那么字符串的生成越迟越好，因为有可能日志根本就无需输出，也就无需生成这个字符串，这也是我之前提到过的<a href=\"https://www.cnblogs.com/xybaby/p/6425735.html\" target=\"_blank\">lazy思想</a>。</p>\n<p>至于lazy logging，各个语言、框架都是大同小异的，在<a href=\"https://garygregory.wordpress.com/2015/10/08/the-art-of-logging-advanced-message-formatting/\" target=\"_blank\">这篇文章</a>中，举出了log4j的例子，在这里还是用我比较熟悉的python讲解这个例子</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6919e254899348922108\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#coding=utf-8\r\nimport logging\r\n\r\nlogger = logging.getLogger('LazyLogging')\r\nlogger.setLevel(logging.DEBUG)\r\nhander = logging.StreamHandler()\r\nformatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s') \r\nhander.setFormatter(formatter)  \r\nlogger.addHandler(hander)\r\n\r\ndef getUserCount():\r\n    logger.info('getUserCount is called')\r\n    return 1\r\n\r\nlogger.debug(\"There are \" + str(getUserCount()) + \" users logged in now.\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6919e254899348922108-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254899348922108-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254899348922108-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254899348922108-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254899348922108-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254899348922108-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254899348922108-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254899348922108-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254899348922108-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254899348922108-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254899348922108-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254899348922108-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254899348922108-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e254899348922108-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e254899348922108-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6919e254899348922108-1\"><span class=\"crayon-p\">#coding=utf-8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254899348922108-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">logging</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254899348922108-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254899348922108-4\"><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'LazyLogging'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254899348922108-5\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setLevel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254899348922108-6\"><span class=\"crayon-v\">hander</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StreamHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254899348922108-7\"><span class=\"crayon-v\">formatter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Formatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254899348922108-8\"><span class=\"crayon-v\">hander</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFormatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">formatter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254899348922108-9\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hander</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254899348922108-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6919e254899348922108-11\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getUserCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254899348922108-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'getUserCount is called'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e254899348922108-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e254899348922108-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6919e254899348922108-15\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"There are \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getUserCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" users logged in now.\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n\n</div>\n<p>上面的代码可谓麻雀虽小五脏俱全，包含了使用logging框架的方方面面。第4行是named logger，第5行设置log level，第6行指定输出目标，第7行指定输出格式（包括时间，logger name，log level，具体的日志内容）。</p>\n<p>运行结果如下：</p>\n<blockquote><p>2017-12-02 17:52:20,049 – LazyLogging – DEBUG – getUserCount is called<br>\n2017-12-02 17:52:20,049 – LazyLogging – INFO – There are 1 users logged in now.</p></blockquote>\n<p>由于当前的log level是DEBUG，那么第15行的日志会输出，这是正常的。</p>\n<p>但是将log level改成INFO，<em>“getUserCount is called”</em>这条日志仍然会被输出。这就暴露出两个问题，第一，即使日志内容最终不会被输出，仍然会生成一个字符串；第二，一定会调用getUserCount 这个函数，而如果根据log lebel不需要输出日志，这两步都是没有必要的</p>\n<p>要解决第一个问题很简单，将第15行改成</p>\n<blockquote><p>logger.debug(“There are %s users logged in now.”, getUserCount())</p></blockquote>\n<p>即可，但是<em>“getUserCount is called”</em>这条日志仍然会被输出，即第二个问题仍然没有解决</p>\n<p>按照stackoverflow上的<a href=\"https://stackoverflow.com/questions/4148790/lazy-logger-message-string-evaluation\" target=\"_blank\">这篇文章</a>，也是可以解决第二个问题的，方案如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6919e25489d815004404\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass lazyEval:\r\n    def __init__(self, f, *args):\r\n        self.func = f\r\n        self.args = args\r\n\r\n    def __str__(self):\r\n        return str(self.func(*self.args))\r\n\r\nlogger.debug(\"There are %s users logged in now.\", lazyEval(getUserCount))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6919e25489d815004404-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25489d815004404-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e25489d815004404-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25489d815004404-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e25489d815004404-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25489d815004404-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e25489d815004404-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6919e25489d815004404-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6919e25489d815004404-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6919e25489d815004404-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lazyEval</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25489d815004404-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e25489d815004404-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25489d815004404-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e25489d815004404-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25489d815004404-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__str__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6919e25489d815004404-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6919e25489d815004404-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6919e25489d815004404-9\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"There are %s users logged in now.\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lazyEval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">getUserCount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>在log lever为INFO的时候，可以发现<em>“getUserCount is called”</em>也不会被输出了，即不会调用getUserCount函数，做到了真正的lazy logging。</p>\n<p>但是，这是非常不好的写法！除非你们保证所调用的函数是没有副作用的（side－effect），即函数的调用无状态，不会改变程序的状态，否则程序的状态居然会依赖于log level，这是一个陷阱，一个坑，一点都不pythonic。</p>\n<h2>consider async logging</h2>\n<p>日志的记录也是要消耗时间的，这也是我们不能到处打印日志的原因。一般来说，logging框架的效率都是比较高的，但是如果profile发现日志的输出确实带来了不容忽视的消耗，那么也是值得优化的，其中的一个方法就是异步log，以避免日志输出阻塞线程</p>\n<h1>conclusion</h1>\n<p>在网上看到这么一句话</p>\n<blockquote><p>Logs are like car insurance. Nobody wants to pay for it, but when something goes wrong everyone wants the best available</p></blockquote>\n<p>log就像车辆保险，没人愿意为保险付钱，但是一旦出了问题谁都又想有保险可用。</p>\n<p>我们打印日志的时候都很随意，于是在差bug的时候，就会骂别人、或者几天前的自己：SB！</p>\n<p>从今天起，写好每一条日志吧，与君共勉！</p>\n<h1>参考</h1>\n<ul>\n<li><a href=\"http://book.mixu.net/distsys/time.html\" target=\"_blank\">Distributed systems for fun and profit</a></li>\n<li><a href=\"https://docs.python.org/2/library/logging.html#logrecord-attributes\" target=\"_blank\">python logging#logrecord-attributes</a></li>\n<li><a href=\"https://garygregory.wordpress.com/2015/10/08/the-art-of-logging-advanced-message-formatting/\" target=\"_blank\">the-art-of-logging-advanced-message-formatting</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113413\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113413votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113413\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 10 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113413/", "comment_nums": 3, "create_date": "2018/01/02", "tags": "IT技术,logging,日志", "url_object_id": "ca3846b5e25e9357415c9c823f73b25b", "front_image_path": "full/456ebee8cee612d98b57ddd51097ea8c6f411717.jpg"}
{"fav_nums": 3, "praise_nums": "2", "title": "搭建Keepalived + Nginx + Tomcat的高可用负载均衡架构", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/feinik/blog/1590941\">FEINIK</a>   </div><h1 id=\"h1_0\">1 概述</h1>\n<p>初期的互联网企业由于业务量较小，所以一般单机部署，实现单点访问即可满足业务的需求，这也是最简单的部署方式，但是随着业务的不断扩大，系统的访问量逐渐的上升，单机部署的模式已无法承载现有的业务量，需要进行服务集群化部署，本文主要介绍服务端Tomcat多实例部署，以及如何保证web服务的高可用方案。</p>\n<ul>\n<li>Nginx 是一个高性能的 HTTP反向代理服务器</li>\n<li>Keepalived 是一个基于VRRP协议来实现的LVS服务高可用方案，可以利用其来避免服务的单点故障</li>\n<li>Tomcat 是一个免费的开放源代码的Web 应用服务器，属于轻量级应用服务器。</li>\n</ul>\n<h1 id=\"h1_1\">2 Nginx的高可用负载均衡架构</h1>\n<p>如下图：为典型的Tomcat服务多实例部署的架构图</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fml0ntgngoj20f70evmxu.jpg\" width=\"547\" height=\"535\"></p>\n<p>（1）用户通过域名请求到DNS，由DNS解析域名后返回对应的IP地址，该IP及为Keepalived映射服务器的虚拟IP</p>\n<p>（2）通过该虚拟IP访问到对应的负载均衡器（Nginx），这里Nginx部署两个，然后通过Keepalived来保证NG的高可用，正常情况下由Keepalived-M将虚拟IP映射转发至Nginx-M，如果Nginx-M出现故障，此时Keepalived会切换至Keepalived-S开始工作，从而保证了NG的单点故障问题。</p>\n<p>（3）通过Nginx负载均衡器，将请求路由到对应的Tomcat服务。</p>\n<h1 id=\"h1_2\">3 搭建Keepalived + Nginx + Tomcat的高可用负载均衡架构</h1>\n<h2 id=\"h2_3\">3.1 需要准备的软件</h2>\n<p>（1）apache-tomcat-8.5.16.tar.gz</p>\n<p>（2）nginx-1.12.2.tar.gz</p>\n<p>（3）keepalived-1.3.9.tar.gz</p>\n<h2 id=\"h2_4\">3.2 服务器准备</h2>\n<p>两台服务器如：192.168.10.11，192.168.10.12</p>\n<h2 id=\"h2_5\">3.3 安装需要的依赖包</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6929ae37a8f872383933\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ yum -y install gcc gcc-c++ automake pcre pcre-devel zlib zlib-devel open openssl-devel</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a8f872383933-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6929ae37a8f872383933-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">gcc </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">automake </span><span class=\"crayon-e\">pcre </span><span class=\"crayon-v\">pcre</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-e\">zlib </span><span class=\"crayon-v\">zlib</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-e\">open </span><span class=\"crayon-v\">openssl</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">devel</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h2 id=\"h2_6\">3.4 安装</h2>\n<h3 id=\"h3_7\">3.4.1 安装Tomcat</h3>\n<p>（1）分别在两台服务器中安装Tomcat，解压apache-tomcat-8.5.16.tar.gz及可完成安装。</p>\n<h3 id=\"h3_8\">3.4.2 安装Nginx</h3>\n<p>（1）解压安装包：tar -zxvf nginx-1.12.2.tar.gz</p>\n<p>（2）进入到nginx-1.12.2目录：cd nginx-1.12.2</p>\n<p>（3）编译：</p>\n<p>a) ./configure –with-http_stub_status_module –with-http_ssl_module  –prefix=/usr/local/nginx</p>\n<p>b) sudo make &amp;&amp; sudo make install</p>\n<h3 id=\"h3_9\">3.4.3 安装Keepalived</h3>\n<p>（1）解压安装包：tar -zxvf keepalived-1.3.9.tar.gz</p>\n<p>（2）进入到keepalived-1.3.9目录：cd keepalived-1.3.9</p>\n<p>（3）执行编译：</p>\n<p>a）./configure –prefix=/usr/local/keepalived –sysconf=/etc</p>\n<p>b）sudo make &amp;&amp; sudo make install</p>\n<h2 id=\"h2_10\">3.5 配置</h2>\n<h3 id=\"h3_11\">3.5.1 分别配置两台服务器的Nginx</h3>\n<p>（1）分别修改两台服务器nginx配置文件，vi /usr/local/nginx/conf/nginx.conf</p>\n<p>（2）内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6929ae37a9a503230229\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#nginx进程数\r\nworker_processes  1;\r\n\r\n#单个进程最大连接数\r\nevents {\r\n    worker_connections  1024;\r\n}\r\n\r\n#http服务器配置\r\nhttp {\r\n    include       mime.types;\r\n    default_type  application/octet-stream;\r\n    sendfile        on;\r\n\t#长连接超时时间，单位是秒\r\n    keepalive_timeout  65;\r\n\t#upstream负载均衡配置，配置路由到tomcat的服务地址以及权重\r\n    upstream localhost{\r\n       server 192.168.10.11:8080 weight=2;\r\n       server 192.168.10.12:8080 weight=2;\r\n    }\r\n\t\r\n\t#虚拟主机的配置\r\n    server {\r\n\t    #监听端口\r\n        listen       80;\r\n\t\t #域名可以有多个，用空格隔开\r\n        server_name  localhost;\r\n        location / {\r\n            root   html;\r\n            index  index.html index.htm;\r\n\t\t\t#nginx跟后端服务器连接超时时间(代理连接超时)\r\n            proxy_connect_timeout 3;\r\n\t\t\t#后端服务器数据回传时间(代理发送超时)\r\n            proxy_send_timeout 30;\r\n\t\t\t#连接成功后，后端服务器响应时间(代理接收超时)\r\n            proxy_read_timeout 30;\r\n            proxy_pass http://localhost;\r\n        }\r\n\r\n        error_page   500 502 503 504  /50x.html;\r\n        location = /50x.html {\r\n            root   html;\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9a503230229-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9a503230229-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-1\"><span class=\"crayon-p\">#nginx进程数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-2\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>processes<span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-4\"><span class=\"crayon-p\">#单个进程最大连接数</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-5\"><span class=\"crayon-e\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>connections<span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-9\"><span class=\"crayon-p\">#http服务器配置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-10\"><span class=\"crayon-e\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">include       </span><span class=\"crayon-v\">mime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">types</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">default_type  </span><span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">octet</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sendfile        </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#长连接超时时间，单位是秒</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">keepalive</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\">  </span><span class=\"crayon-cn\">65</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#upstream负载均衡配置，配置路由到tomcat的服务地址以及权重</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">upstream</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">localhost</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-18\"><span class=\"crayon-h\">       </span><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.10.11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.10.12</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-21\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-22\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟主机的配置</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-24\"><span class=\"crayon-h\">\t    </span><span class=\"crayon-p\">#监听端口</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">listen</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-26\"><span class=\"crayon-h\">\t\t </span><span class=\"crayon-p\">#域名可以有多个，用空格隔开</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">server_name  </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">root   </span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">index  </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">html </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">htm</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-31\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-p\">#nginx跟后端服务器连接超时时间(代理连接超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">proxy_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-33\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-p\">#后端服务器数据回传时间(代理发送超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">proxy_send</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-35\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-p\">#连接成功后，后端服务器响应时间(代理接收超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">proxy_read</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">proxy_pass </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//localhost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">_</span>page<span class=\"crayon-h\">   </span><span class=\"crayon-cn\">500</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">502</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">503</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">504</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">50x.html</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">50x.html</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">root   </span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9a503230229-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9a503230229-45\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p></p>\n<h3 id=\"h3_12\">3.5.2 主Keepalived配置</h3>\n<p>（1）修改11服务器的keepalived配置文件，vi /etc/keepalived/keepalived.conf</p>\n<p>（2）内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6929ae37a9e277149400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n! Configuration File for keepalived\r\n#全局配置\r\nglobal_defs {\r\n   #keepalived切换的时候，发消息到指定的email，可配置多个email\r\n   notification_email {\r\n     feinik1@foxmail.com\r\n\t feinik2@foxmail.com\r\n   }\r\n   #通知邮件从哪个地址发出\r\n   notification_email_from feinik@foxmail.com\r\n   #通知邮件的smtp地址\r\n   smtp_server smtp.exmail.qq.com\r\n   #连接smtp服务器的超时时间，单位秒\r\n   smtp_connect_timeout 30\r\n   #Keepalived的机器标识，一个网络内保持唯一\r\n   router_id nginx-master\r\n}\r\n\r\n#执行脚本配置\r\nvrrp_script chk_nginx {\r\n\t#脚本所在路径\r\n    script \"/home/project/keepalived/check_nginx.sh\"\r\n\t#脚本执行间隔时间，秒\r\n    interval 2\r\n\t#优先级\r\n    weight 2\r\n}\r\n#keepalived实例配置\r\nvrrp_instance VI_1 {\r\n\t#指定实例的初始状态，MASTER或BACKUP两种状态，并且需要大写\r\n    state MASTER\r\n\t#实例绑定的网卡\r\n    interface ens33\r\n\t#虚拟路由标识，是一个数字，整个VRRP内唯一，如果keepalived配置了主备，需要相同\r\n    virtual_router_id 51\r\n\t#优先级，数值愈大，优先级越高\r\n    priority 100\r\n\t#MASTER与BACKUP之间同步检查的时间间隔，单位为秒\r\n    advert_int 1\r\n\t#通信验证\r\n    authentication {\r\n        auth_type PASS\r\n        auth_pass feinik\r\n    }\r\n\t#追踪外围脚本\r\n    track_script {\r\n\t    #这里配置vrrp_script的名称\r\n        chk_nginx\r\n    }\r\n\t#虚拟ip配置，可配置多个\r\n    virtual_ipaddress {\r\n        192.168.10.200\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37a9e277149400-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37a9e277149400-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-1\"><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Configuration</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keepalived</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-2\"><span class=\"crayon-p\">#全局配置</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-3\"><span class=\"crayon-e\">global_defs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#keepalived切换的时候，发消息到指定的email，可配置多个email</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">notification_email</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">feinik1</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-7\"><span class=\"crayon-e\">\t </span><span class=\"crayon-v\">feinik2</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-9\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#通知邮件从哪个地址发出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">notification_email_from </span><span class=\"crayon-v\">feinik</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#通知邮件的smtp地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">smtp_server </span><span class=\"crayon-v\">smtp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">qq</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#连接smtp服务器的超时时间，单位秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">smtp_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#Keepalived的机器标识，一个网络内保持唯一</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-16\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">router_id </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">master</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-19\"><span class=\"crayon-p\">#执行脚本配置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-20\"><span class=\"crayon-e\">vrrp_script</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chk_nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#脚本所在路径</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">script</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/home/project/keepalived/check_nginx.sh\"</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#脚本执行间隔时间，秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-25\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#优先级</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-28\"><span class=\"crayon-p\">#keepalived实例配置</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-29\"><span class=\"crayon-e\">vrrp_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VI_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-30\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#指定实例的初始状态，MASTER或BACKUP两种状态，并且需要大写</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MASTER</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-32\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#实例绑定的网卡</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ens33</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟路由标识，是一个数字，整个VRRP内唯一，如果keepalived配置了主备，需要相同</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">virtual_router_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-36\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#优先级，数值愈大，优先级越高</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">priority</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-38\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#MASTER与BACKUP之间同步检查的时间间隔，单位为秒</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">advert_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-40\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#通信验证</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">authentication</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">auth_type </span><span class=\"crayon-e\">PASS</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-43\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">auth_pass </span><span class=\"crayon-i\">feinik</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-45\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#追踪外围脚本</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">track_script</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-47\"><span class=\"crayon-h\">\t    </span><span class=\"crayon-p\">#这里配置vrrp_script的名称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">chk</span><span class=\"crayon-sy\">_</span>nginx</div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-50\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟ip配置，可配置多个</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">virtual_ipaddress</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">192.168.10.200</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37a9e277149400-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37a9e277149400-54\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p></p>\n<h3 id=\"h3_13\">3.5.3 备Keepalived配置</h3>\n<p>（1）修改12服务器的keepalived配置文件，vi /etc/keepalived/keepalived.conf</p>\n<p>（2）内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6929ae37aa5218718637\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n! Configuration File for keepalived\r\n#全局配置\r\nglobal_defs {\r\n   #keepalived切换的时候，发消息到指定的email，可配置多个email\r\n   notification_email {\r\n     feinik1@foxmail.com\r\n\t feinik2@foxmail.com\r\n   }\r\n   #通知邮件从哪个地址发出\r\n   notification_email_from feinik@foxmail.com\r\n   #通知邮件的smtp地址\r\n   smtp_server smtp.exmail.qq.com\r\n   #连接smtp服务器的超时时间，单位秒\r\n   smtp_connect_timeout 30\r\n   #Keepalived的机器标识，一个网络内保持唯一\r\n   router_id nginx-master\r\n}\r\n\r\n#执行脚本配置\r\nvrrp_script chk_nginx {\r\n\t#脚本所在路径\r\n    script \"/home/project/keepalived/check_nginx.sh\"\r\n\t#脚本执行间隔时间，秒\r\n    interval 2\r\n\t#优先级\r\n    weight 2\r\n}\r\n#keepalived实例配置\r\nvrrp_instance VI_1 {\r\n\t#指定实例的初始状态，MASTER或BACKUP两种状态，并且需要大写\r\n    state BACKUP\r\n\t#实例绑定的网卡\r\n    interface ens33\r\n\t#虚拟路由标识，是一个数字，整个VRRP内唯一，如果keepalived配置了主备，需要相同\r\n    virtual_router_id 51\r\n\t#优先级，数值愈大，优先级越高\r\n    priority 99\r\n\t#MASTER与BACKUP之间同步检查的时间间隔，单位为秒\r\n    advert_int 1\r\n\t#通信验证\r\n    authentication {\r\n        auth_type PASS\r\n        auth_pass feinik\r\n    }\r\n\t#追踪外围脚本\r\n    track_script {\r\n\t    #这里配置vrrp_script的名称\r\n        chk_nginx\r\n    }\r\n\t#虚拟ip配置，可配置多个\r\n    virtual_ipaddress {\r\n        192.168.10.200\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37aa5218718637-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37aa5218718637-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-1\"><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Configuration</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keepalived</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-2\"><span class=\"crayon-p\">#全局配置</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-3\"><span class=\"crayon-e\">global_defs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#keepalived切换的时候，发消息到指定的email，可配置多个email</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">notification_email</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">feinik1</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-7\"><span class=\"crayon-e\">\t </span><span class=\"crayon-v\">feinik2</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-9\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#通知邮件从哪个地址发出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">notification_email_from </span><span class=\"crayon-v\">feinik</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#通知邮件的smtp地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">smtp_server </span><span class=\"crayon-v\">smtp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">qq</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#连接smtp服务器的超时时间，单位秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">smtp_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#Keepalived的机器标识，一个网络内保持唯一</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-16\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">router_id </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">master</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-19\"><span class=\"crayon-p\">#执行脚本配置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-20\"><span class=\"crayon-e\">vrrp_script</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chk_nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#脚本所在路径</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">script</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/home/project/keepalived/check_nginx.sh\"</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#脚本执行间隔时间，秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-25\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#优先级</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-28\"><span class=\"crayon-p\">#keepalived实例配置</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-29\"><span class=\"crayon-e\">vrrp_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VI_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-30\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#指定实例的初始状态，MASTER或BACKUP两种状态，并且需要大写</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BACKUP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-32\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#实例绑定的网卡</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ens33</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟路由标识，是一个数字，整个VRRP内唯一，如果keepalived配置了主备，需要相同</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">virtual_router_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-36\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#优先级，数值愈大，优先级越高</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">priority</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">99</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-38\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#MASTER与BACKUP之间同步检查的时间间隔，单位为秒</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">advert_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-40\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#通信验证</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">authentication</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">auth_type </span><span class=\"crayon-e\">PASS</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-43\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">auth_pass </span><span class=\"crayon-i\">feinik</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-45\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#追踪外围脚本</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">track_script</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-47\"><span class=\"crayon-h\">\t    </span><span class=\"crayon-p\">#这里配置vrrp_script的名称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">chk</span><span class=\"crayon-sy\">_</span>nginx</div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-50\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟ip配置，可配置多个</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">virtual_ipaddress</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">192.168.10.200</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37aa5218718637-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37aa5218718637-54\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p></p>\n<h3 id=\"h3_14\">3.5.4 Nginx状态检查脚本创建</h3>\n<p>（1）新建Nginx的状态检查脚本：check_nginx.sh</p>\n<p>（2）内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6929ae37ab6937405310\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/sh\r\nNGINX=/usr/common/nginx/sbin/nginx\r\nPORT=80\r\nnmap localhost -p $PORT | grep \"$PORT/tcp open\"\r\n#echo $?\r\nif [ $? -ne 0 ];then\r\n    $NGINX -s stop\r\n    #这里再次尝试启动NG\r\n    $NGINX\r\n    sleep 5\r\n    nmap localhost -p $PORT | grep \"$PORT/tcp open\"\r\n    [ $? -ne 0 ] &amp;&amp; cd /usr/common/keepalived/sbin &amp;&amp; pkill keepalived\r\n    echo \"stoped\"\r\nfi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37ab6937405310-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37ab6937405310-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37ab6937405310-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37ab6937405310-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37ab6937405310-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37ab6937405310-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37ab6937405310-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37ab6937405310-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37ab6937405310-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37ab6937405310-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37ab6937405310-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37ab6937405310-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6929ae37ab6937405310-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6929ae37ab6937405310-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6929ae37ab6937405310-1\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37ab6937405310-2\"><span class=\"crayon-v\">NGINX</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">common</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37ab6937405310-3\"><span class=\"crayon-v\">PORT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">80</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37ab6937405310-4\"><span class=\"crayon-e\">nmap </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$PORT/tcp open\"</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37ab6937405310-5\"><span class=\"crayon-p\">#echo $?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37ab6937405310-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ne</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37ab6937405310-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">NGINX</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37ab6937405310-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#这里再次尝试启动NG</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37ab6937405310-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">NGINX</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37ab6937405310-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37ab6937405310-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">nmap </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$PORT/tcp open\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37ab6937405310-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ne</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">common</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">keepalived</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pkill </span><span class=\"crayon-e\">keepalived</span></div><div class=\"crayon-line\" id=\"crayon-5a6929ae37ab6937405310-13\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"stoped\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6929ae37ab6937405310-14\"><span class=\"crayon-v\">fi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p></p>\n<h1 id=\"h1_15\">4 运行测试</h1>\n<p>（1）为了更直观的查看到keepalived切换的效果，将11服务器中的nginx的upstream服务只配置11的tomcat服务地址，12服务器中的upstream服务只配置12的tomcat服务地址，这样只需要观察将11服务器中的nginx关闭看使用虚拟ip是否可以访问到12服务器的tomcat。</p>\n<p>（2）分别启动两个服务器中的tomcat、nginx、keepalived，访问虚拟ip：192.168.10.200，可以查看到访问的是主keepalived服务器的tomcat</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fml0nugsrvj211u0bv467.jpg\" width=\"690\" height=\"216\"></p>\n<p>（3）关闭11服务器的nginx，nginx -s stop，再次访问虚拟ip，如下：说明主keepalived通过配置的脚本检测到了本服务的nginx服务挂掉了，所以立马切换至了备的keepalived，这时12服务器的keepalived升为了主，所以就访问到了12服务器的tomcat。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fml0nuzmagj211v0c1ahf.jpg\" width=\"690\" height=\"219\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113347\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113347votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113347\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113347/", "comment_nums": 1, "create_date": "2017/12/18", "tags": "IT技术,Keepalived,Nginx,Tomcat", "url_object_id": "fb10c29fd52231cba79635856a16c3f9", "front_image_path": "full/2d4fd40c8eaec8319c1de2f154b3275aecd23f9d.jpg"}
{"fav_nums": 1, "praise_nums": "2", "title": "我见过的那些愚蠢的安全漏洞", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/05/Security-logo.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.troyhunt.com/reckon-youve-seen-some-stupid-security-things-here-hold-my-beer/\">Tony Hunt</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：知名安全技术博主 Tony Hunt 吐槽了一些正规公司、正规网站的安全漏洞：HTTP + cookie 里明文存放用户名密码；输入用户名与生日就能重设密码；密保问题；邮箱绑定个人信息等等。</p>\n<hr>\n<p>我的朋友 Lars Klint 发过这条推：「你的密码并不是独一无二的」</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fml0ubtkrdj20fj0h3q6y.jpg\" width=\"559\" height=\"615\"></p>\n<div class=\"resize-sensor\" style=\"text-align: center;\">（附图中的提示为：密码已经被 XXX 使用。请换一个。）</div>\n<p>我顺手把它<a href=\"https://twitter.com/troyhunt/status/853517036131041280\">转发</a>了出去，因为我知道还有比这更疯狂的事情。Twitter 用户没有把它当作一个<a href=\"https://www.reddit.com/r/ProgrammerHumor/comments/65l9yq/logins_should_be_unique/\">在 Reddit 上流行的笑话</a>，而是带着恐惧和指责评论它。事实上，这完全是可能的。呵呵，我看到过一些非常愚蠢的安全问题，它不仅让我相信这篇 tweet 的真实性，并且认为这非常有可能发生。你不信？来，朋友，帮我拿着啤酒，我来给你说道说道…</p>\n<h3>记住我</h3>\n<p>假设现在你想做一个“记住我”功能，就是在方框里打勾，然后下次回到网站时，已经登录的那种。<a href=\"https://www.troyhunt.com/how-to-build-and-how-not-to-build/\">这是 Black 和 Decker 的做法</a>：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/02/33143313image2.png\" alt=\"Black and Decker remember me feature\"></p>\n<p>是的，这是 cookie 中 Base64 编码版本的密码，每次请求时的发送其实都不安全，而且由于它没有被标记为“安全的”，整个发送过程都很自由，容易被获取。</p>\n<p>觉得这很糟糕？试试我在这一篇文章中提到的 Aussie Farmers Direct 的做法：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/02/33103309image91.png\" alt=\"Aussie Farmers Direct remember me feature\"></p>\n<p>看吧，这是安全的，但它仍然是一个 cookie 中的密码，并且由于它不是 HttpOnly，在网站上仍然会有 XSS 攻击的风险。那对此他们是如何回应的？这就引出了下一个话题…</p>\n<h3>企业的反应</h3>\n<p>回到 2013 年，我做了一件尽职的事情，让 Aussie Farmers 知道了上述风险。我还建议，他们不应该通过邮件发送密码（这是我最讨厌的事情之一），之后我收到了一封来自自称是“市场部经理”的人的回信：</p>\n<blockquote><p>到目前为止，我司还没有发生过，因为给新用户通过电子邮件发送密码，而引起的安全问题，而且据我所知，我本人网上注册的 90% 网站，也遵循着一样的流程。</p></blockquote>\n<p>这让我想起了国际石油和天然气公司（Oil and Gas International）的<a href=\"https://www.troyhunt.com/new-pluralsight-course-what-every-developer-must-know-about-https/\">这条评论</a>，是它在我的新 HTTPS 课程文章中给出的回复。现在当登录表单没有被安全加载时，Firefox 开始警告用户，而这让他们变得暴躁：</p>\n<blockquote><p>你方对于不安全的密码和/或登录的公告，会自动出现在本司（Oil and Gas International）的登录页面上，但并未得到我方的许可，请立即移除它。我方有自己的安全系统，并且超过 15 年来从未被攻破。你发出的公告引起了订阅者的关注，并对本司的业务造成了不良影响。</p></blockquote>\n<p>他们的网站，呃，在那之后不久就没法用了（SQL 注入风险可能没有帮到他们）。但网站现在又能用了，就是不清楚，是不是他们已经把时钟往前重置了整整 15 年。</p>\n<p>（译注：SQL Injection，即 SQL 注入，就是通过把 SQL 命令插入到 Web 表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的 SQL 命令。）</p>\n<p>虽然我们谈论的是无关紧要的安全意见，但<a href=\"https://www.troyhunt.com/the-cobra-effect-that-is-disabling/\">英国天然气公司（British Gas）过去也遇到了一些困难</a>：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/1b1b00021015034ad420c21850dca58d.jpg\"></p>\n<blockquote><p>（内容：@BritishGasHelp 不允许粘贴对于密码管理不是一个有效的举措，完全没有必要，而且很危险！</p>\n<p>@passy 如果我们允许用户粘贴，我们将失去安全证书，这会让我们置身在暴力破解的危险中，不管怎样，谢谢你的提醒~ Steve）</p></blockquote>\n<p>当我们身处世界的一角时，很难忽视 <a href=\"https://www.troyhunt.com/lessons-in-website-security-anti/\">Twitter 上像乐购（Tesco）这种大企业偶尔精神错乱的例子</a> ：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/02/46624661SNAGHTML3928683.png\" alt=\"Tesco: Passwords are stored in a secure way. They're only copied into plain test when pasted automatically into a password reminder email.\"></p>\n<blockquote><p>（@troyhunt 请不要担心，您的密码正被安全地存储，它只在密码提醒邮件中显示，供您进行粘贴操作）</p></blockquote>\n<p>但是，你会说“嘿，安全密码重置很难！”不尽然，看看这个…</p>\n<h3>密码重置</h3>\n<p>一切是这样开始的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/1a43f438d531818f5b2cffdb0fa57f2c.jpg\"></p>\n<blockquote><p>（内容：@BetfairHelpdesk 那些使用用户名和生日登录的人，是不是应该都应该改改他们的密码？）</p></blockquote>\n<p>你原本可能会想:“哦，你的用户名是电子邮件地址，然后 Betfair 给你发了一封电子邮件，而你通过其中包含的特殊链接就能重置密码”，但现在你知道了，这种想法太想当然了。出乎意料的是，Betfair 实际上并没有相信 Paul 的说法，所以我做了个视频来解释一切。</p>\n<p style=\"text-align: center;\">【视频】：https://youtu.be/YjBBmfovL08</p>\n<p>这是听上去的样子：如果你知道某人的电子邮件地址和生日，你就可以任意重置他的密码。但是，在双方交流的过程中，一定是哪里出错了，导致 Betfair 板起脸来，“好心地”提醒 Paul，如果他把电子邮件地址和生日告诉其他人，就违反了他们的条款。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/6cb8ed87a72a2c91d63e7dcebeb1c137.jpg\"></p>\n<blockquote><p>（内容：@BetfairHelpdesk 你似乎是在回避问题：只需要用户名和生日就能更改密码，是这样的吗？</p>\n<p>@psawers 是的，但是如果你告诉了别人这个信息，就违反了我们的条款）</p></blockquote>\n<p>你知道他们真正需要的是什么吗？安全问题…</p>\n<h3>安全问题</h3>\n<p>我在这儿举个例子：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/0aac9096a80678c521e0d19d5aa202a6.jpg\"></p>\n<blockquote>\n<div class=\"resize-sensor\">（内容：这是我见过的最糟糕的安全问题）</div>\n</blockquote>\n<p>什么？这个太一般了？那么试试这个：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/524a1868012d2bbd4a569771ca92f8f8.jpg\"></p>\n<blockquote><p>我刚刚上的一个网站，它有个这样的安全问题：你祖母家的狗叫什么？</p>\n<p>&amp;*#￥*&amp;(*%^$</p></blockquote>\n<p>这些安全问题真是疯了！我是说，这都是怎么想的？总体而言，要么采取不变的数据，比如你母亲的姓，或者可枚举的问题，比如你第一辆车的样子、你最喜欢的电影…在本文中，安全问题应该获得一席之地！现在让我们看看一些更为理智的东西…</p>\n<h3>登录</h3>\n<p>你知道登录过程中最难的一步是什么？密码。要是有更简单的方法就好了：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/f571151e630277bdcb65879ffbbe1b30.jpg\"></p>\n<blockquote><p>（内容：呃…玩真的吗？这简直蠢到了一种新高度）</p></blockquote>\n<p>你可能会想“它只是一条 tweet，不一定是真的”，但你错了，它就是真的，这是<a href=\"https://web-beta.archive.org/web/20150117203933/mysmsdiary.co.uk\"> archive.org 的快照</a>：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2017/04/My-SMS-Diary-Logon.png\" alt=\"My SMS Diary Logon\"></p>\n<blockquote><p>（内容：输入手机号和密码快速登录，密码默认是手机号后四位）</p></blockquote>\n<p>在我们精神失常，说出“密码必须消失”这种话之前，还是要冷静一下，毕竟还没有人知道如何做到这一点！此外还有很多有帮助的技术解决方案，但没人真正想要使用它们，而事实是，为了规避技术问题，我们反而设置了更多的密码。但是，我还看到过更糟糕的…</p>\n<h3>物理安全</h3>\n<p>我觉得我找不到比这更荒谬的例子了，所以我把它放在这儿：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2017/04/virus-noises.jpg\" alt=\"Anti-virus protection in HDMI cable\"></p>\n<blockquote><p>（内容：“100％ 聚酯薄膜”双屏蔽 1.3c 级电缆，具有抗病毒保护功能，可减少病毒噪音，并获得完美的图像传输。）</p></blockquote>\n<p>你知道真正让我恼火的是什么吗？想想你那些不懂技术的朋友和亲戚，他们为了让 DVD 播放机与电视机一起工作，走进商店拿起两根 HDMI 线缆，然后翻到盒子背面，开始比较产品规格。当看到其中一根有抗病毒保护，而另一个根没有，你认为他们会选择哪根? ！</p>\n<p>现在，还有一件事…</p>\n<h3>账户枚举</h3>\n<p>我想把“最好的”东西留到最后讲。说它是最好的，是因为它仍然是一个随处可见、愚蠢的安全问，尽管愚蠢，但至少人们正在积极修复它：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/f816f8379042be1b8b0bae5b022c63f5.jpg\"></p>\n<blockquote><p>（内容：我们马上要更换登录系统了，但同时，用户仍然可以使用我们的快速结账功能，敬请期待~）</p></blockquote>\n<p>这是距离本文八个月前的事了，那么这个愚蠢的安全问题究竟是什么？想象一下：你前往 <a href=\"https://strawberrynet.com/\">Strawberrynet</a>，扔掉了购物车里的一些香薰、爽肤水或其他什么，然后点击结账按钮。呈现在你面前的是：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/08/Checkout-1.png\" alt=\"Strawberrynet Checkout\"></p>\n<blockquote><p>（内容：请输入电子邮箱地址以结账）</p></blockquote>\n<p>你需要输入电子邮件地址，可以是网站上的任何邮件地址，之后，你就可以看到他人的个人资料了：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/08/Personal-details-shown-1.png\" alt=\"Strawberrynet disclosing other people's data\"></p>\n<p>等等，这是什么鬼？！这是因为他们将个人数据与系统上的电子邮件地址进行了捆绑。而且由于这是<a href=\"http://www.alexa.com/siteinfo/strawberrynet.com\">世界上（访问量）最大的五千个网站之一</a>，每天有许多人打开浏览，从而在网站中留下了很多的数据。你可以输入一个女性的名字（网站主要卖化妆品）再加上一个常见的电子邮箱后缀，之后就是惊喜啦！如果你认为这有点可怕，呵呵，这实际上正是网站的一个特色：</p>\n<blockquote><p>请注意，经过我们的调查，绝大多数用户都喜欢我们这个“不带密码”的系统。使用您的电子邮件地址作为密码已经足够安全了。</p></blockquote>\n<p>才怪，这根本不安全！我在八月写了篇列举<a href=\"https://www.troyhunt.com/website-enumeration-insanity-how-our-personal-data-is-leaked/\">网站精神错乱的文章</a>，其中提到了他们早期的 tweet，但他们似乎完全无视这个问题。我甚至创建了一个帐户来检测它的工作原理：</p>\n<p><img src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fml1we5rn5g20p007ogxo.gif\" alt=\"Marquee FTW!\"></p>\n<p>好吧，我想我还需要再喝杯啤酒…</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113343\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113343votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113343\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113343/", "comment_nums": 3, "create_date": "2017/12/18", "tags": "IT技术,安全", "url_object_id": "1960505fabd1be2e545f68a984679b36", "front_image_path": "full/1ef0c99044632a162ca37b8246f9136048574deb.jpg"}
{"fav_nums": 1, "praise_nums": "1", "title": "Linux 移动或重命名文件/目录－mv 的10个实用例子", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/0ffd848e786b38cbd9e7fe73b8a984f9.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://linoxide.com/linux-command/mv-command-linux/\">Pungki Arianto</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-2688-1.html\">Linux中国/Linchenguang</a>   </div><p>熟悉了 <a href=\"http://linux.cn/article-2687-1.html\">复制命令</a>，下一个相关的命令就是 mv 命令。当你想要将文件从一个位置移动到另一个地方并且不想复制它，那么<strong>mv 命令</strong>是完成这个任务的首选。</p>\n<h3>初识 mv 命令</h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0ffd848e786b38cbd9e7fe73b8a984f9.png\" alt=\"\" width=\"512\" height=\"512\"></p>\n<p>mv 命令是一个与<strong>cp</strong>类似的命令，但是它<strong>并非</strong>创建文件或目录的复制品/副本。不管你在使用什么版本的Linux系统，mv 都默认安装在你的Linux系统上了。来看一下 mv 命令在日常操作中的一些例子。</p>\n<h4>1.移动文件</h4>\n<p>移动文件时需要注意的是文件的源地址和目标地址<strong>必须不同</strong>。这里有个例子，想要将<strong>file_1.txt</strong>文件从当前目录移动到其它目录，以<strong>/home/pungki/</strong>为例，语法应该如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d8070a724042140\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv file_1.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d8070a724042140-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d8070a724042140-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">file_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4337b72366dcd1d179e54f6733353c31.png\" alt=\"mv command\"></p>\n<p>如我们所见，当我们移动 file_1.txt 文件时，先前目录的 file<em>_</em>1.txt 就<strong>被删除了</strong>。</p>\n<h4>2.移动多个文件</h4>\n<p>如果想一次移动多个文件，我们可以将他们放在一行并用空格分开。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d80716557298654\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv file_2.txt file_3.txt file_4.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d80716557298654-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d80716557298654-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">file_2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">file_3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">file_4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/b2638990e4d535ef720494594f82aeff.png\" alt=\"Move multiple files\"></p>\n<p>如果你的文件有规律可循的话那么你就可以使用通配符。比如，为了移除所有以<strong>.txt</strong>为扩展名的文件，我们可以用下面的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d8071b313665449\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d8071b313665449-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d8071b313665449-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">mv *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/001cbc57d22fd5836324e4c34ff49a98.png\" alt=\"Move using pattern\"></p>\n<h4>3.移动目录</h4>\n<p>不同于复制命令，用 mv 命令移动目录相当直接。移动目录你可以使用不带选项的 mv 命令。看下面的截图就一目了然了。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6097ea1227a2aacc6f5da69ab6ba228a.png\" alt=\"Moving directory\"></p>\n<h4>4.重命名文件或目录</h4>\n<p>我们也用 mv 命令来重命名文件或目录。不过目标位置和源位置必须相同才可以。然后文件名必须不同。</p>\n<p>假定我们当前所在目录为<strong>/home/pungki/Documents</strong>，而我们想将<strong>file_1.txt重命名为file_2.txt</strong>。那么命令应该如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d8071f884974720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv file_1.txt file_2.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d8071f884974720-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d8071f884974720-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">file_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">file_2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果是绝对路径，它应该像下面这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d80722334690001\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv /home/pungki/Documents/file_1.txt /home/pungki/Documents/file_2.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d80722334690001-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d80722334690001-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Documents</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">file_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Documents</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">file_2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/d10e2e03d32e0a5970da8ce2cdbc0254.png\" alt=\"Renaming file\"></p>\n<h4>5. 重命名目录</h4>\n<p>上一段的规则同样适用于目录。请看这个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d80725400451781\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv directory_1/ directory_2/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d80725400451781-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d80725400451781-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">directory_1</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">directory_2</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cf60abcbc8e5d4ad81ea8666b78564a3.png\" alt=\"Renaming directory\"></p>\n<h4>6. 打印移动信息</h4>\n<p>当你移动或重命名一大堆文件或目录时，你可能会想在不去目标位置去查看的情况下知道你自己的命令是否成功地执行了。这就要用到<strong>-v</strong>选项了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d80729559366427\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -v *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d80729559366427-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d80729559366427-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">v *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4f9bef19e69f100e7d4f1ec973114f82.png\" alt=\"mv with verbose mode\"></p>\n<p>该方法同样适用于目录。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/8eda462dd144998963b5adea39260da7.png\" alt=\"mv directory with verbose mode\"></p>\n<h4>7. 使用交互模式</h4>\n<p>当你将文件移动到其它位置，而那个位置恰好有同样的文件，这时 mv 命令会覆盖掉原来的文件。对于mv的这一行为一般不会有什么提示。如果想产生一个关于覆盖文件的提示，我们可以使用<strong>-i</strong>选项。（译注：通常发行版会通过alias命令，将-i作为默认选项，所以会有提示。）</p>\n<p>假设我们想将 file_1.txt 移动到 /home/pungki/office。同时，/home/pungki/office 目录下已经有file_1.txt文件了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d8072c986068399\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -i file_1.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d8072c986068399-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d8072c986068399-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0e39f8eaefe16af197716905386551be.png\" alt=\"mv with interactive mode\"></p>\n<p>这个提示会让我们知道目标位置处file_1.txt的存在。如果我们按<strong>y</strong>键，那么那个文件将会被删除，否则不会。</p>\n<h4>8. 使用更新选项</h4>\n<p>-i 选项会提示我们关于覆盖文件的提示，而 -u 则只在源文件比目标文件新时才执行更新。让我们看一看下面的例子：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/2eb8dce13a7f749f4c2b392c0622324a.png\" alt=\"Update only newer\"></p>\n<p>假如 file_1.txt 和 file_2.txt有如下特点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d80732304179742\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFile_1.txt has 84 bytes file size and it last modified time is 12:00\r\nFile_2.txt has 0 bytes file size and it last modified time is 11:59</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d80732304179742-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258d80732304179742-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d80732304179742-1\"><span class=\"crayon-v\">File_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-i\">has</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">84</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">size </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">last </span><span class=\"crayon-e\">modified </span><span class=\"crayon-e\">time </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258d80732304179742-2\"><span class=\"crayon-v\">File_2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-i\">has</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">size </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">last </span><span class=\"crayon-e\">modified </span><span class=\"crayon-e\">time </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>我们想将它们移动到 /home/pungki/office 目录下。<strong>但是目标地址</strong>已经有file_1.txt和file_2.txt了。</p>\n<p>我们用下面的命令将file_1.txt 和file_2.txt从当前目录移动到/home/pungki/office</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d80736876598958\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -uv *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d80736876598958-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d80736876598958-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">uv *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>可以看到这些文件被移动了。能移动这些文件是因为它们最近的修改时间戳比 /home/pungki/office 目录中的文件新。</p>\n<h4>9.不要覆盖任何已存在的文件</h4>\n<p>如果<strong>-i</strong>选项询问我们是否要覆盖文件，那么 -n 选项将不会允许我们覆盖任何已存在的文件。</p>\n<p>继续使用第8点中的例子，如果我们将<strong>-u 换成 -n</strong>同时加上<strong>-v</strong>选项，那么我们会看到没有任何文件移动到了 /home/pungki/office 目录下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d80739582020065\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -vn *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d80739582020065-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d80739582020065-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">vn *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/a5751c3a71e972ec2e8a1abad55667ce.png\" alt=\"No overwrite\"></p>\n<h4>10. 复制时创建备份</h4>\n<p>默认情况下，移动文件将会覆盖已存在的目标文件。但是如果我们移动错了文件而目标文件已经被新的文件覆盖了，这时应该怎么办才好呢？<strong>有没有一种方法可以恢复之前的文件呢？答案是肯定的</strong>。我们可以用<strong>-b</strong>选项。该选项会在新文件覆盖旧文件时将旧文件做备份。这里我们还以第8点为例。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d8073d362931085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -bv *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d8073d362931085-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d8073d362931085-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">bv *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/c5e357026dd7c98407042492ab8592e2.png\" alt=\"Backup option\"></p>\n<p>如截图中所见，在 /home/pungki/office 目录下出现了名为<strong>file_1.txt~</strong> 和 <strong>file_2.txt~</strong> 的文件。那个<strong>波浪符号（～）</strong>意味着这些文件是备份文件。从它们的属性中我们可以看到，这些文件比file_1.txt和file_2.txt要旧。</p>\n<h4>11. 无条件覆盖已经存在的文件</h4>\n<p>（译注：这一节是译者补充的，原文遗漏了这个重要选项）</p>\n<p>当你希望无论如何都覆盖已经存在的文件或目录时，你可以使用 -f 选项。如果同时指定了 -f 选项和 -i 或 -n 选项，则 -f 选项会覆盖它们——即不进行任何提示而覆盖，所以，在使用此参数时，知道你在做什么。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258d80740472538502\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -f *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258d80740472538502-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258d80740472538502-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">f *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3>总结</h3>\n<p>移动文件和目录命令是Linux系统的基本命令。通常你可以通过<strong>man mv</strong> 或者 <strong>mv –help</strong>显示mv的手册页以了解更多详细信息。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113352\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113352votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113352\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113352/", "comment_nums": 0, "create_date": "2017/12/18", "tags": "IT技术,Linux", "url_object_id": "b2be77988c2b81aa8c8c5c8a69811c1a", "front_image_path": "full/0103b0e13e2f637c79f77601cd7eed63b09b1158.jpg"}
{"fav_nums": 3, "praise_nums": "1", "title": "如何在不会导致服务器宕机的情况下，用 PHP 读取大文件", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/01/ee9bc25f0b5757b6f90f093b53eb2271.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.sitepoint.com/performant-reading-big-files-php/\">Christopher Pitt</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/performant-reading-big-files-php\">开源中国</a>   </div><p><strong>作为PHP开发人员，我们并不经常需要担心内存管理。PHP 引擎在我们背后做了很好的清理工作，短期执行上下文的 Web 服务器模型意味着即使是最潦草的代码也不会造成持久的影响。</strong></p>\n<p>很少情况下我们可能需要走出这个舒适的地方 ——比如当我们试图在一个大型项目上运行 Composer 来创建我们可以创建的最小的 VPS 时，或者当我们需要在一个同样小的服务器上读取大文件时。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/60a1bd66a2c254a6123189a62d5ba656.jpg\" width=\"400\" height=\"400\"></p>\n<p>后面的问题就是我们将在本教程中深入探讨的。</p>\n<p>在 <a href=\"https://github.com/sitepoint-editors/sitepoint-performant-reading-of-big-files-in-php\" target=\"_blank\" rel=\"nofollow\">GitHub</a>上可以找到本教程的源码。</p>\n<h2>衡量成功的标准</h2>\n<p>确保我们对代码有改进的唯一方法是测试一个不好的情况，然后将我们修复之后的测量与另一个进行比较。换句话说，除非我们知道“解决方案”对我们有多大的帮助（如果有的话），否则我们不知道它是否真的是一个解决方案。</p>\n<p>这里有两个我们可以关系的衡量标准。首先是CPU使用率。我们要处理的进程有多快或多慢？第二是内存使用情况。脚本执行时需要多少内存？这两个通常是成反比的 – 这意味着我们可以以CPU使用率为代价来降低内存使用，反之亦然。</p>\n<p>在一个异步执行模型（如多进程或多线程的PHP应用程序）中，CPU和内存的使用率是很重要的考量因素。在传统的PHP架构中，当任何一个值达到服务器的极限时，这些通常都会成为问题。</p>\n<p>测量PHP内的CPU使用率是不切实际的。如果这是你要关注的领域，请考虑在Ubuntu或MacOS上使用类似top的工具。对于Windows，请考虑使用Linux子系统，以便在Ubuntu中使用top。</p>\n<p>为了本教程的目的，我们将测量内存使用情况。我们将看看在“传统”的脚本中使用了多少内存。我们将执行一些优化策略并对其进行度量。最后，我希望你能够做出一个有经验的选择。<br>\n我们查看内存使用多少的方法是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7cb200186292\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// formatBytes is taken from the php.net documentation\r\n\r\nmemory_get_peak_usage();\r\n\r\nfunction formatBytes($bytes, $precision = 2) {\r\n    $units = array(\"b\", \"kb\", \"mb\", \"gb\", \"tb\");\r\n\r\n    $bytes = max($bytes, 0);\r\n    $pow = floor(($bytes ? log($bytes) : 0) / log(1024));\r\n    $pow = min($pow, count($units) - 1);\r\n\r\n    $bytes /= (1 &lt;&lt; (10 * $pow));\r\n\r\n    return round($bytes, $precision) . \" \" . $units[$pow];\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7cb200186292-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7cb200186292-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7cb200186292-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7cb200186292-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7cb200186292-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7cb200186292-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7cb200186292-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7cb200186292-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7cb200186292-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7cb200186292-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7cb200186292-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7cb200186292-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7cb200186292-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7cb200186292-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7cb200186292-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7cb200186292-1\"><span class=\"crayon-c\">// formatBytes is taken from the php.net documentation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7cb200186292-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7cb200186292-3\"><span class=\"crayon-e\">memory_get_peak_usage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7cb200186292-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7cb200186292-5\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">formatBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">precision</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7cb200186292-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"b\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"kb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"gb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tb\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7cb200186292-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7cb200186292-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7cb200186292-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7cb200186292-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7cb200186292-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7cb200186292-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7cb200186292-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7cb200186292-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">precision</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7cb200186292-15\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>我们将在脚本的最后使用这些函数，以便我们能够看到哪个脚本一次使用最大的内存。</p>\n<h3>我们的选择是什么？</h3>\n<p>这里有很多方法可以有效地读取文件。但是也有两种我们可能使用它们的情况。我们想要同时读取和处理所有数据，输出处理过的数据或根据我们所读取的内容执行其他操作。我们也可能想要转换一个数据流，而不需要真正访问的数据。<br>\n让我们设想一下，对于第一种情况，我们希望读取一个文件，并且每10,000行创建一个独立排队的处理作业。我们需要在内存中保留至少10000行，并将它们传递给排队的工作管理器（无论采取何种形式）。<br>\n对于第二种情况，我们假设我们想要压缩一个特别大的API响应的内容。我们不在乎它的内容是什么，但我们需要确保它是以压缩形式备份的。<br>\n在这两种情况下，如果我们需要读取大文件，首先，我们需要知道数据是什么。第二，我们并不在乎数据是什么。让我们来探索这些选择吧…</p>\n<h2><strong>逐行读取文件</strong></h2>\n<p>有许多操作文件的函数，我们把部分结合到一个简单的文件阅读器中(封装为一个方法)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7d6811788643\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from memory.php\r\n\r\nfunction formatBytes($bytes, $precision = 2) {\r\n    $units = array(\"b\", \"kb\", \"mb\", \"gb\", \"tb\");\r\n\r\n    $bytes = max($bytes, 0);\r\n    $pow = floor(($bytes ? log($bytes) : 0) / log(1024));\r\n    $pow = min($pow, count($units) - 1);\r\n\r\n    $bytes /= (1 &lt;&lt; (10 * $pow));\r\n\r\n    return round($bytes, $precision) . \" \" . $units[$pow];\r\n}\r\n\r\nprint formatBytes(memory_get_peak_usage());</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7d6811788643-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7d6811788643-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7d6811788643-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7d6811788643-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7d6811788643-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7d6811788643-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7d6811788643-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7d6811788643-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7d6811788643-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7d6811788643-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7d6811788643-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7d6811788643-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7d6811788643-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7d6811788643-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7d6811788643-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7d6811788643-1\"><span class=\"crayon-c\">// from memory.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7d6811788643-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7d6811788643-3\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">formatBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">precision</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7d6811788643-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"b\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"kb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"gb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tb\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7d6811788643-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7d6811788643-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7d6811788643-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7d6811788643-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7d6811788643-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7d6811788643-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7d6811788643-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7d6811788643-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">precision</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7d6811788643-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7d6811788643-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7d6811788643-15\"><span class=\"crayon-e\">print </span><span class=\"crayon-e\">formatBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">memory_get_peak_usage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7da893801856\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from reading-files-line-by-line-1.php\r\n\r\nfunction readTheFile($path) {\r\n    $lines = [];\r\n    $handle = fopen($path, \"r\");\r\n\r\n    while(!feof($handle)) {\r\n        $lines[] = trim(fgets($handle));\r\n    }\r\n\r\n    fclose($handle);\r\n    return $lines;\r\n}\r\n\r\nreadTheFile(\"shakespeare.txt\");\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7da893801856-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7da893801856-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7da893801856-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7da893801856-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7da893801856-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7da893801856-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7da893801856-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7da893801856-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7da893801856-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-1\"><span class=\"crayon-c\">// from reading-files-line-by-line-1.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7da893801856-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-3\"><span class=\"crayon-t\">function</span> <span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7da893801856-4\">    <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">lines</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-5\">    <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7da893801856-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-7\">    <span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">feof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7da893801856-8\">        <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">trim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fgets</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-9\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7da893801856-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-11\">    <span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7da893801856-12\">    <span class=\"crayon-st\">return</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7da893801856-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-15\"><span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7da893801856-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7da893801856-17\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>我们读取一个文本文件为莎士比亚全集。文件大小为5.5MB，内存占用峰值为12.8MB。现在让我们用一个生成器来读取每一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7de721583400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from reading-files-line-by-line-2.php\r\n\r\nfunction readTheFile($path) {\r\n    $handle = fopen($path, \"r\");\r\n\r\n    while(!feof($handle)) {\r\n        yield trim(fgets($handle));\r\n    }\r\n\r\n    fclose($handle);\r\n}\r\n\r\nreadTheFile(\"shakespeare.txt\");\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7de721583400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7de721583400-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7de721583400-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7de721583400-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7de721583400-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7de721583400-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7de721583400-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7de721583400-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7de721583400-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7de721583400-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7de721583400-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7de721583400-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7de721583400-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7de721583400-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7de721583400-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7de721583400-1\"><span class=\"crayon-c\">// from reading-files-line-by-line-2.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7de721583400-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7de721583400-3\"><span class=\"crayon-t\">function</span> <span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7de721583400-4\">    <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7de721583400-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7de721583400-6\">    <span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">feof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7de721583400-7\">        <span class=\"crayon-i\">yield</span> <span class=\"crayon-e\">trim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fgets</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7de721583400-8\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7de721583400-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7de721583400-10\">    <span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7de721583400-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7de721583400-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7de721583400-13\"><span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7de721583400-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7de721583400-15\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>文本文件大小不变，但内存使用峰值只是393KB。即使我们能把读取到的数据做一些事情也并不意味着什么。也许我们可以在看到两条空白时把文档分割成块，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7e1018449586\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from reading-files-line-by-line-3.php\r\n\r\n$iterator = readTheFile(\"shakespeare.txt\");\r\n\r\n$buffer = \"\";\r\n\r\nforeach ($iterator as $iteration) {\r\n    preg_match(\"/\\n{3}/\", $buffer, $matches);\r\n\r\n    if (count($matches)) {\r\n        print \".\";\r\n        $buffer = \"\";\r\n    } else {\r\n        $buffer .= $iteration . PHP_EOL;\r\n    }\r\n}\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e1018449586-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e1018449586-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-1\"><span class=\"crayon-c\">// from reading-files-line-by-line-3.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">iterator</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">buffer</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-7\"><span class=\"crayon-st\">foreach</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">iterator</span> <span class=\"crayon-st\">as</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iteration</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-8\">    <span class=\"crayon-e\">preg_match</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\\n{3}/\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matches</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-10\">    <span class=\"crayon-st\">if</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matches</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-11\">        <span class=\"crayon-i\">print</span> <span class=\"crayon-s\">\".\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-12\">        <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">buffer</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-13\">    <span class=\"crayon-sy\">}</span> <span class=\"crayon-st\">else</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-14\">        <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">buffer</span> <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">iteration</span> <span class=\"crayon-sy\">.</span> <span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-15\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e1018449586-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e1018449586-18\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>猜到我们使用了多少内存吗？我们把文档分割为1216块，仍然只使用了459KB的内存，这是否让你惊讶？考虑到生成器的性质，我们使用的最多内存是使用在迭代中我们需要存储的最大文本块。在本例中，最大的块为101985字符。</p>\n<p>我已经撰写了<a href=\"https://www.sitepoint.com/memory-performance-boosts-with-generators-and-nikiciter/\" target=\"_blank\" rel=\"nofollow\">使用生成器提示性能</a>和<a href=\"https://github.com/nikic/iter\" target=\"_blank\" rel=\"nofollow\">Nikita Popov的迭代器库</a>，如果你感兴趣就去看看吧！</p>\n<p>生成器还有其它用途，但是最明显的好处就是高性能读取大文件。如果我们需要处理这些数据，生成器可能是最好的方法。</p>\n<h3>管道间的文件</h3>\n<p>在我们不需要处理数据的情况下，我们可以把文件数据传递到另一个文件。通常被称为管道（大概是因为我们看不到除了两端的管子里面，当然，它也是不透明的），我们可以通过使用流方法实现。让我们先写一个脚本从一个文件传到另一个文件。这样我们可以测量内存的占用情况：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7e5539222164\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from piping-files-1.php\r\n\r\nfile_put_contents(\r\n    \"piping-files-1.txt\", file_get_contents(\"shakespeare.txt\")\r\n);\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e5539222164-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e5539222164-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e5539222164-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e5539222164-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e5539222164-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e5539222164-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e5539222164-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e5539222164-1\"><span class=\"crayon-c\">// from piping-files-1.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e5539222164-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e5539222164-3\"><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e5539222164-4\">    <span class=\"crayon-s\">\"piping-files-1.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e5539222164-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e5539222164-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e5539222164-7\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>不出所料，这个脚本使用更多的内存来进行文本文件复制。这是因为它读取(和保留)文件内容在内存中，直到它被写到新文件中。对于小文件这种方法也许没问题。当为更大的文件时，就捉襟见肘了…</p>\n<p>让我们尝试用流(管道)来传送一个文件到另一个：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7e9333287264\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from piping-files-2.php\r\n\r\n$handle1 = fopen(\"shakespeare.txt\", \"r\");\r\n$handle2 = fopen(\"piping-files-2.txt\", \"w\");\r\n\r\nstream_copy_to_stream($handle1, $handle2);\r\n\r\nfclose($handle1);\r\nfclose($handle2);\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e9333287264-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e9333287264-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e9333287264-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e9333287264-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e9333287264-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e9333287264-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e9333287264-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e9333287264-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e9333287264-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7e9333287264-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7e9333287264-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e9333287264-1\"><span class=\"crayon-c\">// from piping-files-2.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e9333287264-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e9333287264-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e9333287264-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"piping-files-2.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e9333287264-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e9333287264-6\"><span class=\"crayon-e\">stream_copy_to_stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e9333287264-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e9333287264-8\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e9333287264-9\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7e9333287264-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7e9333287264-11\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>这段代码稍微有点陌生。我们打开了两文件的句柄，第一个是只读模式，第二个是只写模式，然后我们从第一个复制到第二个中。最后我们关闭了它，也许使你惊讶，内存只占用了393KB</p>\n<p>这似乎很熟悉。像代码生成器在存储它读到的每一行代码？那是因为第二个参数fgets规定了每行读多少个字节（默认值是-1或者直到下一行为止）。</p>\n<p>第三个参数stream_copy_to_stream和第二个参数是同一类参数（默认值相同），stream_copy_to_stream一次从一个数据流里读一行，同时写到另一个数据流里。它跳过生成器只有一个值的部分（因为我们不需要这个值）。</p>\n<p>这篇文章对于我们来说可能是没用的，所以让我们想一些我们可能会用到的例子。假设我们想从我们的CDN中输出一张图片，作为一种重定向的路由应用程序。我们可以参照下边的代码来实现它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7ed238897073\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from piping-files-3.php\r\n\r\nfile_put_contents(\r\n    \"piping-files-3.jpeg\", file_get_contents(\r\n        \"https://github.com/assertchris/uploads/raw/master/rick.jpg\"\r\n    )\r\n);\r\n\r\n// ...or write this straight to stdout, if we don't need the memory info\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7ed238897073-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7ed238897073-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7ed238897073-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7ed238897073-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7ed238897073-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7ed238897073-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7ed238897073-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7ed238897073-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7ed238897073-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7ed238897073-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7ed238897073-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7ed238897073-1\"><span class=\"crayon-c\">// from piping-files-3.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7ed238897073-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7ed238897073-3\"><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7ed238897073-4\">    <span class=\"crayon-s\">\"piping-files-3.jpeg\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7ed238897073-5\">        <span class=\"crayon-s\">\"https://github.com/assertchris/uploads/raw/master/rick.jpg\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7ed238897073-6\">    <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7ed238897073-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7ed238897073-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7ed238897073-9\"><span class=\"crayon-c\">// ...or write this straight to stdout, if we don't need the memory info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7ed238897073-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7ed238897073-11\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>设想一下，一个路由应用程序让我们看到这段代码。但是，我们想从CDN获取一个文件，而不是从本地的文件系统获取。我们可以用一些其他的东西来更好的替换file_get_contents（就像<a href=\"http://docs.guzzlephp.org/en/stable/\" rel=\"nofollow\">Guzzle</a>），即使在引擎内部它们几乎是一样的。</p>\n<p>图片的内存大概有581K。现在，让我们来试试这个</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7f0512127985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from piping-files-4.php\r\n\r\n$handle1 = fopen(\r\n    \"https://github.com/assertchris/uploads/raw/master/rick.jpg\", \"r\"\r\n);\r\n\r\n$handle2 = fopen(\r\n    \"piping-files-4.jpeg\", \"w\"\r\n);\r\n\r\n// ...or write this straight to stdout, if we don't need the memory info\r\n\r\nstream_copy_to_stream($handle1, $handle2);\r\n\r\nfclose($handle1);\r\nfclose($handle2);\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f0512127985-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f0512127985-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-1\"><span class=\"crayon-c\">// from piping-files-4.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-4\">    <span class=\"crayon-s\">\"https://github.com/assertchris/uploads/raw/master/rick.jpg\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-8\">    <span class=\"crayon-s\">\"piping-files-4.jpeg\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w\"</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-9\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-11\"><span class=\"crayon-c\">// ...or write this straight to stdout, if we don't need the memory info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-13\"><span class=\"crayon-e\">stream_copy_to_stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-15\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-16\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f0512127985-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f0512127985-18\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>内存使用明显变少（大概<strong>400K</strong>），但是结果是一样的。如果我们不关注内存信息，我们依旧可以用标准模式输出。实际上，PHP提供了一个简单的方式来完成：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7f4874333542\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$handle1 = fopen(\r\n    \"https://github.com/assertchris/uploads/raw/master/rick.jpg\", \"r\"\r\n);\r\n\r\n$handle2 = fopen(\r\n    \"php://stdout\", \"w\"\r\n);\r\n\r\nstream_copy_to_stream($handle1, $handle2);\r\n\r\nfclose($handle1);\r\nfclose($handle2);\r\n\r\n// require \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f4874333542-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f4874333542-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f4874333542-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f4874333542-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f4874333542-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f4874333542-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f4874333542-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f4874333542-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f4874333542-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f4874333542-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f4874333542-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f4874333542-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f4874333542-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f4874333542-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f4874333542-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f4874333542-2\">    <span class=\"crayon-s\">\"https://github.com/assertchris/uploads/raw/master/rick.jpg\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f4874333542-3\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f4874333542-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f4874333542-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f4874333542-6\">    <span class=\"crayon-s\">\"php://stdout\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w\"</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f4874333542-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f4874333542-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f4874333542-9\"><span class=\"crayon-e\">stream_copy_to_stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f4874333542-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f4874333542-11\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f4874333542-12\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f4874333542-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f4874333542-14\"><span class=\"crayon-c\">// require \"memory.php\";</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3>其它流</h3>\n<p>还有其它一些流，我们可以通过管道来写入和读取（或只读取/只写入）：</p>\n<ul>\n<li>php://stdin (只读)</li>\n<li>php://stderr (只写, 如php://stdout)</li>\n<li>php://input (只读) 这使我们能够访问原始请求体</li>\n<li>php://output (只写) 让我们写入输出缓冲区</li>\n<li>php://memory 和 php://temp (读-写) 是我们可以临时存储数据的地方。 不同之处在于一旦它变得足够大 php://temp 会将数据存储在文件系统中，而 php://memory 将一直持存储在内存中直到资源耗尽。</li>\n</ul>\n<h2>过滤器</h2>\n<p>还有一个我们可以在stream上使用的技巧，称为<b>过滤器</b>。它们是一种中间的步骤，提供对stream数据的一些控制，但不把他们暴露给我们。想象一下，我们会使用Zip扩展名来压缩我们的shakespeare.txt文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7f7322513784\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from filters-1.php\r\n\r\n$zip = new ZipArchive();\r\n$filename = \"filters-1.zip\";\r\n\r\n$zip-&gt;open($filename, ZipArchive::CREATE);\r\n$zip-&gt;addFromString(\"shakespeare.txt\", file_get_contents(\"shakespeare.txt\"));\r\n$zip-&gt;close();\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f7322513784-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f7322513784-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f7322513784-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f7322513784-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f7322513784-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f7322513784-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f7322513784-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f7322513784-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7f7322513784-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7f7322513784-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f7322513784-1\"><span class=\"crayon-c\">// from filters-1.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f7322513784-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f7322513784-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">zip</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-r\">new</span> <span class=\"crayon-e\">ZipArchive</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f7322513784-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">filename</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">\"filters-1.zip\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f7322513784-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f7322513784-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">zip</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">ZipArchive</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">CREATE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f7322513784-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">zip</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addFromString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f7322513784-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">zip</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7f7322513784-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7f7322513784-10\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这是一小段整洁的代码，但它测量内存占用在10.75MB左右。使用过滤器的话，我们可以减少内存：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7fb918352348\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from filters-2.php\r\n\r\n$handle1 = fopen(\r\n    \"php://filter/zlib.deflate/resource=shakespeare.txt\", \"r\"\r\n);\r\n\r\n$handle2 = fopen(\r\n    \"filters-2.deflated\", \"w\"\r\n);\r\n\r\nstream_copy_to_stream($handle1, $handle2);\r\n\r\nfclose($handle1);\r\nfclose($handle2);\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fb918352348-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fb918352348-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fb918352348-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fb918352348-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fb918352348-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fb918352348-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fb918352348-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fb918352348-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fb918352348-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fb918352348-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fb918352348-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fb918352348-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fb918352348-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fb918352348-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fb918352348-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fb918352348-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fb918352348-1\"><span class=\"crayon-c\">// from filters-2.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fb918352348-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fb918352348-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fb918352348-4\">    <span class=\"crayon-s\">\"php://filter/zlib.deflate/resource=shakespeare.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fb918352348-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fb918352348-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fb918352348-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fb918352348-8\">    <span class=\"crayon-s\">\"filters-2.deflated\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w\"</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fb918352348-9\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fb918352348-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fb918352348-11\"><span class=\"crayon-e\">stream_copy_to_stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fb918352348-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fb918352348-13\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fb918352348-14\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fb918352348-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fb918352348-16\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>此处，我们可以看到名为php://filter/zlib.deflate的过滤器，它读取并压缩资源的内容。我们可以在之后将压缩数据导出到另一个文件中。这仅使用了<strong>896KB</strong>.</p>\n<p>我知道这是不一样的格式，或者制作zip存档是有好处的。你不得不怀疑：如果你可以选择不同的格式并节省约12倍的内存，为什么不选呢？</p>\n<p>为了解压此数据，我们可以通过执行另一个zlib filter将压缩后的数据还原：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d7fe007109636\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from filters-2.php\r\n\r\nfile_get_contents(\r\n    \"php://filter/zlib.inflate/resource=filters-2.deflated\"\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fe007109636-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fe007109636-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fe007109636-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d7fe007109636-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d7fe007109636-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fe007109636-1\"><span class=\"crayon-c\">// from filters-2.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fe007109636-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fe007109636-3\"><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d7fe007109636-4\">    <span class=\"crayon-s\">\"php://filter/zlib.inflate/resource=filters-2.deflated\"</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d7fe007109636-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>Streams have been extensively covered in Stream在“<a href=\"https://www.sitepoint.com/%EF%BB%BFunderstanding-streams-in-php/\" rel=\"nofollow\">理解PHP中的流</a>”和“<a href=\"https://www.sitepoint.com/using-php-streams-effectively/\" rel=\"nofollow\">U高效使用PHP中的流</a>”中已经被全面介绍了。如果你喜欢一个完全不同的视角，可以阅读一下。</p>\n<h2>定制流</h2>\n<p>fopen和file_get_contents有它们自己的一套默认选项，但是这些都是完全可定制的。为了定义它们，我们需要创建一个新的流上下文：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d802492512575\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from creating-contexts-1.php\r\n\r\n$data = join(\"&amp;\", [\r\n    \"twitter=assertchris\",\r\n]);\r\n\r\n$headers = join(\"\\r\\n\", [\r\n    \"Content-type: application/x-www-form-urlencoded\",\r\n    \"Content-length: \" . strlen($data),\r\n]);\r\n\r\n$options = [\r\n    \"http\" =&gt; [\r\n        \"method\" =&gt; \"POST\",\r\n        \"header\"=&gt; $headers,\r\n        \"content\" =&gt; $data,\r\n    ],\r\n];\r\n\r\n$context = stream_content_create($options);\r\n\r\n$handle = fopen(\"https://example.com/register\", \"r\", false, $context);\r\n$response = stream_get_contents($handle);\r\n\r\nfclose($handle);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d802492512575-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d802492512575-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-1\"><span class=\"crayon-c\">// from creating-contexts-1.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">data</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&amp;\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-4\">    <span class=\"crayon-s\">\"twitter=assertchris\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-5\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">headers</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-8\">    <span class=\"crayon-s\">\"Content-type: application/x-www-form-urlencoded\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-9\">    <span class=\"crayon-s\">\"Content-length: \"</span> <span class=\"crayon-sy\">.</span> <span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-10\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-13\">    <span class=\"crayon-s\">\"http\"</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-14\">        <span class=\"crayon-s\">\"method\"</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-15\">        <span class=\"crayon-s\">\"header\"</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-16\">        <span class=\"crayon-s\">\"content\"</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-17\">    <span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-18\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-20\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">context</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">stream_content_create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-22\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"https://example.com/register\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-23\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">response</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">stream_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d802492512575-24\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d802492512575-25\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>在这个例子中，我们正在尝试向API发出POST请求。 API终端是安全的，但我们仍然需要使用http上下文属性（用于http和https）。我们设置一些消息头参数，并打开一个文件句柄到API。由于上下文处理写操作，我们可以将句柄打开为只读。</p>\n<p>查看<a href=\"https://php.net/function.stream-context-create\" target=\"_blank\" rel=\"nofollow\">文档</a>了解更多<i>。</i></p>\n<h3>制定自定义协议和过滤器</h3>\n<p>在我们结束之前，让我们谈谈制定自定义协议。 如果你查看<a href=\"https://php.net/manual/en/class.streamwrapper.php\" target=\"_blank\" rel=\"nofollow\">文档</a>，你可以找到一个示例类来实现：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d806428520240\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nProtocol {\r\n    public resource $context;\r\n    public __construct ( void )\r\n    public __destruct ( void )\r\n    public bool dir_closedir ( void )\r\n    public bool dir_opendir ( string $path , int $options )\r\n    public string dir_readdir ( void )\r\n    public bool dir_rewinddir ( void )\r\n    public bool mkdir ( string $path , int $mode , int $options )\r\n    public bool rename ( string $path_from , string $path_to )\r\n    public bool rmdir ( string $path , int $options )\r\n    public resource stream_cast ( int $cast_as )\r\n    public void stream_close ( void )\r\n    public bool stream_eof ( void )\r\n    public bool stream_flush ( void )\r\n    public bool stream_lock ( int $operation )\r\n    public bool stream_metadata ( string $path , int $option , mixed $value )\r\n    public bool stream_open ( string $path , string $mode , int $options ,\r\n        string &amp;$opened_path )\r\n    public string stream_read ( int $count )\r\n    public bool stream_seek ( int $offset , int $whence = SEEK_SET )\r\n    public bool stream_set_option ( int $option , int $arg1 , int $arg2 )\r\n    public array stream_stat ( void )\r\n    public int stream_tell ( void )\r\n    public bool stream_truncate ( int $new_size )\r\n    public int stream_write ( string $data )\r\n    public bool unlink ( string $path )\r\n    public array url_stat ( string $path , int $flags )\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d806428520240-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d806428520240-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-1\"><span class=\"crayon-e\">Protocol</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-2\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-i\">resource</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-3\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-v\">_</span><span class=\"crayon-sy\">_</span>construct <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-4\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-v\">_</span><span class=\"crayon-sy\">_</span>destruct <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-5\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">_</span>closedir <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-6\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">_</span>opendir <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-7\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">_</span>readdir <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-8\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">_</span>rewinddir <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-9\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">mkdir</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">mode</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-10\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">rename</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">_</span>from <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">_</span>to <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-11\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">rmdir</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-12\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-i\">resource</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>cast <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">cast</span><span class=\"crayon-sy\">_</span>as <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-13\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>close <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-14\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>eof <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-15\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>flush <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-16\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>lock <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">operation</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-17\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>metadata <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">option</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">mixed</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">value</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-18\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>open <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">mode</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-19\">        <span class=\"crayon-t\">string</span> <span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">opened</span><span class=\"crayon-sy\">_</span>path <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-20\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>read <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">count</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-21\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>seek <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">offset</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">whence</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">SEEK</span><span class=\"crayon-sy\">_</span>SET <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-22\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream_set</span><span class=\"crayon-sy\">_</span>option <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">option</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">arg1</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">arg2</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-23\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">array</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>stat <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-24\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>tell <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-25\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>truncate <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">new</span><span class=\"crayon-sy\">_</span>size <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-26\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>write <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">data</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-27\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">unlink</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d806428520240-28\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">array</span> <span class=\"crayon-v\">url</span><span class=\"crayon-sy\">_</span>stat <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">flags</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d806428520240-29\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0086 seconds] -->\r\n<p>我们不打算实现其中的一个，因为我认为它应该有自己的教程。这里有很多工作需要完成。但是一旦这个工作完成，我们可以很容易地注册我们的流包装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d80b042420869\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif (in_array(\"highlight-names\", stream_get_wrappers())) {\r\n    stream_wrapper_unregister(\"highlight-names\");\r\n}\r\n\r\nstream_wrapper_register(\"highlight-names\", \"HighlightNamesProtocol\");\r\n\r\n$highlighted = file_get_contents(\"highlight-names://story.txt\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d80b042420869-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d80b042420869-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d80b042420869-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d80b042420869-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d80b042420869-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d80b042420869-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d80b042420869-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d80b042420869-1\"><span class=\"crayon-st\">if</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-e\">in_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"highlight-names\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-e\">stream_get_wrappers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d80b042420869-2\">    <span class=\"crayon-e\">stream_wrapper_unregister</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"highlight-names\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d80b042420869-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d80b042420869-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d80b042420869-5\"><span class=\"crayon-e\">stream_wrapper_register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"highlight-names\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"HighlightNamesProtocol\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d80b042420869-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d80b042420869-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">highlighted</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"highlight-names://story.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>同样，也可以创建自定义流过滤器。该<a href=\"https://php.net/manual/en/class.php-user-filter.php\" target=\"_blank\" rel=\"nofollow\">文档</a>有一个示例过滤器类：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d80e570991648\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFilter {\r\n    public $filtername;\r\n    public $params\r\n    public int filter ( resource $in , resource $out , int &amp;$consumed ,\r\n        bool $closing )\r\n    public void onClose ( void )\r\n    public bool onCreate ( void )\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d80e570991648-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d80e570991648-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d80e570991648-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d80e570991648-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d80e570991648-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d80e570991648-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d80e570991648-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d80e570991648-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d80e570991648-1\"><span class=\"crayon-e\">Filter</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d80e570991648-2\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">filtername</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d80e570991648-3\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">params</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d80e570991648-4\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-i\">filter</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-i\">resource</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-st\">in</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">resource</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">consumed</span> <span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d80e570991648-5\">        <span class=\"crayon-t\">bool</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">closing</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d80e570991648-6\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-i\">onClose</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1d5d80e570991648-7\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">onCreate</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d80e570991648-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>这可以很容易地注册：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1d5d811024015485\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$handle = fopen(\"story.txt\", \"w+\");\r\nstream_filter_append($handle, \"highlight-names\", STREAM_FILTER_READ);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1d5d811024015485-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1d5d811024015485-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1d5d811024015485-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"story.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w+\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1d5d811024015485-2\"><span class=\"crayon-e\">stream_filter_append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"highlight-names\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">STREAM_FILTER_READ</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>突出显示名称需要匹配新的筛选器类的filtername属性。也可以在php：//filter/highligh-names/resource=story.txt字符串中使用自定义过滤器。定义过滤器比定义协议要容易得多。因为协议需要处理目录操作，而过滤器只需处理每个数据块。</p>\n<p>如果你有这个想法，我强烈建议你尝试创建自定义协议和过滤器。如果你可以将过滤器应用于stream_copy_to_streamoperations，那么即使在使用大容量文件时，你的应用程序也可以在没有内存的情况下使用。想象一下，编写一个调整大小的图像过滤器或加密的应用程序过滤器。</p>\n<h2>总结</h2>\n<p>虽然这不是我们经常遇到的问题，但在处理大文件时很容易搞砸。在异步应用程序中，当我们不注意小心使用内存的话，很容易导致整个服务器宕机。<br>\n本教程希望向你介绍一些新的想法（或者让你重新认识他们），以便你可以更多地考虑如何高效地读取和写入大型文件。当我们开始熟悉流程和生成器，并停止使用像file_get_contents这样的函数时，我们的应用程序中就会减少错误的类别，这看起来是很好。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113339\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113339votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113339\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113339/", "comment_nums": 1, "create_date": "2017/12/17", "tags": "IT技术,php", "url_object_id": "14c027911b193616950f9c0ad1de58fd", "front_image_path": "full/63dbb7a09172c6338db7eec551434b92d3899476.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "谈谈 MySQL 隐式类型转换", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/dea4002e77dd3ecd398568bf746ea46c.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/1462914/blog/1572292\">andyqian</a>   </div><h4>前言</h4>\n<p>今天我们继续回到MySQL系列文章中,谈一谈MySQL中隐式类型转换。(其实我最早知道是在慢SQL优化中知道隐式类型转换概念的),在说隐式类型转换之前,首先我们通过一个实例来看看是怎么回事。</p>\n<h4>数据结构</h4>\n<p>本文中所有的操作,都是基于该数据结构(有兴趣的童鞋,可以实验):</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691f1dadb3d351804565\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncreate table t_base_user(   \r\noid bigint(20) not null primary key auto_increment,  \r\nname varchar(30) null comment \"name\",  \r\nemail varchar(30) null comment \"email\",  \r\nage int null comment \"age\",  \r\ntelephone varchar(30) null comment \"telephone\",  \r\nstatus tinyint(4) null comment \"0 无效 1 有效\",  \r\ncreated_at datetime null default now() comment \"创建时间\",  \r\nupdated_at datetime null default now() comment \"修改时间\"  )\r\n\r\n### 新建索引alter table t_base_user add index idx_email(email);\r\nalter table t_base_user add index idx_name(name);\r\nalter table t_base_user add index idx_telephone(telephone);\r\n\r\n### 新增记录: \r\nINSERT INTO `andyqian`.`t_base_user` (`name`, `email`, `age`, `telephone`, `status`, `created_at`, `updated_at`) \r\nVALUES ('111111', 'andytohome@gmail.com', '111', '12345678901', '1', now(),now());</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1dadb3d351804565-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1dadb3d351804565-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1dadb3d351804565-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1dadb3d351804565-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1dadb3d351804565-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1dadb3d351804565-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1dadb3d351804565-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691f1dadb3d351804565-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a691f1dadb3d351804565-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-1\"><span class=\"crayon-e\">create </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1dadb3d351804565-2\"><span class=\"crayon-e\">oid </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">primary </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">auto_increment</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-3\"><span class=\"crayon-e\">name </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1dadb3d351804565-4\"><span class=\"crayon-e\">email </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"email\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-5\"><span class=\"crayon-e\">age </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1dadb3d351804565-6\"><span class=\"crayon-e\">telephone </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"telephone\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-7\"><span class=\"crayon-e\">status </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0 无效 1 有效\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1dadb3d351804565-8\"><span class=\"crayon-e\">created_at </span><span class=\"crayon-e\">datetime </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"创建时间\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-9\"><span class=\"crayon-e\">updated_at </span><span class=\"crayon-e\">datetime </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改时间\"</span><span class=\"crayon-h\"> </span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1dadb3d351804565-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-11\"><span class=\"crayon-p\">### 新建索引alter table t_base_user add index idx_email(email);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1dadb3d351804565-12\"><span class=\"crayon-e\">alter </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">idx_name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-13\"><span class=\"crayon-e\">alter </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">idx_telephone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">telephone</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1dadb3d351804565-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-15\"><span class=\"crayon-p\">### 新增记录: </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691f1dadb3d351804565-16\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-i\">INTO</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">andyqian</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_base_user</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">age</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">telephone</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">created_at</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">updated_at</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a691f1dadb3d351804565-17\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'111111'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'andytohome@gmail.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'111'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'12345678901'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p></p>\n<h4>引子</h4>\n<p>首先我们基于上述数据结构中,我们来看看下面这个执行计划:</p>\n<blockquote><p>explain select * from t_base_user where telephone=12345678901;</p></blockquote>\n<p>执行计划结果:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/05cc14303bda573f6977d4d18c48c42a.png\"><img class=\"alignnone size-full wp-image-113317\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/05cc14303bda573f6977d4d18c48c42a.png\" alt=\"QQ截图20171214105031\"></a></p>\n<p>细心的童鞋应该已经看出来了,为什么数据结构中已经在telephone字段上新建了idx_telephone索引，而上述语句并没有走索引,而是全表扫描。这是为什么呢？带着这疑问,我们来看看今天的主角——MySQL隐式类型转换</p>\n<h4>什么是隐式类型转换？</h4>\n<p>在MySQL中:</p>\n<blockquote><p>当操作符与不同类型的操作数一起使用时，会发生类型转换以使操作数兼容。则会发生转换隐式</p></blockquote>\n<p>也就是说,MySQL会根据需要自动将数字转换为字符串，将字符串转换数字。看到这个概念之后,是不是有一种茅塞顿开的感觉。哦… 原来在数据结构中telephone字段为字符串(varchar)类型,而我们传的手机号是数字类型。现在我们将SQL修改下:</p>\n<blockquote><p>select * from t_base_user where telephone=’12345678901′;</p></blockquote>\n<p>再看看上述语句的执行计划:</p>\n<blockquote><p>explain select * from t_base_user where telephone=’12345678901′;</p></blockquote>\n<p>结果:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/70ee38005ac1816b149f228df6287fd2.png\"><img class=\"alignnone size-full wp-image-113318\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/70ee38005ac1816b149f228df6287fd2.png\" alt=\"QQ截图20171214105207\"></a></p>\n<p>从这里看,现在语句已经走索引了。为了加深我们对隐式类型转换的印象,我们再多看看几个隐式类型转换案例:</p>\n<p>案例一: 字符串转换为数字</p>\n<blockquote><p>mysql &gt; SELECT 1+’1′;</p></blockquote>\n<p>结果:</p>\n<blockquote><p>mysql &gt; 2</p></blockquote>\n<p>案例二: 数字转换为字符串</p>\n<blockquote><p>mysql -&gt; SELECT CONCAT(1024,’ andyqian’);</p></blockquote>\n<p>结果:</p>\n<blockquote><p>‘1024,’ andyqian’;</p></blockquote>\n<p>此时CONCAT(字符拼接)函数就将1024进行了隐式类型转换。</p>\n<h4>如何避免隐式类型转换?</h4>\n<p>只有当清楚的知道隐式类型转换的规则，才能从根本上避免产生隐式类型转换。MySQL也在官网描述了进行隐式类型转换的一些规则如下:</p>\n<p>1. 隐式类型转换规则:</p>\n<ul>\n<li>如果一个或两个参数都是NULL，比较的结果是NULL，除了NULL安全的&lt;=&gt;相等比较运算符。对于NULL &lt;=&gt; NULL，结果为true。不需要转换</li>\n<li>如果比较操作中的两个参数都是字符串，则将它们作为字符串进行比较。</li>\n<li>如果两个参数都是整数，则将它们作为整数进行比较。</li>\n<li>如果不与数字进行比较，则将十六进制值视为二进制字符串</li>\n<li>如果其中一个参数是十进制值，则比较取决于另一个参数。 如果另一个参数是十进制或整数值，则将参数与十进制值进行比较，如果另一个参数是浮点值，则将参数与浮点值进行比较</li>\n<li>如果其中一个参数是TIMESTAMP或DATETIME列，另一个参数是常量，则在执行比较之前将常量转换为时间戳。</li>\n<li>在所有其他情况下，参数都是作为浮点数（实数）比较的。</li>\n</ul>\n<p>2. 使用CAST函数显示转换<br>\n我们可以使用CAST显示的将类型进行转换,如下所示:</p>\n<blockquote><p>mysql&gt; SELECT 38.8, CAST(38.8 AS CHAR);</p></blockquote>\n<p>结果:</p>\n<blockquote><p>mysql &gt; 38.8, ‘38.8’</p></blockquote>\n<p>如上述中:</p>\n<blockquote><p>select * from t_base_user where telephone=cast(12345678901 as char);</p></blockquote>\n<p>查看执行计划,我们也可以看出</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/383bbad2ced38d0ca41ae862eaae9165.png\"><img class=\"alignnone size-full wp-image-113319\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/383bbad2ced38d0ca41ae862eaae9165.png\" alt=\"QQ截图20171214105349\"></a></p>\n<p>你看,这个时候也走索引了。</p>\n<p>3. 类型一致<br>\n这里说的类型一致,指的是在写SQL时,参数类型一定要与数据库中的类型一致,避免产生隐式类型转换,就如刚才在文首时,如果多检查,写的SQL的参数类型与数据库中字段类型一致，也就不会不走索引了，你说是不是？</p>\n<h4>小心隐式类型转换</h4>\n<p>这里再重申一次,写SQL时一定要检查参数类型与数据库字段类型一致,(如果参数不一致,也要使用CAST函数显示转换成一致)否则造成隐式类型转换,不走索引,后果简直不堪设想, 在前面<a href=\"http://mp.weixin.qq.com/s?__biz=MzI2NDU3OTg5Nw==&amp;mid=2247483736&amp;idx=1&amp;sn=e3fa0bf61b77c9ca12ee1d295c51313a&amp;scene=21#wechat_redirect\" rel=\"nofollow\">《写会MySQL索引》</a>这篇文章中提到过,不走索引,轻则造成慢查询，重则造成数据库服务器CPU100%。唉,说到这里,不瞒你说，我就吃过不少MySQL隐式类型转换的亏 ! (如慢查询) !</p>\n<h4>小结</h4>\n<p>看到这里,是不是有一种,数据表设计还真不是件容易的事情。需要考虑的因素太多太多了,需要考虑字段类型,索引设计,还有各种约束条件等等。也一定要谨慎谨慎再谨慎！其实换个角度就更容易理解了,大家都知道高楼大厦都是需要一个好的地基的,在数据库表设计中,前期的表结构设计就是这个地基，其重要性可想而知。</p>\n<p>从后续开始,每篇MySQL文章最后,都推荐一个常用且实用的MySQL命令:</p>\n<p>今天的命令是:</p>\n<blockquote><p>show full columns from table_name;</p></blockquote>\n<p>作用: 显示指定表所有列信息</p>\n<p>例如:</p>\n<blockquote><p>show full columns from t_base_user;</p></blockquote>\n<p>返回结果如下图所示:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0ae91cc856d3e41ea81248f9f6d7d9af.png\"><img class=\"alignnone size-full wp-image-113320\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0ae91cc856d3e41ea81248f9f6d7d9af.png\" alt=\"QQ截图20171214105501\"></a></p>\n<p>其中:<br>\nField: 字段名<br>\nType: 该字段类型<br>\nCollation: 描述了如何对查询出来的数据进行比较和排序<br>\nNull: 是否允许为空, NO: 不允许，YES 允许<br>\nKey: 键,例如: 主键(PRI), 唯一键(UNI) 等<br>\nDefault: 该字段默认值 Extra: 附加信息如自增主键上的(auto_increment)<br>\nPrivileges: 权限,有select,update等<br>\nComment: 字段注释</p>\n<p>注意: 通过该命令显示都是建表时的信息,这里着重强调一下,在数据库建表时,在每个字段上, 一定要加注释,加注释，加注释！</p>\n<p><strong>最后:  </strong>大家今天剁手了吗？ 祝大家晚安!</p>\n<p>相关阅读:</p>\n<p><a href=\"http://blog.jobbole.com/113142/\" target=\"_blank\" rel=\"nofollow\">写会MySQL索引</a></p>\n<p><a href=\"http://blog.jobbole.com/112877/\" target=\"_blank\" rel=\"nofollow\">读懂MySQL执行计划</a></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113315\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113315votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113315\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113315/", "comment_nums": 0, "create_date": "2017/12/14", "tags": "IT技术,MySQL,数据库", "url_object_id": "8044183d5be6bd3a67d777b3e5b0d219", "front_image_path": "full/75f6595b87bc254afe77bc1151f1aea91fb72f4b.jpg"}
{"fav_nums": 0, "praise_nums": "1", "title": "最早做游戏设计与开发的女程序员", "front_image_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz312xf4mj207r09madg.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.fastcodesign.com/90147592/rediscovering-historys-lost-first-female-video-game-designer\">BENJ EDWARDS</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>第一批电子游戏程序员之一是一位年轻女性，那时她刚从高中毕业。</p>\n<p>四十年前，消费电子产品巨头 RAC 发布了 Studio II。这是一款可编程的电子游戏控制台，与 <a href=\"https://www.fastcompany.com/3040889/the-untold-story-of-the-invention-of-the-game-cartridge\">Fairchild Channel F</a> 一起，率先使用只读存储器盒（ROM cartridge）作为可交换的游戏媒体。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz312xf4mj207r09madg.jpg\" width=\"279\" height=\"346\"></p>\n<p>RCA 的控制台永远没能比得上 Atari 的 VCS，Magnavox 的 Odyssey，或者 Mattel 的 Intellivision。而且现在几乎没人记得它。但是它背后的真实故事是迷人的。它的基础技术始于 1969 年，当时一位有远见的人——Joseph Weisbecker——在家中开发出个人电脑。他的女儿 Joyce 最终成为了已知最早的女性开发者，她编写电子游戏并为此拿报酬。</p>\n<p>Joyce Weisbecker 的工作成果太不出名了，以至于在 2011 年，我宣称 <a href=\"http://www.vintagecomputing.com/index.php/archives/800/vcg-interview-carol-shaw-female-video-game-pioneer-2\">Carol Shaw</a> 为“第一位女性专业电子游戏设计师”。<a href=\"http://www.vintagecomputing.com/index.php/archives/800/vcg-interview-carol-shaw-female-video-game-pioneer-2\">Carol Shaw</a> 从 1978 年开始在 Atari 工作，并在之后设计了 Activision 的经典游戏 <i>River Raid</i>。而 Joyce Weisbecker 的成果是由一位科技历史学家提醒我的。尽管 Shaw 的工作成果依然在历史上很重要，但是实际上，Joyce Weisbecker 的成果要比她的早大约两年。</p>\n<p>而且 Joyce 是在没有成为 RCA 工作人员的情况下完成的。她现在说：“我知道当时 RCA 没有其他女性做开发工作。开发工作是由一些男性来做的，而且他们都是员工。我想我是唯一一个收钱开发电子游戏的公司外的人。所以我是第一个合同工，可能也是第一个独立的电子游戏开发者，因为我想到了这个主意又推销了它，然后他们说行。”</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmz313s7zpj20g3092qaf.jpg\" width=\"579\" height=\"326\"></p>\n<h2>流在她血液里的工程学</h2>\n<p>Joyce Weisbecker 于 1958 年出生于新泽西州。她记得在童年时期，看着她的爸爸——一个固执的爱好者——利用白天不在 RCA 工作的时间，开发逻辑游戏，为当地魔术师设计舞台幻象并在地下室建造电子发明。她的妈妈 Jean Ann 是一位三年级教师。Jean 强调教育的价值，并鼓励大女儿追寻她天生的追求。</p>\n<p>无论什么时候，Joyce 一有机会就跟着去父亲在 RCA 的办公室，看看开发是什么。在那里，工程师们亲切地看着这个女孩，她似乎自然地吸收了展示给她的所有东西，包括一个由 RCA 爱玩的工程师在 20 世纪 60 年代中期开发的台球电子游戏原型。</p>\n<p>除了 Joseph 在 RCA 的工程工作外，他还被电脑的未来深深吸引着。在他读了 Edmund Berkeley 1949年的一本开创性的书——<i>Giant Brains </i>或者叫<i> Machines that Think ——</i>之后，他就迷上了这个领域。Joyce 讲述了她的父母在 1955 年秋天第一次相遇的故事，她的父亲告诉她母亲，某一天电脑会急剧微型化，并被装进几乎所有东西里——冰箱、打字机和烤箱。</p>\n<p>当 Joseph 最初迷上电脑时，电脑基本上就是真空管供电的庞然大物，需要用一个小城市的电力来操作。所以年长的 Weisbecker 用任何人能在纸上演算的计算技巧进行了大量实验。在 20 世纪 60 年代，他甚至写了一本平装书来跟你玩井字棋游戏（Tic-Tac-Toe），依据你选的哪一页书（也就是走哪一步）。</p>\n<p>随着科技的进步，Joseph 开始在家用电脑进行实验。一个叫作 Heathkit 的公司销售各种各样的电子产品和器具，任何人都可以订购未组装的产品，自己组装。Joyce 说：“他想买一个 Heathkit 的产品来建一个电脑。但是既然没有现成的，他决定把设计一个电脑的 Heathkit 作为一生的目标，这样任何人都能买来造一台电脑。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz314gnjej20fz093n40.jpg\" width=\"575\" height=\"327\"></p>\n<p>那时，典型的迷你电脑的价格在 $6,000 到 $25,000 之间。（为正确看待它，1972 年的美国户均年收入为 $11,286。）Joseph 晚上在地下室工作几个小时，自己用分离的元件和电路设计了一个完整的电脑系统，包括一个定制的中央处理器。</p>\n<p>Joyce 记得 1969 年陪父亲去 Radio Shack 商店购买他电脑原型的元件。他得去四个不同的商店买足够的开关和元件来制作电脑的前面板。前面板包含八个开关，每个开关都针对一个指令位。一路上他都对他的计划闭口不谈，这样就不会引起店主的怀疑，否则这些店主必然就会用关于家庭电脑的问题耽误他的时间。家庭电脑在那时是神奇疯狂的想法。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3151cq5j20ft09342a.jpg\" width=\"569\" height=\"327\"></p>\n<p>在 Joseph 快完成第一个家庭个人电脑原型时，他决定把他的电脑称为 FRED，或者灵活的娱乐教育设备（Flexible Recreational Educational Device）。他自己掏腰包做了一个笑脸标志，并在 1970年、1971 年及 1972 年持续工作。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz316ch12j20gl0bpgzb.jpg\" width=\"597\" height=\"421\"></p>\n<h2>从 FRED 到 STUDIO II</h2>\n<p>Joyce 家 1300 平方英尺的房子在切里希尔（Cherry Hill）。Joyce 的父亲在地下室完成 FRED 之后，把他的机器放在餐厅旁的封闭后阳台。很快 Joyce 和她的小妹妹 Jean 就在父亲的鼓励下玩起了 FRED。Joyce 甚至开始了编程。</p>\n<p>她回忆说：“这是自然而然的兴趣。爸爸向我和妹妹演示了怎么做。我妹妹更喜欢上马术课。但是我想：’这就像很酷的谜题。这就是谜题的本质——它要么抓住你的兴趣，要么不。’”它一定抓住了 Joyce 的兴趣，Joyce 是她高中为数不多学习使用学校的可编程 100 步计算器的人之一。</p>\n<p>Joseph Weisbecker 在 RCA 的经理注意到了 FRED，但是他们最初持怀疑态度。在 20 世纪 70 年代早期，RCA 有号召力的长期领导 David Sarnoff 退休，RCA 随之退出了其黄金时代。他的辞职使得公司群龙无首，尽管他的儿子带领 RCA 走向无数方向，包括收购地毯公司和养鸡场。另外，RCA 由于最近向大型电脑市场进军的尝试失败而受损，导致数百万美元的贬值。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3174s1ej20g8091n52.jpg\" width=\"584\" height=\"325\"></p>\n<p>大约 1973 年，RCA 将其注意力转回电脑上，Joseph 的自制 8 位电脑体系结构成为了官方用芯片建完整电脑项目的一部分。结果有了 Cosmac 1801 系列，它是 1975 年首次商用的两芯片微处理器系统。（后来改进为单芯片，Cosmac 1802，发布于 1976 年。）RCA 管理层把项目转向工业应用的内置电脑控制方向，但是老 Weisbecker 从没放弃为大众创造教育电脑的梦想。</p>\n<p>大约在 Atari 的 <i>Pong </i>火起来的时候，Joseph 试着向 RCA 推销可编程家庭电子游戏控制台的想法，但是管理层最初对这个想法没有兴趣。大约 1975 年，FRED 技术进入了拥有可交换软件的硬币操控的街机电子游戏柜。该项目很快成为泡影。但是最终，Joseph 的努力促成了一些家庭电脑产品，包括 DIY 个人电脑 Cosmac VIP 和游戏控制台 Studio II。</p>\n<p>Joyce Weisbecker 说：“他们拖了一年来决定他们向进入家庭市场。然后他们又花了一年多一点时间才真正做出来。而且还绕过了 FCC 认证。”</p>\n<p>根据 Joyce 所说，尽管 Studio II 直到 1977 年一月才公布——那是 Fairchild Channel F 进入市场几个月后——所用的技术，包括盒里的游戏，在 1975 年就准备好了。她说：“我觉得我对这件事有点愤愤不平，他本可以成为第一个。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz317saz6j20g5093tgo.jpg\" width=\"581\" height=\"327\"></p>\n<h2>工作中的 WEISBECKERS</h2>\n<p>基于 Joyce 父亲工作成果的家庭电子产品出现了。这为刚刚高中毕业的 Joyce 提供了一个机会。在 1976 年夏天，也是在瑞德大学第一个学期开始前的假期，Joseph 问她是否想为 RCA 编写电子游戏。</p>\n<p>她已经对她父亲的机器有了丰富的经验，便一头扎进了为 RCA Cosmac VIP 编写演示游戏的工作中。RCA Cosmac VIP 是廉价的商业电脑组件。它是基于 Joseph 的 FRED 来设计的，既作为原始家庭个人电脑，也作为 Cosmac 1802 CPU 应用的开发组件。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz318e5d8j20ev07mmz1.jpg\" width=\"535\" height=\"274\"></p>\n<p><i></i><i>Snake Race</i> 和 <i>Jackpot </i>是 Joyce 在 RCA 的编程首秀，尽管她没有为此收取报酬。她的父亲用来执行 VIP 项目的预算并不充足。RCA 把她写的软件包括在 VIP 使用手册的登记项目中，由机器所有者手动键入。</p>\n<p>但是很快 Joyce 就从 RCA 拿到了她的第一笔收入。随着  Studio II 家庭游戏控制台的工作准备好了，公司开始寻找软件。RCA 的雇员 Andy Modla 完成了 Studio II 10 盒的大部分发布，但是老 Weisbecker 把这看成她女儿获得更多编程经验的好机会。</p>\n<p>至于她女儿的控制台首秀的主角，Joseph 转向了他最喜欢的关注点：教育。把 Studio II 既看作廉价家庭电脑，又看作游戏控制台。他建议 RCA 利用它与子公司 Random House 教科书事业的联系。（该出版社是 RCA 疯狂混乱的经营多样化时期收购的不相关的公司。）</p>\n<p>八月份的某一天，Joseph 回家说：“他们在找人做关于 Studio II 的测验。你想做吗？”</p>\n<p>Joyce 回复道：“听起来挺无聊的。”</p>\n<p>他说：“写到你的简历上，你还能得到报酬呢。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3191lt5j20g80bj11q.jpg\" width=\"584\" height=\"415\"></p>\n<p>根据 Joyce 保存的发票来看，这开始于一个叫做 <i>TV Schoolhouse I </i>的项目。Joyce 于 1976 年八月初编写完 TV Schoolhouse I，于八月九号提供给 RCA 并拿到了 250 美元的收入。编写这个简单游戏花了她大约一周时间。她在父亲的 FRED 原型机上工作，用纸笔写下集合代码，用十六进制的键盘输进电脑，一次一条命令。与她早期为 RCA 做的的编程工作不同，她的早期工作为她在 Cosmac VIP 使用手册上赢得了称赞，而这次她是匿名工作的。</p>\n<p><i></i><i>TV Schoolhouse I </i>是双玩家电脑测验，依赖于打印的来自盒的问题集。每个玩家轮流读小册子里的问题，然后用 Studio II 的键盘输入一个单选答案。程序会检查正确答案并在屏幕上计分。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz319r583j20gg0cf7e0.jpg\" width=\"592\" height=\"447\"></p>\n<p>1976 年十月，Joyce 编写了两个动作游戏：<i>Speedway</i> 和 <i>Tag</i>。在 <i>Speedway</i> 里，玩家驾驶一辆小车行驶在头顶上的赛道，与第二个人类玩家比赛。只有一个问题：Studio II 极低的 64 图形分辨率的 32 像素没给细节留下多大空间。</p>\n<p>Joyce 说：“和现代电脑打交道的人不能理解这样的限制。困难的部分不是把代码放进 2K 或者运行一个缓慢的处理器——你能用它做很多事情。问题是你怎么在有限的东西上展现这个游戏？你有两个等级的、黑白的、32 比 32 窗口图标，那就是你整个屏幕。”</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz31a7yq0j20fz0acwep.jpg\" width=\"575\" height=\"372\"></p>\n<p>这些限制解释了为什么在 <i>Speedway </i>里，Joyce 选择用两个白色方块代表赛车，其中一个中间有个黑点。她说：“人们批评说：’哦，是啊，这看起来根本不像个车。’你试试啊！你知道吗？你试试做一个能整个放进两个窗口图标里的游戏。”</p>\n<p>Joyce 的 <i>Tag </i>是一个更简装的东西。在这个双玩家游戏中，每个玩家控制屏幕上的一个简单的点。一个玩家是“it;”，他必须引导他们的点远离另一个玩家的点，这样他们就不会碰到。每次游戏都有两分钟长，得到最高分的人（每次接触得 10  分）赢得游戏。</p>\n<p><i></i><i>Tag </i>代表能用两个点在屏幕上玩的几乎最简单的电子游戏。巧合地是，一个相似的游戏是第一个 TV 基础上的电子游戏，由 Sanders Associates 的 Ralph Baer 和 Bill Harrison 在 1967 年创造（Baer 把它叫做“追逐游戏”）。</p>\n<p>RCA 在一个盒中发布了这两个游戏，这是 Weisbecker 自己做的选择。她回忆说：“在 <i>Speedway </i>上我还有多余的空间。<i>Tag </i>太简单了不能放在它自己单独的盒里。我想提高 RCA 想买我的赛车游戏的机会。”</p>\n<p>RCA 确实买了它，由一张 1976 年 11 月 28 日的发票证明。她说这两个游戏花了她 200 个小时来工作。她回忆说：“我十月份发送了代码并给他们开了账单。但显然，要么他们不喜欢它，要么我意识到我本来能让它更快。在十一月，我给他们发送了修改版本，那是他们发布的版本。”</p>\n<p>在考虑到这些游戏的历史意义时，必须记着 Studio II 的局限——以及这些早期游戏来自于一个刚刚高中毕业的人，那时只有极少美国人拥有电脑或者与电脑有交集。当然，那时她已经在世界上第一台家庭电脑上编程了好几年。世界很快会跟上步伐：1976年末，美国会卖出 40,000 台个人电脑。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz31b06cwj20gf097ak1.jpg\" width=\"591\" height=\"331\"></p>\n<h2>发布失败</h2>\n<p>在市场上没能打败更有能力的 Fairchild Channel F，Studio II 在发布时就被淘汰了。Atari 后来在 1977 年发布了未来的控制台 VCS。</p>\n<p>除了低像素，Studio II 的主要缺点之一是它的内置 Touch Tone，像是键盘控制器，没有操控杆的选择。Joyce 为键盘给出了几个理由，包括降低制造价格来达到 150 美元价格点的诉求，以及 RCA （和 Joseph Weisbecker）打算在计划的替代物发布之前把 Studio II 作为权宜之计的事实。包括彩色 Studio III 游戏控制台，中间的 Studio IV 家庭个人电脑以及完全合格的 Studio V 电脑。Joyce 说：“当你有一个高分辨率的全色彩屏幕，是的，你才把操控杆放上去。那是为了后来的新版软件，与家庭电脑或者高级电子游戏系统搭配，如果你能走到那一步的话。”</p>\n<p>由于技术限制和有限的游戏库，Studio II 经营惨淡，RCA 在仅仅一年后撤下了该产品，也就是 1978 年二月。</p>\n<p>Joseph Weisbecker 发现自己受阻受挫，有着很多永不见天日的教育电脑产品计划。但是对 RCA 来说，这些消费电子产品永远是次要的考虑，Joyce 说：“RCA 管理层永远不想踏进电子游戏市场了。”他们仅仅想为他们的半导体找到市场。</p>\n<p>根据该目标判断，1802 CPU 取得了巨大的成功。虽然 RCA 在娱乐和家庭电脑产品上永远进行得不好，但是它在移动电话、心脏起搏器甚至太空探测器（比如 1989 年发射的 <i>Galileo</i>，探索木星和它的卫星）领域中找到了位置。芯片的一个版本今天仍然被制造，并为它的错误忍耐力和物理强度受到称赞。该芯片包含与 Joseph Weisbecker 在 1969 年为其家庭电脑设计相同的电脑架构。</p>\n<p>由于 Studio II 的短暂寿命，Joyce 与控制台的关系迅速结束。她说：“他们没有销售足够多的游戏，以至于从来没有回来向我要更多。”她从来没机会在零售店货架上看到她的第一个商业电子产品，但是她为自己做了一份拷贝。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmz31bozg2j20gh097n2r.jpg\" width=\"593\" height=\"331\"></p>\n<h2>RCA 之后的生活</h2>\n<p>1977 年，Joyce 在还与 RCA 签有合同的情况下，为 VIP 包含的登记项目（叫做RCA Cosmac VIP Game Manual）的商业供给编写了三个游戏 <i>Slide</i>, <i>Sum Fun</i>, 和 <i>Sequence Shoot</i>。之后，她的合同过期了。到决定是否继续追求游戏开发的时候，她决定专心于学校，选择了稳定，而不是向迅速发展的早期家庭个人电脑游戏市场前进的不确定性。</p>\n<p>Joyce 说：“你看了看周围，说，’好吧，我真的想在家生活，每天晚上复制录音带，然后去邮局，复印指导手册，在回家把他们放进塑料 Ziploc 袋子里然后邮寄给人们吗？’那就是那时的电脑游戏行业。”</p>\n<p>Joyce 在里德大学继续她的大学生涯，直到她在 1980 年取得了电脑工程和精算双学位。她从事了精算师工作，部分受到她父亲的偶像 Edmund Berkeley 的鼓舞。Edmund Berkeley 正是做了同样的工作。在 1998 年，她回到学校取得了电子工程的本科学位和计算机科学的研究生学位，并作为雷达信号处理工程师工作了一段时间，设计数字滤波器。最近几年，她又对游戏开发起了兴趣。她解释说：“我试着准备做真正有趣的 AI 和电脑辅助动画。因为我意识到我想做有故事基础的合作游戏。”</p>\n<p>至于她的父亲， Joseph 继续在 RCA 工作到 1982 年，那时肺气肿使得他开车去工作变得危险。他坚持认为肺的损伤来自于常年在家里地下室的狭小空间里焊接东西时吸入的树脂烟雾。Joyce 回忆说：“那是他的 Radio Shack 通量。”他在退休时仍然是一个爱好者，还是电子游戏的献身者，尤其是 <i>The Legend of Zelda</i>。他在 1990 年去世。</p>\n<p>回望过去，Joyce Weisbecker 不是特别想作为第一位女性电子游戏开发者出名。对她来说，那仅仅是个巧合。她把自己看为可能是第一位“非主流”电子游戏开发者，因为她是一个独立的合同工，而不是 RCA 的雇员。</p>\n<p>但是，她淡化了她作为一个科技英雄的角色。在我第一次询问她的过去时，她马上被我对她的成就的注意力所震惊。她说：“你是第一个问我的工作的人。我只准备好谈我父亲的工作，而我只是个脚注。”</p>\n<p>好吧，我在这要说 Joyce Weisbecker 绝不是个脚注。对科技历史上的每一个 Steve Jobs 和 Bill Gates 来说，有像她一样被忘记的先驱。通过纪念她在上世纪 70 年代的成就，当家庭电子游戏市场几乎被忘记时，我们可以帮助未来的工程师和科学家的更包容的未来铺平道路。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113401\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113401votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113401\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 16</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113401/", "comment_nums": 0, "create_date": "2017/12/30", "tags": "其他", "url_object_id": "d319eedfb1e9cbc1005652a308ca61e9", "front_image_path": "full/34af66ec0a5fd8bfe9417796de5cea3f5953ab7c.jpg"}
{"fav_nums": 1, "praise_nums": "1", "title": "PostgreSQL 查询成本模型", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/PostgreSQL-logo.gif"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://shiroyasha.io/the-postgresql-query-cost-model.html\">igor_sarcevic</a>   译文出处：<a target=\"_blank\" href=\"http://blog.csdn.net/dev_csdn/article/details/78841624\">CSDN/无阻我飞扬</a>   </div><p><em>摘要：PostgreSQL是一个自由的对象-关系数据库服务器(数据库管理系统)，被业界誉为“最先进的开源数据库”，本文作者以代码实例说明了如何计算和评估PostgreSQL查询成本，以下是译文。</em></p>\n<p>数据库查询速度如果太慢会从很多方面损害机构，比如可能会损害一些优秀应用程序的声誉，因为数据库查询速度过慢，造成后台处理速度慢得令人痛苦，并大幅增加基础设施的成本。作为一名经验丰富的Web开发人员，了解数据层的优化策略是绝对必要的。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/e5e6809a4b86af8aff9897d8f816be4c.jpeg\" alt=\"这里写图片描述\"></p>\n<p>在本文中，我们将探讨PostgreSQL的成本模型，如何了解<code>explain</code>命令（关于explain命令可参见这篇<a href=\"http://toplchx.iteye.com/blog/2091860\" target=\"_blank\">文章</a>）的输出，最重要的是如何利用这些模型数据来提高应用程序的吞吐量。</p>\n<h1 id=\"使用postgresql-explain-命令\">使用PostgreSQL Explain 命令</h1>\n<p>在应用程序中部署一个新的查询语句之前，最好通过PostgreSQL中的 <code>explain</code>中的命令来运行它，以评估新查询对应用系统性能的影响。</p>\n<p>以一个示例数据库表开始，来说明<code>explain</code>命令的用法。这个表存有一百万条数据记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447ce7279814070\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # CREATE TABLE users (id serial, name varchar);\r\n\r\ndb # INSERT INTO users (name) SELECT 'John'\r\n FROM generate_series(1, 1000000);\r\n\r\ndb # SELECT count(*) FROM users;\r\n      count\r\n\r\n 1000000\r\n(1 row)\r\n\r\ndb # SELECT id, name FROM users LIMIT 10;\r\n id | name\r\n----+------\r\n  1 | John\r\n  2 | John\r\n  3 | John\r\n  4 | John\r\n  5 | John\r\n  6 | John\r\n  7 | John\r\n  8 | John\r\n  9 | John\r\n 10 | John\r\n(10 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447ce7279814070-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447ce7279814070-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># CREATE TABLE users (id serial, name varchar);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-3\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># INSERT INTO users (name) SELECT 'John'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">generate_series</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-6\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SELECT count(*) FROM users;</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-i\">count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-12\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SELECT id, name FROM users LIMIT 10;</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-14\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-18\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-24\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447ce7279814070-25\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447ce7279814070-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>假设需要用一个给定的id来查找一个用户名，但是在部署新的查询代码之前，要评估这个查询操作的成本。运行一个explain语句来做相关查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447cf2945238644\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n        QUERY PLAN                  \r\n--------------------------------------------------\r\n Gather  (cost=1000.00..11614.43 rows=1 width=9)\r\n   Workers Planned: 2\r\n           -&gt;  Parallel Seq Scan on users  (cost=0.00..10614.33 rows=1 width=9)\r\n     Filter: (id = 870123)\r\n\r\n(4 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf2945238644-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf2945238644-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf2945238644-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf2945238644-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf2945238644-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf2945238644-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf2945238644-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf2945238644-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf2945238644-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf2945238644-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf2945238644-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf2945238644-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf2945238644-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf2945238644-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span><span class=\"crayon-h\">                  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf2945238644-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf2945238644-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Gather</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000.00..11614.43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf2945238644-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">Workers </span><span class=\"crayon-v\">Planned</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf2945238644-7\"><span class=\"crayon-h\">           </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Parallel </span><span class=\"crayon-e\">Seq </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..10614.33</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf2945238644-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf2945238644-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf2945238644-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf2945238644-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>在上面的例子中有很多的输出，但是可以得到它的要点。为了运行这个查询，PostgreSQL计划启动两个并行的工作进程（workers）。每个工作进程将在表上进行顺序扫描，最后，收集器合并来自两个工作进程的结果。</p>\n<p>在本文中，重点介绍上面输出的<code>cost</code>以及PostgreSQL如何计算它。</p>\n<p>为了简化成本探索，运行上面的查询，但限制可并行的工作进程数量为0。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447cf6519724285\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SET max_parallel_workers_per_gather = 0;\r\n\r\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n                   QUERY PLAN\r\n--------------------------------------------------\r\n Seq Scan on users  (cost=0.00..17906.00 rows=1 width=9)\r\n   Filter: (id = 870123)\r\n\r\n(2 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf6519724285-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf6519724285-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf6519724285-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf6519724285-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf6519724285-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf6519724285-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf6519724285-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf6519724285-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf6519724285-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cf6519724285-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cf6519724285-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf6519724285-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SET max_parallel_workers_per_gather = 0;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf6519724285-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf6519724285-3\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf6519724285-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf6519724285-5\"><span class=\"crayon-h\">                   </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf6519724285-6\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf6519724285-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Seq </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..17906.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf6519724285-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf6519724285-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cf6519724285-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cf6519724285-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>这有点简单。在只有单CPU内核的情况下，评估成本是<code>17906</code>。</p>\n<h1 id=\"成本值背后的数学\">成本值背后的数学</h1>\n<p>在PostgreSQL中，成本或惩罚点大多是一个抽象的概念。PostgreSQL可以执行查询的方式很多，而PostgreSQL总是选择最低成本值的执行规划。</p>\n<p>计算成本，PostgreSQL首先查看表的字节数大小。接下来看看用户表的大小。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447cfa792226354\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # select pg_relation_size('users');\r\n\r\n pg_relation_size\r\n--------------------------\r\n     44285952\r\n(1 row)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cfa792226354-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cfa792226354-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cfa792226354-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cfa792226354-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cfa792226354-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cfa792226354-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cfa792226354-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447cfa792226354-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># select pg_relation_size('users');</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cfa792226354-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cfa792226354-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pg_relation_size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cfa792226354-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cfa792226354-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cfa792226354-6\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cfa792226354-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>PostgreSQL会为每个要依次读取的块添加成本点。如果知道每个块都包含了<code>8kb</code>，那么就可以计算从表中读取的顺序块的成本值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447cfe280019091\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nblock_size = 8192 # block size in bytes\r\nrelation_size = 44285952\r\n\r\nblocks = relation_size / block_size # =&gt; 5406\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cfe280019091-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cfe280019091-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cfe280019091-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447cfe280019091-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447cfe280019091-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447cfe280019091-1\"><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8192</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># block size in bytes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cfe280019091-2\"><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cfe280019091-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447cfe280019091-4\"><span class=\"crayon-v\">blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 5406</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447cfe280019091-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>现在，已经知道块的数量，找出PostgreSQL为每个块读取分配多少个成本点。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447d01686711712\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW seq_page_cost;\r\n seq_page_cost\r\n ----------\r\n 1\r\n(1 row)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d01686711712-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d01686711712-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d01686711712-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d01686711712-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d01686711712-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d01686711712-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447d01686711712-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW seq_page_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d01686711712-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seq_page_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d01686711712-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d01686711712-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d01686711712-5\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d01686711712-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>换句话说，PostgreSQL为每个块分配一个成本点。这就需要 <code>5406</code>个成本点从表中读取数据。</p>\n<p>从磁盘读取值并不是PostgreSQL需要做的。它必须将这些值发送给CPU并应用一个<code>WHERE</code>子句过滤。对于这个计算来说，如下的两个值非常有趣。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447d05170832032\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW cpu_tuple_cost;\r\n\r\n cpu_tuple_cost\r\n--------------------\r\n  0.01\r\ndb # SHOW cpu_operator_cost;\r\n cpu_operator_cost\r\n ----------------\r\n  0.0025\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d05170832032-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d05170832032-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d05170832032-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d05170832032-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d05170832032-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d05170832032-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d05170832032-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d05170832032-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d05170832032-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d05170832032-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447d05170832032-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d05170832032-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d05170832032-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_tuple_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d05170832032-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d05170832032-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d05170832032-6\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_operator_cost;</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d05170832032-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_operator_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d05170832032-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d05170832032-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.0025</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d05170832032-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>现在，用所有的值来计算在<code>explain</code> 语句中得到的值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447d08699865470\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnumber_of_records = 1000000\r\n\r\nblock_size    = 8192     # block size in bytes\r\nrelation_size = 44285952\r\n\r\nblocks = relation_size / block_size # =&gt; 5406\r\n\r\nseq_page_cost   = 1\r\ncpu_tuple_cost  = 0.01\r\ncpu_filter_cost = 0.0025;\r\n\r\ncost = blocks * seq_page_cost +\r\n   number_of_records * cpu_tuple_cost +\r\n   number_of_records * cpu_filter_cost\r\n\r\ncost # =&gt; 17546\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d08699865470-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d08699865470-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d08699865470-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d08699865470-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d08699865470-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d08699865470-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d08699865470-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d08699865470-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d08699865470-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-1\"><span class=\"crayon-v\">number_of_records</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d08699865470-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-3\"><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8192</span><span class=\"crayon-h\">     </span><span class=\"crayon-p\"># block size in bytes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d08699865470-4\"><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d08699865470-6\"><span class=\"crayon-v\">blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 5406</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d08699865470-8\"><span class=\"crayon-v\">seq_page_cost</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-9\"><span class=\"crayon-v\">cpu_tuple_cost</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d08699865470-10\"><span class=\"crayon-v\">cpu_filter_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0025</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d08699865470-12\"><span class=\"crayon-v\">cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">blocks *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seq_page_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-e \">number_of_records *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_tuple_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d08699865470-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-e \">number_of_records *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cpu_filter_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d08699865470-16\"><span class=\"crayon-v\">cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 17546</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d08699865470-17\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h1 id=\"索引和postgresql成本模型\">索引和PostgreSQL成本模型</h1>\n<p>索引在数据库工程师的生活中很可能仍然是最重要的话题。添加索引是否可以降低SELECT语句的成本呢？通过下面的例子来找出答案。</p>\n<p>首先，在users表中添加一个索引：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447d0c531740506\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # CREATE INDEX idx_users_id ON users (id);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d0c531740506-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d0c531740506-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447d0c531740506-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># CREATE INDEX idx_users_id ON users (id);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d0c531740506-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>观察一下新索引的查询规划。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447d0f955904881\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n           QUERY PLAN\r\n----------  ----------  ----------\r\n     Index Scan using idx_users_id on users  (cost=0.42..8.44 rows=1 width=9)\r\n   Index Cond: (id = 870123)\r\n(2 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d0f955904881-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d0f955904881-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d0f955904881-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d0f955904881-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d0f955904881-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d0f955904881-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d0f955904881-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d0f955904881-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447d0f955904881-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d0f955904881-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d0f955904881-3\"><span class=\"crayon-h\">           </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d0f955904881-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d0f955904881-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">Index </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">using </span><span class=\"crayon-e\">idx_users_id </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.42..8.44</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d0f955904881-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">Index </span><span class=\"crayon-v\">Cond</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d0f955904881-7\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d0f955904881-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>成本函数显著下降。索引扫描的计算比顺序扫描的计算要复杂一些。它由两个阶段组成。</p>\n<p>PostgreSQL会考虑<code>random_page_cost</code>和<code>cpu_index_tuple_cost</code> 变量，并返回一个基于索引树的高度的值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447d13084047663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW random_page_cost;\r\n\r\n random_page_cost\r\n ----------------\r\n  4\r\n\r\ndb # SHOW cpu_index_tuple_cost;\r\n cpu_index_tuple_cost\r\n----------\r\n  0.005\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d13084047663-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d13084047663-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d13084047663-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d13084047663-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d13084047663-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d13084047663-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d13084047663-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d13084047663-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d13084047663-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d13084047663-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d13084047663-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447d13084047663-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW random_page_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d13084047663-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d13084047663-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_page_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d13084047663-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d13084047663-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d13084047663-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d13084047663-7\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_index_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d13084047663-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_index_tuple_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d13084047663-9\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d13084047663-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.005</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d13084047663-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>对于实际的计算，请考虑阅读<a href=\"https://github.com/postgres/postgres/blob/ab72716778128fb63d54ac256adf7fe6820a1185/src/backend/optimizer/path/costsize.c#L466\" target=\"_blank\">成本指数</a>计算器的源代码。</p>\n<h1 id=\"工作进程的成本\">工作进程的成本</h1>\n<p>PostgreSQL可以启动并行的工作进程（worker）来执行查询。但是，开启一个新的工作进程，性能会受到影响。</p>\n<p>为了计算使用并行工作进程的成本，PostgreSQL使用 <code>parallel_tuple_cost</code>这个命令，它定义了从一个工作进程传送元组到另一个工作进程的成本，<code>parallel_setup_cost</code>命令意味着启动一个新的工作进程（worker）的成本，以下是查询示例。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a68fa4447d17847008330\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW parallel_tuple_cost;\r\n\r\n parallel_tuple_cost\r\n---------------------\r\n  0.1\r\n\r\ndb # SHOW parallel_setup_cost;\r\n\r\n parallel_setup_cost\r\n---------------------\r\n 1000\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d17847008330-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d17847008330-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d17847008330-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d17847008330-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d17847008330-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d17847008330-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d17847008330-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d17847008330-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d17847008330-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d17847008330-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a68fa4447d17847008330-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a68fa4447d17847008330-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a68fa4447d17847008330-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW parallel_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d17847008330-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d17847008330-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parallel_tuple_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d17847008330-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d17847008330-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d17847008330-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d17847008330-7\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW parallel_setup_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d17847008330-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d17847008330-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parallel_setup_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d17847008330-10\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a68fa4447d17847008330-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a68fa4447d17847008330-12\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113358\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113358votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113358\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113358/", "comment_nums": 1, "create_date": "2017/12/21", "tags": "IT技术,PostgreSQL,数据库", "url_object_id": "2d2fe070e21aca17bf9d6ef863e27af3", "front_image_path": "full/d925c992a1aa410e25f0bb681dae99423f162420.jpg"}
{"fav_nums": 1, "praise_nums": "1", "title": "关于负载均衡的一切：总结与思考", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/b4822f398c6b3d29e8f309640f2bb305.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xybaby/p/7867735.html\">xybaby</a>   </div><p>古人云，不患寡而患不均。</p>\n<p>在计算机的世界，这就是大家耳熟能详的负载均衡（<a href=\"https://en.wikipedia.org/wiki/Load_balancing_(computing)\" target=\"_blank\">load balancing</a>），所谓负载均衡，就是说如果一组计算机节点（或者一组进程）提供<strong>相同的（同质的）服务</strong>，那么对服务的请求就应该均匀的分摊到这些节点上。负载均衡的前提一定是“provide a single Internet service from multiple servers”， 这些提供服务的节点被称之为server farm、server pool或者backend servers。</p>\n<p>这里的服务是广义的，可以是简单的计算，也可能是数据的读取或者存储。负载均衡也不是新事物，这种思想在多核CPU时代就有了，只不过在分布式系统中，负载均衡更是无处不在，这是分布式系统的天然特性决定的，分布式就是利用大量计算机节点完成单个计算机无法完成的计算、存储服务，既然有大量计算机节点，那么均衡的调度就非常重要。</p>\n<p>负载均衡的意义在于，让所有节点以最小的代价、最好的状态对外提供服务，这样系统吞吐量最大，性能更高，对于用户而言请求的时间也更小。而且，负载均衡增强了系统的可靠性，最大化降低了单个节点过载、甚至crash的概率。不难想象，如果一个系统绝大部分请求都落在同一个节点上，那么这些请求响应时间都很慢，而且万一节点降级或者崩溃，那么所有请求又会转移到下一个节点，造成雪崩。</p>\n<p>事实上，网上有很多文章介绍负载均衡的算法，大多都是大同小异。本文更多的是自己对这些算法的总结与思考。</p>\n<h1>一分钟了解负载均衡的一切</h1>\n<p>本章节的标题和内容都来自<a href=\"http://zhuanlan.51cto.com/art/201609/517313.htm\" target=\"_blank\">一分钟了解负载均衡的一切</a>这一篇文章。当然，原文的标题是夸张了点，不过文中列出了在一个大型web网站中各层是如何用到负载均衡的，一目了然。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b4822f398c6b3d29e8f309640f2bb305.png\" alt=\"\"></p>\n<p>常见互联网分布式架构如上，分为客户端层、反向代理nginx层、站点层、服务层、数据层。可以看到，每一个下游都有多个上游调用，只需要做到，<strong>每一个上游都均匀访问每一个下游</strong>，就能实现“将请求/数据【均匀】分摊到多个操作单元上执行”。</p>\n<p>(1)【客户端层】到【反向代理层】的负载均衡，是通过“DNS轮询”实现的<br>\n(2)【反向代理层】到【站点层】的负载均衡，是通过“nginx”实现的<br>\n(3)【站点层】到【服务层】的负载均衡，是通过“服务连接池”实现的<br>\n(4)【数据层】的负载均衡，要考虑“数据的均衡”与“请求的均衡”两个点，常见的方式有“按照范围水平切分”与“hash水平切分”。</p>\n<p>数据层的负载均衡，在我之前的《<a href=\"http://www.cnblogs.com/xybaby/p/7076731.html\" target=\"_blank\">带着问题学习分布式系统之数据分片</a>》中有详细介绍。</p>\n<h1>算法衡量</h1>\n<p>在我看来，当我们提到一个负载均衡算法，或者具体的应用场景时，应该考虑以下问题</p>\n<p>第一，是否意识到不同节点的服务能力是不一样的，比如CPU、内存、网络、地理位置</p>\n<p>第二，是否意识到节点的服务能力是动态变化的，高配的机器也有可能由于一些突发原因导致处理速度变得很慢</p>\n<p>第三，是否考虑将同一个客户端，或者说同样的请求分发到同一个处理节点，这对于“有状态”的服务非常重要，比如session，比如分布式存储</p>\n<p>第四，谁来负责负载均衡，即谁充当负载均衡器（load balancer），balancer本身是否会成为瓶颈</p>\n<p>下面会结合具体的算法来考虑这些问题</p>\n<h1>负载均衡算法</h1>\n<h2>轮询算法（round-robin）</h2>\n<p>思想很简单，就是提供同质服务的节点逐个对外提供服务，这样能做到绝对的均衡。Python示例代码如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69127061191525208020\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSERVER_LIST = [\r\n    '10.246.10.1',\r\n    '10.246.10.2',\r\n    '10.246.10.3',\r\n]\r\ndef round_robin(server_lst, cur = [0]):\r\n    length = len(server_lst)\r\n    ret = server_lst[cur[0] % length]\r\n    cur[0] = (cur[0] + 1) % length\r\n    return ret</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69127061191525208020-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69127061191525208020-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69127061191525208020-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69127061191525208020-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69127061191525208020-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69127061191525208020-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69127061191525208020-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69127061191525208020-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69127061191525208020-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69127061191525208020-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69127061191525208020-1\"><span class=\"crayon-v\">SERVER_LIST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69127061191525208020-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.1'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a69127061191525208020-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.2'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69127061191525208020-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.3'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a69127061191525208020-5\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69127061191525208020-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">round_robin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a69127061191525208020-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69127061191525208020-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a69127061191525208020-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69127061191525208020-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>可以看到，所有的节点都是以同样的概率提供服务，即没有考虑到节点的差异，也许同样数目的请求，高配的机器CPU才20%，低配的机器CPU已经80%了</p>\n<h2>加权轮询算法（weight round-robin）</h2>\n<p>加权轮训算法就是在轮训算法的基础上，考虑到机器的差异性，分配给机器不同的权重，能者多劳。注意，这个权重的分配依赖于请求的类型，比如计算密集型，那就考虑CPU、内存；如果是IO密集型，那就考虑磁盘性能。Python示例代码如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6912706119e224833166\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nWEIGHT_SERVER_LIST = {\r\n    '10.246.10.1': 1,\r\n    '10.246.10.2': 3,\r\n    '10.246.10.3': 2,\r\n}\r\n\r\ndef weight_round_robin(servers, cur = [0]):\r\n    weighted_list = []\r\n    for k, v in servers.iteritems():\r\n        weighted_list.extend([k] * v)\r\n\r\n    length = len(weighted_list)\r\n    ret = weighted_list[cur[0] % length]\r\n    cur[0] = (cur[0] + 1) % length\r\n    return ret</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6912706119e224833166-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6912706119e224833166-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6912706119e224833166-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6912706119e224833166-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6912706119e224833166-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6912706119e224833166-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6912706119e224833166-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6912706119e224833166-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6912706119e224833166-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6912706119e224833166-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6912706119e224833166-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6912706119e224833166-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6912706119e224833166-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6912706119e224833166-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6912706119e224833166-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6912706119e224833166-1\"><span class=\"crayon-v\">WEIGHT_SERVER_LIST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6912706119e224833166-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a6912706119e224833166-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6912706119e224833166-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.3'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a6912706119e224833166-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6912706119e224833166-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a6912706119e224833166-7\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_round_robin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6912706119e224833166-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6912706119e224833166-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6912706119e224833166-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6912706119e224833166-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6912706119e224833166-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6912706119e224833166-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6912706119e224833166-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span></div><div class=\"crayon-line\" id=\"crayon-5a6912706119e224833166-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n\n</div>\n<h2>随机算法（random）</h2>\n<p>这个就更好理解了，随机选择一个节点服务，按照概率，只要请求数量足够多，那么也能达到绝对均衡的效果。而且实现简单很多</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691270611a3802454266\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef random_choose(server_lst):\r\n    import random\r\n    random.seed()\r\n    return random.choice(server_lst)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691270611a3802454266-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611a3802454266-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611a3802454266-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611a3802454266-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691270611a3802454266-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">random_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611a3802454266-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">random</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611a3802454266-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611a3802454266-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<h2>加权随机算法（random）</h2>\n<p>如同加权轮训算法至于轮训算法一样，也是在随机的时候引入不同节点的权重，实现也很类似。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691270611a6705716713\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef weight_random_choose(servers):\r\n    import random\r\n    random.seed()\r\n    weighted_list = []\r\n    for k, v in servers.iteritems():\r\n        weighted_list.extend([k] * v)\r\n    return random.choice(weighted_list)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691270611a6705716713-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611a6705716713-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611a6705716713-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611a6705716713-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611a6705716713-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611a6705716713-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611a6705716713-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691270611a6705716713-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_random_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611a6705716713-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">random</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611a6705716713-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611a6705716713-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611a6705716713-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611a6705716713-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611a6705716713-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>当然，如果节点列表以及权重变化不大，那么也可以对所有节点归一化，然后按概率区间选择</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691270611aa240408278\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef normalize_servers(servers):\r\n    normalized_servers = {}\r\n    total = sum(servers.values())\r\n    cur_sum = 0\r\n    for k, v in servers.iteritems():\r\n        normalized_servers[k] = 1.0 * (cur_sum + v) / total\r\n        cur_sum += v\r\n    return normalized_servers\r\n\r\ndef weight_random_choose_ex(normalized_servers):\r\n    import random, operator\r\n    random.seed()\r\n    rand = random.random()\r\n    for k, v in sorted(normalized_servers.iteritems(), key = operator.itemgetter(1)):\r\n        if v &gt;= rand:\r\n            return k\r\n    else:\r\n        assert False, 'Error normalized_servers with rand %s ' % rand</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611aa240408278-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611aa240408278-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">normalize_servers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">total</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">normalized_servers</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_random_choose_ex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">operator</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-12\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">rand</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">operator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">itemgetter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rand</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611aa240408278-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611aa240408278-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">assert</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Error normalized_servers with rand %s '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rand</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n\n</div>\n<h2>哈希法（hash）</h2>\n<p>根据客户端的IP，或者请求的“Key”，计算出一个hash值，然后对节点数目取模。好处就是，同一个请求能够分配到同样的服务节点，这对于“有状态”的服务很有必要</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a691270611ae598358187\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef hash_choose(request_info, server_lst):\r\n    hashed_request_info = hash(request_info)\r\n    return server_lst[hashed_request_info % len(server_lst)]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a691270611ae598358187-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a691270611ae598358187-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a691270611ae598358187-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a691270611ae598358187-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">hash_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request_info</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a691270611ae598358187-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hashed_request_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request_info</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a691270611ae598358187-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hashed_request_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>只要hash结果足够分散，也是能做到绝对均衡的。</p>\n<h2>一致性哈希</h2>\n<p>哈希算法的缺陷也很明显，当节点的数目发生变化的时候，请求会大概率分配到其他的节点，引发到一系列问题，比如sticky session。而且在某些情况，比如分布式存储，是绝对的不允许的。</p>\n<p>为了解决这个哈希算法的问题，又引入了<a href=\"https://en.wikipedia.org/wiki/Consistent_hashing\" target=\"_blank\">一致性哈希</a>算法，简单来说，一个物理节点与多个虚拟节点映射，在hash的时候，使用虚拟节点数目而不是物理节点数目。当物理节点变化的时候，虚拟节点的数目无需变化，只涉及到虚拟节点的重新分配。而且，调整每个物理节点对应的虚拟节点数目，也就相当于每个物理节点有不同的权重</p>\n<h2>最少连接算法（least connection）</h2>\n<p>以上的诸多算法，要么没有考虑到节点间的差异（轮训、随机、哈希），要么节点间的权重是静态分配的（加权轮训、加权随机、一致性hash）。</p>\n<p>考虑这么一种情况，某台机器出现故障，无法及时处理请求，但新的请求还是会以一定的概率源源不断的分配到这个节点，造成请求的积压。因此，根据节点的真实负载，动态地调整节点的权重就非常重要。当然，要获得接节点的真实负载也不是一概而论的事情，如何定义负载，负载的收集是否及时，这都是需要考虑的问题。</p>\n<p>每个节点当前的连接数目是一个非常容易收集的指标，因此lease connection是最常被人提到的算法。也有一些侧重不同或者更复杂、更客观的指标，比如最小响应时间（least response time）、最小活跃数（least active）等等。</p>\n<h1>一点思考</h1>\n<h2>有状态的请求</h2>\n<p>首先来看看“算法衡量”中提到的第三个问题：同一个请求是否分发到同样的服务节点，同一个请求指的是同一个用户或者同样的唯一标示。什么时候同一请求最好（必须）分发到同样的服务节点呢？那就是有状态 — 请求依赖某些存在于内存或者磁盘的数据，比如web请求的session，比如分布式存储。怎么实现呢，有以下几种办法：</p>\n<p>（1）请求分发的时候，保证同一个请求分发到同样的服务节点。</p>\n<p>这个依赖于负载均衡算法，比如简单的轮训，随机肯定是不行的，哈希法在节点增删的时候也会失效。可行的是一致性hash，以及分布式存储中的按范围分段（即记录哪些请求由哪个服务节点提供服务），代价是需要在load balancer中维护额外的数据。</p>\n<p>（2）状态数据在backend servers之间共享</p>\n<p>保证同一个请求分发到同样的服务节点，这个只是手段，目的是请求能使用到对应的状态数据。如果状态数据能够在服务节点之间共享，那么也能达到这个目的。比如服务节点连接到共享数据库，或者内存数据库如memcached</p>\n<p>（3）状态数据维护在客户端</p>\n<p>这个在web请求中也有使用，即cookie，不过要考虑安全性，需要加密。</p>\n<h2>关于load balancer</h2>\n<p>接下来回答第四个问题：关于load balancer，其实就是说，在哪里做负载均衡，是客户端还是服务端，是请求的发起者还是请求的3。具体而言，要么是在客户端，根据服务节点的信息自行选择，然后将请求直接发送到选中的服务节点；要么是在服务节点集群之前放一个集中式代理（proxy），由代理负责请求求分发。不管哪一种，至少都需要知道当前的服务节点列表这一基础信息。</p>\n<p>如果在客户端实现负载均衡，客户端首先得知道服务器列表，要么是静态配置，要么有简单接口查询，但backend server的详细负载信息，就不适用通过客户端来查询。因此，客户端的负载均衡算法要么是比较简单的，比如轮训（加权轮训）、随机（加权随机）、哈希这几种算法，只要每个客户端足够随机，按照大数定理，服务节点的负载也是均衡的。要在客户端使用较为复杂的算法，比如根据backend的实际负载，那么就需要去额外的负载均衡服务（external load balancing service）查询到这些信息，在<a href=\"https://github.com/grpc/grpc/blob/master/doc/load-balancing.md\" target=\"_blank\">grpc</a>中，就是使用的这种办法</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/5567530ef55fda8f329c24d7c510017a.png\" alt=\"\"></p>\n<p>可以看到，load balancer与grpc server通信，获得grpc server的负载等具体详细，然后grpc client从load balancer获取这些信息，最终grpc client直连到被选择的grpc server。</p>\n<p>而基于Proxy的方式是更为常见的，比如7层的Nginx，四层的F5、LVS，既有硬件路由，也有软件分发。集中式的特点在于方便控制，而且能容易实现一些更精密，更复杂的算法。但缺点也很明显，一来负载均衡器本身可能成为性能瓶颈；二来可能引入额外的延迟，请求一定先发到达负载均衡器，然后到达真正的服务节点。</p>\n<p>load balance proxy对于请求的响应（response），要么不经过proxy，如LVS；要么经过Proxy，如Nginx。下图是LVS示意图（来源见水印）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/67aae7bdbbab3340571198f7ffb00261.png\" alt=\"\"></p>\n<p>而如果response也是走load balancer proxy的话，那么整个服务过程对客户端而言就是完全透明的，也防止了客户端去尝试连接后台服务器，提供了一层安全保障！</p>\n<p>值得注意的是，<strong>load balancer proxy不能成为单点故障</strong>（single point of failure），因此一般会设计为高可用的主从结构</p>\n<h2> 其他</h2>\n<p>在<a href=\"http://www.cnblogs.com/data2value/p/6107653.html\" target=\"_blank\">这篇文章</a>中提到，负载均衡是一种推模型，一定会选出一个服务节点，然后把请求推送过来。而换一种思路，使用消息队列，就变成了拉模型：空闲的服务节点主动去拉取请求进行处理，各个节点的负载自然也是均衡的。消息队列相比负载均衡好处在于，服务节点不会被大量请求冲垮，同时增加服务节点更加容易；缺点也很明显，请求不是事实处理的。</p>\n<p>想到另外一个例子，比如在gunicorn这种pre-fork模型中，master（gunicorn 中Arbiter）会fork出指定数量的worker进程，worker进程在同样的端口上监听，谁先监听到网络连接请求，谁就提供服务，这也是worker进程之间的负载均衡。</p>\n<h1>references</h1>\n<p><a href=\"https://en.wikipedia.org/wiki/Load_balancing_(computing)\" target=\"_blank\">wiki：Load balancing</a></p>\n<p><a href=\"http://zhuanlan.51cto.com/art/201609/517313.htm\" target=\"_blank\">一分钟了解负载均衡的一切</a></p>\n<p><a href=\"https://github.com/grpc/grpc/blob/master/doc/load-balancing.md\" target=\"_blank\">grpc load-balancing.md</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113417\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113417votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113417\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113417/", "comment_nums": 3, "create_date": "2018/01/02", "tags": "IT技术,负载均衡", "url_object_id": "6811109c460504a206757c8ec1f476ae", "front_image_path": "full/454455dcb286199a6ce66f724472bfe5efeebea7.jpg"}
{"fav_nums": 9, "praise_nums": "10", "title": "客户想要的 vs 客户实际预算：漫画解读软件开发模式 ​​​​", "front_image_url": ["http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg6692mmwj20ig0bs4am.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>1913 年，美利坚工业之神——亨利福特，发明了世界上第一条流水线，汽车工业从此进入了大规模生产的时代。丰田公司提出的丰田生产系统（Toyota Production System）又为汽车工业带来了很多先进的生产和管理理念。</p>\n<p>先进的生产和管理理念是一个行业从小作坊走向规模化的必经之路，软件工业虽然诞生较晚，但是发展却非常迅速，这也同样得益于软件工业开发和管理理念的发展。这其中就从汽车工业吸收了很多成熟的理念。</p>\n<p>下面，就让我们通过这张出自 Toggle 的漫画，来了解软件开发模式的变迁史。</p>\n<h2>总览</h2>\n<p><img id=\"pic\" class=\"M_cur_zoom_out\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fm603hue8aj20rs3duqn3.jpg\"></p>\n<p>这张图片从上向下，五个房间，分别是瀑布模型（waterfall），敏捷开发（agile），看板（KANBAN），SCRUM 和精益软件开发（lean）。</p>\n<p>除了瀑布模型这间小屋和其他小屋有着明显的界限之外，其他几种模型就像一个四合院，有着不可分割的关系，这也恰好表明，瀑布模式和敏捷开发模式是软件工业先后经历的两个阶段，而 KANBAN，SCRUM 和 LEAN 则是敏捷运动的产物。</p>\n<p>OK，客官里边请，让我们进第一个屋子看看。</p>\n<h2>Old Days——瀑布式软件开发</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/fa38bde05d5560efbfc865afcc0aa5a0.jpg\" alt=\"15128081424398\"></p>\n<p>所谓瀑布模型，就是说，软件开发是按照一定顺序展开的（传统线性生产流程 : Traditional,linear production flow）。就像汽车生产的流水线一样，每个部门各司其责，工作按照顺序展开，交付件单通道线性流动。你看这幅图，总体上就分为：<strong>需求 → 设计<strong> → </strong>制造<strong> → </strong>测试</strong>，四个阶段。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg664g0ndj208d06dgoo.jpg\" width=\"301\" height=\"229\"></p>\n<p>在这个系统中，客户被排除在生产系统之外（围墙是密闭不透明的），它们只能从需求的接口人那里向系统输入需求（Client places order）。正因如此，客户无法理解生产所需的费用以及为什么交付总是会延期，因此，也难免会闹出下面这样的笑话：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg662v0xcj207e0gyte6.jpg\" width=\"266\" height=\"610\"></p>\n<p>客户希望你造一辆汽车，却只愿意支付一辆自行车的开发成本。</p>\n<p>需求接纳后进入到设计阶段：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg6652zs5j20c707tgqa.jpg\" width=\"439\" height=\"281\"></p>\n<p>设计定型后，进入制造阶段：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg665nbgij20dn08t45d.jpg\" width=\"491\" height=\"317\"></p>\n<p>在线性的生产系统中，或者说在瀑布开发模式中，需求和设计是不可以进行修改的。工人被安排在制造系统中一个个工位上，每个人仅负责一个部件的生产和装配，就像这位盘腿坐着的“I know HTML”大哥一样，HTML 开发者只需要负责 HTML 的开发而无需，也不应该关心软件的其他部分。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66671jzj209d07r78i.jpg\" width=\"337\" height=\"279\"></p>\n<p>喂喂喂，这位老铁，不上班玩什么球啊？哎，您也别怪他，毕竟交付件（整车/软件）还没有完成开发，测试工作自然无法开展，当然得等着咯。这也是瀑布模型最大的弊端，下游工作的开展严格依赖于上游交付件的完成情况，这无疑是一种浪费，在争分夺秒的软件开发过程中，你能忍受这种浪费吗？</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg666trlkj208506777b.jpg\" width=\"293\" height=\"223\"></p>\n<p>汽车完成生产和测试之后，一次性交付到客户手中，完成客户的全部需求。</p>\n<h2>走进新时代——敏捷开发模式</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/d0d1ceb8da75fe97e9dff8706d6df0be.jpg\" alt=\"15128097291193\"></p>\n<blockquote><p>敏捷开发以用户的<strong>需求进化为</strong>核心，采用迭代、循序渐进的方法进行软件开发。在敏捷开发中，软件项目在构建初期被切分成多个子项目，各个子项目的成果都经过测试，具备可视、可集成和可运行使用的特征。换言之，就是把一个大项目分为多个相互联系，但也可独立运行的小项目，并分别完成，在此过程中软件一直处于可使用状态</p></blockquote>\n<p>有点书面是吧，其实很简单，敏捷开发的一个前提假设是：用户不可能在产品开发之前，设计之初就完整、明确的提出需求。期望用户在开发过程中不变更需求是不现实的。用户在开发前提出的需求，可能并不是它们最终希望得到的。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1flk6c8yl83j20k008qglx.jpg\" width=\"523\" height=\"228\"></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg667ckk9j20bt05zn1n.jpg\" width=\"425\" height=\"215\"></p>\n<p>在敏捷开发中，客户会参与到软件开发的整个流程中。整个开发过程不再是一堵不透风的墙，透明是关键（TRANSPARENCY IS KEY），但是，随着越来越多的用户参与进来，越来越多的问题也暴露出来了，越来越多不着调的需求也会被提出。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg667xsfij20dr08qn36.jpg\" width=\"495\" height=\"314\"></p>\n<p>敏捷开发的另一个重要概念就是<strong>迭代</strong>，所谓迭代，就是不断对产品进行细微的、渐进式的改进（Small incremental changes）。</p>\n<blockquote><p>“先给您上个小号的尾翼，用着好我再给您换个大的~”</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg668ixufj20aa06ltc7.jpg\" width=\"370\" height=\"237\"></p>\n<p>在敏捷开发中，生产不再是线性的，开发的同时还会进行测试工作，所有人都在同时工作。尴尬等待的日子一去不复返咯~</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg6692mmwj20ig0bs4am.jpg\" width=\"664\" height=\"424\"></p>\n<p>利用敏捷模式开发出的产品，相较于传统的软件交付方式，一个显著的特点是能够及时响应客户需求的变更，不断适应新的趋势。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg669pb2lj20cc07a79q.jpg\" width=\"444\" height=\"262\"></p>\n<p>这不，隔壁老王喜当爹了，之前定的法拉利显得有点不稳重，宝宝也没地方坐。我们的产品经理和开发人员快速响应，轿跑变商务也不是什么大问题~~ 当然，为谁辛苦为谁忙，客户爸爸们一定要买单呀！</p>\n<p>什么？您问第一稿方案是什么样的？去翻垃圾桶吧！ <img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66aari0j208e04uq4v.jpg\" width=\"302\" height=\"174\"></p>\n<h2>一股来自东方的神秘力量——看板</h2>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66ayb9mj20fw0g9apk.jpg\" width=\"572\" height=\"585\"></p>\n<p>相信各位也注意到了，相对于瀑布模式的井井有条，敏捷开发在灵活的同时，也带来了一定程度的混乱。</p>\n<p>就在这个节骨眼上，还得请这位来自东方的神秘人物——丰田看板大师（KANBAN SENSEI）给你点拨点拨。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66bk590j206k07gdim.jpg\" width=\"236\" height=\"268\"></p>\n<p>KANBAN，不是汉语拼音，更不是英文缩写，它来自日语“看板”，カンバン的罗马拼写：Kanban。它正是丰田生产系统的一个重要概念：</p>\n<blockquote><p>看板管理，常作“Kanban管理”，是丰田生产模式中的重要概念，指为了达到及时生产（JIT）方式控制现场生产流程的工具。及时生产方式中的拉式（Pull）生产系统可以使信息的流程缩短，并配合定量、固定装货容器等方式，而使生产过程中的物料流动顺畅。</p></blockquote>\n<p>KANBAN要求把开发中的任务，以 TODO List 的方式表现出来：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66c3l9lj207c06itbl.jpg\" width=\"264\" height=\"234\"></p>\n<p>形式可以是即时贴，也可以是可视化软件等等。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg663dya7j20ds09h764.jpg\" width=\"496\" height=\"341\"></p>\n<p>在制造业中，看板也是非常重要的管理方法。也有将其称为目视化管理的。</p>\n<h2>SCRUM 又是什么？</h2>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66crh75j20m50fwx10.jpg\" width=\"690\" height=\"495\"></p>\n<blockquote><p>Scrum原始含义是指英式橄榄球次要犯规时在犯规地点对阵争球。争球双方各有8个队员参与，各方出3名前锋队员，并肩各站成一横排，面对面躬身互相顶肩，中间形成一条通道，其他队员分别站在后面，后排队员用肩顶住前锋队员的臀部，组成3、2、3或3、4、1阵形。然后，由犯规队的对方队员在对阵一侧1码外，用双手低手将球抛入通道，不得有利于本队。当球抛入通道时，前排的3对前锋队员互相抗挤，争相踢球给本方前卫或后卫队员，前卫和后卫队员必须等候前锋将球踢回后，方可移动</p></blockquote>\n<p><img class=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/259a008f1edf1a34a14e98f4e10e65dc.jpg\" alt=\"15128143307299\" width=\"463\" height=\"261\"></p>\n<p>在敏捷开发领域，SCRUM是一种迭代式增量软件开发过程，它包括了一些预定义的角色：</p>\n<ul>\n<li><strong>产品负责人 Product Owner</strong></li>\n</ul>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66db5hvj207i05w76o.jpg\" width=\"270\" height=\"212\"></p>\n<p>产品负责人负责维护订单</p>\n<ul>\n<li><strong>Scrum主管 Scrum Master </strong></li>\n</ul>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66dufcfj207s05kgo6.jpg\" width=\"280\" height=\"200\"></p>\n<p>SCURM Master 对整个SCRUM 过程负责，不惜一切代价（<em>AT ANY COST</em>），保证团队的工作时间和计划。</p>\n<ul>\n<li><strong>开发团队 Team </strong></li>\n</ul>\n<p>在 SCRUM 过程中，开发团队通常会进行冲刺 （Sprint），一个冲刺周期的长度通常是2-4周。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66e9phnj205x03qabg.jpg\" width=\"213\" height=\"134\"></p>\n<p>在这个冲刺过程中，开发小组专注于完成一组订单项的开发。比如：制造一个发动机 <img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66esfh8j209c05u77y.jpg\" width=\"336\" height=\"210\"></p>\n<p>对于KANBAN 和 SCRUM，有人说 KANBAN vs SCRUM，也有人说 KANBAN+SCRUM，究竟谁是谁非，我看只有适合自己团队的才是最好的，毕竟方法和流程是为业务服务的。就这篇漫画来看，SCRUM + KANBAN 是两个避免混乱的好方法。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66f9q2mj205o08a40g.jpg\" width=\"204\" height=\"298\"></p>\n<p><em>来来来，兄弟们，我们来开一个关于减少站会的站会~~</em></p>\n<h2>精益软件开发</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6dd2911f0156068e997abd790e0f7493.jpg\" alt=\"15128322280368\"></p>\n<p>第二次世界大战结束后，丰田公司前社长丰田英二曾经去美国汽车城底特律对福特生产线进行了考察，尽管福特高效的大规模生产线给他造成了很大的冲击，丰田英二还是非常理智的认识到了当时日本制造业所面临的困难。经济萧条，资源短缺，小批量差异化的需求使他不能盲目的引进这种大规模的生产方式，随后丰田公司发明并实践了一系列的管理和生产方法，这些方法在后来被统称为精益生产和管理方式（lean）</p>\n<p>精益生产的思想， 简单来说就是Just In Time（JIT），也就是说，只在必要的时候，按照需求的量，仅生产必要的产品，杜绝浪费。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66ftyjjj206b03r3zb.jpg\" width=\"227\" height=\"135\"></p>\n<blockquote><p>Eric Ries曾在《精益创业实战》中提出MVP（minimum viable product）概念，意即“最简可行产品”——用最快、最简明的方式建立一个可用的产品原型，这个原型要表达出你产品最终想要的效果，然后通过迭代来完善细节。</p></blockquote>\n<p>精益软件开发不再像传统的软件开发一样，耗时几年才向客户交付完整的软件。取而代之的是，优先建立一个最简可用的原型产品投放市场或交付到客户手中。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66geocdj209h0biq8i.jpg\" width=\"341\" height=\"414\"></p>\n<p>一辆最简可用的汽车是什么样子的呢？不就是四个轮子、一个方向盘、一个座椅然后一起装在底盘上么。能开、能停、能转弯不就是汽车嘛。让客户先享受到产品带来的收益是最重要的。</p>\n<p><img src=\"https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1512898589423&amp;di=158b96821c3e271a06d229192b48d81f&amp;imgtype=0&amp;src=http%3A%2F%2Fa1.att.hudong.com%2F05%2F95%2F01300000432220148643955825350_s.jpg\" alt=\"\"></p>\n<p><strong>BUT!!!</strong></p>\n<p>你看，这里还有一位失落的大叔</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66h14y4j20b706877s.jpg\" width=\"403\" height=\"224\"></p>\n<p>尽管MPV 的概念听上去是如此的简单，可是实施起来却没有那么容易。</p>\n<blockquote><p>因为在设计产品原型的过程中，很多设计师是这么做的：把他们认为的产品应当具备的功能罗列出来，然后一一排除，排定优先级，决定哪个功能要在最初的版本中出现，而哪个可以靠后一些。但设计师们往往无法真的只把最必要的功能留在初级版本中——因为诱惑太多。设计师们总希望把很cool、很有惊喜的小细节带给用户来博取赞叹，但从全局来看，其实把某些功能刻意强加进产品，是会削弱产品整体流畅性的。Mr Jamie曾在其博客中把这种心理表现称作<strong>“艺术家心结”</strong>。</p></blockquote>\n<p>所有不必的东西（ALL NON-ESSENTIALS ARE THROWN OUT）都不能应用到当前的最小可用产品。你说，艺术家们得多伤心啊（愁的胡子都长一脸了）</p>\n<p>此外，尽早交付产品给客户或部署到生产环境，也促进了 DevOps，持续集成（CI），生产环境测试（testing in production）等实践的发展。尽早交付产品，尽早从用户获取反馈，不论是好的还是坏的，促使问题尽早暴露，尽早修复，持续集成，持续改进。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg68pf1nbj209208wgps.jpg\" width=\"326\" height=\"320\"></p>\n<p>眼尖的童鞋，估计早就看到了桌子上有一只程序员的好朋友 —— 小黄鸭。你还不知道小黄鸭？那你该看看这篇文章：《<a href=\"http://blog.jobbole.com/85719/\" target=\"_blank\">小黄鸭调试法，每个程序员都要知道的</a>》。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg663ygd2j206n047ta2.jpg\" width=\"239\" height=\"151\"></p>\n<h2>结束语</h2>\n<p>实际工作中的软件开发和管理模式，往往并不能纯粹的归类于以上某种类型。即使是相同的开发模型，在不同的团队中也往往会根据实际情况进行变化和改进，留言告诉我们你所在的公司是如何进行软件开发的吧~</p>\n<p>此外，如果你对我的解析有不同的看法，或者你在图中看出了新的内涵，也欢迎在评论中互动！</p>\n<h3>扩展阅读</h3>\n<ul>\n<li>[1] <a href=\"http://www.agileweboperations.com/scrum-vs-kanban\">kanban vs scrum vs agile</a></li>\n<li>[2] <a href=\"http://www.jianshu.com/p/e44b1038c9cf\">Scrum vs. 看板，还是Scrum + 看板？ </a></li>\n<li>[3] <a href=\"https://msdn.microsoft.com/zh-cn/library/hh533841(v=vs.110).aspx\">精益软件开发</a></li>\n<li>[4] <a href=\"https://www.ibm.com/developerworks/cn/rational/leaner-software-development-with-the-aid-of-collaborative-lifecycle-management/\">使用 DevOps 进行精益软件开发</a></li>\n<li>[5]<a href=\"https://baike.baidu.com/item/%E4%B8%B0%E7%94%B0%E5%BC%8F%E7%94%9F%E4%BA%A7%E7%AE%A1%E7%90%86/511862?fr=aladdin&amp;fromid=10166317&amp;fromtitle=%E4%B8%B0%E7%94%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F\"> 丰田生产系统</a></li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/d3704dca07a3c6ce19c14a9762a0d776.jpg\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/d8aa159efcd108a908cd3d6ab74b8f5f.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113230\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113230votetotal\">10</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113230\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 6 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/10/bb74ca97c7e8b5a21a24f0b5bbc519c3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            翻译组的勤务员（联系此人请微博私信或hanxiaomax@qq.com        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hanxiaomax\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hanxiaomax/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 95</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://hanxiaomax.github.io\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://www.weibo.com/smilingly1989\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/hanxiaomax\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113230/", "comment_nums": 6, "create_date": "2017/12/14", "tags": "趣文小说,趣图", "url_object_id": "adfa75d1779c8eafc10e8cabe3bff3e9", "front_image_path": "full/ddea7e492385a85fd588582693b753dfb4e75192.jpg"}
{"fav_nums": 2, "praise_nums": "2", "title": "布隆过滤器:Google Guava类库源码分析及基于Redis Bitmaps的重构", "front_image_url": ["http://www.fullstackyang.com/wp-content/uploads/2017/09/bloom-filter.jpg"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><blockquote><p>本文源地址：http://www.fullstackyang.com/archives/464.html，转发请注明该地址或伯乐在线地址，谢谢！</p></blockquote>\n<p><span style=\"font-family: 'Microsoft YaHei', 宋体, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 24px; font-style: normal; font-weight: normal;\">一、背景知识</span></p>\n<p>在网上已经有很多关于布隆过滤器的介绍了，这里就不再赘述，下面简单地提炼几个要点：</p>\n<ol>\n<li>布隆过滤器是用来判断一个元素是否出现在给定集合中的重要工具，具有快速，比哈希表更节省空间等优点，而缺点在于有一定的误识别率（false-positive，假阳性），亦即，它可能会把不是集合内的元素判定为存在于集合内，不过这样的概率相当小，在大部分的生产环境中是可以接受的；</li>\n<li>其原理比较简单，如下图所示，S集合中有n个元素，利用k个哈希函数，将S中的每个元素映射到一个长度为m的位（bit）数组B中不同的位置上，这些位置上的二进制数均置为1，如果待检测的元素经过这k个哈希函数的映射后，发现其k个位置上的二进制数不全是1，那么这个元素一定不在集合S中，反之，该元素可能是S中的某一个元素（参考1）；\n<div><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/bloom-filter.jpg\" alt=\"\" width=\"882\" height=\"476\"></div>\n</li>\n<li>综上描述，那么到底需要多少个哈希函数，以及创建长度为多少的bit数组比较合适，为了估算出k和m的值，在构造一个布隆过滤器时，需要传入两个参数，即可以接受的误判率fpp和元素总个数n（不一定完全精确）。至于参数估计的方法，有兴趣的同学可以参考维基英文页面，下面直接给出公式：<img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/km.jpg\" alt=\"\" width=\"346\" height=\"56\"></li>\n<li>哈希函数的要求尽量满足平均分布，这样既降低误判发生的概率，又可以充分利用bit数组的空间；</li>\n<li>\n<div>根据论文《Less Hashing, Same Performance: Building a Better Bloom Filter》提出的一个技巧，可以用2个哈希函数来模拟k个哈希函数，即gi(x) = h1(x) + ih2(x) ，其中0&lt;=i&lt;=k-1；</div>\n</li>\n<li>在吴军博士的《数学之美》一书中展示了不同情况下的误判率，例如，假定一个元素用16位比特，8个哈希函数，那么假阳性的概率是万分之五，这已经相当小了。</li>\n</ol>\n<p>目前已经有相应实现的开源类库，如Google的Guava类库，Twitter的Algebird类库，和ScalaNLP breeze等等，其中Guava 11.0版本中增加了BloomFilter类，它使用了Funnel和Sink的设计，增强了泛化的能力，使其可以支持任何数据类型，其利用murmur3 hash来做哈希映射函数，不过它底层并没有使用传统的java.util.BitSet来做bit数组，而是用long型数组进行了重新封装，大部分操作均基于位的运算，因此能达到一个非常好的性能；下面我们就Guava类库中实现布隆过滤器的源码作详细分析，最后出于灵活性和解耦等因素的考虑，我们想要把布隆过滤器从JVM中拿出来，于是利用了Redis自带的Bitmaps作为底层的bit数组进行重构，另外随着插入的元素越来越多，当实际数量远远大于创建时设置的预计数量时，布隆过滤器的误判率会越来越高，因此在重构的过程中增加了自动扩容的特性，最后通过测试验证其正确性。</p>\n<h2>二、布隆过滤器在Guava中的实现</h2>\n<p>Guava中，布隆过滤器的实现主要涉及到2个类，BloomFilter和BloomFilterStrategies，首先来看一下BloomFilter：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d42793296726042\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n /** The bit set of the BloomFilter (not necessarily power of 2!) */\r\n  private final BitArray bits;\r\n\r\n  /** Number of hashes per element */\r\n  private final int numHashFunctions;\r\n\r\n  /** The funnel to translate Ts to bytes */\r\n  private final Funnel&lt;? super T&gt; funnel;\r\n\r\n  /**\r\n   * The strategy we employ to map an element T to {@ code numHashFunctions} bit indexes.\r\n   */\r\n  private final Strategy strategy;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d42793296726042-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d42793296726042-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d42793296726042-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d42793296726042-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d42793296726042-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d42793296726042-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d42793296726042-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d42793296726042-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d42793296726042-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d42793296726042-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d42793296726042-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d42793296726042-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d42793296726042-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d42793296726042-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/** The bit set of the BloomFilter (not necessarily power of 2!) */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d42793296726042-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d42793296726042-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d42793296726042-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/** Number of hashes per element */</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d42793296726042-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d42793296726042-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d42793296726042-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/** The funnel to translate Ts to bytes */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d42793296726042-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d42793296726042-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d42793296726042-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d42793296726042-11\"><span class=\"crayon-c\">   * The strategy we employ to map an element T to {@ code numHashFunctions} bit indexes.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d42793296726042-12\"><span class=\"crayon-c\">   */</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d42793296726042-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p><!-- [Format Time: 0.0017 seconds] --></p>\n<p>这是它的4个成员变量</p>\n<ul>\n<li>BitArrays是定义在BloomFilterStrategies中的内部类，封装了布隆过滤器底层bit数组的操作，后文详述；</li>\n<li>numHashFunctions表示哈希函数的个数，即上文提到的k；</li>\n<li>Funnel，这是Guava中定义的一个接口，它和PrimitiveSink配套使用，主要是把任意类型的数据转化成Java基本数据类型（primitive value，如char，byte，int……），默认用java.nio.ByteBuffer实现，最终均转化为byte数组；</li>\n<li>Strategy是定义在BloomFilter类内部的接口，代码如下，有3个方法，put（插入元素），mightContain（判定元素是否存在）和ordinal方法（可以理解为枚举类中那个默认方法）</li>\n</ul>\n<p><!-- [Format Time: 0.0029 seconds] --></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d4279f515457631\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Strategy extends java.io.Serializable {\r\n\r\n    /**\r\n     * Sets {@ code numHashFunctions} bits of the given bit array, by hashing a user element.\r\n     *\r\n     * &lt;p&gt;Returns whether any bits changed as a result of this operation.\r\n     */\r\n    &lt;T&gt; boolean put(T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits);\r\n\r\n    /**\r\n     * Queries {@ code numHashFunctions} bits of the given bit array, by hashing a user element;\r\n     * returns {@ code true} if and only if all selected bits are set.\r\n     */\r\n    &lt;T&gt; boolean mightContain(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits);\r\n\r\n    /**\r\n     * Identifier used to encode this strategy, when marshalled as part of a BloomFilter. Only\r\n     * values in the [-128, 127] range are valid for the compact serial form. Non-negative values\r\n     * are reserved for enums defined in BloomFilterStrategies; negative values are reserved for any\r\n     * custom, stateful strategy we may define (e.g. any kind of strategy that would depend on user\r\n     * input).\r\n     */\r\n    int ordinal();\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d4279f515457631-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d4279f515457631-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Serializable</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-4\"><span class=\"crayon-c\">     * Sets {@ code numHashFunctions} bits of the given bit array, by hashing a user element.</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-5\"><span class=\"crayon-c\">     *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-6\"><span class=\"crayon-c\">     * &lt;p&gt;Returns whether any bits changed as a result of this operation.</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-7\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-11\"><span class=\"crayon-c\">     * Queries {@ code numHashFunctions} bits of the given bit array, by hashing a user element;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-12\"><span class=\"crayon-c\">     * returns {@ code true} if and only if all selected bits are set.</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-13\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-18\"><span class=\"crayon-c\">     * Identifier used to encode this strategy, when marshalled as part of a BloomFilter. Only</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-19\"><span class=\"crayon-c\">     * values in the [-128, 127] range are valid for the compact serial form. Non-negative values</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-20\"><span class=\"crayon-c\">     * are reserved for enums defined in BloomFilterStrategies; negative values are reserved for any</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-21\"><span class=\"crayon-c\">     * custom, stateful strategy we may define (e.g. any kind of strategy that would depend on user</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-22\"><span class=\"crayon-c\">     * input).</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-23\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d4279f515457631-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ordinal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d4279f515457631-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>对于创建布隆过滤器，BloomFilter并没有公有的构造函数，只有一个私有构造函数，而对外它提供了5个重载的create方法，在缺省情况下误判率设定为3%，采用BloomFilterStrategies.MURMUR128_MITZ_64的实现。其中4个create方法最终都调用了同一个create方法，由它来负责调用私有构造函数，其源码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d427a4832561951\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic &lt;T&gt; BloomFilter&lt;T&gt; create(\r\n      Funnel&lt;? super T&gt; funnel, long expectedInsertions, double fpp, Strategy strategy) {\r\n    checkNotNull(funnel);\r\n    checkArgument(\r\n        expectedInsertions &gt;= 0, \"Expected insertions (%s) must be &gt;= 0\", expectedInsertions);\r\n    checkArgument(fpp &gt; 0.0, \"False positive probability (%s) must be &gt; 0.0\", fpp);\r\n    checkArgument(fpp &lt; 1.0, \"False positive probability (%s) must be &lt; 1.0\", fpp);\r\n    checkNotNull(strategy);\r\n\r\n    if (expectedInsertions == 0) {\r\n      expectedInsertions = 1;\r\n    }\r\n    /*\r\n     * TODO(user): Put a warning in the javadoc about tiny fpp values, since the resulting size\r\n     * is proportional to -log(p), but there is not much of a point after all, e.g.\r\n     * optimalM(1000, 0.0000000000000001) = 76680 which is less than 10kb. Who cares!\r\n     */\r\n    long numBits = optimalNumOfBits(expectedInsertions, fpp);\r\n    int numHashFunctions = optimalNumOfHashFunctions(expectedInsertions, numBits);\r\n    try {\r\n      return new BloomFilter&lt;T&gt;(new BitArray(numBits), numHashFunctions, funnel, strategy);\r\n    } catch (IllegalArgumentException e) {\r\n      throw new IllegalArgumentException(\"Could not create BloomFilter of \" + numBits + \" bits\", e);\r\n    }\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a4832561951-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a4832561951-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-2\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkNotNull</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Expected insertions (%s) must be &gt;= 0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"False positive probability (%s) must be &gt; 0.0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"False positive probability (%s) must be &lt; 1.0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkNotNull</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-14\"><span class=\"crayon-c\">     * TODO(user): Put a warning in the javadoc about tiny fpp values, since the resulting size</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-15\"><span class=\"crayon-c\">     * is proportional to -log(p), but there is not much of a point after all, e.g.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-16\"><span class=\"crayon-c\">     * optimalM(1000, 0.0000000000000001) = 76680 which is less than 10kb. Who cares!</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-17\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfBits</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfHashFunctions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-21\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numBits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IllegalArgumentException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-23\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IllegalArgumentException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Could not create BloomFilter of \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" bits\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a4832561951-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a4832561951-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p><!-- [Format Time: 0.0060 seconds] --></p>\n<p>在create中接受了4个参数，funnel（输入的数据），expectedInsertions（预计插入的元素总数），fpp（期望误判率），strategy（实现Strategy的实例），然后它计算了bit数组的长度以及哈希函数的个数（公式参考前文），最后用numBits创建了BitArray，并调用了构造函数完成赋值操作。</p>\n<p><!-- Crayon Syntax Highlighter v_2.7.2_beta --></p>\n<div id=\"crayon-5a446fa247293650434407\">\n<div>\n<div>\n<div title=\"Toggle Line Wrap\">\n<div title=\"Toggle Line Numbers\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d427a9699594589\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic long optimalNumOfBits(long n, double p) {\r\n    if (p == 0) {\r\n      p = Double.MIN_VALUE;\r\n    }\r\n    return (long) (-n * Math.log(p) / (Math.log(2) * Math.log(2)));\r\n  }\r\n\r\nstatic int optimalNumOfHashFunctions(long n, long m) {\r\n    // (m / n) * log(2), but avoid truncation due to division!\r\n    return Math.max(1, (int) Math.round((double) m / n * Math.log(2)));\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a9699594589-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a9699594589-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a9699594589-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a9699594589-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a9699594589-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a9699594589-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a9699594589-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a9699594589-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a9699594589-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427a9699594589-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427a9699594589-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d427a9699594589-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfBits</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a9699594589-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a9699594589-3\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Double</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MIN_VALUE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a9699594589-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a9699594589-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a9699594589-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a9699594589-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a9699594589-8\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfHashFunctions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a9699594589-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// (m / n) * log(2), but avoid truncation due to division!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427a9699594589-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">double</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427a9699594589-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n\n</div>\n<div title=\"Toggle Line Numbers\">接着再来看一下BloomFilterStrategies类，首先它是实现了BloomFilter.Strategy 接口的一个枚举类，其次它有两个2枚举值，MURMUR128_MITZ_32和MURMUR128_MITZ_64，分别对应了32位哈希映射函数，和64位哈希映射函数，后者使用了murmur3 hash生成的所有128位，具有更大的空间，不过原理是相通的，我们选择默认的MURMUR128_MITZ_64来分析：</div>\n<div title=\"Toggle Line Numbers\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d427ac892637216\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMURMUR128_MITZ_64() {\r\n    &lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n    public &lt;T&gt; boolean put(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits) {\r\n      long bitSize = bits.bitSize();\r\n      byte[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();\r\n      long hash1 = lowerEight(bytes);\r\n      long hash2 = upperEight(bytes);\r\n\r\n      boolean bitsChanged = false;\r\n      long combinedHash = hash1;\r\n      for (int i = 0; i &lt; numHashFunctions; i++) {\r\n        // Make the combined hash positive and indexable\r\n        bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);\r\n        combinedHash += hash2;\r\n      }\r\n      return bitsChanged;\r\n    }\r\n\r\n    @ Override\r\n    public &lt;T&gt; boolean mightContain(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits) {\r\n      long bitSize = bits.bitSize();\r\n      byte[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();\r\n      long hash1 = lowerEight(bytes);\r\n      long hash2 = upperEight(bytes);\r\n\r\n      long combinedHash = hash1;\r\n      for (int i = 0; i &lt; numHashFunctions; i++) {\r\n        // Make the combined hash positive and indexable\r\n        if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {\r\n          return false;\r\n        }\r\n        combinedHash += hash2;\r\n      }\r\n      return true;\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427ac892637216-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427ac892637216-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-1\"><span class=\"crayon-e\">MURMUR128_MITZ_64</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-n\">@Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytesInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Make the combined hash positive and indexable</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-17\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-21\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-23\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-24\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytesInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Make the combined hash positive and indexable</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-32\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-35\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427ac892637216-36\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427ac892637216-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0075 seconds] -->\r\n\n</div>\n</div>\n</div>\n</div>\n</div>\n<p><!-- [Format Time: 0.0074 seconds] --></p>\n<p>抽象来看，put是写，mightContain是读，两个方法的代码有一点相似，都是先利用murmur3 hash对输入的funnel计算得到128位的字节数组，然后高低分别取8个字节（64位）创建2个long型整数hash1，hash2作为哈希值。循环体内采用了2个函数模拟其他函数的思想，即上文提到的gi(x) = h1(x) + ih2(x) ，这相当于每次累加hash2，然后通过基于bitSize取模的方式在bit数组中索引。</p>\n<blockquote><p>这里之所以要和Long.MAX_VALUE进行按位与的操作，是因为在除数和被除数符号不一致的情况下计算所得的结果是有差别的，在程序语言里，“%”准确来说是取余运算（C，C++和Java均如此，python是取模），如-5%3=-2，而取模的数学定义是x mod y=x-y[x/y]（向下取整），所以-5 mod 3= -5-3*(-2)=1，因此当哈希值为负数的时候，其取余的结果为负（bitSize始终为正数），这样就不方便在bit数组中取值，因此通过Long.MAX_VALUE(二进制为0111…1111)，直接将开头的符号位去掉，从而转变为正数。当然也可以取绝对值，在另一个MURMUR128_MITZ_32的实现中就是这么做的。</p></blockquote>\n<p>在put方法中，先是将索引位置上的二进制置为1，然后用bitsChanged记录插入结果，如果返回true表明没有重复插入成功，而mightContain方法则是将索引位置上的数值取出，并判断是否为0，只要其中出现一个0，那么立即判断为不存在。</p>\n<p>最后再说一下底层bit数组的实现，主要代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d427b2075902917\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n static final class BitArray {\r\n    final long[] data;\r\n    long bitCount;\r\n\r\n    BitArray(long bits) {\r\n      this(new long[Ints.checkedCast(LongMath.divide(bits, 64, RoundingMode.CEILING))]);\r\n    }\r\n\r\n    // Used by serialization\r\n    BitArray(long[] data) {\r\n      checkArgument(data.length &gt; 0, \"data length is zero!\");\r\n      this.data = data;\r\n      long bitCount = 0;\r\n      for (long value : data) {\r\n        bitCount += Long.bitCount(value);\r\n      }\r\n      this.bitCount = bitCount;\r\n    }\r\n\r\n    /** Returns true if the bit changed value. */\r\n    boolean set(long index) {\r\n      if (!get(index)) {\r\n        data[(int) (index &gt;&gt;&gt; 6)] |= (1L &lt;&lt; index);\r\n        bitCount++;\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n\r\n    boolean get(long index) {\r\n      return (data[(int) (index &gt;&gt;&gt; 6)] &amp; (1L &lt;&lt; index)) != 0;\r\n    }\r\n\r\n    /** Number of bits */\r\n    long bitSize() {\r\n      return (long) data.length * Long.SIZE;\r\n    }\r\n...\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b2075902917-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b2075902917-39\">39</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Ints</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">checkedCast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LongMath</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">divide</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RoundingMode</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CEILING</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Used by serialization</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"data length is zero!\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-13\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-17\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Returns true if the bit changed value. */</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1L</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-31\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1L</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Number of bits */</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-36\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIZE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b2075902917-38\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b2075902917-39\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0057 seconds] -->\r\n<p>之前也提到了Guava没有使用java.util.BitSet，而是封装了一个long型的数组，另外还有一个long型整数，用来统计数组中已经占用（置为1）的数量，在第一个构造函数中，它把传入的long型整数按长度64分段（例如129分为3段），段数作为数组的长度，你可以想象成由若干个64位数组拼接成一个超长的数组，它的长度就是64乘以段数，即bitSize，在第二个构造函数中利用Long.bitCount方法来统计对应二进制编码中的1个数，这个方法在JDK1.5中就有了，其算法设计得非常精妙，有精力的同学可以自行研究。</p>\n<p>另外两个重要的方法是set和get，在get方法中，参考put和mightContain方法，传入的参数index是经过bitSize取模的，因此一定能落在这个超长数组的范围之内，为了获取index对应索引位置上的值，首先将其无符号右移6位，并且强制转换成int型，这相当于除以64向下取整的操作，也就是换算成段数，得到该段上的数值之后，又将1左移index位，最后进行按位与的操作，如果结果等于0，那么返回false，从而在mightContain中判断为不存在。在set方法中，首先调用了get方法判断是否已经存在，如果不存在，则用同样的逻辑取出data数组中对应索引位置的数值，然后按位或并赋值回去。</p>\n<p>到这里，对Guava中布隆过滤器的实现就基本讨论完了，简单总结一下：</p>\n<p>1.BloomFilter类的作用在于接收输入，利用公式完成对参数的估算，最后初始化Strategy接口的实例；</p>\n<p>2.BloomFilterStrategies是一个枚举类，具有两个实现了Strategy接口的成员，分别为MURMUR128_MITZ_32和MURMUR128_MITZ_64，另外封装了long型的数组作为布隆过滤器底层的bit数组，其中在get和set方法中完成核心的位运算。</p>\n<h2>三、利用Redis Bitmaps进行重构</h2>\n<p>通过上面的分析，主要算法和逻辑的部分大体都是一样的，真正需要重构的部分是底层位数组的实现，在Guava中是封装了一个long型的数组，而对于redis来说，本身自带了Bitmaps的“数据结构”（本质上还是一个字符串），已经提供了位操作的接口，因此重构本身并不复杂，相对比较复杂的是，之前提到的实现自动扩容特性。</p>\n<p>这里实现自动扩容的思想是，在redis中记录一个自增的游标cursor，如果当前key对应的Bitmaps已经达到饱和状态，则cursor自增，同时用其生成一个新的key，并创建规模同等的Bitmaps。然后在get的时候，需要判断该元素是否存在于任意一个Bitmaps中。于是整个的逻辑就变成，一个元素在每个Bitmaps中都不存在时，才能插入当前cursor对应key的Bitmaps中。</p>\n<p><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/12/QQ20171224-003813.png\" alt=\"\" width=\"801\" height=\"352\"></p>\n<p>下面是代码的实现部分。</p>\n<p>首先，为了简化redis的操作，定义了2个函数式接口，分别执行单条命令和pipeline，另外还实现了一个简单的工具类</p>\n<p><!-- Crayon Syntax Highlighter v_2.7.2_beta --></p>\n<div id=\"crayon-5a446fa2472ad605895102\">\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d427b8431480496\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@FunctionalInterface\r\npublic interface JedisExecutor&lt;T&gt; {\r\n    T execute(Jedis jedis);\r\n}\r\n\r\n@FunctionalInterface\r\npublic interface PipelineExecutor {\r\n    void load(Pipeline pipeline);\r\n}\r\n\r\npublic class JedisUtils {\r\n\r\n    private static final GenericObjectPoolConfig poolConfig = new GenericObjectPoolConfig();\r\n\r\n    private JedisPool jedisPool;\r\n\r\n    public JedisUtils() {\r\n        jedisPool = new JedisPool(poolConfig, \"localhost\", 6379);\r\n    }\r\n\r\n    public &lt;T&gt; T execute(JedisExecutor&lt;T&gt; jedisExecutor) {\r\n        try (Jedis jedis = jedisPool.getResource()) {\r\n            return jedisExecutor.execute(jedis);\r\n        }\r\n    }\r\n\r\n    public List&lt;Object&gt; pipeline(List&lt;PipelineExecutor&gt; pipelineExecutors) {\r\n        try (Jedis jedis = jedisPool.getResource()) {\r\n            Pipeline pipeline = jedis.pipelined();\r\n            for (PipelineExecutor executor : pipelineExecutors)\r\n                executor.load(pipeline);\r\n            return pipeline.syncAndReturnAll();\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427b8431480496-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427b8431480496-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-1\"><span class=\"crayon-n\">@FunctionalInterface</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisExecutor</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-6\"><span class=\"crayon-n\">@FunctionalInterface</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-7\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PipelineExecutor</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Pipeline </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-11\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GenericObjectPoolConfig </span><span class=\"crayon-v\">poolConfig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GenericObjectPoolConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">poolConfig</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"localhost\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-20\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">JedisExecutor</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisExecutor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisExecutor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-26\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-e \">&lt;Object&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pipeline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">List</span><span class=\"crayon-e \">&lt;PipelineExecutor&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelineExecutors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Pipeline </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pipelined</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-v\">executor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelineExecutors</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">syncAndReturnAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427b8431480496-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427b8431480496-35\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<br>\n其次在Strategy中，对put和mightContain作了一点修改，其中被注释的部分是Guava中的实现。为了简化，这里我们只接受String对象。\n<p>这里先把所有的随机函数对应的索引位置收集到一个数组中，然后交由底层的RedisBitmaps处理get或set，具体过程后面会详细说明。</p>\n<p>bits.ensureCapacityInternal()方法，即表示自动扩容，这个函数名是从ArrayList中搬过来的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d427bc524476656\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    @ Override\r\n    public boolean put(String string, int numHashFunctions, RedisBitmaps bits) {\r\n        long bitSize = bits.bitSize();\r\n        byte[] bytes = Hashing.murmur3_128().hashString(string, Charsets.UTF_8).asBytes();\r\n        long hash1 = lowerEight(bytes);\r\n        long hash2 = upperEight(bytes);\r\n\r\n        boolean bitsChanged = false;\r\n        long combinedHash = hash1;\r\n//        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n//            bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);\r\n//            combinedHash += hash2;\r\n//        }\r\n        long[] offsets = new long[numHashFunctions];\r\n        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n            offsets[i] = (combinedHash &amp; Long.MAX_VALUE) % bitSize;\r\n            combinedHash += hash2;\r\n        }\r\n        bitsChanged = bits.set(offsets);\r\n        bits.ensureCapacityInternal();//自动扩容\r\n        return bitsChanged;\r\n    }\r\n\r\n    @ Override\r\n    public boolean mightContain(String object, int numHashFunctions, RedisBitmaps bits) {\r\n        long bitSize = bits.bitSize();\r\n        byte[] bytes = Hashing.murmur3_128().hashString(object, Charsets.UTF_8).asBytes();\r\n        long hash1 = lowerEight(bytes);\r\n        long hash2 = upperEight(bytes);\r\n        long combinedHash = hash1;\r\n//        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n//            if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {\r\n//                return false;\r\n//            }\r\n//            combinedHash += hash2;\r\n//        }\r\n//        return true;\r\n        long[] offsets = new long[numHashFunctions];\r\n        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n            offsets[i] = (combinedHash &amp; Long.MAX_VALUE) % bitSize;\r\n            combinedHash += hash2;\r\n        }\r\n        return bits.get(offsets);\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427bc524476656-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427bc524476656-44\">44</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-2\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-10\"><span class=\"crayon-c\">//        for (int i = 0; i &lt; numHashFunctions; i++) {</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-11\"><span class=\"crayon-c\">//            bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-12\"><span class=\"crayon-c\">//            combinedHash += hash2;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-13\"><span class=\"crayon-c\">//        }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensureCapacityInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//自动扩容</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-31\"><span class=\"crayon-c\">//        for (int i = 0; i &lt; numHashFunctions; i++) {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-32\"><span class=\"crayon-c\">//            if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-33\"><span class=\"crayon-c\">//                return false;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-34\"><span class=\"crayon-c\">//            }</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-35\"><span class=\"crayon-c\">//            combinedHash += hash2;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-36\"><span class=\"crayon-c\">//        }</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-37\"><span class=\"crayon-c\">//        return true;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427bc524476656-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427bc524476656-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0080 seconds] -->\r\n<p>最后，也是最重要的RedisBitmaps，其中bitSize用了Guava布隆过滤器中计算Long型数组长度的方法，得到bitSize之后使用setbit命令初始化一个全部为0的位数组。get(long offset)和set(long offset)，这两个与Guava布隆过滤器中的逻辑类似，这里就不再赘述了，而get(long[] offsets)方法中，所有的offset要与每一个cursor对应的Bitmaps进行判断，若全部命中，那么这个元素就可能存在于该Bitmaps，反之若不能完全命中，则表示该元素不存在于任何一个Bitmaps，所以当满足这个条件，在set(long[] offsets)方法中，就可以插入到当前key的Bitmaps中了。</p>\n<p>在ensureCapacityInternal方法，判断需要扩容的条件是bitCount*2&gt;bitSize，bitCount表示一个Bitmaps中“1”出现的个数，也就是当“1”出现的个数超过总数的一半时，进行扩容操作——首先使用incr命令对cursor自增，然后使用新的key创建一个新的Bitmaps。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d427c2270323757\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RedisBitmaps {\r\n\r\n    private static final String BASE_KEY = \"bloomfilter\";\r\n    private static final String CURSOR = \"cursor\";\r\n\r\n    private JedisUtils jedisUtils;\r\n    private long bitSize;\r\n\r\n    RedisBitmaps(long bits) {\r\n        this.jedisUtils = new JedisUtils();\r\n        this.bitSize = LongMath.divide(bits, 64, RoundingMode.CEILING) * Long.SIZE;//位数组的长度，相当于n个long的长度\r\n        if (bitCount() == 0) {\r\n            jedisUtils.execute((jedis -&gt; jedis.setbit(currentKey(), bitSize - 1, false)));\r\n        }\r\n    }\r\n\r\n   boolean get(long[] offsets) {\r\n        for (long i = 0; i &lt; cursor() + 1; i++) {\r\n            final long cursor = i;\r\n            //只要有一个cursor对应的bitmap中，offsets全部命中，则表示可能存在\r\n            boolean match = Arrays.stream(offsets).boxed()\r\n                    .map(offset -&gt; jedisUtils.execute(jedis -&gt; jedis.getbit(genkey(cursor), offset)))\r\n                    .allMatch(b -&gt; (Boolean) b);\r\n            if (match)\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    boolean get(final long offset) {\r\n        return jedisUtils.execute(jedis -&gt; jedis.getbit(currentKey(), offset));\r\n    }\r\n\r\n    boolean set(long[] offsets) {\r\n        if (cursor() &gt; 0 &amp;&amp; get(offsets)) {\r\n            return false;\r\n        }\r\n        boolean bitsChanged = false;\r\n        for (long offset : offsets)\r\n            bitsChanged |= set(offset);\r\n        return bitsChanged;\r\n    }\r\n\r\n    boolean set(long offset) {\r\n        if (!get(offset)) {\r\n            jedisUtils.execute(jedis -&gt; jedis.setbit(currentKey(), offset, true));\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    long bitCount() {\r\n        return jedisUtils.execute(jedis -&gt; jedis.bitcount(currentKey()));\r\n    }\r\n\r\n    long bitSize() {\r\n        return this.bitSize;\r\n    }\r\n\r\n    private String currentKey() {\r\n        return genkey(cursor());\r\n    }\r\n\r\n    private String genkey(long cursor) {\r\n        return BASE_KEY + \"-\" + cursor;\r\n    }\r\n\r\n    private Long cursor() {\r\n        String cursor = jedisUtils.execute(jedis -&gt; jedis.get(CURSOR));\r\n        return cursor == null ? 0 : Longs.tryParse(cursor);\r\n    }\r\n\r\n    void ensureCapacityInternal() {\r\n        if (bitCount() * 2 &gt; bitSize())\r\n            grow();\r\n    }\r\n\r\n    void grow() {\r\n        Long cursor = jedisUtils.execute(jedis -&gt; jedis.incr(CURSOR));\r\n        jedisUtils.execute((jedis -&gt; jedis.setbit(genkey(cursor), bitSize - 1, false)));\r\n    }\r\n\r\n    void reset() {\r\n        String[] keys = LongStream.range(0, cursor() + 1).boxed().map(this::genkey).toArray(String[]::new);\r\n        jedisUtils.execute(jedis -&gt; jedis.del(keys));\r\n        jedisUtils.execute(jedis -&gt; jedis.set(CURSOR, \"0\"));\r\n        jedisUtils.execute(jedis -&gt; jedis.setbit(currentKey(), bitSize - 1, false));\r\n    }\r\n\r\n    private PipelineExecutor apply(PipelineExecutor executor) {\r\n        return executor;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c2270323757-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c2270323757-93\">93</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BASE_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bloomfilter\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursor\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">RedisBitmaps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LongMath</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">divide</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RoundingMode</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CEILING</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIZE</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//位数组的长度，相当于n个long的长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-17\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//只要有一个cursor对应的bitmap中，offsets全部命中，则表示可能存在</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-22\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-23\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allMatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Boolean</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-25\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-43\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitcount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-55\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-59\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BASE_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Longs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tryParse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-72\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ensureCapacityInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-75\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">grow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-77\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">incr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-80\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-82\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LongStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">genkey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">new</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">del</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-e\">apply</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c2270323757-92\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c2270323757-93\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0161 seconds] -->\r\n<p>下面我们做一个单元测试来验证其正确性。</p>\n<p>如果我们插入的数量等于原预计总数，RedisBloomFilter扩容了1次，而两个布隆过滤器的结果一致，都为false,true,false。</p>\n<p>如果插入的数量为原预计总数的3倍，RedisBloomFilter扩容了3次，并且仍判断正确，而Guava布隆过滤器则在判断str3时出现误判。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69040d427c7978411803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class TestRedisBloomFilter {\r\n\r\n    private static final int TOTAL = 10000;\r\n    private static final double FPP = 0.0005;\r\n\r\n    @ Test\r\n    public void test() {\r\n        RedisBloomFilter redisBloomFilter = RedisBloomFilter.create(TOTAL, FPP);\r\n        redisBloomFilter.resetBitmap();\r\n        BloomFilter&lt;String&gt; bloomFilter = BloomFilter.create(Funnels.stringFunnel(Charsets.UTF_8), TOTAL, FPP);\r\n\r\n        IntStream.range(0, /* 3* */TOTAL).boxed()\r\n                .map(i -&gt; Hashing.md5().hashInt(i).toString())\r\n                .collect(toList()).forEach(s -&gt; {\r\n            redisBloomFilter.put(s);\r\n            bloomFilter.put(s);\r\n        });\r\n\r\n        String str1 = Hashing.md5().hashInt(99999).toString();\r\n        String str2 = Hashing.md5().hashInt(9999).toString();\r\n        String str3 = \"abcdefghijklmnopqrstuvwxyz123456\";\r\n        System.out.println(redisBloomFilter.mightContain(str1) + \":\" + bloomFilter.mightContain(str1));\r\n        System.out.println(redisBloomFilter.mightContain(str2) + \":\" + bloomFilter.mightContain(str2));\r\n        System.out.println(redisBloomFilter.mightContain(str3) + \":\" + bloomFilter.mightContain(str3));\r\n    }\r\n}\r\n&gt;&gt;\r\ngrow bloomfilter-1\r\nfalse:false\r\ntrue:true\r\nfalse:false\r\n&gt;&gt;\r\ngrow bloomfilter-1\r\ngrow bloomfilter-2\r\ngrow bloomfilter-3\r\nfalse:false\r\ntrue:true\r\nfalse:true</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a69040d427c7978411803-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69040d427c7978411803-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TestRedisBloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0005</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">RedisBloomFilter </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resetBitmap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;String&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stringFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">IntStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 3* */</span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">collect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">toList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">99999</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">9999</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"abcdefghijklmnopqrstuvwxyz123456\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-27\"><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-28\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-29\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-30\"><span class=\"crayon-t\">true</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-31\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-32\"><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-33\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-34\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-35\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-36\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5a69040d427c7978411803-37\"><span class=\"crayon-t\">true</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69040d427c7978411803-38\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0069 seconds] -->\r\n<p>综上，本文利用了Guava布隆过滤器的思想，并结合Redis中的Bitmaps等特性实现了支持动态扩容的布隆过滤器，它将布隆过滤器底层的位数据装载到了Redis数据库中，这样的好处在于可以部署在更复杂的多应用或分布式系统中，还可以利用Redis完成持久化，定时过期等功能。</p>\n<p><strong>四、参考文献</strong></p>\n<ol>\n<li>吴军. 数学之美[M]. 人民邮电出版社, 2012.</li>\n<li>Kirsch A, Mitzenmacher M. Less hashing, same performance: building a better bloom filter[C]//ESA. 2006, 6: 456-467.</li>\n<li>Bloom Filters for the Perplexed, https://sagi.io/2017/07/bloom-filters-for-the-perplexed/</li>\n<li>Google Guava, https://github.com/google/guava</li>\n</ol>\n</div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113396\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113396votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113396\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">\r\n\t\t\t<img src=\"http://tp2.sinaimg.cn/2233098320/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            会当凌绝顶，一览众山小——全栈之路        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2653yy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2653yy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 7</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.fullstackyang.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2653yy\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113396/", "comment_nums": 0, "create_date": "2017/12/30", "tags": "开发,Bitmaps,BloomFilter,Guava,Redis,布隆过滤器", "url_object_id": "e8eb842f84448b7433a380c11c41c941", "front_image_path": "full/98bb9228f02f68efac9268ed6a26dad9a00ce1c5.jpg"}
{"fav_nums": 3, "praise_nums": "1", "title": "浅谈重构中踩过的坑", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/93e463354f2ead2ca7ccb6a636eec994.png"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/chanshuyi/p/7832360.html\">陈树义</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/93e463354f2ead2ca7ccb6a636eec994.png\"></p>\n<p>最近重构了公司一个将近10年的核心功能模块，踩了不少坑。在做这个重构的时候好几次都觉得做不下去，好几次压力都非常大，心想着我该不会做着做着就退出编程届了吧。</p>\n<p>不过还好，自己还是坚持下来了，回想写这个项目的时候自己曾三次推翻重来，那种心路历程真的只有经历了才知道，真是煎熬。后来回想起这一路踩过的坑，其实更多的是经验问题，而不是技术方面的问题。</p>\n<h2 id=\"关于心态\">关于心态</h2>\n<p>回顾做这个项目，我觉得心态问题是最重要的，技术问题倒是其次。为什么这么说呢？因为对于10余年的老功能模块来说，其中最复杂的其实是业务逻辑，而并非技术实现。所以对于老系统的重构，你首先需要将这十余年来积淀在该模块的业务逻辑梳理清楚，这本身就给了重构者一个无形的压力。再加上又是核心业务模块，少一点业务逻辑就会导致线上收入的减少，最后就是程序员祭天的悲惨命运。这一系列的背景，使得重构之时心理压力真的很大。</p>\n<p>现在回头来看，对于重构项目，最好的方式还是先仔仔细细梳理清楚所有的业务逻辑，之后将其用<strong>思维导图</strong>画出来，这样你会对这十几年来的业务逻辑一清二楚。清楚了业务逻辑，对于你后面进行系统重新设计以及编码都是大有裨益的，甚至是起决定性作用的一环。</p>\n<p>说到心态这个话题，无论是做什么项目，即使是重构，也会涉及到排期问题。有时候很可能你自己还没完全了解业务逻辑之时，上级就要你给出一个排期，这时候其实作为重构者是很为难的。对于这种情况，其实我建议还是与上级做好充分的沟通，如果能延长给排期的时间是最好的。如果不能，那应该主动上报每天的进度，让上级知道你的进展。其实要你给出排期，不就是为了掌控进度吗。</p>\n<p>当你给出排期后，很可能会出现了许多当时预估排期时没有出现的情况，这时候一般我们有两种选择：一种是急急忙忙草草处理了事，另一种则是稳定心态思考最好的解决方式。其实当你发觉另一种做法是更好的处理方式，但这种方式在目前排期下无法完成，这时候作为整体功能的开发重构人，你应该有自己的判断。即使是因为做了这件事情而延期，但只要你做的这件事情是对的，有利于系统拓展性和稳定性的，那还是应该坚持自己的选择。<strong>我想，如果你因为正确的坚持而延期，我想公司并不会因此而责怪，只要你给出了自己的理由。最怕的是惊慌失措地写完一个东西，而这东西又漏洞百出。</strong></p>\n<p>所以有时候觉得开发或重构一个系统真的是得抱着必死的决心，这样才能有自己的坚持，而不会在上级的排期压力之下做出错误的选择。特别对于重构类的项目，如果没有一个从容的心态，那系统是肯定做不好的。</p>\n<h2 id=\"关于技巧\">关于技巧</h2>\n<p>我觉得重构中的经验技巧远重要于技术实力，因为一个经验可以让你减少很多不必要的麻烦。在说出我的心得之前，我想问一个问题：</p>\n<p>在你重构的时候遇到一个问题，这个问题解决了会更好，但不解决也不会影响到此次项目的结果。请问，此时你是解决这个问题，还是不解决好？</p>\n<p>有些人会分析：这要看情况，如果我有时间我会去解决，如果没有时间，那我就会跳过它。一般会给出这种答案的人，都是理论上的巨人，行动上的矮子，基本可以断定没有经历过实战。因为其分析很符合马克思主义的辩证主义思想啊，这也确实没错。但这样的解决方式对于实际情况是不够有用的。</p>\n<p>对于这种情况，我建议是不做。准确地说：<strong>对于任何不影响你达成重构目标的事情，能不做就不做。因为你永远不知道这个坑到底有多深！</strong>在你并不知道坑有多深，而此时又有排期（追兵）在后面，这时候最聪明的做法就是不做。等你把必须做的做完了，你再回头来看看这个问题，如果你可以解决，那就尝试着解决。但如果此时你发现坑真的很深，你可以果断返回，这时你其实已经做完了事情，并不会有排期的压力了。这样的做法给自己留足了后路，自己可进可退，可攻可守。但如果你一开始就选择踩这个坑，那么可能你会让自己陷入泥潭。</p>\n<p><strong>所以建议大家在不清楚的情况下不做，不是叫大家做事懒惰。而是让大家明白自己的目的是什么，在资源（时间）有限的情况下把事情做成。</strong></p>\n<h2 id=\"关于技术\">关于技术</h2>\n<p>技术是放最后的，因为我确实觉得技术在重构中并不是特别重要。至少在我这次重构中，我基本上60%的工作都是因为我的心态或技巧不足导致的重复劳动。我项目中重构涉及到的技术，我只用了不到10%的时间就完成了。回头想一想，真是觉得好凄凉。</p>\n<p>重构中的技术其实更多的是使用设计模式将复杂的业务逻辑用简洁的代码呈现出来。<strong>简单点来说，就是用设计模式承载复杂的业务逻辑，尽可能使写出的代码简洁。</strong></p>\n<p>怎么样才是一个好的系统重构呢？其实有一句话说得特别好：<strong>对拓展开放，对修改封闭。</strong>意思就是说别人只能拓展你的代码，而不能修改你的代码。很多老系统为什么会越来越复杂？逻辑越来越多？原因就是他写的代码允许别人进行修改。这么说可能会很抽象，我们举个例子说吧。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258eec529681035508\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif(type == apple){\r\n    //deal with apple \r\n} else if (type == banana){\r\n    //deal with banana\r\n} else if (type == ......){\r\n    //......\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258eec529681035508-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec529681035508-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec529681035508-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec529681035508-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec529681035508-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec529681035508-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec529681035508-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258eec529681035508-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec529681035508-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//deal with apple </span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec529681035508-3\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">banana</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec529681035508-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//deal with banana</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec529681035508-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec529681035508-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//......</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec529681035508-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>上面这段代码模拟的是对于水果剥皮的处理程序。如果是苹果，那么是一种拨皮方法；如果是香蕉，则是另一种剥皮方法。如果以后还需要处理其他水果，那么就会在后面加上很多 if else 语句，最终会让整个方法变得又臭又长。如果恰好这个水果中的不同品种有不同的剥皮方法，那么这里面又会有很多层嵌套。</p>\n<p>可以看得出来，上面这样的代码并没有满足「对拓展开放，对修改封闭」的原则。每次需要新增一种水果，都可以直接在原来的代码上进行修改。久而久之，整个代码块就会变得又臭又长。</p>\n<p>如果我们对剥水果皮这件事情做一个抽象，剥苹果皮是一个具体的实现，剥香蕉皮是一个具体的实现，那么写出的代码会是这样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a69258eec539370742279\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic interface PeelOff {\r\n    void peelOff();\r\n}\r\n\r\npublic class ApplePeelOff implement PeelOff{\r\n    void peelOff(){\r\n        //deal with apple\r\n    }\r\n}\r\n\r\npublic class BananaPeelOff implement PeelOff{\r\n    void peelOff(){\r\n        //deal with banan\r\n    }\r\n}\r\n\r\npublic class PeelOffFactory{\r\n    private Map&lt;String, PeelOff&gt; map = new HashMap();\r\n\r\n    private init(){\r\n        //init all the Class that implements PeelOff interface \r\n      }\r\n}\r\n\r\n.....\r\n\r\npublic static void main(){\r\n    String type = \"apple\";\r\n    PeelOff peelOff = PeelOffFactory.getPeelOff(type);  //get ApplePeelOff Class Instance.\r\n    peelOff.pealOff();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a69258eec539370742279-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a69258eec539370742279-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PeelOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">peelOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-5\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplePeelOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implement</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PeelOff</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">peelOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//deal with apple</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-11\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BananaPeelOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implement</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PeelOff</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">peelOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//deal with banan</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-17\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PeelOffFactory</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PeelOff</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HashMap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//init all the Class that implements PeelOff interface </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-23\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-24\"> </div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-25\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-26\"> </div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-27\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apple\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">PeelOff </span><span class=\"crayon-v\">peelOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PeelOffFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getPeelOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//get ApplePeelOff Class Instance.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a69258eec539370742279-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">peelOff</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pealOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a69258eec539370742279-31\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>上面这种实现方式使得别人无法修改我们的代码，为什么？</p>\n<p>因为当需要对西瓜剥皮的时候，他会发现他只能新增一个类实现 PeelOff 接口，而无法再原来的代码上修改。这样就实现了「对拓展开放，对修改封闭」的原则。</p>\n<p>其实上面这种设计模式是最基本的设计模式：抽象设计模式。对于各种复杂的业务情形，还有其他许多设计模式，例如：代理模式、装饰模式等等。但各种模式归根到底还是考察你对业务的理解能力以及抽象能力，如果你对业务足够理解，你即使不知道某个设计模式，你也会写着写着写出这样一个设计模式。</p>\n<h2 id=\"总结\">总结</h2>\n<p>此时重构的经历让我觉得十分痛苦，但熬过来了就觉得没什么了。忽然感叹道重构还是很有技巧性的，对于技术要求反而没有那么高。重构更多考验的是对业务的深入理解，对抽象思维的进一步运用。如果业务理解深入，有抽象的思维，那设计模式还可以一点点学出来。而如果反过来，则没有办法做下去。</p>\n<p>重构何其苦，且做且前行。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113355\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113355votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113355\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url": "http://blog.jobbole.com/113355/", "comment_nums": 1, "create_date": "2017/12/20", "tags": "IT技术,重构", "url_object_id": "85a1563f08476f99dd846fd88f85ca11", "front_image_path": "full/b814d46e0e4369d6fba5adf938c13795fd668c05.jpg"}
